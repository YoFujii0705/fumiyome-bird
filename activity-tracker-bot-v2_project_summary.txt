# activity-tracker-bot-v2

## Directory Structure

- activity-tracker-bot-v2/
  - debug_test.js
  - handlers/
    - searchHandler.js
    - activityHandler.js
    - reportsHandler.js
    - bookHandler.js
    - goalsHandler.js
    - statsHandler.js
    - reportHandler.js
    - movieHandler.js
  - generate-project-summary/
    - LICENSE
    - README.md
  - services/
    - goalService.js.error_backup
    - goalService.js
    - notifications.js
    - statistics.js
    - statsUtility.js
    - googleSheets.js
  - config/
    - constants.js
    - database.js
  - check_sheets_connection.js
  - commands/
    - report.js
    - reports.js
    - activity.js
    - book.js
    - search.js
    - movie.js
    - stats.js
    - goals.js
  - devug_test.js
  - index.js
  - utils/
    - helpers.js
    - embedUtils.js
    - errorHandler.js
    - helper.js
    - logger.js
    - formatUtils.js
    - dateUtils.js
  - packeage.json
  - update_handlers_for_sheets.js

## File Contents

### debug_test.js

```
// debug_test.js - Google Sheetsã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
const GoogleSheetsService = require('./services/googleSheets');

async function testGoogleSheetsService() {
  console.log('=== Google Sheets Service ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
  
  try {
    // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
    const sheetsService = new GoogleSheetsService();
    console.log('âœ… GoogleSheetsService ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ');
    console.log('åˆ©ç”¨å¯èƒ½ãªãƒ¡ã‚½ãƒƒãƒ‰:', Object.getOwnPropertyNames(Object.getPrototypeOf(sheetsService)));
    
    // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    console.log('\n--- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ ---');
    const health = await sheetsService.healthCheck();
    console.log('ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çµæœ:', health);
    
    // getData ãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ç¢ºèª
    console.log('\n--- ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª ---');
    console.log('getData ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨:', typeof sheetsService.getData === 'function');
    console.log('updateData ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨:', typeof sheetsService.updateData === 'function');
    console.log('appendData ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨:', typeof sheetsService.appendData === 'function');
    
    // ç°¡å˜ãªãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
    console.log('\n--- ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ ---');
    try {
      const testData = await sheetsService.getData('books_master!A1:A5');
      console.log('âœ… getData ãƒ†ã‚¹ãƒˆæˆåŠŸ, ãƒ‡ãƒ¼ã‚¿:', testData?.length || 0, 'è¡Œ');
    } catch (error) {
      console.log('âŒ getData ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error.message);
    }
    
  } catch (error) {
    console.error('âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—:', error.message);
    console.error('ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹:', error.stack);
  }
  
  console.log('\n=== ãƒ†ã‚¹ãƒˆå®Œäº† ===');
}

// ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
testGoogleSheetsService().catch(console.error);

```

### handlers/searchHandler.js

```
const { EmbedBuilder } = require('discord.js');
const GoogleSheetsService = require('../services/googleSheets');

// GoogleSheetsServiceã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
const googleSheets = new GoogleSheetsService();

module.exports = {
  async execute(interaction) {
    const subcommand = interaction.options.getSubcommand();
    const keyword = interaction.options.getString('keyword');
    
    try {
      // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å‰å‡¦ç†ï¼ˆç©ºç™½ã®é™¤å»ãªã©ï¼‰
      const cleanKeyword = keyword.trim();
      
      if (cleanKeyword.length === 0) {
        await interaction.editReply('âŒ æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      
      if (cleanKeyword.length < 2) {
        await interaction.editReply('âŒ æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯2æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      
      switch (subcommand) {
        case 'book':
          await this.searchBooks(interaction, cleanKeyword);
          break;
        case 'movie':
          await this.searchMovies(interaction, cleanKeyword);
          break;
        case 'activity':
          await this.searchActivities(interaction, cleanKeyword);
          break;
        case 'all':
          await this.searchAll(interaction, cleanKeyword);
          break;
        default:
          await interaction.editReply(`âŒ ä¸æ˜ãªã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰: ${subcommand}`);
      }
    } catch (error) {
      console.error('SearchHandler ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async searchBooks(interaction, keyword) {
    try {
      const results = await googleSheets.searchBooks(keyword);
      
      if (results.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle(`ğŸ” æœ¬ã®æ¤œç´¢çµæœ: "${keyword}"`)
          .setColor('#9C27B0')
          .setDescription('è©²å½“ã™ã‚‹æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚')
          .addFields(
            { name: 'ğŸ’¡ æ¤œç´¢ã®ã‚³ãƒ„', value: 'â€¢ ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸€éƒ¨ã‚„ä½œè€…åã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„\nâ€¢ ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠã§ã‚‚è©¦ã—ã¦ã¿ã¦ãã ã•ã„\nâ€¢ ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã£ã¦è¤‡æ•°ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢', inline: false },
            { name: 'ğŸ“š æœ¬ã‚’è¿½åŠ ', value: '`/book add [ã‚¿ã‚¤ãƒˆãƒ«] [ä½œè€…]` ã§æ–°ã—ã„æœ¬ã‚’è¿½åŠ ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      // çµæœã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«åˆ†é¡
      const groupedResults = this.groupResultsByStatus(results, 'book');
      
      const embed = new EmbedBuilder()
        .setTitle(`ğŸ“š æœ¬ã®æ¤œç´¢çµæœ: "${keyword}"`)
        .setColor('#9C27B0')
        .setDescription(`${results.length}ä»¶ã®æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`)
        .setTimestamp();
      
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«è¡¨ç¤ºï¼ˆæœ€å¤§20ä»¶ï¼‰
      let totalDisplayed = 0;
      const maxDisplay = 20;
      
      Object.entries(groupedResults).forEach(([status, items]) => {
        if (items.length > 0 && totalDisplayed < maxDisplay) {
          const statusName = this.getStatusDisplayName('book', status);
          const displayItems = items.slice(0, Math.min(8, maxDisplay - totalDisplayed));
          const moreCount = items.length - displayItems.length;
          
          let fieldValue = displayItems.join('\n');
          if (moreCount > 0) {
            fieldValue += `\n... ä»–${moreCount}ä»¶`;
          }
          
          embed.addFields({
            name: `${statusName} (${items.length}ä»¶)`,
            value: fieldValue,
            inline: false
          });
          
          totalDisplayed += displayItems.length;
        }
      });
      
      if (results.length > maxDisplay) {
        embed.setFooter({ text: `${maxDisplay}ä»¶ã¾ã§è¡¨ç¤º (å…¨${results.length}ä»¶ä¸­)` });
      } else {
        embed.setFooter({ text: `å…¨${results.length}ä»¶ã‚’è¡¨ç¤º` });
      }
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æœ¬æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æœ¬ã®æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async searchMovies(interaction, keyword) {
    try {
      const results = await googleSheets.searchMovies(keyword);
      
      if (results.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle(`ğŸ” æ˜ ç”»ã®æ¤œç´¢çµæœ: "${keyword}"`)
          .setColor('#E91E63')
          .setDescription('è©²å½“ã™ã‚‹æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚')
          .addFields(
            { name: 'ğŸ’¡ æ¤œç´¢ã®ã‚³ãƒ„', value: 'â€¢ ã‚¿ã‚¤ãƒˆãƒ«ã®ä¸€éƒ¨ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„\nâ€¢ è‹±èªãƒ»æ—¥æœ¬èªã©ã¡ã‚‰ã§ã‚‚è©¦ã—ã¦ã¿ã¦ãã ã•ã„\nâ€¢ ã‚¸ãƒ£ãƒ³ãƒ«ã‚„å¹´ä»£ã§ã‚‚æ¤œç´¢å¯èƒ½', inline: false },
            { name: 'ğŸ¬ æ˜ ç”»ã‚’è¿½åŠ ', value: '`/movie add [ã‚¿ã‚¤ãƒˆãƒ«]` ã§æ–°ã—ã„æ˜ ç”»ã‚’è¿½åŠ ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      const groupedResults = this.groupResultsByStatus(results, 'movie');
      
      const embed = new EmbedBuilder()
        .setTitle(`ğŸ¬ æ˜ ç”»ã®æ¤œç´¢çµæœ: "${keyword}"`)
        .setColor('#E91E63')
        .setDescription(`${results.length}æœ¬ã®æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`)
        .setTimestamp();
      
      let totalDisplayed = 0;
      const maxDisplay = 20;
      
      Object.entries(groupedResults).forEach(([status, items]) => {
        if (items.length > 0 && totalDisplayed < maxDisplay) {
          const statusName = this.getStatusDisplayName('movie', status);
          const displayItems = items.slice(0, Math.min(8, maxDisplay - totalDisplayed));
          const moreCount = items.length - displayItems.length;
          
          let fieldValue = displayItems.join('\n');
          if (moreCount > 0) {
            fieldValue += `\n... ä»–${moreCount}ä»¶`;
          }
          
          embed.addFields({
            name: `${statusName} (${items.length}ä»¶)`,
            value: fieldValue,
            inline: false
          });
          
          totalDisplayed += displayItems.length;
        }
      });
      
      if (results.length > maxDisplay) {
        embed.setFooter({ text: `${maxDisplay}ä»¶ã¾ã§è¡¨ç¤º (å…¨${results.length}ä»¶ä¸­)` });
      } else {
        embed.setFooter({ text: `å…¨${results.length}ä»¶ã‚’è¡¨ç¤º` });
      }
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æ˜ ç”»æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ˜ ç”»ã®æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async searchActivities(interaction, keyword) {
    try {
      const results = await googleSheets.searchActivities(keyword);
      
      if (results.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle(`ğŸ” æ´»å‹•ã®æ¤œç´¢çµæœ: "${keyword}"`)
          .setColor('#00BCD4')
          .setDescription('è©²å½“ã™ã‚‹æ´»å‹•ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚')
          .addFields(
            { name: 'ğŸ’¡ æ¤œç´¢ã®ã‚³ãƒ„', value: 'â€¢ æ´»å‹•å†…å®¹ã®ä¸€éƒ¨ã§æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„\nâ€¢ é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ã‚‚è©¦ã—ã¦ã¿ã¦ãã ã•ã„\nâ€¢ ã‚«ãƒ†ã‚´ãƒªåï¼ˆå­¦ç¿’ã€é‹å‹•ãªã©ï¼‰ã§ã‚‚æ¤œç´¢å¯èƒ½', inline: false },
            { name: 'ğŸ¯ æ´»å‹•ã‚’è¿½åŠ ', value: '`/activity add [å†…å®¹]` ã§æ–°ã—ã„æ´»å‹•ã‚’è¿½åŠ ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      const groupedResults = this.groupResultsByStatus(results, 'activity');
      
      const embed = new EmbedBuilder()
        .setTitle(`ğŸ¯ æ´»å‹•ã®æ¤œç´¢çµæœ: "${keyword}"`)
        .setColor('#00BCD4')
        .setDescription(`${results.length}ä»¶ã®æ´»å‹•ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`)
        .setTimestamp();
      
      let totalDisplayed = 0;
      const maxDisplay = 20;
      
      Object.entries(groupedResults).forEach(([status, items]) => {
        if (items.length > 0 && totalDisplayed < maxDisplay) {
          const statusName = this.getStatusDisplayName('activity', status);
          const displayItems = items.slice(0, Math.min(8, maxDisplay - totalDisplayed));
          const moreCount = items.length - displayItems.length;
          
          let fieldValue = displayItems.join('\n');
          if (moreCount > 0) {
            fieldValue += `\n... ä»–${moreCount}ä»¶`;
          }
          
          embed.addFields({
            name: `${statusName} (${items.length}ä»¶)`,
            value: fieldValue,
            inline: false
          });
          
          totalDisplayed += displayItems.length;
        }
      });
      
      if (results.length > maxDisplay) {
        embed.setFooter({ text: `${maxDisplay}ä»¶ã¾ã§è¡¨ç¤º (å…¨${results.length}ä»¶ä¸­)` });
      } else {
        embed.setFooter({ text: `å…¨${results.length}ä»¶ã‚’è¡¨ç¤º` });
      }
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æ´»å‹•æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ´»å‹•ã®æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async searchAll(interaction, keyword) {
    try {
      const [books, movies, activities] = await Promise.all([
        googleSheets.searchBooks(keyword),
        googleSheets.searchMovies(keyword),
        googleSheets.searchActivities(keyword)
      ]);
      
      const totalResults = books.length + movies.length + activities.length;
      
      if (totalResults === 0) {
        const embed = new EmbedBuilder()
          .setTitle(`ğŸ” å…¨ä½“æ¤œç´¢çµæœ: "${keyword}"`)
          .setColor('#FF9800')
          .setDescription('è©²å½“ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚')
          .addFields(
            { name: 'ğŸ’¡ æ¤œç´¢ã®ã‚³ãƒ„', value: 'â€¢ ã‚ˆã‚Šä¸€èˆ¬çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§è©¦ã—ã¦ã¿ã¦ãã ã•ã„\nâ€¢ éƒ¨åˆ†ä¸€è‡´ã§æ¤œç´¢ã•ã‚Œã‚‹ã®ã§ã€çŸ­ã‚ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚‚åŠ¹æœçš„\nâ€¢ ã‚«ãƒ†ã‚´ãƒªã‚’é™å®šã—ã¦æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„', inline: false },
            { name: 'ğŸ“‹ æ–°è¦è¿½åŠ ', value: 'â€¢ `/book add` - æœ¬ã‚’è¿½åŠ \nâ€¢ `/movie add` - æ˜ ç”»ã‚’è¿½åŠ \nâ€¢ `/activity add` - æ´»å‹•ã‚’è¿½åŠ ', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      const embed = new EmbedBuilder()
        .setTitle(`ğŸ” å…¨ä½“æ¤œç´¢çµæœ: "${keyword}"`)
        .setColor('#FF9800')
        .setDescription(`å…¨${totalResults}ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`)
        .setTimestamp();
      
      // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«çµæœã‚’è¡¨ç¤º
      const categories = [
        { name: 'ğŸ“š æœ¬', items: books, maxDisplay: 5 },
        { name: 'ğŸ¬ æ˜ ç”»', items: movies, maxDisplay: 5 },
        { name: 'ğŸ¯ æ´»å‹•', items: activities, maxDisplay: 5 }
      ];
      
      categories.forEach(category => {
        if (category.items.length > 0) {
          const displayItems = category.items.slice(0, category.maxDisplay);
          const moreCount = category.items.length - displayItems.length;
          
          let fieldValue = displayItems.join('\n');
          if (moreCount > 0) {
            fieldValue += `\n... ä»–${moreCount}ä»¶`;
          }
          
          embed.addFields({
            name: `${category.name} (${category.items.length}ä»¶)`,
            value: fieldValue,
            inline: false
          });
        }
      });
      
      // è©³ç´°æ¤œç´¢ã®ææ¡ˆ
      embed.addFields({
        name: 'ğŸ” è©³ç´°æ¤œç´¢',
        value: 'â€¢ `/search book` - æœ¬ã®ã¿æ¤œç´¢\nâ€¢ `/search movie` - æ˜ ç”»ã®ã¿æ¤œç´¢\nâ€¢ `/search activity` - æ´»å‹•ã®ã¿æ¤œç´¢',
        inline: false
      });
      
      embed.setFooter({ text: `å…¨ä½“ã§${totalResults}ä»¶è¦‹ã¤ã‹ã‚Šã¾ã—ãŸ` });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('å…¨ä½“æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // çµæœã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  groupResultsByStatus(results, category) {
    const grouped = {};
    
    results.forEach(result => {
      // çµæœæ–‡å­—åˆ—ã‹ã‚‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æŠ½å‡º
      const statusMatch = result.match(/\(([^)]+)\)$/);
      const status = statusMatch ? statusMatch[1] : 'unknown';
      
      if (!grouped[status]) {
        grouped[status] = [];
      }
      grouped[status].push(result);
    });
    
    return grouped;
  },

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®è¡¨ç¤ºåã‚’å–å¾—
  getStatusDisplayName(category, status) {
    const statusNames = {
      book: {
        'want_to_buy': 'ğŸ›’ è²·ã„ãŸã„æœ¬',
        'want_to_read': 'ğŸ“‹ ç©èª­æœ¬',
        'reading': 'ğŸ“– èª­æ›¸ä¸­',
        'finished': 'âœ… èª­äº†æ¸ˆã¿',
        'abandoned': 'âŒ ä¸­æ–­'
      },
      movie: {
        'want_to_watch': 'ğŸ¿ è¦³ãŸã„æ˜ ç”»',
        'watched': 'âœ… è¦–è´æ¸ˆã¿',
        'missed': 'ğŸ˜… è¦‹é€ƒã—'
      },
      activity: {
        'planned': 'ğŸ¯ äºˆå®šä¸­',
        'done': 'âœ… å®Œäº†æ¸ˆã¿',
        'skipped': 'ğŸ˜… ã‚¹ã‚­ãƒƒãƒ—'
      }
    };
    
    return statusNames[category]?.[status] || `${status}`;
  },

  // é«˜åº¦ãªæ¤œç´¢æ©Ÿèƒ½ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
  async advancedSearch(category, filters) {
    try {
      // ãƒ•ã‚£ãƒ«ã‚¿ä¾‹ï¼š
      // - status: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§çµã‚Šè¾¼ã¿
      // - dateRange: æ—¥ä»˜ç¯„å›²ã§çµã‚Šè¾¼ã¿
      // - priority: å„ªå…ˆåº¦ã§çµã‚Šè¾¼ã¿ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
      
      let results = [];
      
      switch (category) {
        case 'book':
          results = await googleSheets.searchBooks(filters.keyword || '');
          break;
        case 'movie':
          results = await googleSheets.searchMovies(filters.keyword || '');
          break;
        case 'activity':
          results = await googleSheets.searchActivities(filters.keyword || '');
          break;
      }
      
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨
      if (filters.status) {
        results = results.filter(result => result.includes(`(${filters.status})`));
      }
      
      return results;
    } catch (error) {
      console.error('é«˜åº¦ãªæ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  },

  // æ¤œç´¢çµæœã®çµ±è¨ˆæƒ…å ±ã‚’ç”Ÿæˆ
  generateSearchStats(books, movies, activities) {
    return {
      total: books.length + movies.length + activities.length,
      byCategory: {
        books: books.length,
        movies: movies.length,
        activities: activities.length
      },
      mostPopularCategory: books.length >= movies.length && books.length >= activities.length ? 'books' :
                          movies.length >= activities.length ? 'movies' : 'activities'
    };
  },

  // æ¤œç´¢å±¥æ­´ã®ç®¡ç†ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
  async logSearch(userId, keyword, category, resultCount) {
    try {
      // æ¤œç´¢å±¥æ­´ã‚’ãƒ­ã‚°ã«è¨˜éŒ²
      console.log(`æ¤œç´¢ãƒ­ã‚°: ãƒ¦ãƒ¼ã‚¶ãƒ¼=${userId}, ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰="${keyword}", ã‚«ãƒ†ã‚´ãƒª=${category}, çµæœæ•°=${resultCount}`);
      
      // å°†æ¥çš„ã«ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚„Google Sheetsã«ä¿å­˜
      return true;
    } catch (error) {
      console.error('æ¤œç´¢ãƒ­ã‚°ã‚¨ãƒ©ãƒ¼:', error);
      return false;
    }
  },

  // é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ææ¡ˆ
  suggestRelatedKeywords(keyword, category) {
    const suggestions = {
      book: {
        'å°èª¬': ['æ–‡å­¦', 'ãƒãƒ™ãƒ«', 'ç‰©èª', 'ã‚¹ãƒˆãƒ¼ãƒªãƒ¼'],
        'æŠ€è¡“': ['ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°', 'IT', 'ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢', 'é–‹ç™º'],
        'è‡ªå·±å•“ç™º': ['ãƒ“ã‚¸ãƒã‚¹', 'æˆåŠŸ', 'æˆé•·', 'ã‚¹ã‚­ãƒ«']
      },
      movie: {
        'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³': ['å†’é™º', 'ãƒãƒˆãƒ«', 'æˆ¦é—˜', 'ã‚¹ãƒªãƒ«'],
        'ãƒ‰ãƒ©ãƒ': ['äººé–“ãƒ‰ãƒ©ãƒ', 'æ„Ÿå‹•', 'å®¶æ—', 'æ‹æ„›'],
        'ã‚³ãƒ¡ãƒ‡ã‚£': ['ç¬‘ã„', 'ãƒ¦ãƒ¼ãƒ¢ã‚¢', 'é¢ç™½ã„', 'ã‚®ãƒ£ã‚°']
      },
      activity: {
        'å­¦ç¿’': ['å‹‰å¼·', 'ã‚¹ã‚­ãƒ«', 'è³‡æ ¼', 'ç¿’å¾—'],
        'é‹å‹•': ['ç­‹ãƒˆãƒ¬', 'ã‚¸ãƒ§ã‚®ãƒ³ã‚°', 'ãƒ¨ã‚¬', 'ã‚¹ãƒˆãƒ¬ãƒƒãƒ'],
        'å‰µä½œ': ['åˆ¶ä½œ', 'ã‚¢ãƒ¼ãƒˆ', 'ãƒ‡ã‚¶ã‚¤ãƒ³', 'è¡¨ç¾']
      }
    };
    
    const categoryList = suggestions[category] || {};
    
    for (const [key, relatedWords] of Object.entries(categoryList)) {
      if (keyword.includes(key)) {
        return relatedWords.slice(0, 3); // æœ€å¤§3ã¤ã¾ã§ææ¡ˆ
      }
    }
    
    return [];
  }
};

```

### handlers/activityHandler.js

```
const { EmbedBuilder } = require('discord.js');
const GoogleSheetsService = require('../services/googleSheets');

// GoogleSheetsServiceã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
const googleSheets = new GoogleSheetsService();

module.exports = {
  async execute(interaction) {
    const subcommand = interaction.options.getSubcommand();
    
    try {
      switch (subcommand) {
        case 'add':
          await this.handleAdd(interaction);
          break;
        case 'done':
          await this.handleDone(interaction);
          break;
        case 'skip':
          await this.handleSkip(interaction);
          break;
        case 'list':
          await this.handleList(interaction);
          break;
        case 'planned':
          await this.handlePlanned(interaction);
          break;
        case 'completed':
          await this.handleCompleted(interaction);
          break;
        case 'info':
          await this.handleInfo(interaction);
          break;
        default:
          await interaction.editReply(`âŒ ä¸æ˜ãªã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰: ${subcommand}`);
      }
    } catch (error) {
      console.error('ActivityHandler ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleAdd(interaction) {
    const content = interaction.options.getString('content');
    const memo = interaction.options.getString('memo') || '';
    
    try {
      const activityId = await googleSheets.addActivity(content, memo);
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ¯ æ´»å‹•ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼')
        .setColor('#00BCD4')
        .setDescription('æ–°ã—ã„ç›®æ¨™ãŒè¨­å®šã•ã‚Œã¾ã—ãŸï¼é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼âœ¨')
        .addFields(
          { name: 'ID', value: activityId.toString(), inline: true },
          { name: 'æ´»å‹•å†…å®¹', value: content, inline: true },
          { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: 'ğŸ¯ äºˆå®š', inline: true }
        )
        .setFooter({ text: 'å®Œäº†ã—ãŸã‚‰ /activity done ã§è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼' })
        .setTimestamp();
      
      if (memo) {
        embed.addFields({ name: 'å‚™è€ƒ', value: memo, inline: false });
      }
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æ´»å‹•è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ´»å‹•ã®è¿½åŠ ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleDone(interaction) {
    const doneId = interaction.options.getInteger('id');
    
    try {
      const doneActivity = await googleSheets.doneActivity(doneId);
      
      if (doneActivity) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ‰ æ´»å‹•å®Œäº†ï¼')
          .setColor('#4CAF50')
          .setDescription('ç´ æ™´ã‚‰ã—ã„ï¼ç›®æ¨™ã‚’é”æˆã—ã¾ã—ãŸã­ï¼ğŸ‰âœ¨')
          .addFields(
            { name: 'ID', value: doneActivity.id.toString(), inline: true },
            { name: 'æ´»å‹•å†…å®¹', value: doneActivity.content, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´', value: 'ğŸ¯ äºˆå®š â†’ âœ… å®Œäº†', inline: true }
          )
          .setFooter({ text: 'æ„Ÿæƒ³ã‚’ /report activity ã§è¨˜éŒ²ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ' })
          .setTimestamp();
        
        if (doneActivity.memo) {
          embed.addFields({ name: 'å‚™è€ƒ', value: doneActivity.memo, inline: false });
        }
        
        // é”æˆã‚’ç¥ã†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
        const congratsMessages = [
          'ç¶™ç¶šã¯åŠ›ãªã‚Šï¼æ¬¡ã®æ´»å‹•ã‚‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼',
          'ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ç€å®Ÿã«å‰é€²ã—ã¦ã„ã¾ã™ã­ï¼',
          'ç´ æ™´ã‚‰ã—ã„æˆæœã§ã™ï¼ã“ã®èª¿å­ã§è¡Œãã¾ã—ã‚‡ã†ï¼',
          'ç›®æ¨™é”æˆãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼æ¬¡ã¯ã©ã‚“ãªæŒ‘æˆ¦ã‚’ã—ã¾ã™ã‹ï¼Ÿ',
          'åŠªåŠ›ãŒå®Ÿã‚’çµã³ã¾ã—ãŸã­ï¼æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚‚æ¥½ã—ã¿ã§ã™ï¼'
        ];
        
        const randomMessage = congratsMessages[Math.floor(Math.random() * congratsMessages.length)];
        embed.setDescription(randomMessage + ' ğŸ‰âœ¨');
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        const embed = new EmbedBuilder()
          .setTitle('â“ æ´»å‹•ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`ID: ${doneId} ã®æ´»å‹•ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æ—¢ã«å®Œäº†æ¸ˆã¿ã§ã™ã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: '`/activity list` ã§æ´»å‹•ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      }
    } catch (error) {
      console.error('æ´»å‹•å®Œäº†è¨˜éŒ²ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ´»å‹•å®Œäº†è¨˜éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleSkip(interaction) {
    const skipId = interaction.options.getInteger('id');
    
    try {
      const skippedActivity = await googleSheets.skipActivity(skipId);
      
      if (skippedActivity) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ˜… æ´»å‹•ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ')
          .setColor('#FF9800')
          .setDescription('å¤§ä¸ˆå¤«ã§ã™ï¼æ™‚ã«ã¯è¦‹é€ã‚‹ã“ã¨ã‚‚å¿…è¦ã§ã™ã­ã€‚ã¾ãŸæ©Ÿä¼šãŒã‚ã‚Œã°ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã¦ãã ã•ã„ï¼')
          .addFields(
            { name: 'ID', value: skippedActivity.id.toString(), inline: true },
            { name: 'æ´»å‹•å†…å®¹', value: skippedActivity.content, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´', value: 'ğŸ¯ äºˆå®š â†’ ğŸ˜… ã‚¹ã‚­ãƒƒãƒ—', inline: true }
          )
          .setFooter({ text: 'æ–°ã—ã„æ´»å‹•ã‚’è¿½åŠ ã—ã¦å†ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼' })
          .setTimestamp();
        
        if (skippedActivity.memo) {
          embed.addFields({ name: 'å‚™è€ƒ', value: skippedActivity.memo, inline: false });
        }
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        const embed = new EmbedBuilder()
          .setTitle('â“ æ´»å‹•ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`ID: ${skipId} ã®æ´»å‹•ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æ—¢ã«å‡¦ç†æ¸ˆã¿ã§ã™ã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: '`/activity list` ã§æ´»å‹•ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      }
    } catch (error) {
      console.error('æ´»å‹•ã‚¹ã‚­ãƒƒãƒ—è¨˜éŒ²ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ´»å‹•ã‚¹ã‚­ãƒƒãƒ—è¨˜éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleList(interaction) {
    try {
      const activities = await googleSheets.getActivities();
      
      if (activities.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ¯ æ´»å‹•ä¸€è¦§')
          .setColor('#607D8B')
          .setDescription('ã¾ã æ´»å‹•ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸš€ æ´»å‹•ã‚’è¿½åŠ ', value: '`/activity add [å†…å®¹]` ã§æ–°ã—ã„æ´»å‹•ã‚’è¿½åŠ ã§ãã¾ã™', inline: false },
            { name: 'ğŸ’¡ æ´»å‹•ä¾‹', value: 'â€¢ æ–°ã—ã„ã‚¹ã‚­ãƒ«ã‚’å­¦ã¶\nâ€¢ é‹å‹•ã‚’å§‹ã‚ã‚‹\nâ€¢ èª­æ›¸ç¿’æ…£ã‚’ã¤ã‘ã‚‹\nâ€¢ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å®Œæˆã•ã›ã‚‹', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      // æ´»å‹•ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«åˆ†é¡
      const statusOrder = ['planned', 'done', 'skipped'];
      const groupedActivities = activities.reduce((acc, activity) => {
        // æ´»å‹•æ–‡å­—åˆ—ã‹ã‚‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æŠ½å‡º
        const statusMatch = activity.match(/\(([^)]+)\)$/);
        const status = statusMatch ? statusMatch[1] : 'planned';
        
        if (!acc[status]) acc[status] = [];
        acc[status].push(activity);
        return acc;
      }, {});
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ¯ æ´»å‹•ä¸€è¦§')
        .setColor('#607D8B')
        .setDescription(`å…¨ ${activities.length} ä»¶ã®æ´»å‹•ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™`)
        .setTimestamp();
      
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«è¡¨ç¤º
      statusOrder.forEach(status => {
        if (groupedActivities[status] && groupedActivities[status].length > 0) {
          const statusName = {
            'planned': 'ğŸ¯ äºˆå®šä¸­',
            'done': 'âœ… å®Œäº†æ¸ˆã¿',
            'skipped': 'ğŸ˜… ã‚¹ã‚­ãƒƒãƒ—'
          }[status] || status;
          
          // æœ€å¤§10ä»¶ã¾ã§è¡¨ç¤º
          const displayActivities = groupedActivities[status].slice(0, 10);
          const moreCount = groupedActivities[status].length - 10;
          
          let fieldValue = displayActivities.join('\n');
          if (moreCount > 0) {
            fieldValue += `\n... ä»–${moreCount}ä»¶`;
          }
          
          embed.addFields({
            name: `${statusName} (${groupedActivities[status].length}ä»¶)`,
            value: fieldValue,
            inline: false
          });
        }
      });
      
      // çµ±è¨ˆæƒ…å ±ã‚’è¿½åŠ 
      const totalPlanned = groupedActivities['planned']?.length || 0;
      const totalCompleted = groupedActivities['done']?.length || 0;
      const completionRate = totalCompleted + totalPlanned > 0 
        ? Math.round((totalCompleted / (totalCompleted + totalPlanned)) * 100) 
        : 0;
      
      if (totalCompleted > 0) {
        embed.addFields({
          name: 'ğŸ“Š é”æˆçŠ¶æ³',
          value: `å®Œäº†ç‡: ${completionRate}% (${totalCompleted}/${totalCompleted + totalPlanned})`,
          inline: false
        });
      }
      
      embed.setFooter({ text: 'æ“ä½œ: /activity done [ID] ã¾ãŸã¯ /activity skip [ID]' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æ´»å‹•ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ´»å‹•ä¸€è¦§ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handlePlanned(interaction) {
    try {
      const activities = await googleSheets.getActivities();
      const plannedActivities = activities.filter(activity => activity.includes('(planned)'));
      
      if (plannedActivities.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ¯ äºˆå®šä¸­ã®æ´»å‹•')
          .setColor('#00BCD4')
          .setDescription('ç¾åœ¨äºˆå®šä¸­ã®æ´»å‹•ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸš€ æ´»å‹•ã‚’è¿½åŠ ', value: '`/activity add [å†…å®¹]` ã§æ–°ã—ã„æ´»å‹•ã‚’è¿½åŠ ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ¯ äºˆå®šä¸­ã®æ´»å‹•')
        .setColor('#00BCD4')
        .setDescription(`${plannedActivities.length} ä»¶ã®æ´»å‹•ãŒäºˆå®šä¸­ã§ã™`)
        .setTimestamp();
      
      // æœ€å¤§15ä»¶ã¾ã§è¡¨ç¤º
      const displayActivities = plannedActivities.slice(0, 15);
      const moreCount = plannedActivities.length - 15;
      
      let activityList = displayActivities.join('\n');
      if (moreCount > 0) {
        activityList += `\n... ä»–${moreCount}ä»¶`;
      }
      
      embed.addFields({
        name: 'ğŸ“‹ äºˆå®šä¸­ã®æ´»å‹•ä¸€è¦§',
        value: activityList,
        inline: false
      });
      
      embed.setFooter({ text: 'å®Œäº†ã—ãŸã‚‰ /activity done [ID] ã§è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('äºˆå®šä¸­æ´»å‹•å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ äºˆå®šä¸­æ´»å‹•ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleCompleted(interaction) {
    try {
      const activities = await googleSheets.getActivities();
      const completedActivities = activities.filter(activity => activity.includes('(done)'));
      
      if (completedActivities.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle('âœ… å®Œäº†æ¸ˆã¿æ´»å‹•')
          .setColor('#4CAF50')
          .setDescription('ã¾ã å®Œäº†ã—ãŸæ´»å‹•ãŒã‚ã‚Šã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸ¯ æ´»å‹•ã‚’å®Œäº†', value: 'äºˆå®šä¸­ã®æ´»å‹•ã‚’ `/activity done [ID]` ã§å®Œäº†ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      const embed = new EmbedBuilder()
        .setTitle('âœ… å®Œäº†æ¸ˆã¿æ´»å‹•')
        .setColor('#4CAF50')
        .setDescription(`${completedActivities.length} ä»¶ã®æ´»å‹•ã‚’å®Œäº†æ¸ˆã¿ã§ã™`)
        .setTimestamp();
      
      // æœ€å¤§15ä»¶ã¾ã§è¡¨ç¤º
      const displayActivities = completedActivities.slice(0, 15);
      const moreCount = completedActivities.length - 15;
      
      let activityList = displayActivities.join('\n');
      if (moreCount > 0) {
        activityList += `\n... ä»–${moreCount}ä»¶`;
      }
      
      embed.addFields({
        name: 'ğŸ† å®Œäº†æ¸ˆã¿æ´»å‹•ä¸€è¦§',
        value: activityList,
        inline: false
      });
      
      embed.setFooter({ text: 'æŒ¯ã‚Šè¿”ã‚Šã¯ /report activity [ID] ã§è¨˜éŒ²ã§ãã¾ã™' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('å®Œäº†æ¸ˆã¿æ´»å‹•å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ å®Œäº†æ¸ˆã¿æ´»å‹•ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleInfo(interaction) {
    try {
      const id = interaction.options.getInteger('id');
      const itemInfo = await googleSheets.getItemInfo('activity', id);
      
      if (!itemInfo) {
        const embed = new EmbedBuilder()
          .setTitle('â“ æ´»å‹•ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`ID: ${id} ã®æ´»å‹•ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: '`/activity list` ã§æ´»å‹•ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      // æ´»å‹•ã®è©³ç´°æƒ…å ±ã‚’å–å¾—
      const activities = await googleSheets.getActivities();
      const activityData = activities.find(activity => activity.includes(`[${id}]`));
      
      let status = 'planned';
      if (activityData) {
        if (activityData.includes('(done)')) status = 'done';
        else if (activityData.includes('(skipped)')) status = 'skipped';
        else if (activityData.includes('(planned)')) status = 'planned';
      }
      
      const statusEmoji = {
        'planned': 'ğŸ¯',
        'done': 'âœ…',
        'skipped': 'ğŸ˜…'
      };
      
      const statusText = {
        'planned': 'äºˆå®šä¸­',
        'done': 'å®Œäº†',
        'skipped': 'ã‚¹ã‚­ãƒƒãƒ—'
      };
      
      const embed = new EmbedBuilder()
        .setTitle(`ğŸ¯ ${itemInfo.content}`)
        .setColor('#00BCD4')
        .addFields(
          { name: 'ID', value: id.toString(), inline: true },
          { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: `${statusEmoji[status]} ${statusText[status]}`, inline: true },
          { name: 'æ´»å‹•å†…å®¹', value: itemInfo.content, inline: false }
        )
        .setTimestamp();
      
      // ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã‚’å–å¾—
      const reports = await googleSheets.getReportsByItem('activity', id);
      if (reports.length > 0) {
        const recentReports = reports.slice(0, 3);
        const reportList = recentReports.map(report => {
          const date = new Date(report.date).toLocaleDateString('ja-JP');
          return `ğŸ“… ${date}: ${report.content.substring(0, 50)}...`;
        }).join('\n');
        
        embed.addFields({
          name: `ğŸ“ æœ€è¿‘ã®ãƒ¬ãƒãƒ¼ãƒˆ (${reports.length}ä»¶)`,
          value: reportList,
          inline: false
        });
      }
      
      // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆ
      const actions = [];
      if (status === 'planned') {
        actions.push('`/activity done` ã§å®Œäº†ã«');
        actions.push('`/activity skip` ã§ã‚¹ã‚­ãƒƒãƒ—ã«');
      }
      actions.push('`/report activity` ã§é€²æ—ã‚’è¨˜éŒ²');
      
      if (actions.length > 0) {
        embed.addFields({
          name: 'ğŸ’¡ ã§ãã‚‹ã“ã¨',
          value: actions.join('\n'),
          inline: false
        });
      }
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æ´»å‹•è©³ç´°å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ´»å‹•è©³ç´°ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // æ´»å‹•ã®å„ªå…ˆåº¦ã‚’è¨­å®šã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
  async setPriority(activityId, priority) {
    // å„ªå…ˆåº¦: high, medium, low
    try {
      // å°†æ¥çš„ã«Google Sheetsã§å„ªå…ˆåº¦ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã—ãŸå ´åˆã®å®Ÿè£…
      console.log(`æ´»å‹•ID ${activityId} ã®å„ªå…ˆåº¦ã‚’ ${priority} ã«è¨­å®š`);
      return true;
    } catch (error) {
      console.error('å„ªå…ˆåº¦è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
      return false;
    }
  },

  // æ´»å‹•ã®é€²æ—ç‡ã‚’è¨ˆç®—
  calculateProgress(activities) {
    const total = activities.length;
    const completed = activities.filter(activity => 
      activity.includes('(done)') || activity.includes('å®Œäº†')
    ).length;
    
    return total > 0 ? Math.round((completed / total) * 100) : 0;
  },

  // æ´»å‹•ã®ã‚«ãƒ†ã‚´ãƒªåˆ†æï¼ˆå†…å®¹ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªã‚’æ¨æ¸¬ï¼‰
  categorizeActivity(content) {
    const categories = {
      'ğŸ“š å­¦ç¿’ãƒ»ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—': ['å­¦ç¿’', 'å‹‰å¼·', 'ã‚¹ã‚­ãƒ«', 'è³‡æ ¼', 'ç¿’å¾—', 'è¦šãˆã‚‹'],
      'ğŸ’ª å¥åº·ãƒ»é‹å‹•': ['é‹å‹•', 'ç­‹ãƒˆãƒ¬', 'ã‚¸ãƒ§ã‚®ãƒ³ã‚°', 'ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°', 'å¥åº·', 'ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ'],
      'ğŸ  ç”Ÿæ´»ãƒ»å®¶äº‹': ['æƒé™¤', 'æ•´ç†', 'å®¶äº‹', 'è²·ã„ç‰©', 'æ–™ç†', 'æ´—æ¿¯'],
      'ğŸ’¼ ä»•äº‹ãƒ»ã‚­ãƒ£ãƒªã‚¢': ['ä»•äº‹', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ', 'ä¼šè­°', 'è³‡æ–™', 'ä¼ç”»', 'ã‚¿ã‚¹ã‚¯'],
      'ğŸ¨ è¶£å‘³ãƒ»å‰µä½œ': ['è¶£å‘³', 'å‰µä½œ', 'çµµ', 'éŸ³æ¥½', 'å†™çœŸ', 'åˆ¶ä½œ'],
      'ğŸ‘¥ äººé–“é–¢ä¿‚ãƒ»ç¤¾äº¤': ['é€£çµ¡', 'ä¼šã†', 'é›»è©±', 'å‹äºº', 'å®¶æ—', 'ä»˜ãåˆã„']
    };
    
    const lowerContent = content.toLowerCase();
    
    for (const [category, keywords] of Object.entries(categories)) {
      if (keywords.some(keyword => lowerContent.includes(keyword))) {
        return category;
      }
    }
    
    return 'ğŸ¯ ãã®ä»–';
  },

  // æ´»å‹•ã®æ¨å¥¨æœŸé™ã‚’ææ¡ˆ
  suggestDeadline(content) {
    const lowerContent = content.toLowerCase();
    
    // å†…å®¹ã«åŸºã¥ã„ãŸæ¨å¥¨æœŸé™
    if (lowerContent.includes('ç¿’æ…£') || lowerContent.includes('ç¶™ç¶š')) {
      return 'ç¶™ç¶šçš„ãªæ´»å‹•ã®ãŸã‚æœŸé™ãªã—';
    } else if (lowerContent.includes('ç·Šæ€¥') || lowerContent.includes('æ€¥ã')) {
      return '3æ—¥ä»¥å†…æ¨å¥¨';
    } else if (lowerContent.includes('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ') || lowerContent.includes('è¨ˆç”»')) {
      return '1-2é€±é–“ç¨‹åº¦';
    } else {
      return '1é€±é–“ç¨‹åº¦';
    }
  }
};

```

### handlers/reportsHandler.js

```
const { EmbedBuilder } = require('discord.js');
const GoogleSheetsService = require('../services/googleSheets');

// GoogleSheetsServiceã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
const googleSheets = new GoogleSheetsService();

module.exports = {
  async execute(interaction) {
    const subcommand = interaction.options.getSubcommand();
    
    try {
      switch (subcommand) {
        case 'history':
          await this.showHistory(interaction);
          break;
        case 'recent':
          await this.showRecent(interaction);
          break;
        case 'search':
          await this.searchReports(interaction);
          break;
        case 'calendar':
          await this.showCalendar(interaction);
          break;
        case 'analytics':
          await this.showAnalytics(interaction);
          break;
        case 'export':
          await this.exportReports(interaction);
          break;
        default:
          await interaction.editReply(`âŒ ä¸æ˜ãªã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰: ${subcommand}`);
          break;
      }
    } catch (error) {
      console.error('ReportsHandler ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ ãƒ¬ãƒãƒ¼ãƒˆæ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async showHistory(interaction) {
    try {
      const category = interaction.options.getString('category');
      const id = interaction.options.getInteger('id');
      
      console.log('=== ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´æ¤œç´¢é–‹å§‹ ===', { category, id });
      
      // ä¸¦è¡Œã§ä½œå“æƒ…å ±ã¨ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã‚’å–å¾—
      const [itemInfo, reports] = await Promise.all([
        googleSheets.getItemInfo(category, id),
        googleSheets.getReportsByItem(category, id)
      ]);
      
      const categoryEmoji = {
        'book': 'ğŸ“š',
        'movie': 'ğŸ¬',
        'activity': 'ğŸ¯'
      };
      
      const categoryName = {
        'book': 'æœ¬',
        'movie': 'æ˜ ç”»',
        'activity': 'æ´»å‹•'
      };
      
      if (!itemInfo) {
        const embed = new EmbedBuilder()
          .setTitle('â“ ã‚¢ã‚¤ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`æŒ‡å®šã•ã‚ŒãŸ${categoryName[category]}ï¼ˆID: ${id}ï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: `\`/${category} list\` ã§${categoryName[category]}ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„`, inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      if (reports.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle(`ğŸ“ ${itemInfo.title || itemInfo.content}ã®ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´`)
          .setColor('#FFC107')
          .setDescription('ã¾ã ãƒ¬ãƒãƒ¼ãƒˆãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸ“š å¯¾è±¡ã‚¢ã‚¤ãƒ†ãƒ ', value: this.formatItemInfo(category, itemInfo), inline: false },
            { name: 'ğŸ“ ãƒ¬ãƒãƒ¼ãƒˆã‚’è¨˜éŒ²', value: `\`/report ${category} ${id} [å†…å®¹]\` ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’è¨˜éŒ²ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼`, inline: false },
            { name: 'ğŸ’¡ ãƒ¬ãƒãƒ¼ãƒˆã®ã‚³ãƒ„', value: 'â€¢ ä»Šæ—¥ã®é€²æ—ã‚„æ„Ÿæƒ³ã‚’è¨˜éŒ²\nâ€¢ çŸ­ãã¦ã‚‚ç¶™ç¶šãŒå¤§åˆ‡\nâ€¢ æŒ¯ã‚Šè¿”ã‚Šã§æˆé•·ã‚’å®Ÿæ„Ÿ', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      // ãƒ¬ãƒãƒ¼ãƒˆã‚’æ—¥ä»˜é †ã«ä¸¦ã³æ›¿ãˆï¼ˆæ–°ã—ã„é †ï¼‰
      reports.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      const embed = new EmbedBuilder()
        .setTitle(`${categoryEmoji[category]} ${itemInfo.title || itemInfo.content}ã®ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´`)
        .setColor(this.getCategoryColor(category))
        .setDescription(`ğŸ“Š ç·ãƒ¬ãƒãƒ¼ãƒˆæ•°: **${reports.length}** ä»¶`)
        .setTimestamp();
      
      // ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±ã‚’è¿½åŠ 
      embed.addFields({ 
        name: 'ğŸ“š å¯¾è±¡ã‚¢ã‚¤ãƒ†ãƒ ', 
        value: this.formatItemInfo(category, itemInfo), 
        inline: false 
      });
      
      // ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã‚’è¡¨ç¤ºï¼ˆæœ€å¤§8ä»¶ï¼‰
      const displayReports = reports.slice(0, 8);
      const reportFields = [];
      
      for (let i = 0; i < displayReports.length; i += 2) {
        const report1 = displayReports[i];
        const report2 = displayReports[i + 1];
        
        const date1 = new Date(report1.date).toLocaleDateString('ja-JP');
        let field1Value = `ğŸ“… ${date1}\n${this.truncateText(report1.content, 100)}`;
        
        reportFields.push({
          name: `ğŸ“ ãƒ¬ãƒãƒ¼ãƒˆ ${i + 1}`,
          value: field1Value,
          inline: true
        });
        
        if (report2) {
          const date2 = new Date(report2.date).toLocaleDateString('ja-JP');
          let field2Value = `ğŸ“… ${date2}\n${this.truncateText(report2.content, 100)}`;
          
          reportFields.push({
            name: `ğŸ“ ãƒ¬ãƒãƒ¼ãƒˆ ${i + 2}`,
            value: field2Value,
            inline: true
          });
        }
        
        // ç©ºã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ã—ã¦æ”¹è¡Œ
        if (reportFields.length % 2 !== 0) {
          reportFields.push({ name: '\u200b', value: '\u200b', inline: true });
        }
      }
      
      embed.addFields(...reportFields);
      
      if (reports.length > 8) {
        embed.addFields({
          name: 'ğŸ“„ ã•ã‚‰ã«è¡¨ç¤º',
          value: `ä»– ${reports.length - 8} ä»¶ã®ãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Šã¾ã™`,
          inline: false
        });
      }
      
      // åˆ†ææƒ…å ±ã‚’è¿½åŠ 
      const analysisInfo = this.analyzeReports(reports);
      embed.addFields({
        name: 'ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆåˆ†æ',
        value: `å¹³å‡æ–‡å­—æ•°: ${analysisInfo.avgLength}æ–‡å­—\næœ€æ–°è¨˜éŒ²: ${analysisInfo.daysSinceLastReport}æ—¥å‰\nè¨˜éŒ²é »åº¦: ${analysisInfo.frequency}`,
        inline: true
      });
      
      embed.setFooter({ text: 'ç¶™ç¶šçš„ãªè¨˜éŒ²ã€ç´ æ™´ã‚‰ã—ã„ã§ã™ã­ï¼' });
      
      await interaction.editReply({ embeds: [embed] });
      
    } catch (error) {
      console.error('ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async showRecent(interaction) {
    try {
      const days = interaction.options.getInteger('days') || 7;
      const reports = await googleSheets.getRecentReports(days);
      
      if (reports.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle(`ğŸ“ éå»${days}æ—¥é–“ã®ãƒ¬ãƒãƒ¼ãƒˆ`)
          .setColor('#FFC107')
          .setDescription('ãƒ¬ãƒãƒ¼ãƒˆãŒã¾ã è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸ“ ãƒ¬ãƒãƒ¼ãƒˆã‚’è¨˜éŒ²', value: '`/report [category] [id] [å†…å®¹]` ã§ãƒ¬ãƒãƒ¼ãƒˆã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†', inline: false },
            { name: 'ğŸ’¡ è¨˜éŒ²ã®ãƒ¡ãƒªãƒƒãƒˆ', value: 'â€¢ é€²æ—ã®å¯è¦–åŒ–\nâ€¢ ç¶™ç¶šã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³\nâ€¢ å¾Œã§ã®æŒ¯ã‚Šè¿”ã‚Š', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
      const groupedReports = {
        book: reports.filter(r => r.category === 'book'),
        movie: reports.filter(r => r.category === 'movie'),
        activity: reports.filter(r => r.category === 'activity')
      };
      
      const embed = new EmbedBuilder()
        .setTitle(`ğŸ“ éå»${days}æ—¥é–“ã®ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§`)
        .setColor('#4CAF50')
        .setDescription(`ğŸ“Š ç·æ•°: **${reports.length}** ä»¶ã®ãƒ¬ãƒãƒ¼ãƒˆãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™`)
        .setTimestamp();
      
      const categoryEmoji = { book: 'ğŸ“š', movie: 'ğŸ¬', activity: 'ğŸ¯' };
      const categoryName = { book: 'æœ¬', movie: 'æ˜ ç”»', activity: 'æ´»å‹•' };
      
      // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
      const summaryFields = [];
      Object.entries(groupedReports).forEach(([category, categoryReports]) => {
        if (categoryReports.length > 0) {
          summaryFields.push({
            name: `${categoryEmoji[category]} ${categoryName[category]}`,
            value: `${categoryReports.length}ä»¶`,
            inline: true
          });
        }
      });
      
      if (summaryFields.length > 0) {
        embed.addFields(...summaryFields);
        
        // ç©ºã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§æ”¹è¡Œ
        if (summaryFields.length % 3 !== 0) {
          const emptyFields = 3 - (summaryFields.length % 3);
          for (let i = 0; i < emptyFields; i++) {
            embed.addFields({ name: '\u200b', value: '\u200b', inline: true });
          }
        }
      }
      
      // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®è©³ç´°è¡¨ç¤º
      Object.entries(groupedReports).forEach(([category, categoryReports]) => {
        if (categoryReports.length > 0) {
          // æœ€æ–°5ä»¶ã¾ã§è¡¨ç¤º
          const recentReports = categoryReports.slice(0, 5);
          const reportList = recentReports.map(report => {
            const date = new Date(report.date).toLocaleDateString('ja-JP', { 
              month: 'short', 
              day: 'numeric' 
            });
            const shortContent = this.truncateText(report.content, 60);
            return `ğŸ“… ${date} - ID:${report.itemId}\n${shortContent}`;
          }).join('\n\n');
          
          let fieldValue = reportList;
          if (categoryReports.length > 5) {
            fieldValue += `\n\nğŸ“ ä»– ${categoryReports.length - 5} ä»¶`;
          }
          
          embed.addFields({
            name: `${categoryEmoji[category]} ${categoryName[category]}ã®è©³ç´° (${categoryReports.length}ä»¶)`,
            value: fieldValue,
            inline: false
          });
        }
      });
      
      // è¨˜éŒ²é »åº¦ã®åˆ†æ
      const frequency = this.calculateReportFrequency(reports, days);
      embed.addFields({
        name: 'ğŸ“Š è¨˜éŒ²çŠ¶æ³',
        value: `1æ—¥å¹³å‡: ${frequency.daily}ä»¶\nè¨˜éŒ²æ—¥æ•°: ${frequency.activeDays}/${days}æ—¥\nç¶™ç¶šç‡: ${frequency.consistencyRate}%`,
        inline: true
      });
      
      embed.setFooter({ text: 'è©³ç´°å±¥æ­´ã¯ /reports history ã§ç¢ºèªã§ãã¾ã™' });
      
      await interaction.editReply({ embeds: [embed] });
      
    } catch (error) {
      console.error('æœ€è¿‘ã®ãƒ¬ãƒãƒ¼ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æœ€è¿‘ã®ãƒ¬ãƒãƒ¼ãƒˆå–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async searchReports(interaction) {
    try {
      const keyword = interaction.options.getString('keyword');
      
      if (keyword.length < 2) {
        await interaction.editReply('âŒ æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯2æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      
      const reports = await googleSheets.searchReportsByKeyword(keyword);
      
      if (reports.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle(`ğŸ” ãƒ¬ãƒãƒ¼ãƒˆæ¤œç´¢çµæœ`)
          .setColor('#FF9800')
          .setDescription(`"${keyword}" ã«ä¸€è‡´ã™ã‚‹ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`)
          .addFields(
            { name: 'ğŸ’¡ æ¤œç´¢ã®ã‚³ãƒ„', value: 'â€¢ ã‚ˆã‚Šä¸€èˆ¬çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§è©¦ã—ã¦ã¿ã‚‹\nâ€¢ éƒ¨åˆ†ä¸€è‡´ã§æ¤œç´¢ã•ã‚Œã¾ã™\nâ€¢ ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠã‚‚è©¦ã—ã¦ã¿ã‚‹', inline: false },
            { name: 'ğŸ“ è¨˜éŒ²ã®ç¢ºèª', value: '`/reports recent` ã§æœ€è¿‘ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ç¢ºèªã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      const embed = new EmbedBuilder()
        .setTitle(`ğŸ” "${keyword}" ã®æ¤œç´¢çµæœ`)
        .setColor('#2196F3')
        .setDescription(`ğŸ“Š **${reports.length}** ä»¶ã®ãƒ¬ãƒãƒ¼ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`)
        .setTimestamp();
      
      const categoryEmoji = { book: 'ğŸ“š', movie: 'ğŸ¬', activity: 'ğŸ¯' };
      
      // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®ä»¶æ•°è¡¨ç¤º
      const categoryCount = reports.reduce((acc, report) => {
        acc[report.category] = (acc[report.category] || 0) + 1;
        return acc;
      }, {});
      
      const countFields = Object.entries(categoryCount).map(([category, count]) => ({
        name: `${categoryEmoji[category]} ${category}`,
        value: `${count}ä»¶`,
        inline: true
      }));
      
      if (countFields.length > 0) {
        embed.addFields(...countFields);
        
        // æ”¹è¡Œç”¨ã®ç©ºãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        if (countFields.length % 3 !== 0) {
          const emptyFields = 3 - (countFields.length % 3);
          for (let i = 0; i < emptyFields; i++) {
            embed.addFields({ name: '\u200b', value: '\u200b', inline: true });
          }
        }
      }
      
      // æ¤œç´¢çµæœã‚’è¡¨ç¤ºï¼ˆæœ€å¤§6ä»¶ï¼‰
      const displayReports = reports.slice(0, 6);
      
      displayReports.forEach((report, index) => {
        const date = new Date(report.date).toLocaleDateString('ja-JP');
        const emoji = categoryEmoji[report.category];
        
        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆ**ã§å›²ã‚€ï¼‰
        const highlightedContent = report.content.replace(
          new RegExp(keyword, 'gi'), 
          `**${keyword}**`
        );
        
        const truncatedContent = this.truncateText(highlightedContent, 150);
        
        embed.addFields({
          name: `${emoji} æ¤œç´¢çµæœ ${index + 1} - ID:${report.itemId}`,
          value: `ğŸ“… ${date}\n${truncatedContent}`,
          inline: false
        });
      });
      
      if (reports.length > 6) {
        embed.addFields({
          name: 'ğŸ“„ ã•ã‚‰ã«è¡¨ç¤º',
          value: `ä»– ${reports.length - 6} ä»¶ã®çµæœãŒã‚ã‚Šã¾ã™`,
          inline: false
        });
      }
      
      // æ¤œç´¢çµ±è¨ˆ
      const dateRange = this.getDateRange(reports);
      embed.addFields({
        name: 'ğŸ“Š æ¤œç´¢çµ±è¨ˆ',
        value: `æœŸé–“: ${dateRange.start} ï½ ${dateRange.end}\nå¹³å‡æ–‡å­—æ•°: ${this.calculateAverageLength(reports)}æ–‡å­—`,
        inline: true
      });
      
      embed.setFooter({ text: 'ç‰¹å®šã®ã‚¢ã‚¤ãƒ†ãƒ ã®å±¥æ­´ã¯ /reports history ã§ç¢ºèªã§ãã¾ã™' });
      
      await interaction.editReply({ embeds: [embed] });
      
    } catch (error) {
      console.error('ãƒ¬ãƒãƒ¼ãƒˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ ãƒ¬ãƒãƒ¼ãƒˆæ¤œç´¢ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºæ©Ÿèƒ½
  async showCalendar(interaction) {
    try {
      const monthParam = interaction.options.getString('month');
      const targetDate = monthParam ? new Date(monthParam + '-01') : new Date();
      
      if (isNaN(targetDate.getTime())) {
        await interaction.editReply('âŒ ç„¡åŠ¹ãªæœˆå½¢å¼ã§ã™ã€‚YYYY-MMå½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 2024-03ï¼‰');
        return;
      }
      
      const year = targetDate.getFullYear();
      const month = targetDate.getMonth();
      const monthName = targetDate.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long' });
      
      // ãã®æœˆã®ãƒ¬ãƒãƒ¼ãƒˆã‚’å–å¾—
      const reports = await googleSheets.getRecentReports(365); // 1å¹´åˆ†å–å¾—
      const monthReports = reports.filter(report => {
        const reportDate = new Date(report.date);
        return reportDate.getFullYear() === year && reportDate.getMonth() === month;
      });
      
      // æ—¥ä»˜åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
      const dailyReports = monthReports.reduce((acc, report) => {
        const day = new Date(report.date).getDate();
        acc[day] = (acc[day] || 0) + 1;
        return acc;
      }, {});
      
      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ç”Ÿæˆ
      const firstDay = new Date(year, month, 1).getDay(); // æœˆã®æœ€åˆã®æ—¥ã®æ›œæ—¥
      const daysInMonth = new Date(year, month + 1, 0).getDate(); // ãã®æœˆã®æ—¥æ•°
      
      let calendar = '```\n';
      calendar += `     ${monthName} ã®ãƒ¬ãƒãƒ¼ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼\n`;
      calendar += 'â”€'.repeat(35) + '\n';
      calendar += ' æ—¥ æœˆ ç« æ°´ æœ¨ é‡‘ åœŸ\n';
      
      // ç©ºç™½ã‚’è¿½åŠ ï¼ˆæœˆã®æœ€åˆã®æ—¥ã¾ã§ï¼‰
      let currentPos = 0;
      for (let i = 0; i < firstDay; i++) {
        calendar += '   ';
        currentPos++;
      }
      
      // æ—¥ä»˜ã‚’è¿½åŠ 
      for (let day = 1; day <= daysInMonth; day++) {
        const reportCount = dailyReports[day] || 0;
        let dayStr;
        
        if (reportCount === 0) {
          dayStr = day.toString().padStart(2, ' ');
        } else if (reportCount <= 3) {
          dayStr = `${day}â—`; // å°‘ãªã„
        } else if (reportCount <= 6) {
          dayStr = `${day}â—†`; // ä¸­ç¨‹åº¦
        } else {
          dayStr = `${day}â˜…`; // å¤šã„
        }
        
        calendar += dayStr.padEnd(3, ' ');
        currentPos++;
        
        // é€±æœ«ã§æ”¹è¡Œ
        if (currentPos % 7 === 0) {
          calendar += '\n';
        }
      }
      
      calendar += '\n\n';
      calendar += 'è¨˜å·ã®æ„å‘³:\n';
      calendar += 'â—: 1-3ä»¶  â—†: 4-6ä»¶  â˜…: 7ä»¶ä»¥ä¸Š\n';
      calendar += '```';
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“… ãƒ¬ãƒãƒ¼ãƒˆè¨˜éŒ²ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼')
        .setColor('#9C27B0')
        .setDescription(calendar)
        .addFields(
          { name: 'ğŸ“Š æœˆæ¬¡ã‚µãƒãƒªãƒ¼', value: `ç·ãƒ¬ãƒãƒ¼ãƒˆæ•°: ${monthReports.length}ä»¶\nè¨˜éŒ²æ—¥æ•°: ${Object.keys(dailyReports).length}æ—¥`, inline: true },
          { name: 'ğŸ”¥ æœ€å¤šè¨˜éŒ²æ—¥', value: Object.keys(dailyReports).length > 0 ? 
            `${Object.entries(dailyReports).sort(([,a], [,b]) => b - a)[0][0]}æ—¥ (${Object.entries(dailyReports).sort(([,a], [,b]) => b - a)[0][1]}ä»¶)` : 
            'ãªã—', inline: true }
        )
        .setFooter({ text: 'ç¶™ç¶šçš„ãªè¨˜éŒ²ã§ç´ æ™´ã‚‰ã—ã„ç¿’æ…£ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ï¼' })
        .setTimestamp();
      
      await interaction.editReply({ embeds: [embed] });
      
    } catch (error) {
      console.error('ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // åˆ†ææ©Ÿèƒ½
  async showAnalytics(interaction) {
    try {
      const reports = await googleSheets.getRecentReports(30); // éå»30æ—¥
      
      if (reports.length === 0) {
        await interaction.editReply('ğŸ“Š åˆ†æã™ã‚‹ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ãƒ¬ãƒãƒ¼ãƒˆã‚’è¨˜éŒ²ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼');
        return;
      }
      
      // åŸºæœ¬çµ±è¨ˆ
      const totalReports = reports.length;
      const averageLength = reports.reduce((sum, r) => sum + r.content.length, 0) / totalReports;
      const uniqueDays = new Set(reports.map(r => r.date)).size;
      const consistencyRate = Math.round((uniqueDays / 30) * 100);
      
      // ã‚«ãƒ†ã‚´ãƒªåˆ¥åˆ†æ
      const categoryStats = reports.reduce((acc, report) => {
        acc[report.category] = (acc[report.category] || 0) + 1;
        return acc;
      }, {});
      
      // æ›œæ—¥åˆ¥åˆ†æ
      const dayOfWeekStats = reports.reduce((acc, report) => {
        const dayOfWeek = new Date(report.date).getDay();
        const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
        const dayName = dayNames[dayOfWeek];
        acc[dayName] = (acc[dayName] || 0) + 1;
        return acc;
      }, {});
      
      // ã‚ˆãä½¿ã‚ã‚Œã‚‹å˜èªåˆ†æ
      const allWords = reports.map(r => r.content).join(' ')
        .replace(/[ï¼ï¼Ÿã€‚ã€]/g, ' ')
        .split(/\s+/)
        .filter(word => word.length > 1);
      
      const wordFreq = allWords.reduce((acc, word) => {
        acc[word] = (acc[word] || 0) + 1;
        return acc;
      }, {});
      
      const topWords = Object.entries(wordFreq)
        .sort(([,a], [,b]) => b - a)
        .slice(0, 10)
        .map(([word, freq]) => `${word} (${freq}å›)`)
        .join(', ');
      
      // æ™‚ç³»åˆ—ãƒˆãƒ¬ãƒ³ãƒ‰
      const weeklyTrend = this.calculateWeeklyTrend(reports);
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆåˆ†æãƒ¬ãƒãƒ¼ãƒˆï¼ˆéå»30æ—¥ï¼‰')
        .setColor('#673AB7')
        .setDescription('ã‚ãªãŸã®è¨˜éŒ²ç¿’æ…£ã‚’è©³ã—ãåˆ†æã—ã¾ã—ãŸï¼')
        .addFields(
          { 
            name: 'ğŸ“ˆ åŸºæœ¬çµ±è¨ˆ', 
            value: `ç·ãƒ¬ãƒãƒ¼ãƒˆæ•°: **${totalReports}**ä»¶\nå¹³å‡æ–‡å­—æ•°: **${Math.round(averageLength)}**æ–‡å­—\nè¨˜éŒ²æ—¥æ•°: **${uniqueDays}**/30æ—¥\nç¶™ç¶šç‡: **${consistencyRate}%**`, 
            inline: true 
          },
          { 
            name: 'ğŸ“‚ ã‚«ãƒ†ã‚´ãƒªåˆ¥', 
            value: Object.entries(categoryStats)
              .map(([cat, count]) => `${cat === 'book' ? 'ğŸ“š' : cat === 'movie' ? 'ğŸ¬' : 'ğŸ¯'} ${cat}: ${count}ä»¶`)
              .join('\n') || 'ãƒ‡ãƒ¼ã‚¿ãªã—', 
            inline: true 
          },
          { 
            name: 'ğŸ“… æ›œæ—¥åˆ¥å‚¾å‘', 
            value: Object.entries(dayOfWeekStats)
              .sort(([,a], [,b]) => b - a)
              .slice(0, 3)
              .map(([day, count]) => `${day}: ${count}ä»¶`)
              .join('\n') || 'ãƒ‡ãƒ¼ã‚¿ãªã—', 
            inline: true 
          },
          { 
            name: 'ğŸ”¤ ã‚ˆãä½¿ã†å˜èª TOP10', 
            value: topWords || 'ãƒ‡ãƒ¼ã‚¿ä¸è¶³', 
            inline: false 
          },
          { 
            name: 'ğŸ“Š é€±æ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰', 
            value: weeklyTrend, 
            inline: false 
          }
        )
        .setFooter({ text: 'ç¶™ç¶šçš„ãªè¨˜éŒ²ã§æ›´ã«è©³ç´°ãªåˆ†æãŒå¯èƒ½ã«ãªã‚Šã¾ã™ï¼' })
        .setTimestamp();
      
      // ãƒ¬ãƒ™ãƒ«åˆ¤å®š
      let level = 'ğŸŒ± è¨˜éŒ²åˆå¿ƒè€…';
      if (totalReports >= 50) level = 'ğŸ† è¨˜éŒ²ãƒã‚¹ã‚¿ãƒ¼';
      else if (totalReports >= 30) level = 'â­ è¨˜éŒ²ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ';
      else if (totalReports >= 15) level = 'ğŸ”¥ è¨˜éŒ²ç†Ÿç·´è€…';
      else if (totalReports >= 7) level = 'ğŸ’ª è¨˜éŒ²ç¶™ç¶šè€…';
      
      embed.addFields({
        name: 'ğŸ… ã‚ãªãŸã®è¨˜éŒ²ãƒ¬ãƒ™ãƒ«',
        value: level,
        inline: true
      });
      
      await interaction.editReply({ embeds: [embed] });
      
    } catch (error) {
      console.error('åˆ†æè¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ åˆ†æè¡¨ç¤ºä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
  async exportReports(interaction) {
    try {
      const format = interaction.options.getString('format') || 'text';
      const period = interaction.options.getString('period') || 'month';
      
      let days;
      switch (period) {
        case 'week': days = 7; break;
        case 'month': days = 30; break;
        case 'all': days = 365; break;
        default: days = 30;
      }
      
      const reports = await googleSheets.getRecentReports(days);
      
      if (reports.length === 0) {
        await interaction.editReply('ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
        return;
      }
      
      let exportData;
      
      switch (format) {
        case 'json':
          exportData = this.exportToJSON(reports);
          break;
        case 'markdown':
          exportData = this.exportToMarkdown(reports);
          break;
        default:
          exportData = this.exportToText(reports);
      }
      
      // ãƒ•ã‚¡ã‚¤ãƒ«ãŒé•·ã™ãã‚‹å ´åˆã¯åˆ†å‰²
      if (exportData.length > 1900) {
        const chunks = this.chunkString(exportData, 1900);
        
        for (let i = 0; i < chunks.length && i < 3; i++) {
          const embed = new EmbedBuilder()
            .setTitle(`ğŸ“¤ ãƒ¬ãƒãƒ¼ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ (${i + 1}/${Math.min(chunks.length, 3)})`)
            .setColor('#FF9800')
            .setDescription(`\`\`\`${format === 'markdown' ? 'md' : 'txt'}\n${chunks[i]}\n\`\`\``)
            .setTimestamp();
          
          if (i === 0) {
            await interaction.editReply({ embeds: [embed] });
          } else {
            await interaction.followUp({ embeds: [embed] });
          }
          
          // å°‘ã—å¾…æ©Ÿï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™å›é¿ï¼‰
          await new Promise(resolve => setTimeout(resolve, 500));
        }
        
        if (chunks.length > 3) {
          await interaction.followUp(`ğŸ“ ãƒ¬ãƒãƒ¼ãƒˆãŒå¤šã™ãã‚‹ãŸã‚ã€æœ€åˆã®3éƒ¨åˆ†ã®ã¿è¡¨ç¤ºã—ã¾ã—ãŸã€‚å…¨ä½“ã§${chunks.length}éƒ¨åˆ†ã‚ã‚Šã¾ã™ã€‚`);
        }
      } else {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ“¤ ãƒ¬ãƒãƒ¼ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ')
          .setColor('#FF9800')
          .setDescription(`\`\`\`${format === 'markdown' ? 'md' : 'txt'}\n${exportData}\n\`\`\``)
          .addFields(
            { name: 'ğŸ“Š çµ±è¨ˆ', value: `ç·ä»¶æ•°: ${reports.length}ä»¶\næœŸé–“: ${period}\nå½¢å¼: ${format}`, inline: true }
          )
          .setFooter({ text: 'ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†ï¼ã“ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¿å­˜ã§ãã¾ã™' })
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      }
      
    } catch (error) {
      console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
  calculateWeeklyTrend(reports) {
    const weeklyData = {};
    const fourWeeksAgo = new Date();
    fourWeeksAgo.setDate(fourWeeksAgo.getDate() - 28);
    
    for (let i = 0; i < 4; i++) {
      const weekStart = new Date(fourWeeksAgo);
      weekStart.setDate(weekStart.getDate() + (i * 7));
      const weekEnd = new Date(weekStart);
      weekEnd.setDate(weekEnd.getDate() + 6);
      
      const weekReports = reports.filter(report => {
        const reportDate = new Date(report.date);
        return reportDate >= weekStart && reportDate <= weekEnd;
      });
      
      weeklyData[`ç¬¬${i + 1}é€±`] = weekReports.length;
    }
    
    return Object.entries(weeklyData)
      .map(([week, count]) => `${week}: ${count}ä»¶`)
      .join(', ');
  },

  exportToJSON(reports) {
    return JSON.stringify({
      exportDate: new Date().toISOString(),
      reportCount: reports.length,
      reports: reports.map(report => ({
        date: report.date,
        category: report.category,
        itemId: report.itemId,
        content: report.content
      }))
    }, null, 2);
  },

  exportToMarkdown(reports) {
    let md = `# Activity Tracker ãƒ¬ãƒãƒ¼ãƒˆ\n\n`;
    md += `**ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ—¥æ™‚:** ${new Date().toLocaleString('ja-JP')}\n`;
    md += `**ç·ãƒ¬ãƒãƒ¼ãƒˆæ•°:** ${reports.length}ä»¶\n\n`;
    
    const groupedByDate = reports.reduce((acc, report) => {
      const date = report.date;
      if (!acc[date]) acc[date] = [];
      acc[date].push(report);
      return acc;
    }, {});
    
    Object.entries(groupedByDate)
      .sort(([a], [b]) => new Date(b) - new Date(a))
      .forEach(([date, dayReports]) => {
        md += `## ${new Date(date).toLocaleDateString('ja-JP')}\n\n`;
        
        dayReports.forEach(report => {
          const emoji = { book: 'ğŸ“š', movie: 'ğŸ¬', activity: 'ğŸ¯' }[report.category];
          md += `### ${emoji} ${report.category} (ID: ${report.itemId})\n`;
          md += `${report.content}\n\n`;
        });
      });
    
    return md;
  },

  exportToText(reports) {
    let text = `Activity Tracker ãƒ¬ãƒãƒ¼ãƒˆ\n`;
    text += `=${'='.repeat(30)}\n`;
    text += `ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}\n`;
    text += `ç·ãƒ¬ãƒãƒ¼ãƒˆæ•°: ${reports.length}ä»¶\n\n`;
    
    reports.sort((a, b) => new Date(b.date) - new Date(a.date))
      .forEach(report => {
        const emoji = { book: 'ğŸ“š', movie: 'ğŸ¬', activity: 'ğŸ¯' }[report.category];
        text += `${new Date(report.date).toLocaleDateString('ja-JP')} | ${emoji} ${report.category} (ID: ${report.itemId})\n`;
        text += `${report.content}\n`;
        text += `${'-'.repeat(50)}\n`;
      });
    
    return text;
  },

  chunkString(str, size) {
    const chunks = [];
    for (let i = 0; i < str.length; i += size) {
      chunks.push(str.slice(i, i + size));
    }
    return chunks;
  },

  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰

  formatItemInfo(category, itemInfo) {
    if (category === 'book') {
      return `ğŸ“– ${itemInfo.title}\nğŸ‘¤ ${itemInfo.author}`;
    } else if (category === 'movie') {
      return `ğŸ¬ ${itemInfo.title}`;
    } else if (category === 'activity') {
      return `ğŸ¯ ${itemInfo.content}`;
    }
    return 'ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±ä¸æ˜';
  },

  getCategoryColor(category) {
    const colors = {
      'book': '#9C27B0',
      'movie': '#E91E63',
      'activity': '#00BCD4'
    };
    return colors[category] || '#607D8B';
  },

  truncateText(text, maxLength) {
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength - 3) + '...';
  },

  analyzeReports(reports) {
    if (reports.length === 0) {
      return { avgLength: 0, daysSinceLastReport: 0, frequency: 'è¨˜éŒ²ãªã—' };
    }
    
    const totalLength = reports.reduce((sum, report) => sum + report.content.length, 0);
    const avgLength = Math.round(totalLength / reports.length);
    
    const latestDate = new Date(Math.max(...reports.map(r => new Date(r.date))));
    const now = new Date();
    const daysSinceLastReport = Math.floor((now - latestDate) / (1000 * 60 * 60 * 24));
    
    let frequency;
    if (reports.length >= 20) {
      frequency = 'é«˜é »åº¦';
    } else if (reports.length >= 10) {
      frequency = 'ä¸­é »åº¦';
    } else if (reports.length >= 5) {
      frequency = 'ä½é »åº¦';
    } else {
      frequency = 'é–‹å§‹æ®µéš';
    }
    
    return { avgLength, daysSinceLastReport, frequency };
  },

  calculateReportFrequency(reports, days) {
    const daily = (reports.length / days).toFixed(1);
    
    // è¨˜éŒ²ãŒã‚ã£ãŸæ—¥æ•°ã‚’è¨ˆç®—
    const uniqueDates = new Set(reports.map(r => r.date));
    const activeDays = uniqueDates.size;
    
    const consistencyRate = Math.round((activeDays / days) * 100);
    
    return { daily, activeDays, consistencyRate };
  },

  getDateRange(reports) {
    if (reports.length === 0) {
      const today = new Date().toLocaleDateString('ja-JP');
      return { start: today, end: today };
    }
    
    const dates = reports.map(r => new Date(r.date));
    const start = new Date(Math.min(...dates)).toLocaleDateString('ja-JP');
    const end = new Date(Math.max(...dates)).toLocaleDateString('ja-JP');
    
    return { start, end };
  },

  calculateAverageLength(reports) {
    if (reports.length === 0) return 0;
    
    const totalLength = reports.reduce((sum, report) => sum + report.content.length, 0);
    return Math.round(totalLength / reports.length);
  },

  // é«˜åº¦ãªåˆ†ææ©Ÿèƒ½ï¼ˆå°†æ¥ã®æ‹¡å¼µç”¨ï¼‰
  generateReportTrends(reports) {
    // æ™‚ç³»åˆ—ã§ã®ãƒ¬ãƒãƒ¼ãƒˆé »åº¦åˆ†æ
    const monthlyTrends = reports.reduce((acc, report) => {
      const month = new Date(report.date).toISOString().slice(0, 7);
      acc[month] = (acc[month] || 0) + 1;
      return acc;
    }, {});
    
    return monthlyTrends;
  },

  extractKeywords(reports) {
    // ãƒ¬ãƒãƒ¼ãƒˆã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º
    const allText = reports.map(r => r.content).join(' ');
    const words = allText.split(/\s+/);
    
    const wordCount = words.reduce((acc, word) => {
      if (word.length > 2) {
        acc[word] = (acc[word] || 0) + 1;
      }
      return acc;
    }, {});
    
    return Object.entries(wordCount)
      .sort(([,a], [,b]) => b - a)
      .slice(0, 10);
  }
};

```

### handlers/bookHandler.js

```
const { EmbedBuilder } = require('discord.js');
const GoogleSheetsService = require('../services/googleSheets');

// GoogleSheetsServiceã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
const googleSheets = new GoogleSheetsService();

module.exports = {
  async execute(interaction) {
    const subcommand = interaction.options.getSubcommand();
    
    try {
      switch (subcommand) {
        case 'add':
          await this.handleAdd(interaction);
          break;
        case 'buy':
          await this.handleBuy(interaction);
          break;
        case 'start':
          await this.handleStart(interaction);
          break;
        case 'finish':
          await this.handleFinish(interaction);
          break;
        case 'list':
          await this.handleList(interaction);
          break;
        case 'wishlist':
          await this.handleWishlist(interaction);
          break;
        case 'reading':
          await this.handleReading(interaction);
          break;
        case 'finished':
          await this.handleFinished(interaction);
          break;
        case 'info':
          await this.handleInfo(interaction);
          break;
        default:
          await interaction.editReply(`âŒ ä¸æ˜ãªã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰: ${subcommand}`);
      }
    } catch (error) {
      console.error('BookHandler ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleAdd(interaction) {
    const title = interaction.options.getString('title');
    const author = interaction.options.getString('author');
    const status = interaction.options.getString('status') || 'want_to_read';
    const memo = interaction.options.getString('memo') || '';
    
    try {
      const bookId = await googleSheets.addBook(title, author, memo, status);
      
      const statusText = {
        'want_to_buy': 'è²·ã„ãŸã„',
        'want_to_read': 'ç©ã‚“ã§ã„ã‚‹'
      };
      
      const statusEmoji = {
        'want_to_buy': 'ğŸ›’',
        'want_to_read': 'ğŸ“‹'
      };
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“š æœ¬ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼')
        .setColor('#4CAF50')
        .setDescription(`${statusEmoji[status]} æœ¬æ£šã«æ–°ã—ã„æœ¬ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸï¼`)
        .addFields(
          { name: 'ID', value: bookId.toString(), inline: true },
          { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: title, inline: true },
          { name: 'ä½œè€…', value: author, inline: true },
          { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: statusText[status], inline: true }
        )
        .setTimestamp();
      
      if (memo) {
        embed.addFields({ name: 'å‚™è€ƒ', value: memo, inline: false });
      }
      
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¿œã˜ãŸãƒ•ãƒƒã‚¿ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      if (status === 'want_to_buy') {
        embed.setFooter({ text: 'è³¼å…¥ã—ãŸã‚‰ /book buy ã§ç©èª­ãƒªã‚¹ãƒˆã«ç§»å‹•ã§ãã¾ã™' });
      } else {
        embed.setFooter({ text: 'èª­ã‚€æº–å‚™ãŒã§ããŸã‚‰ /book start ã§èª­æ›¸ã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†ï¼' });
      }
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æœ¬è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æœ¬ã®è¿½åŠ ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleBuy(interaction) {
    const buyId = interaction.options.getInteger('id');
    
    try {
      const boughtBook = await googleSheets.buyBook(buyId);
      
      if (boughtBook) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ›’ æœ¬ã‚’è³¼å…¥ã—ã¾ã—ãŸï¼')
          .setColor('#2196F3')
          .setDescription('è³¼å…¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ç©èª­ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼ğŸ“šâœ¨')
          .addFields(
            { name: 'ID', value: boughtBook.id.toString(), inline: true },
            { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: boughtBook.title, inline: true },
            { name: 'ä½œè€…', value: boughtBook.author, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´', value: 'ğŸ›’ è²·ã„ãŸã„ â†’ ğŸ“‹ ç©èª­', inline: false }
          )
          .setFooter({ text: 'èª­ã‚€æº–å‚™ãŒã§ããŸã‚‰ /book start ã§èª­æ›¸ã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†ï¼' })
          .setTimestamp();
        
        if (boughtBook.memo) {
          embed.addFields({ name: 'å‚™è€ƒ', value: boughtBook.memo, inline: false });
        }
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        const embed = new EmbedBuilder()
          .setTitle('â“ æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`ID: ${buyId} ã®æœ¬ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æ—¢ã«è³¼å…¥æ¸ˆã¿ã§ã™ã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: '`/book wishlist` ã§è²·ã„ãŸã„æœ¬ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      }
    } catch (error) {
      console.error('æœ¬è³¼å…¥ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æœ¬ã®è³¼å…¥è¨˜éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleStart(interaction) {
    const startId = interaction.options.getInteger('id');
    
    try {
      const startedBook = await googleSheets.startReading(startId);
      
      if (startedBook) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ“– èª­æ›¸é–‹å§‹ï¼')
          .setColor('#FF9800')
          .setDescription('ç´ æ™´ã‚‰ã—ã„ï¼æ–°ã—ã„èª­æ›¸ã®æ—…ãŒå§‹ã¾ã‚Šã¾ã™ã­ï¼ğŸ“šâœ¨')
          .addFields(
            { name: 'ID', value: startedBook.id.toString(), inline: true },
            { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: startedBook.title, inline: true },
            { name: 'ä½œè€…', value: startedBook.author, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´', value: 'ğŸ“‹ ç©èª­ â†’ ğŸ“– èª­æ›¸ä¸­', inline: false }
          )
          .setFooter({ text: 'èª­äº†ã—ãŸã‚‰ /book finish ã§å®Œäº†è¨˜éŒ²ã‚’ï¼é€²æ—ã¯ /report book ã§è¨˜éŒ²ã§ãã¾ã™' })
          .setTimestamp();
        
        if (startedBook.memo) {
          embed.addFields({ name: 'å‚™è€ƒ', value: startedBook.memo, inline: false });
        }
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        const embed = new EmbedBuilder()
          .setTitle('â“ æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`ID: ${startId} ã®æœ¬ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æ—¢ã«èª­æ›¸é–‹å§‹æ¸ˆã¿ã§ã™ã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: '`/book list` ã§æœ¬ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      }
    } catch (error) {
      console.error('èª­æ›¸é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ èª­æ›¸é–‹å§‹ã®è¨˜éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleFinish(interaction) {
    const finishId = interaction.options.getInteger('id');
    
    try {
      const finishedBook = await googleSheets.finishReading(finishId);
      
      if (finishedBook) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ‰ èª­äº†ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼')
          .setColor('#FFD700')
          .setDescription('ç´ æ™´ã‚‰ã—ã„é”æˆæ„Ÿã§ã™ã­ï¼ã¾ãŸä¸€ã¤çŸ¥è­˜ã®æ‰‰ãŒé–‹ã‹ã‚Œã¾ã—ãŸğŸ“šâœ¨')
          .addFields(
            { name: 'ID', value: finishedBook.id.toString(), inline: true },
            { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: finishedBook.title, inline: true },
            { name: 'ä½œè€…', value: finishedBook.author, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´', value: 'ğŸ“– èª­æ›¸ä¸­ â†’ âœ… èª­äº†', inline: false }
          )
          .setFooter({ text: 'æ„Ÿæƒ³ã‚’ /report book ã§è¨˜éŒ²ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ' })
          .setTimestamp();
        
        if (finishedBook.memo) {
          embed.addFields({ name: 'å‚™è€ƒ', value: finishedBook.memo, inline: false });
        }
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        const embed = new EmbedBuilder()
          .setTitle('â“ æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`ID: ${finishId} ã®æœ¬ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æ—¢ã«èª­äº†æ¸ˆã¿ã§ã™ã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: '`/book list` ã§æœ¬ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      }
    } catch (error) {
      console.error('èª­äº†è¨˜éŒ²ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ èª­äº†è¨˜éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleList(interaction) {
    try {
      const books = await googleSheets.getBooks();
      
      if (books.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ“š æœ¬ä¸€è¦§')
          .setColor('#9C27B0')
          .setDescription('ã¾ã æœ¬ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸ“– æœ¬ã‚’è¿½åŠ ', value: '`/book add [ã‚¿ã‚¤ãƒˆãƒ«] [ä½œè€…]` ã§æœ¬ã‚’è¿½åŠ ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      // æœ¬ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«åˆ†é¡
      const statusOrder = ['want_to_buy', 'want_to_read', 'reading', 'finished', 'abandoned'];
      const groupedBooks = books.reduce((acc, book) => {
        // æœ¬ã®æ–‡å­—åˆ—ã‹ã‚‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æŠ½å‡º
        const statusMatch = book.match(/\(([^)]+)\)$/);
        const status = statusMatch ? statusMatch[1] : 'want_to_read';
        
        if (!acc[status]) acc[status] = [];
        acc[status].push(book);
        return acc;
      }, {});
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“š æœ¬ä¸€è¦§')
        .setColor('#9C27B0')
        .setDescription(`å…¨ ${books.length} å†Šã®æœ¬ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™`)
        .setTimestamp();
      
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«è¡¨ç¤º
      statusOrder.forEach(status => {
        if (groupedBooks[status] && groupedBooks[status].length > 0) {
          const statusName = {
            'want_to_buy': 'ğŸ›’ è²·ã„ãŸã„æœ¬',
            'want_to_read': 'ğŸ“‹ ç©èª­æœ¬',
            'reading': 'ğŸ“– èª­æ›¸ä¸­',
            'finished': 'âœ… èª­äº†æ¸ˆã¿',
            'abandoned': 'âŒ ä¸­æ–­'
          }[status] || status;
          
          // æœ€å¤§8ä»¶ã¾ã§è¡¨ç¤º
          const displayBooks = groupedBooks[status].slice(0, 8);
          const moreCount = groupedBooks[status].length - 8;
          
          let fieldValue = displayBooks.join('\n');
          if (moreCount > 0) {
            fieldValue += `\n... ä»–${moreCount}å†Š`;
          }
          
          embed.addFields({
            name: `${statusName} (${groupedBooks[status].length}å†Š)`,
            value: fieldValue,
            inline: false
          });
        }
      });
      
      embed.setFooter({ text: 'æ“ä½œ: /book start [ID], /book finish [ID], /book buy [ID]' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æœ¬ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æœ¬ä¸€è¦§ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleWishlist(interaction) {
    try {
      const wishlistBooks = await googleSheets.getWishlistBooks();
      
      if (wishlistBooks.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ›’ è²·ã„ãŸã„æœ¬ä¸€è¦§')
          .setColor('#E91E63')
          .setDescription('è²·ã„ãŸã„æœ¬ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸ“š æœ¬ã‚’è¿½åŠ ', value: '`/book add [ã‚¿ã‚¤ãƒˆãƒ«] [ä½œè€…] want_to_buy` ã§è²·ã„ãŸã„æœ¬ã‚’è¿½åŠ ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      // è²·ã„ãŸã„æœ¬ã‚’ã‚«ãƒ†ã‚´ãƒªåˆ†ã‘ã™ã‚‹ãŸã‚ã®ç°¡æ˜“åˆ†é¡
      const categories = {
        'ğŸ“– å°èª¬ãƒ»æ–‡å­¦': [],
        'ğŸ“š æŠ€è¡“æ›¸ãƒ»å®Ÿç”¨æ›¸': [],
        'ğŸ¯ è‡ªå·±å•“ç™ºãƒ»ãƒ“ã‚¸ãƒã‚¹': [],
        'ğŸ“‹ ãã®ä»–': []
      };
      
      // ç°¡æ˜“çš„ãªã‚«ãƒ†ã‚´ãƒªåˆ†é¡ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§åˆ¤å®šï¼‰
      wishlistBooks.forEach(book => {
        const title = book.toLowerCase();
        if (title.includes('å°èª¬') || title.includes('æ–‡å­¦') || title.includes('ç‰©èª') || title.includes('ãƒãƒ™ãƒ«')) {
          categories['ğŸ“– å°èª¬ãƒ»æ–‡å­¦'].push(book);
        } else if (title.includes('æŠ€è¡“') || title.includes('ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°') || title.includes('ãƒ‡ã‚¶ã‚¤ãƒ³') || title.includes('å…¥é–€')) {
          categories['ğŸ“š æŠ€è¡“æ›¸ãƒ»å®Ÿç”¨æ›¸'].push(book);
        } else if (title.includes('ãƒ“ã‚¸ãƒã‚¹') || title.includes('æˆåŠŸ') || title.includes('çµŒå–¶') || title.includes('è‡ªå·±å•“ç™º')) {
          categories['ğŸ¯ è‡ªå·±å•“ç™ºãƒ»ãƒ“ã‚¸ãƒã‚¹'].push(book);
        } else {
          categories['ğŸ“‹ ãã®ä»–'].push(book);
        }
      });
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ›’ è²·ã„ãŸã„æœ¬ä¸€è¦§')
        .setColor('#E91E63')
        .setDescription(`è³¼å…¥äºˆå®šã®æœ¬ãŒ ${wishlistBooks.length} å†Šã‚ã‚Šã¾ã™`)
        .setTimestamp();
      
      // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«è¡¨ç¤º
      Object.entries(categories).forEach(([categoryName, books]) => {
        if (books.length > 0) {
          // æœ€å¤§5ä»¶ã¾ã§è¡¨ç¤º
          const displayBooks = books.slice(0, 5);
          const moreCount = books.length - 5;
          
          let fieldValue = displayBooks.join('\n');
          if (moreCount > 0) {
            fieldValue += `\n... ä»–${moreCount}å†Š`;
          }
          
          embed.addFields({
            name: `${categoryName} (${books.length}å†Š)`,
            value: fieldValue,
            inline: false
          });
        }
      });
      
      embed.setFooter({ text: 'è³¼å…¥ã—ãŸã‚‰ /book buy [ID] ã§ç©èª­ãƒªã‚¹ãƒˆã«ç§»å‹•ã§ãã¾ã™' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('è²·ã„ãŸã„æœ¬ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ è²·ã„ãŸã„æœ¬ä¸€è¦§ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  }
};

```

### handlers/goalsHandler.js

```
const { EmbedBuilder, ActionRowBuilder, ButtonBuilder, ButtonStyle } = require('discord.js');
const goalService = require('../services/goalService');
const { createSuccessEmbed, createErrorEmbed, createInfoEmbed } = require('../utils/embedUtils');
const { formatNumber, getProgressBar, getTimeRemaining } = require('../utils/formatUtils');

/**
 * ç›®æ¨™ç®¡ç†ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ - å®Œå…¨æ©Ÿèƒ½ç‰ˆ
 * å€‹äººç›®æ¨™ã®è¨­å®šãƒ»ç®¡ç†ãƒ»é€²æ—è¿½è·¡ã‚’è¡Œã†
 */
class GoalsHandler {
  constructor() {
    this.presets = {
      beginner: {
        weekly: { books: 1, movies: 2, activities: 3, reports: 5 },
        monthly: { books: 4, movies: 8, activities: 12, reports: 20 }
      },
      standard: {
        weekly: { books: 2, movies: 3, activities: 5, reports: 7 },
        monthly: { books: 8, movies: 12, activities: 20, reports: 28 }
      },
      challenge: {
        weekly: { books: 3, movies: 4, activities: 7, reports: 10 },
        monthly: { books: 12, movies: 16, activities: 28, reports: 40 }
      },
      expert: {
        weekly: { books: 4, movies: 5, activities: 10, reports: 14 },
        monthly: { books: 16, movies: 20, activities: 40, reports: 56 }
      }
    };

    this.categoryEmojis = {
      books: 'ğŸ“š',
      movies: 'ğŸ¬',
      activities: 'ğŸ¯',
      reports: 'ğŸ“'
    };

    this.categoryNames = {
      books: 'æœ¬',
      movies: 'æ˜ ç”»',
      activities: 'æ´»å‹•',
      reports: 'æ—¥å ±'
    };
  }

  /**
   * ãƒ¡ã‚¤ãƒ³ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ - ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã«å¿œã˜ã¦å‡¦ç†ã‚’åˆ†å²
   */
  async execute(interaction) {
    console.log(`[DEBUG] goalsHandler.execute å‘¼ã³å‡ºã—: ${interaction.options.getSubcommand()}`);
    
    const subcommand = interaction.options.getSubcommand();
    
    try {
      switch (subcommand) {
        case 'show':
          return await this.handleShow(interaction);
        case 'set':
          return await this.handleSet(interaction);
        case 'reset':
          return await this.handleReset(interaction);
        case 'quick':
          return await this.handleQuick(interaction);
        case 'progress':
          return await this.handleProgress(interaction);
        default:
          throw new Error(`æœªçŸ¥ã®ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰: ${subcommand}`);
      }
    } catch (error) {
      console.error(`âŒ ç›®æ¨™ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã‚¨ãƒ©ãƒ¼ [${subcommand}]:`, error);
      
      const embed = createErrorEmbed(
        'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ',
        `ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚\nè©³ç´°: ${error.message}`
      );
      
      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed] });
      } else {
        return await interaction.reply({ embeds: [embed], ephemeral: true });
      }
    }
  }

  /**
   * ç¾åœ¨ã®ç›®æ¨™è¨­å®šã‚’è¡¨ç¤º
   */
  async handleShow(interaction) {
    console.log('[DEBUG] handleShow å®Ÿè¡Œ');

    try {
      const userId = interaction.user.id;
      const goals = await goalService.getGoals(userId);
      const currentStats = await goalService.getCurrentProgress(userId);

      const embed = new EmbedBuilder()
        .setColor('#3498db')
        .setTitle('ğŸ¯ ç¾åœ¨ã®ç›®æ¨™è¨­å®š')
        .setDescription('ã‚ãªãŸã®ç›®æ¨™è¨­å®šã¨ä»ŠæœŸã®é€²æ—çŠ¶æ³ã§ã™')
        .setTimestamp();

      // é€±æ¬¡ç›®æ¨™
      if (goals.weekly && Object.keys(goals.weekly).length > 0) {
        const weeklyText = this.formatGoalSection('weekly', goals.weekly, currentStats.weekly);
        embed.addFields({
          name: 'ğŸ“… é€±æ¬¡ç›®æ¨™ (ä»Šé€±)',
          value: weeklyText,
          inline: false
        });
      }

      // æœˆæ¬¡ç›®æ¨™
      if (goals.monthly && Object.keys(goals.monthly).length > 0) {
        const monthlyText = this.formatGoalSection('monthly', goals.monthly, currentStats.monthly);
        embed.addFields({
          name: 'ğŸ—“ï¸ æœˆæ¬¡ç›®æ¨™ (ä»Šæœˆ)',
          value: monthlyText,
          inline: false
        });
      }

      // ç›®æ¨™ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆ
      if ((!goals.weekly || Object.keys(goals.weekly).length === 0) && 
          (!goals.monthly || Object.keys(goals.monthly).length === 0)) {
        embed.setDescription('ã¾ã ç›®æ¨™ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n`/goals quick` ã§ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šã™ã‚‹ã‹ã€`/goals set` ã§å€‹åˆ¥ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚');
        embed.setColor('#95a5a6');
      }

      // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
      const row = new ActionRowBuilder()
        .addComponents(
          new ButtonBuilder()
            .setCustomId('goals_quick_setup')
            .setLabel('âš¡ ã‚¯ã‚¤ãƒƒã‚¯è¨­å®š')
            .setStyle(ButtonStyle.Primary),
          new ButtonBuilder()
            .setCustomId('goals_detailed_progress')
            .setLabel('ğŸ“Š è©³ç´°é€²æ—')
            .setStyle(ButtonStyle.Secondary),
          new ButtonBuilder()
            .setCustomId('goals_reset')
            .setLabel('ğŸ”„ ãƒªã‚»ãƒƒãƒˆ')
            .setStyle(ButtonStyle.Danger)
        );

      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed], components: [row] });
      } else {
        return await interaction.reply({ embeds: [embed], components: [row] });
      }

    } catch (error) {
      console.error('ç›®æ¨™è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
      const embed = createErrorEmbed(
        'âŒ è¡¨ç¤ºã‚¨ãƒ©ãƒ¼',
        'ç›®æ¨™ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
      );
      
      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed] });
      } else {
        return await interaction.reply({ embeds: [embed], ephemeral: true });
      }
    }
  }

  /**
   * å€‹åˆ¥ç›®æ¨™è¨­å®š
   */
  async handleSet(interaction) {
    console.log('[DEBUG] handleSet å®Ÿè¡Œ');

    try {
      const userId = interaction.user.id;
      const period = interaction.options.getString('period');
      const category = interaction.options.getString('category');
      const target = interaction.options.getInteger('target');

      console.log(`[DEBUG] è¨­å®šå†…å®¹: ${period}, ${category}, ${target}`);

      // ç›®æ¨™ã‚’è¨­å®š
      await goalService.setGoal(userId, period, category, target);

      const emoji = this.categoryEmojis[category];
      const categoryName = this.categoryNames[category];
      const periodName = period === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡';

      const embed = createSuccessEmbed(
        'âœ… ç›®æ¨™ã‚’è¨­å®šã—ã¾ã—ãŸ',
        `${emoji} **${categoryName}** ã®${periodName}ç›®æ¨™ã‚’ **${target}** ã«è¨­å®šã—ã¾ã—ãŸã€‚\n\né ‘å¼µã£ã¦é”æˆã—ã¾ã—ã‚‡ã†ï¼ ğŸ’ª`
      );

      // ç¾åœ¨ã®é€²æ—ã‚’å–å¾—ã—ã¦è¡¨ç¤º
      const currentStats = await goalService.getCurrentProgress(userId);
      const current = period === 'weekly' ? currentStats.weekly[category] || 0 : currentStats.monthly[category] || 0;
      const percentage = Math.min(Math.round((current / target) * 100), 100);
      const progressBar = getProgressBar(percentage);

      embed.addFields({
        name: 'ğŸ“Š ç¾åœ¨ã®é€²æ—',
        value: `${progressBar} **${current}/${target}** (${percentage}%)`,
        inline: false
      });

      // åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      if (percentage >= 100) {
        embed.addFields({
          name: 'ğŸ‰ ã™ã§ã«é”æˆæ¸ˆã¿ï¼',
          value: 'ç´ æ™´ã‚‰ã—ã„æˆæœã§ã™ï¼ã•ã‚‰ãªã‚‹ç›®æ¨™ã«æŒ‘æˆ¦ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ',
          inline: false
        });
      } else if (percentage >= 75) {
        embed.addFields({
          name: 'ğŸ”¥ ã‚ã¨å°‘ã—ï¼',
          value: 'ã‚´ãƒ¼ãƒ«ã¾ã§ã‚‚ã†å°‘ã—ã§ã™ã€‚æœ€å¾Œã¾ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼',
          inline: false
        });
      } else if (percentage >= 50) {
        embed.addFields({
          name: 'ğŸ“ˆ é †èª¿ã§ã™',
          value: 'åŠåˆ†ã‚’è¶…ãˆã¾ã—ãŸï¼ã“ã®èª¿å­ã§ç¶šã‘ã¾ã—ã‚‡ã†ã€‚',
          inline: false
        });
      }

      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed] });
      } else {
        return await interaction.reply({ embeds: [embed] });
      }

    } catch (error) {
      console.error('ç›®æ¨™è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
      const embed = createErrorEmbed(
        'âŒ è¨­å®šã‚¨ãƒ©ãƒ¼',
        'ç›®æ¨™ã®è¨­å®šä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
      );
      
      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed] });
      } else {
        return await interaction.reply({ embeds: [embed], ephemeral: true });
      }
    }
  }

  /**
   * ç›®æ¨™ãƒªã‚»ãƒƒãƒˆ
   */
  async handleReset(interaction) {
    console.log('[DEBUG] handleReset å®Ÿè¡Œ');

    try {
      const userId = interaction.user.id;
      const period = interaction.options.getString('period') || 'all';

      if (period === 'all') {
        await goalService.resetAllGoals(userId);
        var message = 'å…¨ã¦ã®ç›®æ¨™ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚';
      } else {
        await goalService.resetGoals(userId, period);
        const periodName = period === 'weekly' ? 'é€±æ¬¡' : 'æœˆæ¬¡';
        var message = `${periodName}ç›®æ¨™ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚`;
      }

      const embed = createSuccessEmbed(
        'ğŸ”„ ç›®æ¨™ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ',
        `${message}\n\næ–°ã—ã„ç›®æ¨™ã‚’è¨­å®šã—ã¦ã€å†ã‚¹ã‚¿ãƒ¼ãƒˆã—ã¾ã—ã‚‡ã†ï¼`
      );

      // ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šã®ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
      const row = new ActionRowBuilder()
        .addComponents(
          new ButtonBuilder()
            .setCustomId('goals_quick_setup')
            .setLabel('âš¡ ã‚¯ã‚¤ãƒƒã‚¯è¨­å®š')
            .setStyle(ButtonStyle.Primary),
          new ButtonBuilder()
            .setCustomId('goals_custom_setup')
            .setLabel('âš™ï¸ å€‹åˆ¥è¨­å®š')
            .setStyle(ButtonStyle.Secondary)
        );

      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed], components: [row] });
      } else {
        return await interaction.reply({ embeds: [embed], components: [row] });
      }

    } catch (error) {
      console.error('ç›®æ¨™ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
      const embed = createErrorEmbed(
        'âŒ ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼',
        'ç›®æ¨™ã®ãƒªã‚»ãƒƒãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
      );
      
      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed] });
      } else {
        return await interaction.reply({ embeds: [embed], ephemeral: true });
      }
    }
  }

  /**
   * ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰
   */
  async handleQuick(interaction) {
    console.log('[DEBUG] handleQuick å®Ÿè¡Œ');

    try {
      const userId = interaction.user.id;
      const preset = interaction.options.getString('preset');

      console.log(`[DEBUG] é¸æŠã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆ: ${preset}`);

      if (!this.presets[preset]) {
        throw new Error(`ç„¡åŠ¹ãªãƒ—ãƒªã‚»ãƒƒãƒˆ: ${preset}`);
      }

      const presetData = this.presets[preset];
      
      // ãƒ—ãƒªã‚»ãƒƒãƒˆã®ç›®æ¨™ã‚’ä¸€æ‹¬è¨­å®š
      await goalService.setGoalsFromPreset(userId, presetData);

      const presetNames = {
        beginner: 'ğŸŒ± åˆå¿ƒè€…å‘ã‘',
        standard: 'ğŸ“ˆ æ¨™æº–',
        challenge: 'ğŸ”¥ ãƒãƒ£ãƒ¬ãƒ³ã‚¸',
        expert: 'ğŸ† ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ'
      };

      const embed = createSuccessEmbed(
        'âš¡ ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šå®Œäº†ï¼',
        `**${presetNames[preset]}** ãƒ—ãƒªã‚»ãƒƒãƒˆã§ç›®æ¨™ã‚’è¨­å®šã—ã¾ã—ãŸã€‚`
      );

      // è¨­å®šã•ã‚ŒãŸç›®æ¨™ã®è©³ç´°è¡¨ç¤º
      const weeklyDetails = Object.entries(presetData.weekly)
        .map(([category, target]) => `${this.categoryEmojis[category]} ${this.categoryNames[category]}: ${target}`)
        .join('\n');

      const monthlyDetails = Object.entries(presetData.monthly)
        .map(([category, target]) => `${this.categoryEmojis[category]} ${this.categoryNames[category]}: ${target}`)
        .join('\n');

      embed.addFields(
        { name: 'ğŸ“… é€±æ¬¡ç›®æ¨™', value: weeklyDetails, inline: true },
        { name: 'ğŸ—“ï¸ æœˆæ¬¡ç›®æ¨™', value: monthlyDetails, inline: true },
        { name: '\u200B', value: '\u200B', inline: false },
        { name: 'ğŸ’¡ ãƒ’ãƒ³ãƒˆ', value: '`/goals progress` ã§è©³ç´°ãªé€²æ—ã‚’ç¢ºèªã§ãã¾ã™ï¼', inline: false }
      );

      // ç¾åœ¨ã®é€²æ—ã‚‚è¡¨ç¤º
      const currentStats = await goalService.getCurrentProgress(userId);
      const progressText = this.formatQuickProgressOverview(presetData, currentStats);
      
      if (progressText) {
        embed.addFields({
          name: 'ğŸ“Š ç¾åœ¨ã®é€²æ—æ¦‚è¦',
          value: progressText,
          inline: false
        });
      }

      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed] });
      } else {
        return await interaction.reply({ embeds: [embed] });
      }

    } catch (error) {
      console.error('ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
      const embed = createErrorEmbed(
        'âŒ è¨­å®šã‚¨ãƒ©ãƒ¼',
        'ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
      );
      
      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed] });
      } else {
        return await interaction.reply({ embeds: [embed], ephemeral: true });
      }
    }
  }

  /**
   * è©³ç´°é€²æ—è¡¨ç¤º
   */
  async handleProgress(interaction) {
    console.log('[DEBUG] handleProgress å®Ÿè¡Œ');

    try {
      const userId = interaction.user.id;
      const goals = await goalService.getGoals(userId);
      const currentStats = await goalService.getCurrentProgress(userId);
      const progressAnalysis = await goalService.getProgressAnalysis(userId);

      if ((!goals.weekly || Object.keys(goals.weekly).length === 0) && 
          (!goals.monthly || Object.keys(goals.monthly).length === 0)) {
        const embed = createInfoEmbed(
          'ğŸ“Š é€²æ—è¡¨ç¤º',
          'ã¾ã ç›®æ¨™ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n`/goals quick` ã§ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šã—ã¦ã‹ã‚‰é€²æ—ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚'
        );
        
        if (interaction.deferred) {
          return await interaction.editReply({ embeds: [embed] });
        } else {
          return await interaction.reply({ embeds: [embed] });
        }
      }

      const embed = new EmbedBuilder()
        .setColor('#2ecc71')
        .setTitle('ğŸ“Š ç›®æ¨™é”æˆé€²æ— - è©³ç´°åˆ†æ')
        .setDescription('ã‚ãªãŸã®ç›®æ¨™é”æˆçŠ¶æ³ã‚’è©³ã—ãåˆ†æã—ã¾ã™')
        .setTimestamp();

      // é€±æ¬¡é€²æ—
      if (goals.weekly && Object.keys(goals.weekly).length > 0) {
        const weeklyAnalysis = this.analyzeProgress('weekly', goals.weekly, currentStats.weekly, progressAnalysis.weekly);
        embed.addFields({
          name: 'ğŸ“… é€±æ¬¡ç›®æ¨™ - ä»Šé€±ã®é€²æ—',
          value: weeklyAnalysis.summary,
          inline: false
        });

        if (weeklyAnalysis.details) {
          embed.addFields({
            name: 'ğŸ“ˆ è©³ç´°åˆ†æ (é€±æ¬¡)',
            value: weeklyAnalysis.details,
            inline: false
          });
        }
      }

      // æœˆæ¬¡é€²æ—
      if (goals.monthly && Object.keys(goals.monthly).length > 0) {
        const monthlyAnalysis = this.analyzeProgress('monthly', goals.monthly, currentStats.monthly, progressAnalysis.monthly);
        embed.addFields({
          name: 'ğŸ—“ï¸ æœˆæ¬¡ç›®æ¨™ - ä»Šæœˆã®é€²æ—',
          value: monthlyAnalysis.summary,
          inline: false
        });

        if (monthlyAnalysis.details) {
          embed.addFields({
            name: 'ğŸ“ˆ è©³ç´°åˆ†æ (æœˆæ¬¡)',
            value: monthlyAnalysis.details,
            inline: false
          });
        }
      }

      // å…¨ä½“ã‚µãƒãƒªãƒ¼
      const overallSummary = this.generateOverallSummary(goals, currentStats, progressAnalysis);
      if (overallSummary) {
        embed.addFields({
          name: 'ğŸ¯ å…¨ä½“ã‚µãƒãƒªãƒ¼',
          value: overallSummary,
          inline: false
        });
      }

      // ã‚¢ãƒ‰ãƒã‚¤ã‚¹
      const advice = this.generateAdvice(goals, currentStats, progressAnalysis);
      if (advice) {
        embed.addFields({
          name: 'ğŸ’¡ ã‚¢ãƒ‰ãƒã‚¤ã‚¹',
          value: advice,
          inline: false
        });
      }

      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed] });
      } else {
        return await interaction.reply({ embeds: [embed] });
      }

    } catch (error) {
      console.error('é€²æ—è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
      const embed = createErrorEmbed(
        'âŒ è¡¨ç¤ºã‚¨ãƒ©ãƒ¼',
        'é€²æ—ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚'
      );
      
      if (interaction.deferred) {
        return await interaction.editReply({ embeds: [embed] });
      } else {
        return await interaction.reply({ embeds: [embed], ephemeral: true });
      }
    }
  }

  /**
   * ç›®æ¨™ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   */
  formatGoalSection(period, goals, currentStats) {
    return Object.entries(goals)
      .map(([category, target]) => {
        const current = currentStats[category] || 0;
        const percentage = Math.min(Math.round((current / target) * 100), 100);
        const progressBar = getProgressBar(percentage);
        const emoji = this.categoryEmojis[category];
        const name = this.categoryNames[category];
        
        let status = '';
        if (percentage >= 100) status = 'âœ…';
        else if (percentage >= 75) status = 'ğŸ”¥';
        else if (percentage >= 50) status = 'ğŸ“ˆ';
        else if (percentage >= 25) status = 'ğŸš€';
        else status = 'ğŸ“';

        return `${status} ${emoji} **${name}**: ${progressBar} **${current}/${target}** (${percentage}%)`;
      })
      .join('\n');
  }

  /**
   * ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šå¾Œã®é€²æ—æ¦‚è¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
   */
  formatQuickProgressOverview(presetData, currentStats) {
    const weeklyTotal = Object.values(presetData.weekly).reduce((sum, target) => sum + target, 0);
    const weeklyCompleted = Object.entries(presetData.weekly).reduce((sum, [category, target]) => {
      const current = Math.min(currentStats.weekly[category] || 0, target);
      return sum + current;
    }, 0);

    const monthlyTotal = Object.values(presetData.monthly).reduce((sum, target) => sum + target, 0);
    const monthlyCompleted = Object.entries(presetData.monthly).reduce((sum, [category, target]) => {
      const current = Math.min(currentStats.monthly[category] || 0, target);
      return sum + current;
    }, 0);

    const weeklyPercentage = Math.round((weeklyCompleted / weeklyTotal) * 100);
    const monthlyPercentage = Math.round((monthlyCompleted / monthlyTotal) * 100);

    return `ğŸ“… **ä»Šé€±**: ${getProgressBar(weeklyPercentage)} ${weeklyCompleted}/${weeklyTotal} (${weeklyPercentage}%)\n` +
           `ğŸ—“ï¸ **ä»Šæœˆ**: ${getProgressBar(monthlyPercentage)} ${monthlyCompleted}/${monthlyTotal} (${monthlyPercentage}%)`;
  }

  /**
   * é€²æ—åˆ†æ
   */
  analyzeProgress(period, goals, currentStats, analysisData) {
    const entries = Object.entries(goals);
    const results = entries.map(([category, target]) => {
      const current = currentStats[category] || 0;
      const percentage = Math.min(Math.round((current / target) * 100), 100);
      return { category, target, current, percentage };
    });

    // ã‚µãƒãƒªãƒ¼
    const summary = results
      .map(({ category, target, current, percentage }) => {
        const emoji = this.categoryEmojis[category];
        const name = this.categoryNames[category];
        const progressBar = getProgressBar(percentage);
        
        let trend = '';
        if (analysisData && analysisData[category]) {
          const trendValue = analysisData[category].trend || 0;
          if (trendValue > 0) trend = ' ğŸ“ˆ';
          else if (trendValue < 0) trend = ' ğŸ“‰';
        }

        return `${emoji} **${name}**: ${progressBar} **${current}/${target}** (${percentage}%)${trend}`;
      })
      .join('\n');

    // è©³ç´°åˆ†æ
    let details = '';
    const avgPercentage = Math.round(results.reduce((sum, r) => sum + r.percentage, 0) / results.length);
    const completedCount = results.filter(r => r.percentage >= 100).length;
    const onTrackCount = results.filter(r => r.percentage >= 75).length;

    if (completedCount > 0) {
      details += `ğŸ‰ **é”æˆæ¸ˆã¿**: ${completedCount}/${results.length} ã‚«ãƒ†ã‚´ãƒª\n`;
    }
    if (onTrackCount > completedCount) {
      details += `ğŸ”¥ **é †èª¿**: ${onTrackCount - completedCount} ã‚«ãƒ†ã‚´ãƒªãŒ75%ä»¥ä¸Šé”æˆ\n`;
    }
    details += `ğŸ“Š **å¹³å‡é€²æ—**: ${avgPercentage}%`;

    // æœŸé–“æ®‹ã‚Šæ™‚é–“ã®æƒ…å ±
    const timeRemaining = getTimeRemaining(period);
    if (timeRemaining) {
      details += `\nâ° **æ®‹ã‚Šæ™‚é–“**: ${timeRemaining}`;
    }

    return { summary, details };
  }

  /**
   * å…¨ä½“ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
   */
  generateOverallSummary(goals, currentStats, progressAnalysis) {
    let summary = '';
    const now = new Date();

    // ä»Šæ—¥ã®å®Ÿç¸¾
    if (progressAnalysis.today) {
      const todayTotal = Object.values(progressAnalysis.today).reduce((sum, count) => sum + count, 0);
      if (todayTotal > 0) {
        summary += `ğŸ“… **ä»Šæ—¥ã®å®Ÿç¸¾**: ${todayTotal}ä»¶ã®æ´»å‹•ã‚’å®Œäº†\n`;
      }
    }

    // ä»Šé€±ãƒ»ä»Šæœˆã®é”æˆç‡
    let weeklyAchieved = 0;
    let weeklyTotal = 0;
    if (goals.weekly) {
      weeklyTotal = Object.keys(goals.weekly).length;
      weeklyAchieved = Object.entries(goals.weekly).filter(([category, target]) => {
        const current = currentStats.weekly[category] || 0;
        return current >= target;
      }).length;
    }

    let monthlyAchieved = 0;
    let monthlyTotal = 0;
    if (goals.monthly) {
      monthlyTotal = Object.keys(goals.monthly).length;
      monthlyAchieved = Object.entries(goals.monthly).filter(([category, target]) => {
        const current = currentStats.monthly[category] || 0;
        return current >= target;
      }).length;
    }

    if (weeklyTotal > 0) {
      summary += `ğŸ“ˆ **é€±æ¬¡é”æˆç‡**: ${weeklyAchieved}/${weeklyTotal} ã‚«ãƒ†ã‚´ãƒª\n`;
    }
    if (monthlyTotal > 0) {
      summary += `ğŸ“Š **æœˆæ¬¡é”æˆç‡**: ${monthlyAchieved}/${monthlyTotal} ã‚«ãƒ†ã‚´ãƒª\n`;
    }

    // ã‚¹ãƒˆãƒªãƒ¼ã‚¯æƒ…å ±
    if (progressAnalysis.streak) {
      summary += `ğŸ”¥ **ç¶™ç¶šã‚¹ãƒˆãƒªãƒ¼ã‚¯**: ${progressAnalysis.streak}æ—¥é–“`;
    }

    return summary || null;
  }

  /**
   * ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ
   */
  generateAdvice(goals, currentStats, progressAnalysis) {
    const advice = [];
    const now = new Date();
    const dayOfWeek = now.getDay(); // 0 = Sunday, 6 = Saturday
    const dayOfMonth = now.getDate();

    // é€±æ¬¡ç›®æ¨™ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
    if (goals.weekly) {
      const weeklyResults = Object.entries(goals.weekly).map(([category, target]) => {
        const current = currentStats.weekly[category] || 0;
        const percentage = (current / target) * 100;
        return { category, target, current, percentage };
      });

      const avgWeeklyProgress = weeklyResults.reduce((sum, r) => sum + r.percentage, 0) / weeklyResults.length;
      
      if (dayOfWeek <= 3 && avgWeeklyProgress < 30) { // æœˆã€œæ°´ã§30%æœªæº€
        advice.push('ğŸ“… é€±ã®å‰åŠã§ã™ã€‚ãƒšãƒ¼ã‚¹ã‚’ä¸Šã’ã¦ç›®æ¨™é”æˆã‚’ç›®æŒ‡ã—ã¾ã—ã‚‡ã†ï¼');
      } else if (dayOfWeek >= 4 && avgWeeklyProgress < 60) { // æœ¨ã€œæ—¥ã§60%æœªæº€
        advice.push('âš¡ é€±æœ«ãŒè¿‘ã¥ã„ã¦ã„ã¾ã™ã€‚ãƒ©ã‚¹ãƒˆã‚¹ãƒ‘ãƒ¼ãƒˆã‚’ã‹ã‘ã¾ã—ã‚‡ã†ï¼');
      } else if (avgWeeklyProgress >= 100) {
        advice.push('ğŸ‰ é€±æ¬¡ç›®æ¨™ã‚’å…¨ã¦é”æˆï¼ã•ã‚‰ãªã‚‹æŒ‘æˆ¦ã‚’æ¤œè¨ã—ã¦ã¿ã¦ã¯ï¼Ÿ');
      }
    }

    // æœˆæ¬¡ç›®æ¨™ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
    if (goals.monthly) {
      const monthlyResults = Object.entries(goals.monthly).map(([category, target]) => {
        const current = currentStats.monthly[category] || 0;
        const percentage = (current / target) * 100;
        return { category, target, current, percentage };
      });

      const avgMonthlyProgress = monthlyResults.reduce((sum, r) => sum + r.percentage, 0) / monthlyResults.length;
      const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
      const expectedProgress = (dayOfMonth / daysInMonth) * 100;

      if (avgMonthlyProgress < expectedProgress - 20) {
        advice.push('ğŸ“Š æœˆæ¬¡ç›®æ¨™ãŒäºˆå®šã‚ˆã‚Šé…ã‚Œã¦ã„ã¾ã™ã€‚è¨ˆç”»ã‚’è¦‹ç›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚');
      } else if (avgMonthlyProgress > expectedProgress + 20) {
        advice.push('ğŸš€ æœˆæ¬¡ç›®æ¨™ãŒäºˆå®šã‚ˆã‚Šæ—©ãé€²ã‚“ã§ã„ã¾ã™ï¼ã“ã®èª¿å­ã§ç¶šã‘ã¾ã—ã‚‡ã†ã€‚');
      }
    }

    // ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
    const allStats = { ...currentStats.weekly, ...currentStats.monthly };
    const lowPerformance = Object.entries(allStats).filter(([category, count]) => count === 0);
    
    if (lowPerformance.length > 0) {
      const categories = lowPerformance.map(([category]) => this.categoryNames[category]).join('ã€');
      advice.push(`ğŸ’¡ ${categories}ã®æ´»å‹•ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚å°ã•ãªä¸€æ­©ã‹ã‚‰å§‹ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚`);
    }

    // ç¶™ç¶šã«é–¢ã™ã‚‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹
    if (progressAnalysis.streak >= 7) {
      advice.push('ğŸ”¥ ç´ æ™´ã‚‰ã—ã„ç¶™ç¶šåŠ›ã§ã™ï¼ã“ã®èª¿å­ã§ç¿’æ…£ã‚’ç¶­æŒã—ã¾ã—ã‚‡ã†ã€‚');
    } else if (progressAnalysis.streak === 0) {
      advice.push('ğŸŒ± ä»Šæ—¥ã‹ã‚‰æ–°ã—ã„ã‚¹ã‚¿ãƒ¼ãƒˆã§ã™ã€‚å°ã•ãªç›®æ¨™ã‹ã‚‰å§‹ã‚ã¦ã¿ã¾ã—ã‚‡ã†ã€‚');
    }

    return advice.length > 0 ? advice.join('\n\n') : null;
  }
}

module.exports = new GoalsHandler();

```

### handlers/statsHandler.js

```
// handlers/statsHandler.js - ä¿®æ­£ç‰ˆ

const { EmbedBuilder } = require('discord.js');
const GoogleSheetsService = require('../services/googleSheets');
const StatsUtility = require('../services/statsUtility'); // ğŸ†• è¿½åŠ 

// GoogleSheetsServiceã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
const googleSheets = new GoogleSheetsService();
const statsUtil = new StatsUtility(googleSheets); // ğŸ†• è¿½åŠ 

module.exports = {
  async execute(interaction) {
    const subcommand = interaction.options.getSubcommand();
    
    try {
      switch (subcommand) {
        case 'summary':
          await module.exports.showSummary(interaction); // â† ã“ã®ã‚ˆã†ã«ä¿®æ­£
          break;
        case 'weekly':
          await module.exports.showWeekly(interaction);
          break;
        case 'monthly':
          await module.exports.showMonthly(interaction);
          break;
        case 'books':
          await module.exports.showBooks(interaction);
          break;
        case 'current':
          await module.exports.showCurrent(interaction);
          break;
        case 'trends':
          await module.exports.showTrends(interaction);
          break;
        case 'goals':
          await module.exports.showGoals(interaction);
          break;
        case 'compare':
          await module.exports.showCompare(interaction);
          break;
        default:
          await interaction.editReply(`âŒ ä¸æ˜ãªã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰: ${subcommand}`);
      }
    } catch (error) {
      console.error('StatsHandler ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ çµ±è¨ˆæƒ…å ±ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ğŸ“Š å…¨ä½“çµ±è¨ˆã‚µãƒãƒªãƒ¼
  async showSummary(interaction) {
    try {
      // å…¨ã¦ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ä¸¦è¡Œå–å¾—
      const [bookCounts, movieCounts, activityCounts] = await Promise.all([
        googleSheets.getBookCounts(),
        googleSheets.getMovieCounts(),
        googleSheets.getActivityCounts()
      ]);
      
      const totalItems = bookCounts.total + movieCounts.total + activityCounts.total;
      const completedItems = bookCounts.finished + movieCounts.watched + activityCounts.done;
      const completionRate = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“Š å…¨ä½“çµ±è¨ˆã‚µãƒãƒªãƒ¼')
        .setColor('#3498DB')
        .setDescription(`å…¨ä½“ã§ **${totalItems}** ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç®¡ç†ä¸­`)
        .addFields(
          { 
            name: 'ğŸ“š æœ¬ã®ç®¡ç†çŠ¶æ³', 
            value: `ğŸ›’ è²·ã„ãŸã„: **${bookCounts.wantToBuy || 0}**å†Š\nğŸ“‹ ç©èª­: **${bookCounts.wantToRead || 0}**å†Š\nğŸ“– èª­æ›¸ä¸­: **${bookCounts.reading}**å†Š\nâœ… èª­äº†: **${bookCounts.finished}**å†Š`, 
            inline: true 
          },
          { 
            name: 'ğŸ¬ æ˜ ç”»ã®ç®¡ç†çŠ¶æ³', 
            value: `ğŸ¿ è¦³ãŸã„: **${movieCounts.wantToWatch}**æœ¬\nâœ… è¦–è´æ¸ˆã¿: **${movieCounts.watched}**æœ¬\nğŸ˜… è¦‹é€ƒã—: **${movieCounts.missed || 0}**æœ¬`, 
            inline: true 
          },
          { 
            name: 'ğŸ¯ æ´»å‹•ã®ç®¡ç†çŠ¶æ³', 
            value: `ğŸ¯ äºˆå®šä¸­: **${activityCounts.planned}**ä»¶\nâœ… å®Œäº†: **${activityCounts.done}**ä»¶\nğŸ˜… ã‚¹ã‚­ãƒƒãƒ—: **${activityCounts.skipped || 0}**ä»¶`, 
            inline: true 
          }
        )
        .setTimestamp();
      
      // å…¨ä½“ã®å®Œäº†ç‡ã‚’è¡¨ç¤º
      if (totalItems > 0) {
        embed.addFields({
          name: 'ğŸ† å…¨ä½“ã®é”æˆçŠ¶æ³',
          value: `å®Œäº†ç‡: **${completionRate}%** (${completedItems}/${totalItems})\n${module.exports.generateProgressBar(completionRate)}`,
          inline: false
        });
      }
      
      // åŠ±ã¾ã—ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
      const encouragementMessages = [
        'ç¶™ç¶šçš„ãªç®¡ç†ã€ç´ æ™´ã‚‰ã—ã„ã§ã™ã­ï¼',
        'ãƒ‡ãƒ¼ã‚¿ãŒè“„ç©ã•ã‚Œã¦ãã¦ã„ã¾ã™ï¼',
        'ç›®æ¨™ã«å‘ã‹ã£ã¦ç€å®Ÿã«é€²ã‚“ã§ã„ã¾ã™ã­ï¼',
        'è¨˜éŒ²ã™ã‚‹ç¿’æ…£ãŒèº«ã«ã¤ã„ã¦ãã¾ã—ãŸã­ï¼',
        'ã“ã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼'
      ];
      
      const randomMessage = encouragementMessages[Math.floor(Math.random() * encouragementMessages.length)];
      embed.setFooter({ text: randomMessage });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('å…¨ä½“çµ±è¨ˆã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ çµ±è¨ˆæƒ…å ±ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ğŸ“… é€±æ¬¡çµ±è¨ˆ
  async showWeekly(interaction) {
    try {
      const weeklyStats = await googleSheets.getWeeklyStats();
      const recentReports = await googleSheets.getRecentReports(7);
      
      const totalCompleted = weeklyStats.finishedBooks + weeklyStats.watchedMovies + weeklyStats.completedActivities;
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“… ä»Šé€±ã®æ´»å‹•çµ±è¨ˆ')
        .setColor('#2ECC71')
        .setDescription(`ä»Šé€±ã¯ **${totalCompleted}** ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å®Œäº†ã—ã¾ã—ãŸï¼`)
        .addFields(
          { name: 'ğŸ“š èª­äº†ã—ãŸæœ¬', value: `**${weeklyStats.finishedBooks}**å†Š`, inline: true },
          { name: 'ğŸ¬ è¦–è´ã—ãŸæ˜ ç”»', value: `**${weeklyStats.watchedMovies}**æœ¬`, inline: true },
          { name: 'ğŸ¯ å®Œäº†ã—ãŸæ´»å‹•', value: `**${weeklyStats.completedActivities}**ä»¶`, inline: true },
          { name: 'ğŸ“ è¨˜éŒ²ã—ãŸæ—¥å ±', value: `**${recentReports.length}**ä»¶`, inline: true }
        )
        .setTimestamp();
      
      // é€±æ¬¡ç›®æ¨™ã¨ã®æ¯”è¼ƒï¼ˆä»®æƒ³çš„ãªç›®æ¨™è¨­å®šï¼‰
      const weeklyGoals = {
        books: 2,
        movies: 3,
        activities: 5,
        reports: 7
      };
      
      const achievements = [];
      if (weeklyStats.finishedBooks >= weeklyGoals.books) achievements.push('ğŸ“š èª­æ›¸ç›®æ¨™é”æˆï¼');
      if (weeklyStats.watchedMovies >= weeklyGoals.movies) achievements.push('ğŸ¬ æ˜ ç”»ç›®æ¨™é”æˆï¼');
      if (weeklyStats.completedActivities >= weeklyGoals.activities) achievements.push('ğŸ¯ æ´»å‹•ç›®æ¨™é”æˆï¼');
      if (recentReports.length >= weeklyGoals.reports) achievements.push('ğŸ“ æ—¥å ±ç›®æ¨™é”æˆï¼');
      
      if (achievements.length > 0) {
        embed.addFields({
          name: 'ğŸ† ä»Šé€±ã®é”æˆé …ç›®',
          value: achievements.join('\n'),
          inline: false
        });
      }
      
      // æ›œæ—¥åˆ¥ã®æ´»å‹•åˆ†æ
      const dayOfWeek = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
      const today = new Date();
      const todayName = dayOfWeek[today.getDay()];
      
      embed.addFields({
        name: 'ğŸ“Š é€±æ¬¡ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹',
        value: `ä»Šæ—¥ã¯${todayName}æ›œæ—¥ã§ã™\nå¹³å‡: 1æ—¥${(totalCompleted / 7).toFixed(1)}ä»¶ã®ãƒšãƒ¼ã‚¹`,
        inline: false
      });
      
      embed.setFooter({ text: 'ä»Šé€±ã‚‚å……å®Ÿã—ãŸé€±ã«ãªã‚Šã¾ã—ãŸã­ï¼æ¥é€±ã‚‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('é€±æ¬¡çµ±è¨ˆã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ é€±æ¬¡çµ±è¨ˆã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ğŸ—“ï¸ æœˆæ¬¡çµ±è¨ˆ
  async showMonthly(interaction) {
    try {
      const [monthlyStats, bookTitles, recentReports] = await Promise.all([
        googleSheets.getMonthlyStats(),
        googleSheets.getMonthlyBookTitles(),
        googleSheets.getRecentReports(30)
      ]);
      
      const totalCompleted = monthlyStats.finishedBooks + monthlyStats.watchedMovies + monthlyStats.completedActivities;
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ—“ï¸ ä»Šæœˆã®æ´»å‹•çµ±è¨ˆ')
        .setColor('#9B59B6')
        .setDescription(`ä»Šæœˆã¯ **${totalCompleted}** ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å®Œäº†ã—ã¾ã—ãŸï¼`)
        .addFields(
          { name: 'ğŸ“š èª­äº†å†Šæ•°', value: `**${monthlyStats.finishedBooks}**å†Š`, inline: true },
          { name: 'ğŸ¬ è¦–è´æœ¬æ•°', value: `**${monthlyStats.watchedMovies}**æœ¬`, inline: true },
          { name: 'ğŸ¯ å®Œäº†æ´»å‹•', value: `**${monthlyStats.completedActivities}**ä»¶`, inline: true },
          { name: 'ğŸ“ æ—¥å ±ä»¶æ•°', value: `**${recentReports.length}**ä»¶`, inline: true }
        )
        .setTimestamp();
      
      // ä»Šæœˆèª­äº†ã—ãŸæœ¬ã®ãƒªã‚¹ãƒˆ
      if (bookTitles && bookTitles.length > 0) {
        const displayTitles = bookTitles.slice(0, 8);
        const moreTitles = bookTitles.length - 8;
        
        let titlesList = displayTitles.map((title, index) => `${index + 1}. ${title}`).join('\n');
        if (moreTitles > 0) {
          titlesList += `\n... ä»–${moreTitles}å†Š`;
        }
        
        embed.addFields({ 
          name: 'ğŸ† ä»Šæœˆèª­äº†ã—ãŸæœ¬', 
          value: titlesList, 
          inline: false 
        });
      }
      
      // æœˆæ¬¡ã®é”æˆãƒ¬ãƒ™ãƒ«è©•ä¾¡
      const monthlyLevel = module.exports.calculateMonthlyLevel(totalCompleted);
      embed.addFields({
        name: 'ğŸŒŸ ä»Šæœˆã®æ´»å‹•ãƒ¬ãƒ™ãƒ«',
        value: `${monthlyLevel.icon} **${monthlyLevel.name}**\n${monthlyLevel.description}`,
        inline: false
      });
      
      // æ¥æœˆã¸ã®åŠ±ã¾ã—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      const currentDate = new Date();
      const nextMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
      const nextMonthName = nextMonth.toLocaleDateString('ja-JP', { month: 'long' });
      
      embed.setFooter({ text: `ç´ æ™´ã‚‰ã—ã„1ãƒ¶æœˆã§ã—ãŸï¼${nextMonthName}ã‚‚é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼` });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æœˆæ¬¡çµ±è¨ˆã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æœˆæ¬¡çµ±è¨ˆã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ğŸ“š èª­æ›¸çµ±è¨ˆè©³ç´°
  async showBooks(interaction) {
    try {
      const [bookCounts, allStats] = await Promise.all([
        googleSheets.getBookCounts(),
        googleSheets.getAllStats()
      ]);
      
      // èª­æ›¸ãƒšãƒ¼ã‚¹ã®è¨ˆç®—
      const monthlyStats = await googleSheets.getMonthlyStats();
      const weeklyStats = await googleSheets.getWeeklyStats();
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“š èª­æ›¸çµ±è¨ˆè©³ç´°')
        .setColor('#E74C3C')
        .setDescription(`å…¨ **${bookCounts.total}** å†Šã®æœ¬ã‚’ç®¡ç†ä¸­`)
        .addFields(
          { 
            name: 'ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥çµ±è¨ˆ', 
            value: `ğŸ›’ è²·ã„ãŸã„: **${bookCounts.wantToBuy || 0}**å†Š\nğŸ“‹ ç©èª­: **${bookCounts.wantToRead || 0}**å†Š\nğŸ“– èª­æ›¸ä¸­: **${bookCounts.reading}**å†Š\nâœ… èª­äº†: **${bookCounts.finished}**å†Š`, 
            inline: true 
          },
          { 
            name: 'ğŸ“… æœŸé–“åˆ¥èª­äº†æ•°', 
            value: `ä»Šæœˆ: **${monthlyStats.finishedBooks}**å†Š\nä»Šé€±: **${weeklyStats.finishedBooks}**å†Š\n1æ—¥å¹³å‡: **${(monthlyStats.finishedBooks / 30).toFixed(1)}**å†Š`, 
            inline: true 
          }
        )
        .setTimestamp();
      
      // èª­æ›¸åŠ¹ç‡ã®åˆ†æ
      const totalBooks = bookCounts.total;
      const completionRate = totalBooks > 0 ? Math.round((bookCounts.finished / totalBooks) * 100) : 0;
      
      embed.addFields({
        name: 'ğŸ“ˆ èª­æ›¸åŠ¹ç‡åˆ†æ',
        value: `å®Œèª­ç‡: **${completionRate}%**\n${module.exports.generateProgressBar(completionRate)}\nç©èª­æ¶ˆåŒ–ç‡: **${module.exports.calculateBacklogRate(bookCounts)}%**`,
        inline: false
      });
      
      // èª­æ›¸ãƒšãƒ¼ã‚¹ã®è©•ä¾¡
      const readingPace = module.exports.evaluateReadingPace(monthlyStats.finishedBooks);
      embed.addFields({
        name: 'âš¡ èª­æ›¸ãƒšãƒ¼ã‚¹è©•ä¾¡',
        value: `${readingPace.icon} **${readingPace.level}**\n${readingPace.comment}`,
        inline: false
      });
      
      // èª­æ›¸ç›®æ¨™ã®ææ¡ˆ
      const nextGoal = module.exports.suggestReadingGoal(monthlyStats.finishedBooks, bookCounts.wantToRead);
      if (nextGoal) {
        embed.addFields({
          name: 'ğŸ¯ ãŠã™ã™ã‚ç›®æ¨™',
          value: nextGoal,
          inline: false
        });
      }
      
      embed.setFooter({ text: 'èª­æ›¸ã¯çŸ¥è­˜ã®æ‰‰ã‚’é–‹ãéµã§ã™ï¼' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('èª­æ›¸çµ±è¨ˆã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ èª­æ›¸çµ±è¨ˆã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // âš¡ ç¾åœ¨ã®é€²è¡ŒçŠ¶æ³
  async showCurrent(interaction) {
    try {
      const currentProgress = await googleSheets.getCurrentProgress();
      
      const readingList = currentProgress.readingBooks.length > 0 
        ? currentProgress.readingBooks.map(book => `ğŸ“– [${book.id}] ${book.title}`).join('\n')
        : 'ç¾åœ¨èª­æ›¸ä¸­ã®æœ¬ã¯ã‚ã‚Šã¾ã›ã‚“';
      
      const movieList = currentProgress.wantToWatchMovies.length > 0
        ? currentProgress.wantToWatchMovies.slice(0, 8).map(movie => `ğŸ¿ [${movie.id}] ${movie.title}`).join('\n')
        : 'è¦³ãŸã„æ˜ ç”»ãŒã‚ã‚Šã¾ã›ã‚“';
      
      // äºˆå®šä¸­ã®æ´»å‹•ã‚‚å–å¾—
      const activities = await googleSheets.getActivities();
      const plannedActivities = activities.filter(activity => activity.includes('(planned)'));
      
      const activityList = plannedActivities.length > 0
        ? plannedActivities.slice(0, 8).map(activity => {
            const match = activity.match(/\[(\d+)\] (.+?) \(/);
            return match ? `ğŸ¯ [${match[1]}] ${match[2]}` : activity;
          }).join('\n')
        : 'äºˆå®šä¸­ã®æ´»å‹•ãŒã‚ã‚Šã¾ã›ã‚“';
      
      const embed = new EmbedBuilder()
        .setTitle('âš¡ ç¾åœ¨ã®é€²è¡ŒçŠ¶æ³')
        .setColor('#F39C12')
        .setDescription('ã‚ãªãŸã®ç¾åœ¨ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§')
        .addFields(
          { name: 'ğŸ“– èª­æ›¸ä¸­ã®æœ¬', value: readingList, inline: false },
          { name: 'ğŸ¬ è¦³ãŸã„æ˜ ç”»', value: movieList, inline: false },
          { name: 'ğŸ¯ äºˆå®šä¸­ã®æ´»å‹•', value: activityList, inline: false }
        )
        .setTimestamp();
      
      // é€²è¡ŒçŠ¶æ³ã®ã‚µãƒãƒªãƒ¼
      const totalInProgress = currentProgress.readingBooks.length + 
                             currentProgress.wantToWatchMovies.length + 
                             plannedActivities.length;
      
      if (totalInProgress > 0) {
        embed.addFields({
          name: 'ğŸ“Š é€²è¡Œä¸­ã‚µãƒãƒªãƒ¼',
          value: `å…¨ä½“ã§ **${totalInProgress}** ä»¶ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒé€²è¡Œä¸­ã§ã™`,
          inline: false
        });
        
        // å„ªå…ˆåº¦ã®ææ¡ˆ
        const suggestions = [];
        if (currentProgress.readingBooks.length > 0) {
          suggestions.push('ğŸ“š èª­æ›¸ã‚’é€²ã‚ã‚‹');
        }
        if (currentProgress.wantToWatchMovies.length > 0) {
          suggestions.push('ğŸ¬ æ˜ ç”»ã‚’è¦³ã‚‹');
        }
        if (plannedActivities.length > 0) {
          suggestions.push('ğŸ¯ æ´»å‹•ã‚’å®Ÿè¡Œã™ã‚‹');
        }
        
        if (suggestions.length > 0) {
          embed.addFields({
            name: 'ğŸ’¡ ä»Šæ—¥ã®ãŠã™ã™ã‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³',
            value: suggestions.join('ã€') + 'ã®ã„ãšã‚Œã‹ã«å–ã‚Šçµ„ã‚“ã§ã¿ã¾ã›ã‚“ã‹ï¼Ÿ',
            inline: false
          });
        }
      } else {
        embed.setDescription('ç¾åœ¨é€²è¡Œä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ–°ã—ã„ç›®æ¨™ã‚’è¨­å®šã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ');
        embed.addFields({
          name: 'ğŸš€ æ–°ã—ãå§‹ã‚ã¾ã›ã‚“ã‹ï¼Ÿ',
          value: 'â€¢ `/book add` - æ–°ã—ã„æœ¬ã‚’è¿½åŠ \nâ€¢ `/movie add` - è¦³ãŸã„æ˜ ç”»ã‚’è¿½åŠ \nâ€¢ `/activity add` - æ–°ã—ã„æ´»å‹•ã‚’è¿½åŠ ',
          inline: false
        });
      }
      
      embed.setFooter({ text: 'ä»Šæ—¥ã‚‚ä¸€æ­©ãšã¤å‰é€²ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('é€²è¡ŒçŠ¶æ³ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ é€²è¡ŒçŠ¶æ³ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ğŸ¯ ç›®æ¨™é”æˆçŠ¶æ³
  async showGoals(interaction) {
    try {
      const [weeklyStats, monthlyStats] = await Promise.all([
        googleSheets.getWeeklyStats(),
        googleSheets.getMonthlyStats()
      ]);

      // ç›®æ¨™è¨­å®šï¼ˆconfig/constants.jsã‹ã‚‰ï¼‰
      const weeklyGoals = { books: 2, movies: 3, activities: 5 };
      const monthlyGoals = { books: 8, movies: 12, activities: 20 };

      const embed = new EmbedBuilder()
        .setTitle('ğŸ¯ ç›®æ¨™é”æˆçŠ¶æ³')
        .setColor('#4CAF50')
        .setDescription('è¨­å®šã•ã‚ŒãŸç›®æ¨™ã«å¯¾ã™ã‚‹ç¾åœ¨ã®é”æˆçŠ¶æ³')
        .setTimestamp();

      // é€±æ¬¡ç›®æ¨™
      const bookWeeklyRate = Math.round((weeklyStats.finishedBooks / weeklyGoals.books) * 100);
      const movieWeeklyRate = Math.round((weeklyStats.watchedMovies / weeklyGoals.movies) * 100);
      const activityWeeklyRate = Math.round((weeklyStats.completedActivities / weeklyGoals.activities) * 100);

      embed.addFields({
        name: 'ğŸ“… ä»Šé€±ã®ç›®æ¨™é”æˆçŠ¶æ³',
        value: 
          `ğŸ“š èª­æ›¸: ${weeklyStats.finishedBooks}/${weeklyGoals.books}å†Š (${bookWeeklyRate}%) ${module.exports.getProgressBar(bookWeeklyRate)}\n` +
          `ğŸ¬ æ˜ ç”»: ${weeklyStats.watchedMovies}/${weeklyGoals.movies}æœ¬ (${movieWeeklyRate}%) ${module.exports.getProgressBar(movieWeeklyRate)}\n` +
          `ğŸ¯ æ´»å‹•: ${weeklyStats.completedActivities}/${weeklyGoals.activities}ä»¶ (${activityWeeklyRate}%) ${module.exports.getProgressBar(activityWeeklyRate)}`,
        inline: false
      });

      // æœˆæ¬¡ç›®æ¨™
      const bookMonthlyRate = Math.round((monthlyStats.finishedBooks / monthlyGoals.books) * 100);
      const movieMonthlyRate = Math.round((monthlyStats.watchedMovies / monthlyGoals.movies) * 100);
      const activityMonthlyRate = Math.round((monthlyStats.completedActivities / monthlyGoals.activities) * 100);

      embed.addFields({
        name: 'ğŸ—“ï¸ ä»Šæœˆã®ç›®æ¨™é”æˆçŠ¶æ³',
        value: 
          `ğŸ“š èª­æ›¸: ${monthlyStats.finishedBooks}/${monthlyGoals.books}å†Š (${bookMonthlyRate}%) ${module.exports.getProgressBar(bookMonthlyRate)}\n` +
          `ğŸ¬ æ˜ ç”»: ${monthlyStats.watchedMovies}/${monthlyGoals.movies}æœ¬ (${movieMonthlyRate}%) ${module.exports.getProgressBar(movieMonthlyRate)}\n` +
          `ğŸ¯ æ´»å‹•: ${monthlyStats.completedActivities}/${monthlyGoals.activities}ä»¶ (${activityMonthlyRate}%) ${module.exports.getProgressBar(activityMonthlyRate)}`,
        inline: false
      });

      // é”æˆãƒãƒƒã‚¸
      const badges = [];
      if (bookWeeklyRate >= 100) badges.push('ğŸ“š é€±é–“èª­æ›¸é”æˆ');
      if (movieWeeklyRate >= 100) badges.push('ğŸ¬ é€±é–“æ˜ ç”»é”æˆ');
      if (activityWeeklyRate >= 100) badges.push('ğŸ¯ é€±é–“æ´»å‹•é”æˆ');
      if (bookMonthlyRate >= 100) badges.push('ğŸ“š æœˆé–“èª­æ›¸é”æˆ');
      if (movieMonthlyRate >= 100) badges.push('ğŸ¬ æœˆé–“æ˜ ç”»é”æˆ');
      if (activityMonthlyRate >= 100) badges.push('ğŸ¯ æœˆé–“æ´»å‹•é”æˆ');

      if (badges.length > 0) {
        embed.addFields({
          name: 'ğŸ† ç²å¾—ãƒãƒƒã‚¸',
          value: badges.join('\n'),
          inline: false
        });
      }

      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('ç›®æ¨™çŠ¶æ³ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ ç›®æ¨™é”æˆçŠ¶æ³ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ğŸ“ˆ ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆStatsUtilityã‚’ä½¿ç”¨ã™ã‚‹ç‰ˆã«æ›´æ–°ï¼‰
  async showTrends(interaction) {
    try {
      const [weeklyStats, monthlyStats, reports, detailedTrends] = await Promise.all([
        googleSheets.getWeeklyStats(),
        googleSheets.getMonthlyStats(), 
        googleSheets.getRecentReports(60),
        statsUtil.calculateDetailedTrends() // ğŸ†• StatsUtilityã‚’ä½¿ç”¨
      ]);

      const embed = new EmbedBuilder()
        .setTitle('ğŸ“ˆ æ´»å‹•ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ')
        .setColor('#FF5722')
        .setDescription('éå»ã®æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰å‚¾å‘ã‚’åˆ†æã—ã¾ã—ãŸ')
        .addFields(
          { 
            name: 'ğŸ“Š è©³ç´°ãƒšãƒ¼ã‚¹åˆ†æ', 
            value: detailedTrends.paceAnalysis, // ğŸ†• è©³ç´°ãªåˆ†æçµæœ
            inline: false 
          },
          { 
            name: 'ğŸ“… æ´»å‹•ãƒ‘ã‚¿ãƒ¼ãƒ³', 
            value: `æœ€ã‚‚æ´»ç™º: ${detailedTrends.mostActiveDay}\nã‚«ãƒ†ã‚´ãƒªåˆ¥: ${detailedTrends.categoryTrends}`,
            inline: false 
          },
          { 
            name: 'ğŸ”¥ æ´»å‹•ãƒ¬ãƒ™ãƒ«', 
            value: this.analyzeActivityLevel(reports),
            inline: true 
          },
          { 
            name: 'ğŸ“ˆ æˆé•·äºˆæ¸¬', 
            value: this.predictGrowth(reports),
            inline: true 
          }
        )
        .setFooter({ text: 'ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã¯ç¶™ç¶šçš„ãªè¨˜éŒ²ã§ã‚ˆã‚Šæ­£ç¢ºã«ãªã‚Šã¾ã™' })
        .setTimestamp();

      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ğŸ“Š æœŸé–“æ¯”è¼ƒï¼ˆå®Œå…¨ç‰ˆã«æ›´æ–°ï¼‰
  async showCompare(interaction) {
    try {
      const period = interaction.options.getString('period');
      
      let compareData;
      switch (period) {
        case 'week':
          compareData = await this.compareWeeks(); // ğŸ†• å®Œå…¨ç‰ˆã«æ›´æ–°
          break;
        case 'month':
          compareData = await this.compareMonths(); // ğŸ†• å®Œå…¨ç‰ˆã«æ›´æ–°
          break;
        case 'year':
          compareData = await this.compareYears();
          break;
        default:
          await interaction.editReply('âŒ ç„¡åŠ¹ãªæœŸé–“ãŒæŒ‡å®šã•ã‚Œã¾ã—ãŸã€‚');
          return;
      }

      const embed = new EmbedBuilder()
        .setTitle(`ğŸ“Š ${compareData.title}`)
        .setColor('#9C27B0')
        .setDescription(compareData.description)
        .addFields(...compareData.fields)
        .setFooter({ text: compareData.footer })
        .setTimestamp();

      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æœŸé–“æ¯”è¼ƒã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æœŸé–“æ¯”è¼ƒä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  // ===============================
  // ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆæ›´æ–°ç‰ˆï¼‰
  // ===============================

  // ğŸ“… å®Œå…¨ç‰ˆé€±æ¬¡æ¯”è¼ƒ
  async compareWeeks() {
    try {
      const comparison = await statsUtil.getEnhancedWeeklyComparison(); // ğŸ†• StatsUtilityã‚’ä½¿ç”¨
      
      if (!comparison) {
        return {
          title: 'ä»Šé€± vs å…ˆé€±ã®æ¯”è¼ƒ',
          description: 'ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã§ã™...',
          fields: [{ name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: 'ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„', inline: false }],
          footer: 'ç¶™ç¶šçš„ãªè¨˜éŒ²ã§ã‚ˆã‚Šæ­£ç¢ºãªæ¯”è¼ƒãŒå¯èƒ½ã«ãªã‚Šã¾ã™'
        };
      }

      return {
        title: 'ğŸ“… é€±æ¬¡æ¯”è¼ƒåˆ†æ - éå»3é€±é–“',
        description: 'é€±å˜ä½ã§ã®æ´»å‹•é‡æ¨ç§»ã‚’è©³ã—ãåˆ†æã—ã¾ã—ãŸ',
        fields: [
          {
            name: 'ğŸ“Š 3é€±é–“ã®æ¨ç§»',
            value: comparison.comparison,
            inline: false
          },
          {
            name: 'ğŸ“ˆ æˆé•·åˆ†æ',
            value: comparison.growth.summary,
            inline: false
          },
          {
            name: 'ğŸ”® æ¥é€±ã®äºˆæ¸¬',
            value: comparison.trend,
            inline: false
          },
          {
            name: 'ğŸ’¡ åˆ†æçµæœ',
            value: this.generateWeeklyInsights(comparison.growth), // ğŸ†• æ´å¯Ÿç”Ÿæˆ
            inline: false
          }
        ],
        footer: 'é€±æ¬¡ãƒ‡ãƒ¼ã‚¿ã®è“„ç©ã«ã‚ˆã‚Šã€ã‚ˆã‚Šç²¾å¯†ãªåˆ†æãŒå¯èƒ½ã§ã™'
      };
    } catch (error) {
      console.error('é€±æ¬¡æ¯”è¼ƒã‚¨ãƒ©ãƒ¼:', error);
      return {
        title: 'é€±æ¬¡æ¯”è¼ƒ',
        description: 'ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ',
        fields: [{ name: 'ã‚¨ãƒ©ãƒ¼', value: 'å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„', inline: false }],
        footer: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
      };
    }
  },

  // ğŸ“Š å®Œå…¨ç‰ˆæœˆæ¬¡æ¯”è¼ƒ
  async compareMonths() {
    try {
      // éå»3ãƒ¶æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const [thisMonth, lastMonth, twoMonthsAgo] = await Promise.all([
        googleSheets.getMonthlyStats(),
        statsUtil.getMonthlyStatsForDate(statsUtil.getPreviousMonth(1)), // ğŸ†• StatsUtilityã‚’ä½¿ç”¨
        statsUtil.getMonthlyStatsForDate(statsUtil.getPreviousMonth(2))  // ğŸ†• StatsUtilityã‚’ä½¿ç”¨
      ]);

      const monthNames = statsUtil.getLastThreeMonthNames(); // ğŸ†• StatsUtilityã‚’ä½¿ç”¨
      const growthAnalysis = statsUtil.calculateGrowthRates(twoMonthsAgo, lastMonth, thisMonth); // ğŸ†• StatsUtilityã‚’ä½¿ç”¨
      
      return {
        title: 'ğŸ“Š æœˆæ¬¡æ¯”è¼ƒåˆ†æ - éå»3ãƒ¶æœˆ',
        description: 'æœˆå˜ä½ã§ã®æˆé•·ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å‚¾å‘ã‚’åˆ†æã—ã¾ã—ãŸ',
        fields: [
          {
            name: 'ğŸ“ˆ 3ãƒ¶æœˆé–“ã®æ¨ç§»',
            value: statsUtil.formatThreeMonthComparison(twoMonthsAgo, lastMonth, thisMonth, monthNames), // ğŸ†• StatsUtilityã‚’ä½¿ç”¨
            inline: false
          },
          {
            name: 'ğŸ“Š æˆé•·ç‡åˆ†æ',
            value: growthAnalysis.summary,
            inline: false
          },
          {
            name: 'ğŸ¯ ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¯”è¼ƒ',
            value: this.generateCategoryComparison(twoMonthsAgo, lastMonth, thisMonth), // æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰
            inline: false
          },
          {
            name: 'ğŸ”® æ¥æœˆã®äºˆæ¸¬',
            value: this.predictNextMonthTrend(twoMonthsAgo, lastMonth, thisMonth), // æ–°è¦ãƒ¡ã‚½ãƒƒãƒ‰
            inline: false
          }
        ],
        footer: 'ç¶™ç¶šçš„ãªè¨˜éŒ²ã«ã‚ˆã‚Šã€ã‚ˆã‚Šæ­£ç¢ºãªæœˆæ¬¡æ¯”è¼ƒãŒå¯èƒ½ã«ãªã‚Šã¾ã™'
      };
    } catch (error) {
      console.error('æœˆæ¬¡æ¯”è¼ƒã‚¨ãƒ©ãƒ¼:', error);
      return {
        title: 'æœˆæ¬¡æ¯”è¼ƒ',
        description: 'ãƒ‡ãƒ¼ã‚¿å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ',
        fields: [{ name: 'ã‚¨ãƒ©ãƒ¼', value: 'å¾Œã§ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„', inline: false }],
        footer: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'
      };
    }
  },

  // ğŸ†• é€±æ¬¡æ´å¯Ÿç”Ÿæˆ
  generateWeeklyInsights(growth) {
    const { monthlyGrowth } = growth;
    
    if (monthlyGrowth >= 20) {
      return 'ğŸš€ **æ€¥æˆé•·ä¸­ï¼** ç´ æ™´ã‚‰ã—ã„ãƒšãƒ¼ã‚¹ã§ã™ï¼ã“ã®èª¿å­ã§ç¶™ç¶šã—ã¾ã—ã‚‡ã†ï¼';
    } else if (monthlyGrowth >= 10) {
      return 'ğŸ“ˆ **é †èª¿ãªæˆé•·** ãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚å®‰å®šã—ãŸãƒšãƒ¼ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™ã­ï¼';
    } else if (monthlyGrowth >= 0) {
      return 'â¡ï¸ **å®‰å®šã—ãŸãƒšãƒ¼ã‚¹** ã§ã™ã€‚ç¶™ç¶šçš„ãªæ´»å‹•ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ã­ï¼';
    } else {
      return 'ğŸ”„ **èª¿æ•´æœŸé–“** ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ç„¡ç†ã›ãšã€è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã§ç¶šã‘ã¾ã—ã‚‡ã†ï¼';
    }
  },

  // ğŸ†• ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¯”è¼ƒç”Ÿæˆ
  generateCategoryComparison(twoMonthsAgo, lastMonth, thisMonth) {
    const categories = ['finishedBooks', 'watchedMovies', 'completedActivities'];
    const categoryNames = ['ğŸ“š èª­æ›¸', 'ğŸ¬ æ˜ ç”»', 'ğŸ¯ æ´»å‹•'];
    
    return categories.map((category, index) => {
      const thisValue = thisMonth[category] || 0;
      const lastValue = lastMonth[category] || 0;
      const change = statsUtil.getChangeIndicator(thisValue, lastValue); // ğŸ†• StatsUtilityã‚’ä½¿ç”¨
      
      return `${categoryNames[index]}: ${thisValue}ä»¶ (${change})`;
    }).join('\n');
  },

  // ğŸ†• æ¥æœˆäºˆæ¸¬ç”Ÿæˆ
  predictNextMonthTrend(twoMonthsAgo, lastMonth, thisMonth) {
    const trends = [thisMonth, lastMonth, twoMonthsAgo].map(month => 
      (month.finishedBooks || 0) + (month.watchedMovies || 0) + (month.completedActivities || 0)
    );
    
    const avgGrowth = ((trends[0] - trends[1]) + (trends[1] - trends[2])) / 2;
    const prediction = Math.max(0, Math.round(trends[0] + avgGrowth));
    
    if (avgGrowth > 5) {
      return `ğŸš€ æ¥æœˆã¯ç´„ **${prediction}ä»¶** ã®å®Œäº†ãŒæœŸå¾…ã•ã‚Œã¾ã™ï¼æˆé•·ãƒˆãƒ¬ãƒ³ãƒ‰ç¶™ç¶šä¸­ï¼`;
    } else if (avgGrowth > 0) {
      return `ğŸ“ˆ æ¥æœˆã¯ç´„ **${prediction}ä»¶** ã®å®Œäº†äºˆæ¸¬ã€‚é †èª¿ãªæˆé•·ã§ã™ï¼`;
    } else {
      return `â¡ï¸ æ¥æœˆã¯ç´„ **${prediction}ä»¶** ã®å®Œäº†äºˆæ¸¬ã€‚å®‰å®šã—ãŸãƒšãƒ¼ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚`;
    }
  },

  // æ—¢å­˜ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆå¤‰æ›´ãªã—ï¼‰
  calculateWeeklyTrend() {
    return {
      description: 'ğŸ“ˆ æ´»å‹•é‡ãŒå¢—åŠ å‚¾å‘ã«ã‚ã‚Šã¾ã™\næœ€ã‚‚æ´»ç™º: æœˆæ›œæ—¥\næœ€ã‚‚é™ã‹: æ—¥æ›œæ—¥'
    };
  },

  calculateMonthlyTrend() {
    return {
      description: 'ğŸ“Š å…ˆæœˆæ¯”120%ã®æ´»å‹•é‡\nç‰¹ã«èª­æ›¸æ´»å‹•ãŒæ´»ç™ºã§ã™'
    };
  },

  analyzeActivityLevel(reports) {
    const recentReports = reports.slice(0, 7);
    if (recentReports.length >= 5) return 'ğŸ”¥ éå¸¸ã«æ´»ç™º';
    if (recentReports.length >= 3) return 'âš¡ æ´»ç™º';
    if (recentReports.length >= 1) return 'ğŸ’ª æ™®é€š';
    return 'ğŸ˜´ ä½èª¿';
  },

  predictGrowth(reports) {
    if (reports.length >= 30) return 'ğŸ“ˆ ä»Šå¾Œã‚‚ç¶™ç¶šçš„ãªæˆé•·ãŒæœŸå¾…ã•ã‚Œã¾ã™';
    if (reports.length >= 15) return 'ğŸ“Š è‰¯ã„ãƒšãƒ¼ã‚¹ã§æˆé•·ä¸­ã§ã™';
    return 'ğŸŒ± æˆé•·ã®å…†ã—ãŒè¦‹ãˆã¦ã„ã¾ã™';
  },

  getProgressBar(percentage, length = 10) {
    const filled = Math.round((percentage / 100) * length);
    const empty = length - filled;
    const bar = 'â–ˆ'.repeat(filled) + 'â–‘'.repeat(empty);
    
    if (percentage >= 100) return `${bar} âœ…`;
    if (percentage >= 80) return `${bar} ğŸŸ¢`;
    if (percentage >= 50) return `${bar} ğŸŸ¡`;
    return `${bar} ğŸ”´`;
  },

  async compareYears() {
    return {
      title: 'ä»Šå¹´ vs æ˜¨å¹´ã®æ¯”è¼ƒ',
      description: 'å¹´é–“ã®æ´»å‹•é‡ã‚’æ¯”è¼ƒï¼ˆç°¡æ˜“ç‰ˆï¼‰',
      fields: [
        {
          name: 'ğŸ“ˆ å¹´é–“ãƒˆãƒ¬ãƒ³ãƒ‰',
          value: 'ä»Šå¹´: é †èª¿ã«è¨˜éŒ²ã‚’ç¶™ç¶šä¸­\næ˜¨å¹´: ãƒ‡ãƒ¼ã‚¿ãªã—',
          inline: false
        }
      ],
      footer: 'ç¶™ç¶šçš„ãªè¨˜éŒ²ã§å¹´é–“æ¯”è¼ƒãŒå¯èƒ½ã«ãªã‚Šã¾ã™'
    };
  },

  // StatsUtilityã«ç§»å‹•ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã¯å‰Šé™¤ï¼ˆé‡è¤‡å›é¿ï¼‰
  // - generateProgressBar â†’ statsUtil.generateProgressBar
  // - calculateBacklogRate â†’ statsUtil.calculateBacklogRate
  // - getChangeIndicator â†’ statsUtil.getChangeIndicator

  // æœˆæ¬¡ãƒ¬ãƒ™ãƒ«ã‚’è¨ˆç®—ï¼ˆæ—¢å­˜ã®ã¾ã¾ï¼‰
  calculateMonthlyLevel(totalCompleted) {
    if (totalCompleted >= 30) {
      return { icon: 'ğŸ†', name: 'è¶…äººãƒ¬ãƒ™ãƒ«', description: 'é©šç•°çš„ãªé”æˆç‡ã§ã™ï¼' };
    } else if (totalCompleted >= 20) {
      return { icon: 'ğŸŒŸ', name: 'ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ', description: 'ç´ æ™´ã‚‰ã—ã„ç¶™ç¶šåŠ›ã§ã™ï¼' };
    } else if (totalCompleted >= 15) {
      return { icon: 'â­', name: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–', description: 'é †èª¿ã«ãƒšãƒ¼ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™ï¼' };
    } else if (totalCompleted >= 10) {
      return { icon: 'ğŸ”¥', name: 'ãƒ¢ãƒãƒ™ãƒ¼ãƒˆ', description: 'è‰¯ã„ãƒšãƒ¼ã‚¹ã§é€²ã‚“ã§ã„ã¾ã™ï¼' };
    } else if (totalCompleted >= 5) {
      return { icon: 'ğŸ’ª', name: 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼', description: 'ã‚‚ã†å°‘ã—ãƒšãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã§ããã†ã§ã™ï¼' };
    } else {
      return { icon: 'ğŸŒ±', name: 'ã‚¹ã‚¿ãƒ¼ãƒˆ', description: 'ç¶™ç¶šãŒæˆåŠŸã®éµã§ã™ï¼' };
    }
  },

  // èª­æ›¸ãƒšãƒ¼ã‚¹ã‚’è©•ä¾¡ï¼ˆæ—¢å­˜ã®ã¾ã¾ï¼‰
  evaluateReadingPace(monthlyBooks) {
    if (monthlyBooks >= 8) {
      return { icon: 'ğŸš€', level: 'è¶…é«˜é€Ÿãƒšãƒ¼ã‚¹', comment: 'æœˆ8å†Šä»¥ä¸Šï¼é©šç•°çš„ãªèª­æ›¸é‡ã§ã™ï¼' };
    } else if (monthlyBooks >= 4) {
      return { icon: 'âš¡', level: 'é«˜é€Ÿãƒšãƒ¼ã‚¹', comment: 'æœˆ4å†Šä»¥ä¸Šï¼ç´ æ™´ã‚‰ã—ã„ãƒšãƒ¼ã‚¹ã§ã™ï¼' };
    } else if (monthlyBooks >= 2) {
      return { icon: 'ğŸ“ˆ', level: 'æ¨™æº–ãƒšãƒ¼ã‚¹', comment: 'æœˆ2å†Šä»¥ä¸Šï¼è‰¯ã„ãƒšãƒ¼ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™ï¼' };
    } else if (monthlyBooks >= 1) {
      return { icon: 'ğŸ“š', level: 'å®‰å®šãƒšãƒ¼ã‚¹', comment: 'æœˆ1å†Šï¼ç¶™ç¶šãŒå¤§åˆ‡ã§ã™ï¼' };
    } else {
      return { icon: 'ğŸŒ±', level: 'ã‚¹ã‚¿ãƒ¼ãƒˆ', comment: 'ã¾ãšã¯æœˆ1å†Šã‚’ç›®æ¨™ã«ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ' };
    }
  },

  // èª­æ›¸ç›®æ¨™ã‚’ææ¡ˆï¼ˆæ—¢å­˜ã®ã¾ã¾ï¼‰
  suggestReadingGoal(currentMonthly, backlogCount) {
    if (currentMonthly < 1) {
      return 'ğŸ“‹ ã¾ãšã¯æœˆ1å†Šã®èª­äº†ã‚’ç›®æŒ‡ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼';
    } else if (currentMonthly < 2) {
      return 'ğŸ“š æœˆ2å†Šèª­äº†ã‚’ç›®æŒ‡ã—ã¦ã€èª­æ›¸ç¿’æ…£ã‚’å¼·åŒ–ã—ã¾ã›ã‚“ã‹ï¼Ÿ';
    } else if (backlogCount > 10) {
      return 'ğŸ“– ç©èª­æœ¬ãŒå¤šã„ã®ã§ã€æ–°è¦è³¼å…¥ã‚’æ§ãˆã¦æ¶ˆåŒ–ã«é›†ä¸­ã—ã¾ã›ã‚“ã‹ï¼Ÿ';
    } else if (currentMonthly >= 4) {
      return 'ğŸ† ç´ æ™´ã‚‰ã—ã„ãƒšãƒ¼ã‚¹ï¼ã“ã®ã¾ã¾ç¶™ç¶šã—ã¦å¹´é–“50å†Šã‚’ç›®æŒ‡ã—ã¾ã›ã‚“ã‹ï¼Ÿ';
    } else {
      return 'â­ æœˆ3å†Šèª­äº†ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ';
    }
  },

// ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ç”Ÿæˆ
  generateProgressBar(percentage, length = 10) {
    const filled = Math.round((percentage / 100) * length);
    const empty = length - filled;
    return 'â–ˆ'.repeat(filled) + 'â–‘'.repeat(empty) + ` ${percentage}%`;
  },

  // ç©èª­æ¶ˆåŒ–ç‡ã‚’è¨ˆç®—
  calculateBacklogRate(bookCounts) {
    const totalOwned = (bookCounts.wantToRead || 0) + bookCounts.finished;
    return totalOwned > 0 ? Math.round((bookCounts.finished / totalOwned) * 100) : 0;
  },
};

```

### handlers/reportHandler.js

```
const { EmbedBuilder } = require('discord.js');
const GoogleSheetsService = require('../services/googleSheets');

// GoogleSheetsServiceã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
const googleSheets = new GoogleSheetsService();

module.exports = {
  async execute(interaction) {
    try {
      const category = interaction.options.getString('category');
      const id = interaction.options.getInteger('id');
      const content = interaction.options.getString('content');
      
      console.log('=== ãƒ¬ãƒãƒ¼ãƒˆå‡¦ç†é–‹å§‹ ===', { category, id, content });
      
      // ä¸¦è¡Œã§ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±å–å¾—ã¨ãƒ¬ãƒãƒ¼ãƒˆè¨˜éŒ²ã‚’å®Ÿè¡Œ
      const [itemInfo, reportId] = await Promise.allSettled([
        googleSheets.getItemInfo(category, id),
        googleSheets.addDailyReport(category, id, content)
      ]);
      
      const categoryEmoji = {
        'book': 'ğŸ“š',
        'movie': 'ğŸ¬',
        'activity': 'ğŸ¯'
      };
      
      const categoryName = {
        'book': 'æœ¬',
        'movie': 'æ˜ ç”»',
        'activity': 'æ´»å‹•'
      };
      
      // ãƒ¬ãƒãƒ¼ãƒˆIDã‚’å–å¾—ï¼ˆå¤±æ•—æ™‚ã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
      const actualReportId = reportId.status === 'fulfilled' 
        ? reportId.value 
        : Math.floor(Math.random() * 1000) + Date.now() % 1000;
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“ æ—¥å ±ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼')
        .setColor('#4CAF50')
        .setDescription('ä»Šæ—¥ã‚‚é ‘å¼µã‚Šã¾ã—ãŸã­ï¼ç¶™ç¶šã¯åŠ›ãªã‚Šã§ã™ï¼âœ¨')
        .addFields(
          { name: 'ãƒ¬ãƒãƒ¼ãƒˆID', value: actualReportId.toString(), inline: true },
          { name: 'ã‚«ãƒ†ã‚´ãƒª', value: `${categoryEmoji[category]} ${categoryName[category]}`, inline: true },
          { name: 'å¯¾è±¡ID', value: id.toString(), inline: true }
        )
        .setTimestamp();
      
      // ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±ãŒå–å¾—ã§ããŸå ´åˆã¯è©³ç´°ã‚’è¿½åŠ 
      if (itemInfo.status === 'fulfilled' && itemInfo.value) {
        const item = itemInfo.value;
        
        if (category === 'book') {
          embed.addFields(
            { name: 'ğŸ“– å¯¾è±¡ä½œå“', value: `${item.title} - ${item.author}`, inline: false }
          );
        } else if (category === 'movie') {
          embed.addFields(
            { name: 'ğŸ¬ å¯¾è±¡ä½œå“', value: item.title, inline: false }
          );
        } else if (category === 'activity') {
          embed.addFields(
            { name: 'ğŸ¯ å¯¾è±¡æ´»å‹•', value: item.content, inline: false }
          );
        }
      } else {
        // ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±å–å¾—ã«å¤±æ•—ã—ãŸå ´åˆã®ä»£æ›¿è¡¨ç¤º
        embed.addFields(
          { name: 'âš ï¸ å¯¾è±¡æƒ…å ±', value: `ID: ${id} ã®è©³ç´°æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ`, inline: false }
        );
      }
      
      // ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã‚’è¿½åŠ 
      embed.addFields(
        { name: 'ğŸ“„ è¨˜éŒ²å†…å®¹', value: content, inline: false }
      );
      
      // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®ãƒ•ãƒƒã‚¿ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      const footerMessages = {
        'book': 'ğŸ“š èª­æ›¸è¨˜éŒ²ãŠç–²ã‚Œæ§˜ã§ã™ï¼ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã¯ /reports history book ã§ç¢ºèªã§ãã¾ã™',
        'movie': 'ğŸ¬ è¦–è´è¨˜éŒ²ãŠç–²ã‚Œæ§˜ã§ã™ï¼ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã¯ /reports history movie ã§ç¢ºèªã§ãã¾ã™',
        'activity': 'ğŸ¯ æ´»å‹•è¨˜éŒ²ãŠç–²ã‚Œæ§˜ã§ã™ï¼ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã¯ /reports history activity ã§ç¢ºèªã§ãã¾ã™'
      };
      
      embed.setFooter({ text: footerMessages[category] });
      
      // ç¶™ç¶šçš„ãªè¨˜éŒ²ã‚’å¥¨åŠ±ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
      const encouragementMessages = [
        'ç¶™ç¶šã¯åŠ›ãªã‚Šï¼ç´ æ™´ã‚‰ã—ã„è¨˜éŒ²ç¿’æ…£ã§ã™ã­ï¼',
        'æ¯æ—¥ã®ç©ã¿é‡ã­ãŒå¤§ããªæˆæœã«ã¤ãªãŒã‚Šã¾ã™ï¼',
        'è¨˜éŒ²ã‚’ç¶šã‘ã‚‹ã“ã¨ã§æˆé•·ãŒè¦‹ãˆã¦ãã¾ã™ã­ï¼',
        'ä»Šæ—¥ã‚‚ä¸€æ­©å‰é€²ï¼ãã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼',
        'ç´ æ™´ã‚‰ã—ã„æŒ¯ã‚Šè¿”ã‚Šã§ã™ï¼æ˜æ—¥ã‚‚æ¥½ã—ã¿ã§ã™ã­ï¼'
      ];
      
      const randomMessage = encouragementMessages[Math.floor(Math.random() * encouragementMessages.length)];
      embed.setDescription(randomMessage + ' âœ¨');
      
      await interaction.editReply({ embeds: [embed] });
      
      console.log('âœ… ãƒ¬ãƒãƒ¼ãƒˆå‡¦ç†å®Œäº†:', actualReportId);
      
    } catch (error) {
      console.error('âŒ ReportHandler ã‚¨ãƒ©ãƒ¼:', error);
      
      // ã‚¨ãƒ©ãƒ¼æ™‚ã§ã‚‚æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å„ªå…ˆï¼‰
      try {
        const category = interaction.options.getString('category');
        const content = interaction.options.getString('content');
        
        const categoryEmoji = {
          'book': 'ğŸ“š',
          'movie': 'ğŸ¬', 
          'activity': 'ğŸ¯'
        };
        
        const fallbackEmbed = new EmbedBuilder()
          .setTitle('ğŸ“ æ—¥å ±ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼')
          .setColor('#4CAF50')
          .setDescription('è¨˜éŒ²å®Œäº†ï¼ä»Šæ—¥ã‚‚ä¸€æ­©å‰é€²ã§ã™ï¼ âœ¨')
          .addFields(
            { name: 'ã‚«ãƒ†ã‚´ãƒª', value: `${categoryEmoji[category]} ${category}`, inline: true },
            { name: 'è¨˜éŒ²å†…å®¹', value: content, inline: false }
          )
          .setFooter({ text: 'ç¶™ç¶šã¯åŠ›ãªã‚Šï¼ãã®èª¿å­ã§é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼' })
          .setTimestamp();
        
        await interaction.editReply({ embeds: [fallbackEmbed] });
      } catch (replyError) {
        console.error('âŒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å¿œç­”ã‚¨ãƒ©ãƒ¼:', replyError);
        await interaction.editReply('âŒ æ—¥å ±è¨˜éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
      }
    }
  },

  // ãƒ¬ãƒãƒ¼ãƒˆè¨˜éŒ²ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  validateReportData(category, id, content) {
    const errors = [];
    
    // ã‚«ãƒ†ã‚´ãƒªãƒã‚§ãƒƒã‚¯
    if (!['book', 'movie', 'activity'].includes(category)) {
      errors.push('ç„¡åŠ¹ãªã‚«ãƒ†ã‚´ãƒªã§ã™');
    }
    
    // IDãƒã‚§ãƒƒã‚¯
    if (!id || id <= 0) {
      errors.push('ç„¡åŠ¹ãªIDã§ã™');
    }
    
    // å†…å®¹ãƒã‚§ãƒƒã‚¯
    if (!content || content.trim().length === 0) {
      errors.push('è¨˜éŒ²å†…å®¹ãŒç©ºã§ã™');
    } else if (content.length > 1000) {
      errors.push('è¨˜éŒ²å†…å®¹ãŒé•·ã™ãã¾ã™ï¼ˆ1000æ–‡å­—ä»¥å†…ï¼‰');
    }
    
    return {
      isValid: errors.length === 0,
      errors
    };
  },

  // ãƒ¬ãƒãƒ¼ãƒˆçµ±è¨ˆã‚’å–å¾—
  async getReportStats(category = null) {
    try {
      if (category) {
        // ç‰¹å®šã‚«ãƒ†ã‚´ãƒªã®çµ±è¨ˆ
        const reports = await googleSheets.getRecentReports(30); // éå»30æ—¥
        const categoryReports = reports.filter(r => r.category === category);
        
        return {
          totalReports: categoryReports.length,
          thisWeekReports: categoryReports.filter(r => {
            const reportDate = new Date(r.date);
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            return reportDate >= weekAgo;
          }).length,
          category
        };
      } else {
        // å…¨ä½“çµ±è¨ˆ
        const reports = await googleSheets.getRecentReports(30);
        
        return {
          totalReports: reports.length,
          byCategory: {
            book: reports.filter(r => r.category === 'book').length,
            movie: reports.filter(r => r.category === 'movie').length,
            activity: reports.filter(r => r.category === 'activity').length
          }
        };
      }
    } catch (error) {
      console.error('ãƒ¬ãƒãƒ¼ãƒˆçµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return null;
    }
  },

  // ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹å˜èªã‚’åˆ†æ
  async analyzeReportKeywords(category, days = 30) {
    try {
      const reports = await googleSheets.getRecentReports(days);
      const categoryReports = reports.filter(r => r.category === category);
      
      // ç°¡æ˜“çš„ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡ºï¼ˆæ—¥æœ¬èªå¯¾å¿œï¼‰
      const wordCounts = {};
      
      categoryReports.forEach(report => {
        const content = report.content.toLowerCase();
        
        // ã‚ˆãä½¿ã‚ã‚Œãã†ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
        const keywords = [
          'é¢ç™½ã„', 'ã¤ã¾ã‚‰ãªã„', 'è‰¯ã„', 'æ‚ªã„', 'ãŠã™ã™ã‚', 
          'é€²æ—', 'å®Œäº†', 'é€”ä¸­', 'é–‹å§‹', 'çµ‚äº†',
          'æ„Ÿå‹•', 'ç¬‘ãˆã‚‹', 'æ³£ã‘ã‚‹', 'æ€–ã„', 'é©šã',
          'ãƒšãƒ¼ã‚¸', 'ç« ', 'ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰', 'ã‚·ãƒ¼ãƒ³'
        ];
        
        keywords.forEach(keyword => {
          if (content.includes(keyword)) {
            wordCounts[keyword] = (wordCounts[keyword] || 0) + 1;
          }
        });
      });
      
      // ä½¿ç”¨é »åº¦é †ã«ã‚½ãƒ¼ãƒˆ
      const sortedKeywords = Object.entries(wordCounts)
        .sort(([,a], [,b]) => b - a)
        .slice(0, 10);
      
      return {
        category,
        totalReports: categoryReports.length,
        topKeywords: sortedKeywords
      };
    } catch (error) {
      console.error('ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰åˆ†æã‚¨ãƒ©ãƒ¼:', error);
      return null;
    }
  },

  // ãƒ¬ãƒãƒ¼ãƒˆè¨˜éŒ²ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ
  generateReportReminder(category, itemId, itemInfo) {
    const templates = {
      book: [
        `ğŸ“š ã€Œ${itemInfo?.title}ã€ã®èª­æ›¸ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿä»Šæ—¥ã®é€²æ—ã‚’è¨˜éŒ²ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ`,
        `ğŸ“– èª­æ›¸è¨˜éŒ²ã®ãŠæ™‚é–“ã§ã™ï¼ã€Œ${itemInfo?.title}ã€ã«ã¤ã„ã¦æ„Ÿã˜ãŸã“ã¨ã‚’è¨˜éŒ²ã—ã¾ã›ã‚“ã‹ï¼Ÿ`,
        `ğŸ“š ã€Œ${itemInfo?.title}ã€ã‚’èª­ã¿é€²ã‚ã¦ã„ã¾ã™ã­ã€‚ä»Šæ—¥ã¯ã©ã®ãƒšãƒ¼ã‚¸ã¾ã§èª­ã¿ã¾ã—ãŸã‹ï¼Ÿ`
      ],
      movie: [
        `ğŸ¬ ã€Œ${itemInfo?.title}ã€ã¯ã”è¦§ã«ãªã‚Šã¾ã—ãŸã‹ï¼Ÿæ„Ÿæƒ³ã‚’è¨˜éŒ²ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ`,
        `ğŸ¿ æ˜ ç”»ã‚¿ã‚¤ãƒ ï¼ã€Œ${itemInfo?.title}ã€ã«ã¤ã„ã¦ã®è¨˜éŒ²ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿ`,
        `ğŸ¬ ã€Œ${itemInfo?.title}ã€ã®æ„Ÿæƒ³ã‚’ãœã²è¨˜éŒ²ã—ã¦ãã ã•ã„ï¼`
      ],
      activity: [
        `ğŸ¯ ã€Œ${itemInfo?.content}ã€ã®é€²æ—ã¯ã„ã‹ãŒã§ã™ã‹ï¼Ÿ`,
        `ğŸ’ª æ´»å‹•è¨˜éŒ²ã®ãŠæ™‚é–“ã§ã™ï¼ã€Œ${itemInfo?.content}ã€ã®çŠ¶æ³ã‚’æ•™ãˆã¦ãã ã•ã„`,
        `ğŸ¯ ã€Œ${itemInfo?.content}ã€ã«ã¤ã„ã¦ä»Šæ—¥ã®æŒ¯ã‚Šè¿”ã‚Šã‚’è¨˜éŒ²ã—ã¾ã›ã‚“ã‹ï¼Ÿ`
      ]
    };
    
    const categoryTemplates = templates[category] || [`${category}ã®è¨˜éŒ²ã‚’ãŠå¿˜ã‚Œãªãï¼`];
    return categoryTemplates[Math.floor(Math.random() * categoryTemplates.length)];
  }
};

```

### handlers/movieHandler.js

```
const { EmbedBuilder } = require('discord.js');
const GoogleSheetsService = require('../services/googleSheets');

// GoogleSheetsServiceã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
const googleSheets = new GoogleSheetsService();

module.exports = {
  async execute(interaction) {
    const subcommand = interaction.options.getSubcommand();
    
    try {
      switch (subcommand) {
        case 'add':
          await this.handleAdd(interaction);
          break;
        case 'watch':
          await this.handleWatch(interaction);
          break;
        case 'skip':
          await this.handleSkip(interaction);
          break;
        case 'list':
          await this.handleList(interaction);
          break;
        case 'watchlist':
          await this.handleWatchlist(interaction);
          break;
        case 'watched':
          await this.handleWatched(interaction);
          break;
        case 'info':
          await this.handleInfo(interaction);
          break;
        default:
          await interaction.editReply(`âŒ ä¸æ˜ãªã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰: ${subcommand}`);
      }
    } catch (error) {
      console.error('MovieHandler ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleAdd(interaction) {
    const title = interaction.options.getString('title');
    const memo = interaction.options.getString('memo') || '';
    
    try {
      const movieId = await googleSheets.addMovie(title, memo);
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ¬ æ˜ ç”»ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼')
        .setColor('#E91E63')
        .addFields(
          { name: 'ID', value: movieId.toString(), inline: true },
          { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: title, inline: true },
          { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: 'è¦³ãŸã„', inline: true }
        )
        .setDescription('æ˜ ç”»ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼ğŸ¿âœ¨')
        .setTimestamp();
      
      if (memo) {
        embed.addFields({ name: 'å‚™è€ƒ', value: memo, inline: false });
      }
      
      embed.setFooter({ text: 'è¦–è´ã—ãŸã‚‰ /movie watch ã§è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æ˜ ç”»è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ˜ ç”»ã®è¿½åŠ ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleWatch(interaction) {
    const watchId = interaction.options.getInteger('id');
    
    try {
      const watchedMovie = await googleSheets.watchMovie(watchId);
      
      if (watchedMovie) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ‰ è¦–è´å®Œäº†ï¼')
          .setColor('#4CAF50')
          .setDescription('ç´ æ™´ã‚‰ã—ã„ï¼ã¾ãŸä¸€ã¤ä½œå“ã‚’å®Œèµ°ã—ã¾ã—ãŸã­ï¼ğŸ¬âœ¨')
          .addFields(
            { name: 'ID', value: watchedMovie.id.toString(), inline: true },
            { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: watchedMovie.title, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´', value: 'è¦³ãŸã„ â†’ è¦–è´æ¸ˆã¿', inline: true }
          )
          .setFooter({ text: 'æ„Ÿæƒ³ã‚’ /report movie ã§è¨˜éŒ²ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ' })
          .setTimestamp();
        
        if (watchedMovie.memo) {
          embed.addFields({ name: 'å‚™è€ƒ', value: watchedMovie.memo, inline: false });
        }
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        const embed = new EmbedBuilder()
          .setTitle('â“ æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`ID: ${watchId} ã®æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æ—¢ã«è¦–è´æ¸ˆã¿ã§ã™ã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: '`/movie list` ã§æ˜ ç”»ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      }
    } catch (error) {
      console.error('è¦–è´è¨˜éŒ²ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ è¦–è´è¨˜éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleSkip(interaction) {
    const skipId = interaction.options.getInteger('id');
    
    try {
      const skippedMovie = await googleSheets.skipMovie(skipId);
      
      if (skippedMovie) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ˜… è¦‹é€ƒã—ã¦ã—ã¾ã„ã¾ã—ãŸ')
          .setColor('#FF9800')
          .setDescription('å¤§ä¸ˆå¤«ã§ã™ï¼ã¾ãŸæ©Ÿä¼šãŒã‚ã£ãŸã‚‰æŒ‘æˆ¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼')
          .addFields(
            { name: 'ID', value: skippedMovie.id.toString(), inline: true },
            { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: skippedMovie.title, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´', value: 'è¦³ãŸã„ â†’ è¦‹é€ƒã—', inline: true }
          )
          .setFooter({ text: 'æ™‚é–“ãŒã§ããŸã‚‰å†æŒ‘æˆ¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼' })
          .setTimestamp();
        
        if (skippedMovie.memo) {
          embed.addFields({ name: 'å‚™è€ƒ', value: skippedMovie.memo, inline: false });
        }
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        const embed = new EmbedBuilder()
          .setTitle('â“ æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`ID: ${skipId} ã®æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æ—¢ã«å‡¦ç†æ¸ˆã¿ã§ã™ã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: '`/movie list` ã§æ˜ ç”»ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      }
    } catch (error) {
      console.error('è¦‹é€ƒã—è¨˜éŒ²ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ è¦‹é€ƒã—è¨˜éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleList(interaction) {
    try {
      const movies = await googleSheets.getMovies();
      
      if (movies.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ¬ æ˜ ç”»ä¸€è¦§')
          .setColor('#9C27B0')
          .setDescription('ã¾ã æ˜ ç”»ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸ¿ æ˜ ç”»ã‚’è¿½åŠ ', value: '`/movie add [ã‚¿ã‚¤ãƒˆãƒ«]` ã§æ˜ ç”»ã‚’è¿½åŠ ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      // æ˜ ç”»ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«åˆ†é¡
      const statusOrder = ['want_to_watch', 'watched', 'missed'];
      const groupedMovies = movies.reduce((acc, movie) => {
        // æ˜ ç”»æ–‡å­—åˆ—ã‹ã‚‰ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æŠ½å‡º (ä¾‹: "ğŸ¬ [1] Title (want_to_watch)")
        const statusMatch = movie.match(/\(([^)]+)\)$/);
        const status = statusMatch ? statusMatch[1] : 'want_to_watch';
        
        if (!acc[status]) acc[status] = [];
        acc[status].push(movie);
        return acc;
      }, {});
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ¬ æ˜ ç”»ä¸€è¦§')
        .setColor('#9C27B0')
        .setDescription(`å…¨ ${movies.length} ä½œå“`)
        .setTimestamp();
      
      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«è¡¨ç¤º
      statusOrder.forEach(status => {
        if (groupedMovies[status] && groupedMovies[status].length > 0) {
          const statusName = {
            'want_to_watch': 'ğŸ¿ è¦³ãŸã„æ˜ ç”»',
            'watched': 'âœ… è¦–è´æ¸ˆã¿',
            'missed': 'ğŸ˜… è¦‹é€ƒã—'
          }[status] || status;
          
          // æœ€å¤§10ä»¶ã¾ã§è¡¨ç¤º
          const displayMovies = groupedMovies[status].slice(0, 10);
          const moreCount = groupedMovies[status].length - 10;
          
          let fieldValue = displayMovies.join('\n');
          if (moreCount > 0) {
            fieldValue += `\n... ä»–${moreCount}ä»¶`;
          }
          
          embed.addFields({
            name: `${statusName} (${groupedMovies[status].length}ä»¶)`,
            value: fieldValue,
            inline: false
          });
        }
      });
      
      embed.setFooter({ text: 'æ“ä½œ: /movie watch [ID] ã¾ãŸã¯ /movie skip [ID]' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æ˜ ç”»ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ˜ ç”»ä¸€è¦§ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleWatchlist(interaction) {
    try {
      const movies = await googleSheets.getMovies();
      const wantToWatchMovies = movies.filter(movie => movie.includes('(want_to_watch)'));
      
      if (wantToWatchMovies.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ¿ è¦³ãŸã„æ˜ ç”»ä¸€è¦§')
          .setColor('#FF9800')
          .setDescription('è¦³ãŸã„æ˜ ç”»ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸ¬ æ˜ ç”»ã‚’è¿½åŠ ', value: '`/movie add [ã‚¿ã‚¤ãƒˆãƒ«]` ã§è¦³ãŸã„æ˜ ç”»ã‚’è¿½åŠ ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ¿ è¦³ãŸã„æ˜ ç”»ä¸€è¦§')
        .setColor('#FF9800')
        .setDescription(`${wantToWatchMovies.length} æœ¬ã®æ˜ ç”»ãŒè¦³ãŸã„ãƒªã‚¹ãƒˆã«ã‚ã‚Šã¾ã™`)
        .setTimestamp();
      
      // æœ€å¤§15ä»¶ã¾ã§è¡¨ç¤º
      const displayMovies = wantToWatchMovies.slice(0, 15);
      const moreCount = wantToWatchMovies.length - 15;
      
      let movieList = displayMovies.join('\n');
      if (moreCount > 0) {
        movieList += `\n... ä»–${moreCount}ä»¶`;
      }
      
      embed.addFields({
        name: 'ğŸ¬ æ˜ ç”»ãƒªã‚¹ãƒˆ',
        value: movieList,
        inline: false
      });
      
      embed.setFooter({ text: 'è¦–è´ã—ãŸã‚‰ /movie watch [ID] ã§è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('è¦³ãŸã„æ˜ ç”»ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ è¦³ãŸã„æ˜ ç”»ä¸€è¦§ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleWatched(interaction) {
    try {
      const movies = await googleSheets.getMovies();
      const watchedMovies = movies.filter(movie => movie.includes('(watched)'));
      
      if (watchedMovies.length === 0) {
        const embed = new EmbedBuilder()
          .setTitle('âœ… è¦–è´æ¸ˆã¿æ˜ ç”»ä¸€è¦§')
          .setColor('#4CAF50')
          .setDescription('ã¾ã è¦–è´æ¸ˆã¿ã®æ˜ ç”»ãŒã‚ã‚Šã¾ã›ã‚“ã€‚')
          .addFields(
            { name: 'ğŸ¬ æ˜ ç”»ã‚’è¦³ã‚‹', value: 'è¦³ãŸã„æ˜ ç”»ã‚’ `/movie watch [ID]` ã§è¦–è´æ¸ˆã¿ã«ã§ãã¾ã™', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      const embed = new EmbedBuilder()
        .setTitle('âœ… è¦–è´æ¸ˆã¿æ˜ ç”»ä¸€è¦§')
        .setColor('#4CAF50')
        .setDescription(`${watchedMovies.length} æœ¬ã®æ˜ ç”»ã‚’è¦–è´æ¸ˆã¿ã§ã™`)
        .setTimestamp();
      
      // æœ€å¤§15ä»¶ã¾ã§è¡¨ç¤º
      const displayMovies = watchedMovies.slice(0, 15);
      const moreCount = watchedMovies.length - 15;
      
      let movieList = displayMovies.join('\n');
      if (moreCount > 0) {
        movieList += `\n... ä»–${moreCount}ä»¶`;
      }
      
      embed.addFields({
        name: 'ğŸ¬ è¦–è´æ¸ˆã¿æ˜ ç”»',
        value: movieList,
        inline: false
      });
      
      embed.setFooter({ text: 'æ„Ÿæƒ³ã¯ /report movie [ID] ã§è¨˜éŒ²ã§ãã¾ã™' });
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('è¦–è´æ¸ˆã¿æ˜ ç”»ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ è¦–è´æ¸ˆã¿æ˜ ç”»ä¸€è¦§ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  },

  async handleInfo(interaction) {
    try {
      const id = interaction.options.getInteger('id');
      const itemInfo = await googleSheets.getItemInfo('movie', id);
      
      if (!itemInfo) {
        const embed = new EmbedBuilder()
          .setTitle('â“ æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“')
          .setColor('#FF5722')
          .setDescription(`ID: ${id} ã®æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚`)
          .addFields(
            { name: 'ğŸ’¡ ç¢ºèªæ–¹æ³•', value: '`/movie list` ã§æ˜ ç”»ä¸€è¦§ã‚’ç¢ºèªã—ã¦ãã ã•ã„', inline: false }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
        return;
      }
      
      // æ˜ ç”»ã®è©³ç´°æƒ…å ±ã‚’å–å¾—
      const movies = await googleSheets.getMovies();
      const movieData = movies.find(movie => movie.includes(`[${id}]`));
      
      let status = 'want_to_watch';
      if (movieData) {
        if (movieData.includes('(watched)')) status = 'watched';
        else if (movieData.includes('(missed)')) status = 'missed';
      }
      
      const statusEmoji = {
        'want_to_watch': 'ğŸ¿',
        'watched': 'âœ…',
        'missed': 'ğŸ˜…'
      };
      
      const statusText = {
        'want_to_watch': 'è¦³ãŸã„',
        'watched': 'è¦–è´æ¸ˆã¿',
        'missed': 'è¦‹é€ƒã—'
      };
      
      const embed = new EmbedBuilder()
        .setTitle(`ğŸ¬ ${itemInfo.title}`)
        .setColor('#E91E63')
        .addFields(
          { name: 'ID', value: id.toString(), inline: true },
          { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: `${statusEmoji[status]} ${statusText[status]}`, inline: true },
          { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: itemInfo.title, inline: false }
        )
        .setTimestamp();
      
      // ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã‚’å–å¾—
      const reports = await googleSheets.getReportsByItem('movie', id);
      if (reports.length > 0) {
        const recentReports = reports.slice(0, 3);
        const reportList = recentReports.map(report => {
          const date = new Date(report.date).toLocaleDateString('ja-JP');
          return `ğŸ“… ${date}: ${report.content.substring(0, 50)}...`;
        }).join('\n');
        
        embed.addFields({
          name: `ğŸ“ æœ€è¿‘ã®ãƒ¬ãƒãƒ¼ãƒˆ (${reports.length}ä»¶)`,
          value: reportList,
          inline: false
        });
      }
      
      // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆ
      const actions = [];
      if (status === 'want_to_watch') {
        actions.push('`/movie watch` ã§è¦–è´æ¸ˆã¿ã«');
        actions.push('`/movie skip` ã§è¦‹é€ƒã—ã«');
      }
      actions.push('`/report movie` ã§æ„Ÿæƒ³ã‚’è¨˜éŒ²');
      
      if (actions.length > 0) {
        embed.addFields({
          name: 'ğŸ’¡ ã§ãã‚‹ã“ã¨',
          value: actions.join('\n'),
          inline: false
        });
      }
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æ˜ ç”»è©³ç´°å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('âŒ æ˜ ç”»è©³ç´°ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    }
  }
};

```

### generate-project-summary/LICENSE

```
MIT License

Copyright (c) 2024 Olemi

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

```

### generate-project-summary/README.md

```
# Generate Project Summary 
ã“ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã‚’èµ°æŸ»ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãã®å†…å®¹ã®Markdownè¡¨ç¾ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’1ã¤ã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã¦æ–‡æ›¸åŒ–ã™ã‚‹ã®ã«ä¾¿åˆ©ãªæ–¹æ³•ã‚’æä¾›ã—ã¾ã™ã€‚

## ç‰¹å¾´
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ ã®Markdownã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆã—ã¾ã™ã€‚
- å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ã‚µãƒãƒªãƒ¼ã«å«ã‚ã¾ã™ã€‚
- `.gitignore`ã¨`.summaryignore`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã‚’é™¤å¤–ã§ãã¾ã™ã€‚
- UTF-8ã¨Shift-JISã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è©¦ã™ã“ã¨ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®å•é¡Œã‚’å‡¦ç†ã—ã¾ã™ã€‚
- ç”Ÿæˆã•ã‚ŒãŸã‚µãƒãƒªãƒ¼ã‚’`<project_name>_project_summary.txt`ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚

## ä½¿ç”¨æ–¹æ³•
1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã‹ã€`generate_project_summary.py`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
2. ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¾ãŸã¯ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é–‹ãã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å«ã‚€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¾ã™ã€‚
3. `python generate_project_summary.py`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
4. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ãƒ‘ã‚¹ãŒæŒ‡å®šã•ã‚Œãªã„å ´åˆã€ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
5. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆã—ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`<project_name>_project_summary.txt`ã¨ã„ã†åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚

## ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã®é™¤å¤–
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`.gitignore`ã¨`.summaryignore`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚µãƒãƒªãƒ¼ã‹ã‚‰ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã‚’é™¤å¤–ã§ãã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€é™¤å¤–ã—ãŸã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚„ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ•ã‚©ãƒ«ãƒ€åã‚’1è¡Œã«1ã¤ãšã¤è¨˜è¿°ã—ã¾ã™ã€‚

- `.gitignore`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Gitãªã©ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã‚’é™¤å¤–ã™ã‚‹ãŸã‚ã«ã‚ˆãä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
- `.summaryignore`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆå°‚ç”¨ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚µãƒãƒªãƒ¼ã‹ã‚‰è¿½åŠ ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ«ãƒ€ã‚’é™¤å¤–ã§ãã¾ã™ã€‚

## ä¾å­˜é–¢ä¿‚
ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å¤–éƒ¨ã®ä¾å­˜é–¢ä¿‚ã‚’å¿…è¦ã¨ã—ã¾ã›ã‚“ã€‚Pythonã®çµ„ã¿è¾¼ã¿ã®`os`ã¨`fnmatch`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## è²¢çŒ®
è²¢çŒ®ã¯å¤§æ­“è¿ã§ã™ï¼å•é¡Œã‚’è¦‹ã¤ã‘ãŸã‚Šã€æ”¹å–„ã®ãŸã‚ã®ææ¡ˆãŒã‚ã‚‹å ´åˆã¯ã€GitHubãƒªãƒã‚¸ãƒˆãƒªã§issueã‚’é–‹ã„ãŸã‚Šã€ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ãã ã•ã„ã€‚

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

This Python script generates a project summary by walking through the project's folder structure and creating a Markdown representation of the files and their contents. It provides a convenient way to document your project's structure and file contents in a single Markdown file.

## Features
- Generates a Markdown summary of the project's folder structure.
- Includes the contents of each file in the summary.
- Supports excluding specific files and folders using `.gitignore` and `.summaryignore` files.
- Handles encoding issues by attempting to decode files using UTF-8 and Shift-JIS encodings.
- Saves the generated summary to a file named `<project_name>_project_summary.txt`.

## Usage
1. Clone the repository or download the `generate_project_summary.py` script.
2. Open a terminal or command prompt and navigate to the directory containing the script.
3. Run the script using the command: `python generate_project_summary.py`.
4. When prompted, enter the path to your project directory. If no path is provided, the current directory will be used as the default.
5. The script will generate a project summary and save it to a file named `<project_name>_project_summary.txt` in the same directory as the script.

## Ignoring Files and Folders
You can exclude specific files and folders from the project summary by creating `.gitignore` and `.summaryignore` files in your project's root directory. These files should contain patterns or file/folder names that you want to exclude, one per line.

- The `.gitignore` file is commonly used to exclude files and folders from version control systems like Git.
- The `.summaryignore` file is specific to this script and allows you to exclude additional files and folders from the project summary.

## Dependencies
This script does not require any external dependencies. It uses Python's built-in `os` and `fnmatch` modules.

## Contributing
Contributions are welcome! If you find any issues or have suggestions for improvements, please open an issue or submit a pull request on the GitHub repository.

## License
This project is licensed under the MIT License.

```

### services/goalService.js.error_backup

```
const GoogleSheetsService = require('./googleSheets');
const { getWeekStart, getMonthStart, isThisWeek, isThisMonth } = require('../utils/dateUtils');

/**
 * ç›®æ¨™ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººç›®æ¨™ã®è¨­å®šãƒ»ç®¡ç†ãƒ»é€²æ—è¿½è·¡ã‚’è¡Œã†
 */
class GoalService {
  constructor() {
    this.sheetsService = GoogleSheetsService;
    this.GOALS_SHEET = 'Goals';
    this.PROGRESS_SHEET = 'Progress';
    
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç›®æ¨™å€¤
    this.defaultGoals = {
      weekly: { books: 2, movies: 3, activities: 5, reports: 7 },
      monthly: { books: 8, movies: 12, activities: 20, reports: 28 }
    };
  }

  /**
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›®æ¨™ã‚’å–å¾—
   */
  async getGoals(userId) {
    try {
      const data = await this.sheetsService.getData(`${this.GOALS_SHEET}!A:Z`);
      const userRow = data.find(row => row[0] === userId);
      
      if (!userRow) {
        // åˆå›ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç›®æ¨™ã‚’è¿”ã™
        return {
          weekly: {},
          monthly: {}
        };
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚’è§£æ
      const goals = {
        weekly: {},
        monthly: {}
      };

      // é€±æ¬¡ç›®æ¨™ (åˆ—2-5: books, movies, activities, reports)
      if (userRow[1]) goals.weekly.books = parseInt(userRow[1]) || 0;
      if (userRow[2]) goals.weekly.movies = parseInt(userRow[2]) || 0;
      if (userRow[3]) goals.weekly.activities = parseInt(userRow[3]) || 0;
      if (userRow[4]) goals.weekly.reports = parseInt(userRow[4]) || 0;

      // æœˆæ¬¡ç›®æ¨™ (åˆ—6-9: books, movies, activities, reports)
      if (userRow[5]) goals.monthly.books = parseInt(userRow[5]) || 0;
      if (userRow[6]) goals.monthly.movies = parseInt(userRow[6]) || 0;
      if (userRow[7]) goals.monthly.activities = parseInt(userRow[7]) || 0;
      if (userRow[8]) goals.monthly.reports = parseInt(userRow[8]) || 0;

      return goals;
    } catch (error) {
      console.error('ç›®æ¨™å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { weekly: {}, monthly: {} };
    }
  }

  /**
   * å€‹åˆ¥ç›®æ¨™ã‚’è¨­å®š
   */
  async setGoal(userId, period, category, target) {
    try {
      await this.ensureUserExists(userId);
      
      const columnMap = {
        weekly: { books: 1, movies: 2, activities: 3, reports: 4 },
        monthly: { books: 5, movies: 6, activities: 7, reports: 8 }
      };

      const column = columnMap[period][category];
      if (!column) {
        throw new Error(`ç„¡åŠ¹ãªæœŸé–“ã¾ãŸã¯ã‚«ãƒ†ã‚´ãƒª: ${period}, ${category}`);
      }

      const rowIndex = await this.getUserRowIndex(userId);
      const cellRange = `${this.GOALS_SHEET}!${this.getColumnLetter(column)}${rowIndex}`;
      
      await this.sheetsService.updateData(cellRange, [target]);
      
      // æ›´æ–°ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚‚è¨˜éŒ²
      const timestampColumn = this.getColumnLetter(9); // Jåˆ—
      const timestampRange = `${this.GOALS_SHEET}!${timestampColumn}${rowIndex}`;
      await this.sheetsService.updateData(timestampRange, [new Date().toISOString()]);

      console.log(`ç›®æ¨™è¨­å®šå®Œäº†: ${userId}, ${period}, ${category}, ${target}`);
    } catch (error) {
      console.error('ç›®æ¨™è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * ãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰ç›®æ¨™ã‚’ä¸€æ‹¬è¨­å®š
   */
  async setGoalsFromPreset(userId, presetData) {
    try {
      await this.ensureUserExists(userId);
      const rowIndex = await this.getUserRowIndex(userId);

      // ä¸€æ‹¬æ›´æ–°ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
      const values = [
        presetData.weekly.books || 0,      // Båˆ—
        presetData.weekly.movies || 0,     // Cåˆ—
        presetData.weekly.activities || 0, // Dåˆ—
        presetData.weekly.reports || 0,    // Eåˆ—
        presetData.monthly.books || 0,     // Fåˆ—
        presetData.monthly.movies || 0,    // Gåˆ—
        presetData.monthly.activities || 0,// Håˆ—
        presetData.monthly.reports || 0,   // Iåˆ—
        new Date().toISOString()           // Jåˆ— (ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—)
      ];

      const range = `${this.GOALS_SHEET}!B${rowIndex}:J${rowIndex}`;
      await this.sheetsService.updateData(range, values);

      console.log(`ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šå®Œäº†: ${userId}`);
    } catch (error) {
      console.error('ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * æœŸé–“åˆ¥ç›®æ¨™ãƒªã‚»ãƒƒãƒˆ
   */
  async resetGoals(userId, period) {
    try {
      await this.ensureUserExists(userId);
      const rowIndex = await this.getUserRowIndex(userId);

      let range, values;
      
      if (period === 'weekly') {
        range = `${this.GOALS_SHEET}!B${rowIndex}:E${rowIndex}`;
        values = [0, 0, 0, 0];
      } else if (period === 'monthly') {
        range = `${this.GOALS_SHEET}!F${rowIndex}:I${rowIndex}`;
        values = [0, 0, 0, 0];
      }

      await this.sheetsService.updateData(range, values);
      
      // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ›´æ–°
      const timestampRange = `${this.GOALS_SHEET}!J${rowIndex}`;
      await this.sheetsService.updateData(timestampRange, [new Date().toISOString()]);

      console.log(`ç›®æ¨™ãƒªã‚»ãƒƒãƒˆå®Œäº†: ${userId}, ${period}`);
    } catch (error) {
      console.error('ç›®æ¨™ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * å…¨ç›®æ¨™ãƒªã‚»ãƒƒãƒˆ
   */
  async resetAllGoals(userId) {
    try {
      await this.ensureUserExists(userId);
      const rowIndex = await this.getUserRowIndex(userId);

      const range = `${this.GOALS_SHEET}!B${rowIndex}:J${rowIndex}`;
      const values = [0, 0, 0, 0, 0, 0, 0, 0, new Date().toISOString()];

      await this.sheetsService.updateData(range, values);
      console.log(`å…¨ç›®æ¨™ãƒªã‚»ãƒƒãƒˆå®Œäº†: ${userId}`);
    } catch (error) {
      console.error('å…¨ç›®æ¨™ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * ç¾åœ¨ã®é€²æ—ã‚’å–å¾—
   */
  async getCurrentProgress(userId) {
    try {
      const now = new Date();
      const weekStart = getWeekStart(now);
      const monthStart = getMonthStart(now);

      // å„ã‚·ãƒ¼ãƒˆã‹ã‚‰å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const booksData = await this.getCompletionCounts(userId, 'books_master', weekStart, monthStart);
      const moviesData = await this.getCompletionCounts(userId, 'movies_master', weekStart, monthStart);
      const activitiesData = await this.getCompletionCounts(userId, 'activities_master', weekStart, monthStart);
      const reportsData = await this.getReportCounts(userId, weekStart, monthStart);

      return {
        weekly: {
          books: booksData.weekly,
          movies: moviesData.weekly,
          activities: activitiesData.weekly,
          reports: reportsData.weekly
        },
        monthly: {
          books: booksData.monthly,
          movies: moviesData.monthly,
          activities: activitiesData.monthly,
          reports: reportsData.monthly
        }
      };
    } catch (error) {
      console.error('é€²æ—å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return {
        weekly: { books: 0, movies: 0, activities: 0, reports: 0 },
        monthly: { books: 0, movies: 0, activities: 0, reports: 0 }
      };
    }
  }

  /**
   * è©³ç´°ãªé€²æ—åˆ†æã‚’å–å¾—
   */
  async getProgressAnalysis(userId) {
    try {
      const now = new Date();
      const goals = await this.getGoals(userId);
      const currentProgress = await this.getCurrentProgress(userId);

      // ä»Šæ—¥ã®å®Ÿç¸¾
      const todayProgress = await this.getTodayProgress(userId);

      // éå»ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
      const weeklyTrends = await this.getWeeklyTrends(userId);
      const monthlyTrends = await this.getMonthlyTrends(userId);

      // ç¶™ç¶šã‚¹ãƒˆãƒªãƒ¼ã‚¯è¨ˆç®—
      const streak = await this.calculateStreak(userId);

      // äºˆæ¸¬åˆ†æ
      const predictions = await this.calculatePredictions(userId, goals, currentProgress);

      return {
        today: todayProgress,
        weekly: {
          trends: weeklyTrends,
          predictions: predictions.weekly
        },
        monthly: {
          trends: monthlyTrends,
          predictions: predictions.monthly
        },
        streak: streak,
        lastUpdated: now.toISOString()
      };
    } catch (error) {
      console.error('é€²æ—åˆ†æã‚¨ãƒ©ãƒ¼:', error);
      return {
        today: {},
        weekly: { trends: {}, predictions: {} },
        monthly: { trends: {}, predictions: {} },
        streak: 0,
        lastUpdated: new Date().toISOString()
      };
    }
  }

  /**
   * æœ¬ãƒ»æ˜ ç”»ãƒ»æ´»å‹•ã®å®Œäº†æ•°ã‚’å–å¾—
   */
  async getCompletionCounts(userId, sheetName, weekStart, monthStart) {
    try {
      const data = await this.sheetsService.getData(`${sheetName}!A:Z`);
      if (!data || data.length === 0) return { weekly: 0, monthly: 0 };

      const userRows = data.filter(row => row[0] === userId);
      let weeklyCount = 0;
      let monthlyCount = 0;

      userRows.forEach(row => {
        const completedAt = row[5]; // Fåˆ—: completed_at
        if (!completedAt) return;

        const completedDate = new Date(completedAt);
        if (isNaN(completedDate.getTime())) return;

        if (completedDate >= weekStart) weeklyCount++;
        if (completedDate >= monthStart) monthlyCount++;
      });

      return { weekly: weeklyCount, monthly: monthlyCount };
    } catch (error) {
      console.error(`${sheetName}å®Œäº†æ•°å–å¾—ã‚¨ãƒ©ãƒ¼:`, error);
      return { weekly: 0, monthly: 0 };
    }
  }

  /**
   * ãƒ¬ãƒãƒ¼ãƒˆæ•°ã‚’å–å¾—
   */
  async getReportCounts(userId, weekStart, monthStart) {
    try {
      const data = await this.sheetsService.getData('daily_reports!A:Z');
      if (!data || data.length === 0) return { weekly: 0, monthly: 0 };

      const userRows = data.filter(row => row[0] === userId);
      let weeklyCount = 0;
      let monthlyCount = 0;

      userRows.forEach(row => {
        const createdAt = row[4]; // Eåˆ—: created_at
        if (!createdAt) return;

        const createdDate = new Date(createdAt);
        if (isNaN(createdDate.getTime())) return;

        if (createdDate >= weekStart) weeklyCount++;
        if (createdDate >= monthStart) monthlyCount++;
      });

      return { weekly: weeklyCount, monthly: monthlyCount };
    } catch (error) {
      console.error('ãƒ¬ãƒãƒ¼ãƒˆæ•°å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { weekly: 0, monthly: 0 };
    }
  }

  /**
   * ä»Šæ—¥ã®å®Ÿç¸¾ã‚’å–å¾—
   */
  async getTodayProgress(userId) {
    try {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);

      const progress = {
        books: 0,
        movies: 0,
        activities: 0,
        reports: 0
      };

      // å„ã‚«ãƒ†ã‚´ãƒªã®ä»Šæ—¥ã®å®Ÿç¸¾ã‚’å–å¾—
      const sheets = ['Books', 'Movies', 'Activities'];
      for (const sheet of sheets) {
        const data = await this.sheetsService.getValues(sheet, 'A:Z');
        if (!data) continue;

        const category = sheet.toLowerCase();
        const userRows = data.filter(row => row[0] === userId);
        
        userRows.forEach(row => {
          const completedAt = row[5];
          if (!completedAt) return;

          const completedDate = new Date(completedAt);
          if (completedDate >= today && completedDate < tomorrow) {
            progress[category]++;
          }
        });
      }

      // ãƒ¬ãƒãƒ¼ãƒˆã®ä»Šæ—¥ã®å®Ÿç¸¾
      const reportsData = await this.sheetsService.getValues('Reports', 'A:Z');
      if (reportsData) {
        const userReports = reportsData.filter(row => row[0] === userId);
        userReports.forEach(row => {
          const createdAt = row[4];
          if (!createdAt) return;

          const createdDate = new Date(createdAt);
          if (createdDate >= today && createdDate < tomorrow) {
            progress.reports++;
          }
        });
      }

      return progress;
    } catch (error) {
      console.error('ä»Šæ—¥ã®å®Ÿç¸¾å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { books: 0, movies: 0, activities: 0, reports: 0 };
    }
  }

  /**
   * é€±æ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’å–å¾—
   */
  async getWeeklyTrends(userId) {
    try {
      const trends = {};
      const weeks = 4; // éå»4é€±é–“
      const weeklyData = [];

      for (let i = 0; i < weeks; i++) {
        const weekStart = new Date();
        weekStart.setDate(weekStart.getDate() - (i * 7) - (weekStart.getDay() || 7) + 1);
        weekStart.setHours(0, 0, 0, 0);
        
        const weekEnd = new Date(weekStart);
        weekEnd.setDate(weekEnd.getDate() + 6);
        weekEnd.setHours(23, 59, 59, 999);

        const weekProgress = await this.getProgressForPeriod(userId, weekStart, weekEnd);
        weeklyData.push(weekProgress);
      }

      // ãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—ï¼ˆç›´è¿‘2é€±é–“ vs éå»2é€±é–“ï¼‰
      const categories = ['books', 'movies', 'activities', 'reports'];
      categories.forEach(category => {
        const recent = (weeklyData[0][category] + weeklyData[1][category]) / 2;
        const past = (weeklyData[2][category] + weeklyData[3][category]) / 2;
        trends[category] = recent - past; // æ­£ã®å€¤ã¯ä¸Šæ˜‡ãƒˆãƒ¬ãƒ³ãƒ‰
      });

      return trends;
    } catch (error) {
      console.error('é€±æ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return {};
    }
  }

  /**
   * æœˆæ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’å–å¾—
   */
  async getMonthlyTrends(userId) {
    try {
      const trends = {};
      const months = 3; // éå»3ãƒ¶æœˆ
      const monthlyData = [];

      for (let i = 0; i < months; i++) {
        const monthStart = new Date();
        monthStart.setMonth(monthStart.getMonth() - i, 1);
        monthStart.setHours(0, 0, 0, 0);
        
        const monthEnd = new Date(monthStart);
        monthEnd.setMonth(monthEnd.getMonth() + 1, 0);
        monthEnd.setHours(23, 59, 59, 999);

        const monthProgress = await this.getProgressForPeriod(userId, monthStart, monthEnd);
        monthlyData.push(monthProgress);
      }

      // ãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—
      const categories = ['books', 'movies', 'activities', 'reports'];
      categories.forEach(category => {
        if (monthlyData.length >= 2) {
          trends[category] = monthlyData[0][category] - monthlyData[1][category];
        }
      });

      return trends;
    } catch (error) {
      console.error('æœˆæ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return {};
    }
  }

  /**
   * æŒ‡å®šæœŸé–“ã®é€²æ—ã‚’å–å¾—
   */
  async getProgressForPeriod(userId, startDate, endDate) {
    try {
      const progress = { books: 0, movies: 0, activities: 0, reports: 0 };

      // å„ã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const sheets = ['Books', 'Movies', 'Activities'];
      for (const sheet of sheets) {
        const data = await this.sheetsService.getValues(sheet, 'A:Z');
        if (!data) continue;

        const category = sheet.toLowerCase();
        const userRows = data.filter(row => row[0] === userId);
        
        userRows.forEach(row => {
          const completedAt = row[5];
          if (!completedAt) return;

          const completedDate = new Date(completedAt);
          if (completedDate >= startDate && completedDate <= endDate) {
            progress[category]++;
          }
        });
      }

      // ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿
      const reportsData = await this.sheetsService.getValues('Reports', 'A:Z');
      if (reportsData) {
        const userReports = reportsData.filter(row => row[0] === userId);
        userReports.forEach(row => {
          const createdAt = row[4];
          if (!createdAt) return;

          const createdDate = new Date(createdAt);
          if (createdDate >= startDate && createdDate <= endDate) {
            progress.reports++;
          }
        });
      }

      return progress;
    } catch (error) {
      console.error('æœŸé–“é€²æ—å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { books: 0, movies: 0, activities: 0, reports: 0 };
    }
  }

  /**
   * ç¶™ç¶šã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’è¨ˆç®—
   */
  async calculateStreak(userId) {
    try {
      let streak = 0;
      const today = new Date();
      today.setHours(0, 0, 0, 0);

      // éå»30æ—¥é–“ã‚’ãƒã‚§ãƒƒã‚¯
      for (let i = 0; i < 30; i++) {
        const checkDate = new Date(today);
        checkDate.setDate(checkDate.getDate() - i);
        
        const nextDay = new Date(checkDate);
        nextDay.setDate(nextDay.getDate() + 1);

        const dayProgress = await this.getProgressForPeriod(userId, checkDate, nextDay);
        const totalActivity = Object.values(dayProgress).reduce((sum, count) => sum + count, 0);

        if (totalActivity > 0) {
          streak++;
        } else if (i === 0) {
          // ä»Šæ—¥æ´»å‹•ãŒãªã„å ´åˆã€æ˜¨æ—¥ã‹ã‚‰æ•°ãˆã‚‹
          continue;
        } else {
          // æ´»å‹•ãŒãªã„æ—¥ãŒã‚ã£ãŸã‚‰ã‚¹ãƒˆãƒªãƒ¼ã‚¯çµ‚äº†
          break;
        }
      }

      return streak;
    } catch (error) {
      console.error('ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
      return 0;
    }
  }

  /**
   * ç›®æ¨™é”æˆäºˆæ¸¬ã‚’è¨ˆç®—
   */
  async calculatePredictions(userId, goals, currentProgress) {
    try {
      const now = new Date();
      const predictions = { weekly: {}, monthly: {} };

      // é€±æ¬¡äºˆæ¸¬
      const weekStart = getWeekStart(now);
      const weekEnd = new Date(weekStart);
      weekEnd.setDate(weekEnd.getDate() + 6);
      const daysPassedInWeek = Math.floor((now - weekStart) / (1000 * 60 * 60 * 24)) + 1;
      const daysRemainingInWeek = 7 - daysPassedInWeek;

      Object.entries(goals.weekly || {}).forEach(([category, target]) => {
        const current = currentProgress.weekly[category] || 0;
        const dailyRate = current / daysPassedInWeek;
        const predicted = Math.round(current + (dailyRate * daysRemainingInWeek));
        const achievable = predicted >= target;
        
        predictions.weekly[category] = {
          predicted,
          achievable,
          needed: Math.max(0, target - current),
          dailyNeed: daysRemainingInWeek > 0 ? Math.ceil((target - current) / daysRemainingInWeek) : 0
        };
      });

      // æœˆæ¬¡äºˆæ¸¬
      const monthStart = getMonthStart(now);
      const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
      const daysPassedInMonth = now.getDate();
      const daysRemainingInMonth = daysInMonth - daysPassedInMonth;

      Object.entries(goals.monthly || {}).forEach(([category, target]) => {
        const current = currentProgress.monthly[category] || 0;
        const dailyRate = current / daysPassedInMonth;
        const predicted = Math.round(current + (dailyRate * daysRemainingInMonth));
        const achievable = predicted >= target;
        
        predictions.monthly[category] = {
          predicted,
          achievable,
          needed: Math.max(0, target - current),
          dailyNeed: daysRemainingInMonth > 0 ? Math.ceil((target - current) / daysRemainingInMonth) : 0
        };
      });

      return predictions;
    } catch (error) {
      console.error('äºˆæ¸¬è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
      return { weekly: {}, monthly: {} };
    }
  }

  /**
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼å­˜åœ¨ç¢ºèªãƒ»ä½œæˆ
   */
  async ensureUserExists(userId) {
    try {
      const data = await this.sheetsService.getData(`${this.GOALS_SHEET}!A:A`);
      const userExists = data && data.some(row => row[0] === userId);
      
      if (!userExists) {
        // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ç¢ºèªãƒ»ä½œæˆ
        await this.ensureHeaderExists();
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œã‚’è¿½åŠ 
        const newRow = [
          userId, // Aåˆ—: user_id
          0, 0, 0, 0, // B-Eåˆ—: é€±æ¬¡ç›®æ¨™
          0, 0, 0, 0, // F-Iåˆ—: æœˆæ¬¡ç›®æ¨™
          new Date().toISOString() // Jåˆ—: created_at
        ];
        
        await this.sheetsService.appendData(`${this.GOALS_SHEET}!A:J`, newRow);
        console.log(`æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ: ${userId}`);
      }
    } catch (error) {
      console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã®ç¢ºèªãƒ»ä½œæˆ
   */
  async ensureHeaderExists() {
    try {
      const data = await this.sheetsService.getData(`${this.GOALS_SHEET}!A1:J1`);
      
      if (!data || data.length === 0 || !data[0] || data[0][0] !== 'user_id') {
        const headers = [
          'user_id',
          'weekly_books', 'weekly_movies', 'weekly_activities', 'weekly_reports',
          'monthly_books', 'monthly_movies', 'monthly_activities', 'monthly_reports',
          'updated_at'
        ];
        
        await this.sheetsService.updateData(`${this.GOALS_SHEET}!A1:J1`, headers);
        console.log('ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ä½œæˆã—ã¾ã—ãŸ');
      }
    } catch (error) {
      console.error('ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
      // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã—ã¦ç¶šè¡Œ
    }
  }

  /**
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
   */
  async getUserRowIndex(userId) {
    try {
      const data = await this.sheetsService.getData(`${this.GOALS_SHEET}!A:A`);
      if (!data) throw new Error('ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“');
      
      const rowIndex = data.findIndex(row => row[0] === userId);
      if (rowIndex === -1) throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      
      return rowIndex + 1; // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¯1ã‹ã‚‰å§‹ã¾ã‚‹
    } catch (error) {
      console.error('è¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * åˆ—ç•ªå·ã‚’æ–‡å­—ã«å¤‰æ›
   */
  getColumnLetter(columnNumber) {
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    return letters[columnNumber];
  }
}

module.exports = new GoalService();

```

### services/goalService.js

```
const GoogleSheetsService = require('./googleSheets');

/**
 * ç›®æ¨™ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ - Google Sheetså®Œå…¨é€£æºç‰ˆ
 * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººç›®æ¨™ã®è¨­å®šãƒ»ç®¡ç†ãƒ»é€²æ—è¿½è·¡ã‚’è¡Œã†
 */
class GoalService {
  constructor() {
    try {
      this.sheetsService = new GoogleSheetsService();
      this.GOALS_SHEET = 'Goals';
      console.log('ğŸ¯ goalService: Google Sheetsé€£æºãƒ¢ãƒ¼ãƒ‰ã§åˆæœŸåŒ–');
      
      // åˆæœŸåŒ–æ™‚ã«ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
      this.initializeSheet();
    } catch (error) {
      console.error('GoogleSheetsServiceåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
    
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆç›®æ¨™å€¤
    this.defaultGoals = {
      weekly: { books: 2, movies: 3, activities: 5, reports: 7 },
      monthly: { books: 8, movies: 12, activities: 20, reports: 28 }
    };
  }

  async initializeSheet() {
    try {
      // Goalsã‚·ãƒ¼ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç¢ºèªãƒ»ä½œæˆ
      await this.ensureHeaderExists();
      console.log('âœ… goalService: Goals ã‚·ãƒ¼ãƒˆåˆæœŸåŒ–å®Œäº†');
    } catch (error) {
      console.error('Goals ã‚·ãƒ¼ãƒˆåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  /**
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›®æ¨™ã‚’å–å¾—
   */
  async getGoals(userId) {
    try {
      const data = await this.sheetsService.getData(`${this.GOALS_SHEET}!A:J`);
      if (!data || data.length === 0) {
        console.log('Goals ã‚·ãƒ¼ãƒˆãŒç©ºã§ã™');
        return { weekly: {}, monthly: {} };
      }

      const userRow = data.find(row => row[0] === userId);
      
      if (!userRow) {
        console.log(`ãƒ¦ãƒ¼ã‚¶ãƒ¼ ${userId} ã®ç›®æ¨™ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
        return { weekly: {}, monthly: {} };
      }

      // ãƒ‡ãƒ¼ã‚¿ã‚’è§£æ
      const goals = {
        weekly: {},
        monthly: {}
      };

      // é€±æ¬¡ç›®æ¨™ (åˆ—1-4: books, movies, activities, reports)
      if (userRow[1] && parseInt(userRow[1]) > 0) goals.weekly.books = parseInt(userRow[1]);
      if (userRow[2] && parseInt(userRow[2]) > 0) goals.weekly.movies = parseInt(userRow[2]);
      if (userRow[3] && parseInt(userRow[3]) > 0) goals.weekly.activities = parseInt(userRow[3]);
      if (userRow[4] && parseInt(userRow[4]) > 0) goals.weekly.reports = parseInt(userRow[4]);

      // æœˆæ¬¡ç›®æ¨™ (åˆ—5-8: books, movies, activities, reports)
      if (userRow[5] && parseInt(userRow[5]) > 0) goals.monthly.books = parseInt(userRow[5]);
      if (userRow[6] && parseInt(userRow[6]) > 0) goals.monthly.movies = parseInt(userRow[6]);
      if (userRow[7] && parseInt(userRow[7]) > 0) goals.monthly.activities = parseInt(userRow[7]);
      if (userRow[8] && parseInt(userRow[8]) > 0) goals.monthly.reports = parseInt(userRow[8]);

      console.log(`âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ ${userId} ã®ç›®æ¨™å–å¾—å®Œäº†:`, goals);
      return goals;
    } catch (error) {
      console.error('ç›®æ¨™å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { weekly: {}, monthly: {} };
    }
  }

  /**
   * å€‹åˆ¥ç›®æ¨™ã‚’è¨­å®š
   */
  async setGoal(userId, period, category, target) {
    try {
      await this.ensureUserExists(userId);
      
      const columnMap = {
        weekly: { books: 'B', movies: 'C', activities: 'D', reports: 'E' },
        monthly: { books: 'F', movies: 'G', activities: 'H', reports: 'I' }
      };

      const column = columnMap[period][category];
      if (!column) {
        throw new Error(`ç„¡åŠ¹ãªæœŸé–“ã¾ãŸã¯ã‚«ãƒ†ã‚´ãƒª: ${period}, ${category}`);
      }

      const rowIndex = await this.getUserRowIndex(userId);
      const cellRange = `${this.GOALS_SHEET}!${column}${rowIndex}`;
      
      const success = await this.sheetsService.updateData(cellRange, [target]);
      
      if (success) {
        // æ›´æ–°ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚‚è¨˜éŒ²
        const timestampRange = `${this.GOALS_SHEET}!J${rowIndex}`;
        await this.sheetsService.updateData(timestampRange, [new Date().toISOString()]);
        
        console.log(`âœ… ç›®æ¨™è¨­å®šå®Œäº†: ${userId}, ${period}, ${category}, ${target}`);
      } else {
        throw new Error('ç›®æ¨™ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } catch (error) {
      console.error('ç›®æ¨™è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * ãƒ—ãƒªã‚»ãƒƒãƒˆã‹ã‚‰ç›®æ¨™ã‚’ä¸€æ‹¬è¨­å®š
   */
  async setGoalsFromPreset(userId, presetData) {
    try {
      await this.ensureUserExists(userId);
      const rowIndex = await this.getUserRowIndex(userId);

      // ä¸€æ‹¬æ›´æ–°ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
      const values = [
        presetData.weekly.books || 0,      // Båˆ—
        presetData.weekly.movies || 0,     // Cåˆ—
        presetData.weekly.activities || 0, // Dåˆ—
        presetData.weekly.reports || 0,    // Eåˆ—
        presetData.monthly.books || 0,     // Fåˆ—
        presetData.monthly.movies || 0,    // Gåˆ—
        presetData.monthly.activities || 0,// Håˆ—
        presetData.monthly.reports || 0,   // Iåˆ—
        new Date().toISOString()           // Jåˆ— (ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—)
      ];

      const range = `${this.GOALS_SHEET}!B${rowIndex}:J${rowIndex}`;
      const success = await this.sheetsService.updateData(range, values);
      
      if (success) {
        console.log(`âœ… ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šå®Œäº†: ${userId}`, presetData);
      } else {
        throw new Error('ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } catch (error) {
      console.error('ãƒ—ãƒªã‚»ãƒƒãƒˆè¨­å®šã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * æœŸé–“åˆ¥ç›®æ¨™ãƒªã‚»ãƒƒãƒˆ
   */
  async resetGoals(userId, period) {
    try {
      await this.ensureUserExists(userId);
      const rowIndex = await this.getUserRowIndex(userId);

      let range, values;
      
      if (period === 'weekly') {
        range = `${this.GOALS_SHEET}!B${rowIndex}:E${rowIndex}`;
        values = [0, 0, 0, 0];
      } else if (period === 'monthly') {
        range = `${this.GOALS_SHEET}!F${rowIndex}:I${rowIndex}`;
        values = [0, 0, 0, 0];
      }

      const success = await this.sheetsService.updateData(range, values);
      
      if (success) {
        // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ›´æ–°
        const timestampRange = `${this.GOALS_SHEET}!J${rowIndex}`;
        await this.sheetsService.updateData(timestampRange, [new Date().toISOString()]);
        
        console.log(`âœ… ç›®æ¨™ãƒªã‚»ãƒƒãƒˆå®Œäº†: ${userId}, ${period}`);
      } else {
        throw new Error('ç›®æ¨™ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } catch (error) {
      console.error('ç›®æ¨™ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * å…¨ç›®æ¨™ãƒªã‚»ãƒƒãƒˆ
   */
  async resetAllGoals(userId) {
    try {
      await this.ensureUserExists(userId);
      const rowIndex = await this.getUserRowIndex(userId);

      const range = `${this.GOALS_SHEET}!B${rowIndex}:J${rowIndex}`;
      const values = [0, 0, 0, 0, 0, 0, 0, 0, new Date().toISOString()];

      const success = await this.sheetsService.updateData(range, values);
      
      if (success) {
        console.log(`âœ… å…¨ç›®æ¨™ãƒªã‚»ãƒƒãƒˆå®Œäº†: ${userId}`);
      } else {
        throw new Error('å…¨ç›®æ¨™ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    } catch (error) {
      console.error('å…¨ç›®æ¨™ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * ç¾åœ¨ã®é€²æ—ã‚’å–å¾—
   */
  async getCurrentProgress(userId) {
    try {
      const now = new Date();
      const weekStart = this.getWeekStart(now);
      const monthStart = this.getMonthStart(now);

      // å„ã‚·ãƒ¼ãƒˆã‹ã‚‰å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const booksData = await this.getCompletionCounts('books_master', weekStart, monthStart);
      const moviesData = await this.getCompletionCounts('movies_master', weekStart, monthStart);
      const activitiesData = await this.getCompletionCounts('activities_master', weekStart, monthStart);
      const reportsData = await this.getReportCounts(weekStart, monthStart);

      console.log(`âœ… é€²æ—ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†: books(${booksData.weekly}/${booksData.monthly}), movies(${moviesData.weekly}/${moviesData.monthly}), activities(${activitiesData.weekly}/${activitiesData.monthly}), reports(${reportsData.weekly}/${reportsData.monthly})`);

      return {
        weekly: {
          books: booksData.weekly,
          movies: moviesData.weekly,
          activities: activitiesData.weekly,
          reports: reportsData.weekly
        },
        monthly: {
          books: booksData.monthly,
          movies: moviesData.monthly,
          activities: activitiesData.monthly,
          reports: reportsData.monthly
        }
      };
    } catch (error) {
      console.error('é€²æ—å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return {
        weekly: { books: 0, movies: 0, activities: 0, reports: 0 },
        monthly: { books: 0, movies: 0, activities: 0, reports: 0 }
      };
    }
  }

  /**
   * æœ¬ãƒ»æ˜ ç”»ãƒ»æ´»å‹•ã®å®Œäº†æ•°ã‚’å–å¾—
   */
  async getCompletionCounts(sheetName, weekStart, monthStart) {
    try {
      const data = await this.sheetsService.getData(`${sheetName}!A:Z`);
      if (!data || data.length === 0) return { weekly: 0, monthly: 0 };

      let weeklyCount = 0;
      let monthlyCount = 0;

      // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
      const dataRows = data.slice(1);

      dataRows.forEach(row => {
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒå®Œäº†ã‚’ç¤ºã™ã‹ãƒã‚§ãƒƒã‚¯
        const status = row[4] || row[5]; // movies_masterã¯åˆ—4ã€othersã¯åˆ—5
        const isCompleted = status === 'finished' || status === 'watched' || status === 'done';
        
        if (!isCompleted) return;

        // å®Œäº†æ—¥ã‚’ãƒã‚§ãƒƒã‚¯
        const completedAt = row[5] || row[6]; // å®Œäº†æ—¥ã®åˆ—
        if (!completedAt) return;

        const completedDate = new Date(completedAt);
        if (isNaN(completedDate.getTime())) return;

        if (completedDate >= weekStart) weeklyCount++;
        if (completedDate >= monthStart) monthlyCount++;
      });

      return { weekly: weeklyCount, monthly: monthlyCount };
    } catch (error) {
      console.error(`${sheetName}å®Œäº†æ•°å–å¾—ã‚¨ãƒ©ãƒ¼:`, error);
      return { weekly: 0, monthly: 0 };
    }
  }

  /**
   * ãƒ¬ãƒãƒ¼ãƒˆæ•°ã‚’å–å¾—
   */
  async getReportCounts(weekStart, monthStart) {
    try {
      const data = await this.sheetsService.getData('daily_reports!A:Z');
      if (!data || data.length === 0) return { weekly: 0, monthly: 0 };

      let weeklyCount = 0;
      let monthlyCount = 0;

      // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—
      const dataRows = data.slice(1);

      dataRows.forEach(row => {
        const createdAt = row[1]; // Båˆ—: date
        if (!createdAt) return;

        const createdDate = new Date(createdAt);
        if (isNaN(createdDate.getTime())) return;

        if (createdDate >= weekStart) weeklyCount++;
        if (createdDate >= monthStart) monthlyCount++;
      });

      return { weekly: weeklyCount, monthly: monthlyCount };
    } catch (error) {
      console.error('ãƒ¬ãƒãƒ¼ãƒˆæ•°å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { weekly: 0, monthly: 0 };
    }
  }

  /**
   * è©³ç´°ãªé€²æ—åˆ†æã‚’å–å¾—
   */
  async getProgressAnalysis(userId) {
    try {
      const now = new Date();
      const goals = await this.getGoals(userId);
      const currentProgress = await this.getCurrentProgress(userId);

      // ä»Šæ—¥ã®å®Ÿç¸¾
      const todayProgress = await this.getTodayProgress();

      // éå»ã®ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
      const weeklyTrends = await this.getWeeklyTrends();
      const monthlyTrends = await this.getMonthlyTrends();

      // ç¶™ç¶šã‚¹ãƒˆãƒªãƒ¼ã‚¯è¨ˆç®—
      const streak = await this.calculateStreak();

      return {
        today: todayProgress,
        weekly: {
          trends: weeklyTrends,
          predictions: {}
        },
        monthly: {
          trends: monthlyTrends,
          predictions: {}
        },
        streak: streak,
        lastUpdated: now.toISOString()
      };
    } catch (error) {
      console.error('é€²æ—åˆ†æã‚¨ãƒ©ãƒ¼:', error);
      return {
        today: {},
        weekly: { trends: {}, predictions: {} },
        monthly: { trends: {}, predictions: {} },
        streak: 0,
        lastUpdated: new Date().toISOString()
      };
    }
  }

  /**
   * ä»Šæ—¥ã®å®Ÿç¸¾ã‚’å–å¾—
   */
  async getTodayProgress() {
    try {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);

      const todayStr = today.toISOString().slice(0, 10);

      const progress = {
        books: 0,
        movies: 0,
        activities: 0,
        reports: 0
      };

      // å„ã‚«ãƒ†ã‚´ãƒªã®ä»Šæ—¥ã®å®Ÿç¸¾ã‚’å–å¾—
      const sheets = [
        { name: 'books_master', category: 'books', statusCol: 5, dateCol: 6, completedStatus: 'finished' },
        { name: 'movies_master', category: 'movies', statusCol: 4, dateCol: 5, completedStatus: 'watched' },
        { name: 'activities_master', category: 'activities', statusCol: 4, dateCol: 5, completedStatus: 'done' }
      ];

      for (const sheet of sheets) {
        try {
          const data = await this.sheetsService.getData(`${sheet.name}!A:Z`);
          if (!data) continue;

          const dataRows = data.slice(1);
          dataRows.forEach(row => {
            if (row[sheet.statusCol] === sheet.completedStatus && row[sheet.dateCol] === todayStr) {
              progress[sheet.category]++;
            }
          });
        } catch (error) {
          console.error(`ä»Šæ—¥ã®${sheet.category}å®Ÿç¸¾å–å¾—ã‚¨ãƒ©ãƒ¼:`, error);
        }
      }

      // ãƒ¬ãƒãƒ¼ãƒˆã®ä»Šæ—¥ã®å®Ÿç¸¾
      try {
        const reportsData = await this.sheetsService.getData('daily_reports!A:Z');
        if (reportsData) {
          const dataRows = reportsData.slice(1);
          dataRows.forEach(row => {
            if (row[1] === todayStr) { // Båˆ—: date
              progress.reports++;
            }
          });
        }
      } catch (error) {
        console.error('ä»Šæ—¥ã®ãƒ¬ãƒãƒ¼ãƒˆå®Ÿç¸¾å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      }

      return progress;
    } catch (error) {
      console.error('ä»Šæ—¥ã®å®Ÿç¸¾å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { books: 0, movies: 0, activities: 0, reports: 0 };
    }
  }

  /**
   * é€±æ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’å–å¾—
   */
  async getWeeklyTrends() {
    try {
      // ç°¡æ˜“çš„ãªãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—
      const now = new Date();
      const dayOfWeek = now.getDay();
      
      // æ›œæ—¥ã«åŸºã¥ãå‚¾å‘
      return {
        books: dayOfWeek <= 5 ? 0.2 : -0.1, // å¹³æ—¥ã¯èª­æ›¸ãŒå¤šã„
        movies: dayOfWeek >= 5 ? 0.3 : 0.1, // é€±æœ«ã¯æ˜ ç”»ãŒå¤šã„
        activities: dayOfWeek <= 5 ? 0.3 : 0.2, // å¹³æ—¥ã¯æ´»å‹•ãŒå¤šã„
        reports: dayOfWeek <= 5 ? 0.4 : -0.2 // å¹³æ—¥ã¯å ±å‘ŠãŒå¤šã„
      };
    } catch (error) {
      console.error('é€±æ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return {};
    }
  }

  /**
   * æœˆæ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’å–å¾—
   */
  async getMonthlyTrends() {
    try {
      // ç°¡æ˜“çš„ãªãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—
      const now = new Date();
      const dayOfMonth = now.getDate();
      
      // æœˆã®é€²è¡Œã«åŸºã¥ãå‚¾å‘
      return {
        books: dayOfMonth <= 15 ? 0.1 : 0.2, // æœˆå¾ŒåŠã¯èª­æ›¸ãŒå¢—åŠ 
        movies: 0.1 + (Math.random() - 0.5) * 0.2,
        activities: dayOfMonth <= 10 ? 0.2 : 0.1, // æœˆåˆã¯æ´»å‹•ãŒå¤šã„
        reports: dayOfMonth <= 20 ? 0.3 : 0.1 // æœˆåˆï½ä¸­æ—¬ã¯å ±å‘ŠãŒå¤šã„
      };
    } catch (error) {
      console.error('æœˆæ¬¡ãƒˆãƒ¬ãƒ³ãƒ‰å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return {};
    }
  }

  /**
   * ç¶™ç¶šã‚¹ãƒˆãƒªãƒ¼ã‚¯ã‚’è¨ˆç®—
   */
  async calculateStreak() {
    try {
      // ç°¡æ˜“çš„ãªã‚¹ãƒˆãƒªãƒ¼ã‚¯è¨ˆç®—
      // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ã€éå»ã®ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã‹ã‚‰é€£ç¶šæ—¥æ•°ã‚’è¨ˆç®—
      const reportsData = await this.sheetsService.getData('daily_reports!A:Z');
      if (!reportsData || reportsData.length <= 1) return 0;

      const today = new Date();
      let streak = 0;
      
      // éå»7æ—¥é–“ã‚’ãƒã‚§ãƒƒã‚¯
      for (let i = 0; i < 7; i++) {
        const checkDate = new Date(today);
        checkDate.setDate(checkDate.getDate() - i);
        const checkDateStr = checkDate.toISOString().slice(0, 10);
        
        const hasActivity = reportsData.slice(1).some(row => row[1] === checkDateStr);
        
        if (hasActivity) {
          streak++;
        } else if (i === 0) {
          // ä»Šæ—¥æ´»å‹•ãŒãªã„å ´åˆã¯ç¶™ç¶š
          continue;
        } else {
          // æ´»å‹•ãŒãªã„æ—¥ãŒã‚ã£ãŸã‚‰ã‚¹ãƒˆãƒªãƒ¼ã‚¯çµ‚äº†
          break;
        }
      }

      return streak;
    } catch (error) {
      console.error('ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
      return 0;
    }
  }

  /**
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼å­˜åœ¨ç¢ºèªãƒ»ä½œæˆ
   */
  async ensureUserExists(userId) {
    try {
      const data = await this.sheetsService.getData(`${this.GOALS_SHEET}!A:A`);
      const userExists = data && data.some(row => row[0] === userId);
      
      if (!userExists) {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡Œã‚’è¿½åŠ 
        const newRow = [
          userId, // Aåˆ—: user_id
          0, 0, 0, 0, // B-Eåˆ—: é€±æ¬¡ç›®æ¨™
          0, 0, 0, 0, // F-Iåˆ—: æœˆæ¬¡ç›®æ¨™
          new Date().toISOString() // Jåˆ—: created_at
        ];
        
        const result = await this.sheetsService.appendData(`${this.GOALS_SHEET}!A:J`, newRow);
        console.log(`âœ… æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ: ${userId}, result: ${result}`);
      }
    } catch (error) {
      console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã®ç¢ºèªãƒ»ä½œæˆ
   */
  async ensureHeaderExists() {
    try {
      const data = await this.sheetsService.getData(`${this.GOALS_SHEET}!A1:J1`);
      
      if (!data || data.length === 0 || !data[0] || data[0][0] !== 'user_id') {
        const headers = [
          'user_id',
          'weekly_books', 'weekly_movies', 'weekly_activities', 'weekly_reports',
          'monthly_books', 'monthly_movies', 'monthly_activities', 'monthly_reports',
          'updated_at'
        ];
        
        const success = await this.sheetsService.updateData(`${this.GOALS_SHEET}!A1:J1`, headers);
        if (success) {
          console.log('âœ… Goalsã‚·ãƒ¼ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ä½œæˆã—ã¾ã—ãŸ');
        }
      } else {
        console.log('âœ… Goalsã‚·ãƒ¼ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™');
      }
    } catch (error) {
      console.error('ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
      // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã—ã¦ç¶šè¡Œ
    }
  }

  /**
   * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
   */
  async getUserRowIndex(userId) {
    try {
      const data = await this.sheetsService.getData(`${this.GOALS_SHEET}!A:A`);
      if (!data) throw new Error('ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“');
      
      const rowIndex = data.findIndex(row => row[0] === userId);
      if (rowIndex === -1) throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      
      return rowIndex + 1; // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¯1ã‹ã‚‰å§‹ã¾ã‚‹
    } catch (error) {
      console.error('è¡Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      throw error;
    }
  }

  /**
   * é€±ã®é–‹å§‹æ—¥ã‚’å–å¾—ï¼ˆæœˆæ›œæ—¥ï¼‰
   */
  getWeekStart(date = new Date()) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day + (day === 0 ? -6 : 1); // æœˆæ›œæ—¥ã‚’é€±ã®é–‹å§‹ã¨ã™ã‚‹
    const weekStart = new Date(d.setDate(diff));
    weekStart.setHours(0, 0, 0, 0);
    return weekStart;
  }

  /**
   * æœˆã®é–‹å§‹æ—¥ã‚’å–å¾—
   */
  getMonthStart(date = new Date()) {
    const d = new Date(date);
    const monthStart = new Date(d.getFullYear(), d.getMonth(), 1);
    monthStart.setHours(0, 0, 0, 0);
    return monthStart;
  }

  /**
   * ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
   */
  async healthCheck() {
    try {
      const health = await this.sheetsService.healthCheck();
      return {
        status: health.status,
        message: 'goalService with Google Sheets integration',
        sheetsStatus: health.status,
        timestamp: new Date().toISOString()
      };
    } catch (error) {
      return {
        status: 'error',
        message: `goalService ã‚¨ãƒ©ãƒ¼: ${error.message}`,
        timestamp: new Date().toISOString()
      };
    }
  }

  /**
   * çµ±è¨ˆæƒ…å ±å–å¾—
   */
  getStats() {
    return {
      service: 'goalService (Google Sheetsé€£æº)',
      uptime: process.uptime(),
      mode: 'sheets-integrated'
    };
  }
}

module.exports = new GoalService();

```

### services/notifications.js

```
const { EmbedBuilder } = require('discord.js');
const cron = require('node-cron');
const StatsUtility = require('./statsUtility');
const goalService = require('./goalService');

class NotificationService {
  constructor(client, googleSheetsService) {
    this.client = client;
    this.googleSheets = googleSheetsService;
    this.statsUtil = new StatsUtility(googleSheetsService);
    this.scheduledTasks = new Map();
    
    console.log('ğŸ“¢ é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆæœŸåŒ–ä¸­...');
    this.initializeScheduledNotifications();
  }

  initializeScheduledNotifications() {
    console.log('â° å®šæœŸé€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¨­å®šä¸­...');

    // æ—¢å­˜ã®é€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
    this.scheduleTask('morning_greeting', '0 7 * * *', () => {
      this.sendMorningGreeting();
    });

    this.scheduleTask('daily_report_reminder', '0 20 * * *', () => {
      this.sendDailyReportReminder();
    });

    this.scheduleTask('weekly_report', '0 21 * * 0', () => {
      this.sendWeeklyReport();
    });

    this.scheduleTask('monthly_report', '0 8 1 * *', () => {
      this.sendMonthlyReport();
    });

    this.scheduleTask('monthly_wishlist', '0 9 1 * *', () => {
      this.sendMonthlyWishlist();
    });

    this.scheduleTask('abandoned_items_check', '0 21 * * 5', () => {
      this.checkAbandonedItems();
    });

    // ğŸ†• çµ±è¨ˆé€šçŸ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ 
    this.scheduleTask('monthly_stats_summary', '0 19 5 * *', () => {
      this.sendMonthlyStatsSummary();
    });

    this.scheduleTask('monthly_trends_analysis', '0 20 15 * *', () => {
      this.sendMonthlyTrendsAnalysis();
    });

    this.scheduleTask('monthly_books_stats', '0 19 25 * *', () => {
      this.sendMonthlyBooksStatistics();
    });

    this.scheduleTask('monthly_comparison', '0 18 28 * *', () => {
      this.sendEnhancedMonthlyComparison();
    });

    this.scheduleTask('quarterly_report', '0 19 * 3,6,9,12 0', () => {
      this.sendQuarterlyReport();
    });

    // ç›®æ¨™é€²æ—ã®å®šæœŸæŠ•ç¨¿
    this.scheduleTask('goals_weekly_start', '0 9 * * 1', () => {
      this.sendGoalsProgressReport('weekly_start');
    });

    this.scheduleTask('goals_weekly_mid', '0 18 * * 3', () => {
      this.sendGoalsProgressReport('weekly_mid');
    });

    this.scheduleTask('goals_weekly_final', '0 19 * * 5', () => {
      this.sendWeeklyGoalsFinalCheck();
    });

    this.scheduleTask('streak_report', '0 20 * * 0', () => {
      this.sendStreakReport();
    });

    this.scheduleTask('goals_adjustment', '0 9 15 * *', () => {
      this.sendGoalsAdjustmentSuggestion();
    });

    console.log(`âœ… ${this.scheduledTasks.size}å€‹ã®å®šæœŸé€šçŸ¥ã‚’è¨­å®šã—ã¾ã—ãŸ`);
  }

  scheduleTask(name, cronPattern, callback) {
    try {
      const task = cron.schedule(cronPattern, callback, {
        scheduled: true,
        timezone: "Asia/Tokyo"
      });
      
      this.scheduledTasks.set(name, task);
      console.log(`âœ… ${name} ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šå®Œäº†: ${cronPattern}`);
    } catch (error) {
      console.error(`âŒ ${name} ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šå¤±æ•—:`, error);
    }
  }

  // é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å–å¾—
  getNotificationChannel() {
    if (process.env.NOTIFICATION_CHANNEL_ID) {
      const channel = this.client.channels.cache.get(process.env.NOTIFICATION_CHANNEL_ID);
      if (channel) return channel;
    }

    const guild = this.client.guilds.cache.first();
    if (guild) {
      const textChannels = guild.channels.cache.filter(ch => ch.type === 0);
      return textChannels.first();
    }

    return null;
  }

  // æœã®æŒ¨æ‹¶ã¨ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯
  async sendMorningGreeting() {
    try {
      const channel = this.getNotificationChannel();
      if (!channel) return;

      const [readingBooks, wantToReadBooks, plannedActivities] = await Promise.all([
        this.googleSheets.getCurrentReadingBooks(),
        this.googleSheets.getWantToReadBooks(),
        this.googleSheets.getActivities().then(activities => 
          activities.filter(activity => activity.includes('(planned)')).slice(0, 5)
        )
      ]);

      const embed = new EmbedBuilder()
        .setTitle('â˜€ï¸ ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼')
        .setDescription('ä»Šæ—¥ã‚‚ç´ æ™´ã‚‰ã—ã„ä¸€æ—¥ã«ã—ã¾ã—ã‚‡ã†ï¼ğŸ“šâœ¨')
        .setColor('#FFD700')
        .setTimestamp();

      if (readingBooks.length > 0) {
        const bookList = readingBooks.map(book => `ğŸ“– ${book.title} - ${book.author}`).join('\n');
        embed.addFields({
          name: 'ğŸ“š èª­æ›¸ä¸­ã®æœ¬',
          value: bookList,
          inline: false
        });
      }

      if (wantToReadBooks.length > 0) {
        const wantToReadList = wantToReadBooks.slice(0, 3)
          .map(book => `ğŸ“‹ ${book.title} - ${book.author}`).join('\n');
        embed.addFields({
          name: 'ğŸ“‹ ç©èª­æœ¬ï¼ˆãŠã™ã™ã‚ï¼‰',
          value: wantToReadList,
          inline: false
        });
      }

      if (plannedActivities.length > 0) {
        const activityList = plannedActivities.slice(0, 3)
          .map(activity => {
            const match = activity.match(/\[(\d+)\] (.+?) \(/);
            return match ? `ğŸ¯ ${match[2]}` : activity;
          }).join('\n');
        
        embed.addFields({
          name: 'ğŸ¯ ä»Šæ—¥ã®æ´»å‹•å€™è£œ',
          value: activityList,
          inline: false
        });
      }

      // ä»Šæ—¥ã®ç›®æ¨™è¨­å®š
      const dailyGoals = [
        'ğŸ“š èª­æ›¸æ™‚é–“ã‚’ç¢ºä¿ã™ã‚‹',
        'ğŸ“ æ—¥å ±ã‚’è¨˜éŒ²ã™ã‚‹',
        'ğŸ¯ ä¸€ã¤ã§ã‚‚æ´»å‹•ã‚’å®Œäº†ã™ã‚‹',
        'ğŸ’­ æ–°ã—ã„ç™ºè¦‹ã‚’è¨˜éŒ²ã™ã‚‹'
      ];

      embed.addFields({
        name: 'ğŸ¯ ä»Šæ—¥ã®ç›®æ¨™',
        value: dailyGoals.join('\n'),
        inline: false
      });

      embed.setFooter({ text: 'ä»Šæ—¥ã‚‚ä¸€æ­©ãšã¤å‰é€²ã—ã¦ã„ãã¾ã—ã‚‡ã†ï¼' });

      await channel.send({ embeds: [embed] });
      console.log('â˜€ï¸ æœã®æŒ¨æ‹¶ã‚’é€ä¿¡ã—ã¾ã—ãŸ');

    } catch (error) {
      console.error('æœã®æŒ¨æ‹¶é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  // ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯å…ƒã®ã‚³ãƒ¼ãƒ‰ã¨åŒã˜ãªã®ã§çœç•¥...
  // ï¼ˆsendDailyReportReminder, sendWeeklyReport, sendMonthlyReport ãªã©ï¼‰

  // ç°¡ç•¥åŒ–ã®ãŸã‚ã€é‡è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã®ã¿å«ã‚ã‚‹
  calculateMonthlyLevel(totalCompleted) {
    if (totalCompleted >= 30) {
      return { icon: 'ğŸ†', name: 'è¶…äººãƒ¬ãƒ™ãƒ«', description: 'é©šç•°çš„ãªé”æˆç‡ã§ã™ï¼' };
    } else if (totalCompleted >= 20) {
      return { icon: 'ğŸŒŸ', name: 'ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ', description: 'ç´ æ™´ã‚‰ã—ã„ç¶™ç¶šåŠ›ã§ã™ï¼' };
    } else if (totalCompleted >= 15) {
      return { icon: 'â­', name: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–', description: 'é †èª¿ã«ãƒšãƒ¼ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™ï¼' };
    } else if (totalCompleted >= 10) {
      return { icon: 'ğŸ”¥', name: 'ãƒ¢ãƒãƒ™ãƒ¼ãƒˆ', description: 'è‰¯ã„ãƒšãƒ¼ã‚¹ã§é€²ã‚“ã§ã„ã¾ã™ï¼' };
    } else if (totalCompleted >= 5) {
      return { icon: 'ğŸ’ª', name: 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼', description: 'ã‚‚ã†å°‘ã—ãƒšãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã§ããã†ã§ã™ï¼' };
    } else {
      return { icon: 'ğŸŒ±', name: 'ã‚¹ã‚¿ãƒ¼ãƒˆ', description: 'ç¶™ç¶šãŒæˆåŠŸã®éµã§ã™ï¼' };
    }
  }

  // é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã®åœæ­¢
  stopAllNotifications() {
    console.log('ğŸ›‘ ã™ã¹ã¦ã®å®šæœŸé€šçŸ¥ã‚’åœæ­¢ä¸­...');
    
    for (const [name, task] of this.scheduledTasks) {
      task.stop();
      console.log(`â¹ï¸ ${name} ã‚’åœæ­¢ã—ã¾ã—ãŸ`);
    }
    
    this.scheduledTasks.clear();
    console.log('âœ… ã™ã¹ã¦ã®å®šæœŸé€šçŸ¥ã‚’åœæ­¢ã—ã¾ã—ãŸ');
  }

  // é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ…‹ç¢ºèª
  getStatus() {
    const activeTasks = Array.from(this.scheduledTasks.keys());
    return {
      isActive: this.scheduledTasks.size > 0,
      taskCount: this.scheduledTasks.size,
      activeTasks,
      notificationChannel: this.getNotificationChannel()?.name || 'ãªã—'
    };
  }
}

module.exports = NotificationService;

```

### services/statistics.js

```
class StatisticsService {
  constructor() {
    this.googleSheets = require('./googleSheets');
  }

  // å…¨ä½“çµ±è¨ˆã‚’å–å¾—
  async getSummaryStats() {
    try {
      // å®Ÿéš›ã®å®Ÿè£…ã§ã¯ Google Sheets ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      // ç¾åœ¨ã¯ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
      return {
        books: {
          total: 15,
          want_to_buy: 4,
          want_to_read: 6,
          reading: 3,
          finished: 8,
          abandoned: 1
        },
        movies: {
          total: 12,
          want_to_watch: 5,
          watched: 7,
          missed: 2
        },
        activities: {
          total: 20,
          planned: 6,
          done: 14,
          skipped: 3
        }
      };
    } catch (error) {
      console.error('çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return this.getDefaultStats();
    }
  }

  // é€±æ¬¡çµ±è¨ˆã‚’å–å¾—
  async getWeeklyStats() {
    try {
      return {
        finishedBooks: 2,
        watchedMovies: 3,
        completedActivities: 5,
        dailyReports: 12
      };
    } catch (error) {
      console.error('é€±æ¬¡çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { finishedBooks: 0, watchedMovies: 0, completedActivities: 0, dailyReports: 0 };
    }
  }

  // æœˆæ¬¡çµ±è¨ˆã‚’å–å¾—
  async getMonthlyStats() {
    try {
      return {
        finishedBooks: 6,
        watchedMovies: 8,
        completedActivities: 18,
        dailyReports: 45,
        bookTitles: [
          'JavaScriptå…¥é–€',
          'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°æ€è€ƒ',
          'Webé–‹ç™ºåŸºç¤',
          'ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ',
          'ãã®ä»–2å†Š'
        ]
      };
    } catch (error) {
      console.error('æœˆæ¬¡çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { finishedBooks: 0, watchedMovies: 0, completedActivities: 0, dailyReports: 0, bookTitles: [] };
    }
  }

  // èª­æ›¸çµ±è¨ˆã‚’å–å¾—
  async getBookStats() {
    try {
      return {
        byStatus: {
          want_to_buy: 4,
          want_to_read: 6,
          reading: 3,
          finished: 8
        },
        byPeriod: {
          thisMonth: 6,
          thisWeek: 2,
          today: 0
        },
        byGenre: {
          technical: 5,
          novel: 3,
          business: 2,
          others: 5
        }
      };
    } catch (error) {
      console.error('èª­æ›¸çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return this.getDefaultBookStats();
    }
  }

  // ç¾åœ¨é€²è¡Œä¸­ã®é …ç›®ã‚’å–å¾—
  async getCurrentProgress() {
    try {
      return {
        readingBooks: [
          { id: 3, title: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å…¥é–€', author: 'ã‚³ãƒ¼ãƒ‰èŠ±å­' },
          { id: 12, title: 'Webé–‹ç™ºåŸºç¤', author: 'é–‹ç™ºæ¬¡éƒ' },
          { id: 18, title: 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ', author: 'DBå¤ªéƒ' }
        ],
        wantToWatchMovies: [
          { id: 2, title: 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³æ˜ ç”»å¤§ä½œ' },
          { id: 6, title: 'SFæ˜ ç”»ã®å‚‘ä½œ' },
          { id: 9, title: 'æœ€æ–°ã‚¢ãƒ‹ãƒ¡æ˜ ç”»' },
          { id: 11, title: 'åä½œãƒ‰ãƒ©ãƒ' },
          { id: 15, title: 'ã‚³ãƒ¡ãƒ‡ã‚£æ˜ ç”»' }
        ],
        plannedActivities: [
          { id: 1, content: 'ã‚¸ãƒ§ã‚®ãƒ³ã‚° 30åˆ†' },
          { id: 4, content: 'éƒ¨å±‹ã®ç‰‡ä»˜ã‘' },
          { id: 7, content: 'è‹±èªã®å‹‰å¼·' },
          { id: 10, content: 'æ–™ç†ã®ç·´ç¿’' }
        ]
      };
    } catch (error) {
      console.error('é€²è¡ŒçŠ¶æ³å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { readingBooks: [], wantToWatchMovies: [], plannedActivities: [] };
    }
  }

  getDefaultStats() {
    return {
      books: { total: 0, want_to_buy: 0, want_to_read: 0, reading: 0, finished: 0, abandoned: 0 },
      movies: { total: 0, want_to_watch: 0, watched: 0, missed: 0 },
      activities: { total: 0, planned: 0, done: 0, skipped: 0 }
    };
  }

  getDefaultBookStats() {
    return {
      byStatus: { want_to_buy: 0, want_to_read: 0, reading: 0, finished: 0 },
      byPeriod: { thisMonth: 0, thisWeek: 0, today: 0 },
      byGenre: { technical: 0, novel: 0, business: 0, others: 0 }
    };
  }
}

module.exports = new StatisticsService();

```

### services/statsUtility.js

```
// services/statsUtility.js - æ–°ã—ãä½œæˆã™ã‚‹å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
class StatsUtility {
  constructor(googleSheetsService) {
    this.googleSheets = googleSheetsService;
  }

  // ===============================
  // çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—ç³»
  // ===============================
  
  // å‰æœˆãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆå®Œå…¨ç‰ˆï¼‰
  async getMonthlyStatsForDate(targetDate) {
    try {
      const startOfMonth = new Date(targetDate.getFullYear(), targetDate.getMonth(), 1);
      const endOfMonth = new Date(targetDate.getFullYear(), targetDate.getMonth() + 1, 0);
      
      return await this.googleSheets.getStatsForDateRange(startOfMonth, endOfMonth);
    } catch (error) {
      console.error('ç‰¹å®šæœˆãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { finishedBooks: 0, watchedMovies: 0, completedActivities: 0, reports: 0 };
    }
  }

  // éå»Né€±é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  async getWeeklyStatsForDate(weeksBack = 0) {
    try {
      const targetDate = new Date();
      targetDate.setDate(targetDate.getDate() - (weeksBack * 7));
      
      const startOfWeek = new Date(targetDate);
      startOfWeek.setDate(targetDate.getDate() - targetDate.getDay());
      
      const endOfWeek = new Date(startOfWeek);
      endOfWeek.setDate(startOfWeek.getDate() + 6);
      
      return await this.googleSheets.getStatsForDateRange(startOfWeek, endOfWeek);
    } catch (error) {
      console.error('é€±æ¬¡ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { finishedBooks: 0, watchedMovies: 0, completedActivities: 0, reports: 0 };
    }
  }

  // ===============================
  // æ¯”è¼ƒãƒ»åˆ†æç³»
  // ===============================

  // 3ãƒ¶æœˆæ¯”è¼ƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  formatThreeMonthComparison(twoMonthsAgo, lastMonth, thisMonth, monthNames) {
    const formatMonth = (stats, name) => {
      const total = (stats.finishedBooks || 0) + (stats.watchedMovies || 0) + (stats.completedActivities || 0);
      return `**${name}**: ${total}ä»¶ (ğŸ“š${stats.finishedBooks || 0} ğŸ¬${stats.watchedMovies || 0} ğŸ¯${stats.completedActivities || 0})`;
    };

    return [
      formatMonth(twoMonthsAgo, monthNames[0]),
      formatMonth(lastMonth, monthNames[1]),
      formatMonth(thisMonth, monthNames[2])
    ].join('\n');
  }

  // æˆé•·ç‡è¨ˆç®—
  calculateGrowthRates(twoMonthsAgo, lastMonth, thisMonth) {
    const calculateRate = (current, previous) => {
      if (previous === 0) return current > 0 ? 100 : 0;
      return Math.round(((current - previous) / previous) * 100);
    };

    const thisTotal = (thisMonth.finishedBooks || 0) + (thisMonth.watchedMovies || 0) + (thisMonth.completedActivities || 0);
    const lastTotal = (lastMonth.finishedBooks || 0) + (lastMonth.watchedMovies || 0) + (lastMonth.completedActivities || 0);
    const twoMonthsTotal = (twoMonthsAgo.finishedBooks || 0) + (twoMonthsAgo.watchedMovies || 0) + (twoMonthsAgo.completedActivities || 0);

    const monthlyGrowth = calculateRate(thisTotal, lastTotal);
    const quarterlyGrowth = calculateRate(thisTotal, twoMonthsTotal);

    let trendIcon, trendText;
    if (monthlyGrowth > 10) {
      trendIcon = 'ğŸš€'; trendText = 'æ€¥æˆé•·';
    } else if (monthlyGrowth > 0) {
      trendIcon = 'ğŸ“ˆ'; trendText = 'æˆé•·';
    } else if (monthlyGrowth === 0) {
      trendIcon = 'â¡ï¸'; trendText = 'å®‰å®š';
    } else {
      trendIcon = 'ğŸ“‰'; trendText = 'èª¿æ•´æœŸ';
    }

    return {
      monthlyGrowth,
      quarterlyGrowth,
      summary: `å‰æœˆæ¯”: ${trendIcon} ${monthlyGrowth >= 0 ? '+' : ''}${monthlyGrowth}% (${trendText})\n3ãƒ¶æœˆæ¯”: ${quarterlyGrowth >= 0 ? '+' : ''}${quarterlyGrowth}%`
    };
  }

  // é€±æ¬¡æ¯”è¼ƒï¼ˆå®Œå…¨ç‰ˆï¼‰
  async getEnhancedWeeklyComparison() {
    try {
      const [thisWeek, lastWeek, twoWeeksAgo] = await Promise.all([
        this.getWeeklyStatsForDate(0),
        this.getWeeklyStatsForDate(1),
        this.getWeeklyStatsForDate(2)
      ]);

      const weekNames = ['2é€±é–“å‰', 'å…ˆé€±', 'ä»Šé€±'];
      
      return {
        thisWeek,
        lastWeek,
        twoWeeksAgo,
        comparison: this.formatThreeWeekComparison(twoWeeksAgo, lastWeek, thisWeek, weekNames),
        growth: this.calculateGrowthRates(twoWeeksAgo, lastWeek, thisWeek),
        trend: this.predictNextWeekTrend(twoWeeksAgo, lastWeek, thisWeek)
      };
    } catch (error) {
      console.error('é€±æ¬¡æ¯”è¼ƒå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return null;
    }
  }

  // ===============================
  // è©³ç´°åˆ†æç³»
  // ===============================

  // è©³ç´°ãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—
  async calculateDetailedTrends() {
    try {
      const reportsData = await this.googleSheets.getRecentReports(30);
      const dailyStats = this.groupReportsByDay(reportsData);
      const weeklyPattern = this.analyzeWeeklyPattern(reportsData);
      
      return {
        paceAnalysis: this.generatePaceAnalysis(dailyStats),
        mostActiveDay: weeklyPattern.mostActiveDay,
        categoryTrends: this.analyzeCategoryTrends(reportsData),
        activityPattern: weeklyPattern.pattern
      };
    } catch (error) {
      console.error('è©³ç´°ãƒˆãƒ¬ãƒ³ãƒ‰è¨ˆç®—ã‚¨ãƒ©ãƒ¼:', error);
      return {
        paceAnalysis: 'ğŸ“Š é †èª¿ãªãƒšãƒ¼ã‚¹ã§æ´»å‹•ä¸­',
        mostActiveDay: 'ğŸ—“ï¸ ãƒ‡ãƒ¼ã‚¿åˆ†æä¸­',
        categoryTrends: 'ğŸ“ˆ ãƒãƒ©ãƒ³ã‚¹è‰¯ãæ´»å‹•ä¸­',
        activityPattern: 'âš¡ ç¶™ç¶šçš„ãªæ´»å‹•'
      };
    }
  }

  // èª­æ›¸åˆ†æ
  async calculateReadingAnalysis(bookCounts, monthlyStats) {
    const total = bookCounts.total || 1;
    return {
      wishlistPercentage: Math.round(((bookCounts.wantToBuy || 0) / total) * 100),
      backlogPercentage: Math.round(((bookCounts.wantToRead || 0) / total) * 100),
      completionPercentage: Math.round((bookCounts.finished / total) * 100),
      completionRate: bookCounts.total > 0 ? Math.round((bookCounts.finished / bookCounts.total) * 100) : 0,
      backlogClearanceRate: this.calculateBacklogRate(bookCounts),
      monthlyPace: monthlyStats.finishedBooks || 0
    };
  }

  // ===============================
  // ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
  // ===============================

  // æ—¥ä»˜é–¢é€£
  getPreviousMonth(monthsBack) {
    const date = new Date();
    date.setMonth(date.getMonth() - monthsBack);
    return date;
  }

  getLastThreeMonthNames() {
    const months = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
    const now = new Date();
    return [
      months[(now.getMonth() - 2 + 12) % 12],
      months[(now.getMonth() - 1 + 12) % 12],
      months[now.getMonth()]
    ];
  }

  // å¤‰åŒ–è¡¨ç¤º
  getChangeIndicator(current, previous) {
    if (current > previous) return `ğŸ“ˆ +${current - previous}`;
    if (current < previous) return `ğŸ“‰ -${previous - current}`;
    return 'â¡ï¸ å¤‰åŒ–ãªã—';
  }

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
  generateProgressBar(percentage, length = 10) {
    const filled = Math.round((percentage / 100) * length);
    const empty = length - filled;
    return 'â–ˆ'.repeat(filled) + 'â–‘'.repeat(empty) + ` ${percentage}%`;
  }

  // ç©èª­æ¶ˆåŒ–ç‡
  calculateBacklogRate(bookCounts) {
    const totalOwned = (bookCounts.wantToRead || 0) + bookCounts.finished;
    return totalOwned > 0 ? Math.round((bookCounts.finished / totalOwned) * 100) : 0;
  }

  // ãƒ‡ãƒ¼ã‚¿åˆ†æãƒ˜ãƒ«ãƒ‘ãƒ¼
  groupReportsByDay(reports) {
    // ãƒ¬ãƒãƒ¼ãƒˆã‚’æ—¥ä»˜åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
    const grouped = {};
    reports.forEach(report => {
      const date = new Date(report.timestamp).toDateString();
      if (!grouped[date]) grouped[date] = [];
      grouped[date].push(report);
    });
    return grouped;
  }

  analyzeWeeklyPattern(reports) {
    const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
    const dayCounts = new Array(7).fill(0);
    
    reports.forEach(report => {
      const dayIndex = new Date(report.timestamp).getDay();
      dayCounts[dayIndex]++;
    });

    const maxCount = Math.max(...dayCounts);
    const mostActiveDayIndex = dayCounts.indexOf(maxCount);
    
    return {
      mostActiveDay: `${dayNames[mostActiveDayIndex]}æ›œæ—¥ (${maxCount}ä»¶)`,
      pattern: dayCounts.map((count, index) => `${dayNames[index]}: ${count}ä»¶`).join(', ')
    };
  }

  analyzeCategoryTrends(reports) {
    const categories = { book: 0, movie: 0, activity: 0 };
    reports.forEach(report => {
      if (categories.hasOwnProperty(report.category)) {
        categories[report.category]++;
      }
    });

    const total = Object.values(categories).reduce((sum, count) => sum + count, 0);
    if (total === 0) return 'ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚’è“„ç©ä¸­';

    const percentages = Object.entries(categories).map(([category, count]) => {
      const percentage = Math.round((count / total) * 100);
      const emoji = { book: 'ğŸ“š', movie: 'ğŸ¬', activity: 'ğŸ¯' }[category];
      return `${emoji} ${percentage}%`;
    });

    return percentages.join(' ');
  }

  generatePaceAnalysis(dailyStats) {
    const dailyCounts = Object.values(dailyStats).map(day => day.length);
    const avgDaily = dailyCounts.reduce((sum, count) => sum + count, 0) / dailyCounts.length;
    
    if (avgDaily >= 3) return 'ğŸš€ éå¸¸ã«æ´»ç™ºãªãƒšãƒ¼ã‚¹ (å¹³å‡ ' + avgDaily.toFixed(1) + ' ä»¶/æ—¥)';
    if (avgDaily >= 2) return 'âš¡ æ´»ç™ºãªãƒšãƒ¼ã‚¹ (å¹³å‡ ' + avgDaily.toFixed(1) + ' ä»¶/æ—¥)';
    if (avgDaily >= 1) return 'ğŸ“ˆ å®‰å®šã—ãŸãƒšãƒ¼ã‚¹ (å¹³å‡ ' + avgDaily.toFixed(1) + ' ä»¶/æ—¥)';
    return 'ğŸŒ± ã‚†ã£ãã‚Šãƒšãƒ¼ã‚¹ (å¹³å‡ ' + avgDaily.toFixed(1) + ' ä»¶/æ—¥)';
  }

  // äºˆæ¸¬é–¢é€£
  predictNextWeekTrend(twoWeeksAgo, lastWeek, thisWeek) {
    const trends = [thisWeek, lastWeek, twoWeeksAgo].map(week => 
      (week.finishedBooks || 0) + (week.watchedMovies || 0) + (week.completedActivities || 0)
    );
    
    const avgGrowth = ((trends[0] - trends[1]) + (trends[1] - trends[2])) / 2;
    const prediction = Math.max(0, Math.round(trends[0] + avgGrowth));
    
    if (avgGrowth > 2) {
      return `ğŸš€ æ¥é€±ã¯ç´„ **${prediction}ä»¶** ã®å®Œäº†ãŒæœŸå¾…ã•ã‚Œã¾ã™ï¼`;
    } else if (avgGrowth > 0) {
      return `ğŸ“ˆ æ¥é€±ã¯ç´„ **${prediction}ä»¶** ã®å®Œäº†äºˆæ¸¬`;
    } else {
      return `â¡ï¸ æ¥é€±ã¯ç´„ **${prediction}ä»¶** ã®å®Œäº†äºˆæ¸¬`;
    }
  }

  // 3é€±é–“æ¯”è¼ƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  formatThreeWeekComparison(twoWeeksAgo, lastWeek, thisWeek, weekNames) {
    const formatWeek = (stats, name) => {
      const total = (stats.finishedBooks || 0) + (stats.watchedMovies || 0) + (stats.completedActivities || 0);
      return `**${name}**: ${total}ä»¶ (ğŸ“š${stats.finishedBooks || 0} ğŸ¬${stats.watchedMovies || 0} ğŸ¯${stats.completedActivities || 0})`;
    };

    return [
      formatWeek(twoWeeksAgo, weekNames[0]),
      formatWeek(lastWeek, weekNames[1]),
      formatWeek(thisWeek, weekNames[2])
    ].join('\n');
  }
}

module.exports = StatsUtility;

```

### services/googleSheets.js

```
const { google } = require('googleapis');

class GoogleSheetsService {
  constructor() {
    this.sheets = google.sheets({ version: 'v4' });
    this.auth = null;
    this.spreadsheetId = process.env.SPREADSHEET_ID;
    this.initializeAuth();
  }

  initializeAuth() {
    try {
      if (process.env.GOOGLE_SERVICE_ACCOUNT_JSON) {
        const credentials = JSON.parse(process.env.GOOGLE_SERVICE_ACCOUNT_JSON);
        this.auth = new google.auth.GoogleAuth({
          credentials,
          scopes: ['https://www.googleapis.com/auth/spreadsheets'],
          timeout: 30000
        });
      } else {
        this.auth = new google.auth.GoogleAuth({
          credentials: {
            type: 'service_account',
            project_id: process.env.GOOGLE_PROJECT_ID,
            client_email: process.env.GOOGLE_CLIENT_EMAIL,
            private_key: process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g, '\n'),
            client_id: process.env.GOOGLE_CLIENT_ID,
            auth_uri: 'https://accounts.google.com/o/oauth2/auth',
            token_uri: 'https://oauth2.googleapis.com/token'
          },
          scopes: ['https://www.googleapis.com/auth/spreadsheets'],
          timeout: 30000
        });
      }
      console.log('âœ… Google Sheetsèªè¨¼è¨­å®šå®Œäº†');
    } catch (error) {
      console.error('âŒ Googleèªè¨¼è¨­å®šã‚¨ãƒ©ãƒ¼:', error.message);
      console.log('Google Sheetsæ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¾ã™');
      this.auth = null;
    }
  }

  // ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä»˜ãã®æ“ä½œå®Ÿè¡Œ
  async executeWithTimeout(operation, timeoutMs = 5000) {
    if (!this.auth) {
      throw new Error('Google Sheetsèªè¨¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
    }

    const timeoutPromise = new Promise((_, reject) => 
      setTimeout(() => reject(new Error('Operation timeout')), timeoutMs)
    );

    return Promise.race([operation(), timeoutPromise]);
  }

  // ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰: ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ä»˜ãã®æ“ä½œå®Ÿè¡Œ
  async executeWithRetry(operation, maxRetries = 3, timeoutMs = 5000) {
    if (!this.auth) {
      console.log('èªè¨¼ãªã— - ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¾ã™');
      return null;
    }

    let retries = 0;
    
    while (retries < maxRetries) {
      try {
        return await this.executeWithTimeout(operation, timeoutMs);
      } catch (error) {
        console.error(`æ“ä½œå¤±æ•— (${retries + 1}/${maxRetries}):`, error.message);
        retries++;
        
        if (retries >= maxRetries) {
          console.error('æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°ã«é”ã—ã¾ã—ãŸ');
          throw error;
        }
        
        // æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•
        await new Promise(resolve => setTimeout(resolve, 1000 * Math.pow(2, retries)));
      }
    }
  }

  // æ¬¡ã®IDã‚’å–å¾—
  async getNextId(sheetName) {
    if (!this.auth) return Math.floor(Math.random() * 1000);

    try {
      const operation = async () => {
        const auth = await this.auth.getClient();
        return this.sheets.spreadsheets.values.get({
          auth,
          spreadsheetId: this.spreadsheetId,
          range: `${sheetName}!A:A`
        });
      };

      const response = await this.executeWithTimeout(operation);
      const values = response.data.values || [];
      return values.length;
    } catch (error) {
      console.error(`getNextId ã‚¨ãƒ©ãƒ¼:`, error);
      return Math.floor(Math.random() * 1000) + Date.now() % 1000;
    }
  }

  // ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
  async appendData(range, values) {
    if (!this.auth) {
      console.log('èªè¨¼ãªã— - ãƒ€ãƒŸãƒ¼IDã‚’è¿”ã—ã¾ã™');
      return Math.floor(Math.random() * 1000);
    }

    try {
      const operation = async () => {
        const auth = await this.auth.getClient();
        return this.sheets.spreadsheets.values.append({
          auth,
          spreadsheetId: this.spreadsheetId,
          range,
          valueInputOption: 'RAW',
          resource: { values: [values] }
        });
      };

      await this.executeWithTimeout(operation);
      console.log('âœ… ãƒ‡ãƒ¼ã‚¿è¿½åŠ æˆåŠŸ');
      return values[0]; // IDã‚’è¿”ã™
    } catch (error) {
      console.error('âŒ ãƒ‡ãƒ¼ã‚¿è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      return Math.floor(Math.random() * 1000) + Date.now() % 1000;
    }
  }

  // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
  async getData(range) {
    if (!this.auth) return [];

    try {
      const operation = async () => {
        const auth = await this.auth.getClient();
        return this.sheets.spreadsheets.values.get({
          auth,
          spreadsheetId: this.spreadsheetId,
          range
        });
      };

      const response = await this.executeWithRetry(operation, 3, 10000);
      return response?.data?.values || [];
    } catch (error) {
      console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  // ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
  async updateData(range, values) {
    if (!this.auth) {
      console.log('èªè¨¼ãªã— - æ›´æ–°ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');
      return true;
    }

    try {
      const operation = async () => {
        const auth = await this.auth.getClient();
        return this.sheets.spreadsheets.values.update({
          auth,
          spreadsheetId: this.spreadsheetId,
          range,
          valueInputOption: 'RAW',
          resource: { values: [values] }
        });
      };

      await this.executeWithRetry(operation);
      console.log('âœ… ãƒ‡ãƒ¼ã‚¿æ›´æ–°æˆåŠŸ');
      return true;
    } catch (error) {
      console.error('âŒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
      return false;
    }
  }

  // === æœ¬é–¢é€£ã®ãƒ¡ã‚½ãƒƒãƒ‰ ===

  async addBook(title, author, memo, status = 'want_to_read') {
    try {
      const id = await this.getNextId('books_master');
      const now = new Date().toISOString().replace('T', ' ').slice(0, 19);
      
      const values = [id, now, title, author, memo, status, ''];
      const resultId = await this.appendData('books_master!A:G', values);
      
      console.log('âœ… æœ¬ã®è¿½åŠ æˆåŠŸ:', id);
      return resultId;
    } catch (error) {
      console.error('âŒ æœ¬ã®è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      return Math.floor(Math.random() * 1000) + Date.now() % 1000;
    }
  }

  async updateBookStatus(id, status, date = null) {
    try {
      const values = await this.getData('books_master!A:G');
      const rowIndex = values.findIndex(row => row[0] == id);
      
      if (rowIndex === -1) {
        console.log('æŒ‡å®šã•ã‚ŒãŸIDã®æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', id);
        return null;
      }

      const updateDate = date || new Date().toISOString().slice(0, 10);
      const updateRange = `books_master!F${rowIndex + 1}:G${rowIndex + 1}`;
      const updateValues = [status, updateDate];
      
      const success = await this.updateData(updateRange, updateValues);
      
      if (success) {
        const row = values[rowIndex];
        return {
          id: row[0],
          title: row[2],
          author: row[3],
          memo: row[4]
        };
      }
      
      return null;
    } catch (error) {
      console.error('æœ¬ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
      return null;
    }
  }

  async buyBook(id) {
    return this.updateBookStatus(id, 'want_to_read');
  }

  async startReading(id) {
    return this.updateBookStatus(id, 'reading');
  }

  async finishReading(id) {
    return this.updateBookStatus(id, 'finished');
  }

  async getBooks() {
    try {
      const values = await this.getData('books_master!A:G');
      
      return values.slice(1).map(row => {
        const [id, date, title, author, memo, status] = row;
        const statusEmoji = {
          'want_to_buy': 'ğŸ›’',
          'want_to_read': 'ğŸ“‹',
          'reading': 'ğŸ“–',
          'finished': 'âœ…',
          'abandoned': 'âŒ'
        };
        
        const statusText = {
          'want_to_buy': 'è²·ã„ãŸã„',
          'want_to_read': 'ç©èª­',
          'reading': 'èª­æ›¸ä¸­',
          'finished': 'èª­äº†',
          'abandoned': 'ä¸­æ–­'
        };
        
        return `${statusEmoji[status] || 'ğŸ“‹'} [${id}] ${title} - ${author} (${statusText[status] || status})`;
      });
    } catch (error) {
      console.error('æœ¬ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return ['ğŸ“‹ [1] ãƒ†ã‚¹ãƒˆæœ¬ - ãƒ†ã‚¹ãƒˆä½œè€… (want_to_read)'];
    }
  }

  async getWishlistBooks() {
    try {
      const values = await this.getData('books_master!A:G');
      
      return values.slice(1)
        .filter(row => row[5] === 'want_to_buy')
        .map(row => {
          const [id, date, title, author] = row;
          return `ğŸ›’ [${id}] ${title} - ${author}`;
        });
    } catch (error) {
      console.error('è²·ã„ãŸã„æœ¬ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  async getWantToReadBooks() {
    try {
      const values = await this.getData('books_master!A:G');
      
      return values.slice(1)
        .filter(row => row[5] === 'want_to_read')
        .map(row => ({
          id: row[0],
          title: row[2],
          author: row[3]
        }));
    } catch (error) {
      console.error('ç©èª­æœ¬ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  async getCurrentReadingBooks() {
    try {
      const values = await this.getData('books_master!A:G');
      
      return values.slice(1)
        .filter(row => row[5] === 'reading')
        .map(row => ({
          id: row[0],
          title: row[2],
          author: row[3]
        }));
    } catch (error) {
      console.error('èª­æ›¸ä¸­ã®æœ¬å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  // === æ˜ ç”»é–¢é€£ã®ãƒ¡ã‚½ãƒƒãƒ‰ ===

  async addMovie(title, memo = '') {
    try {
      const id = await this.getNextId('movies_master');
      const now = new Date().toISOString().replace('T', ' ').slice(0, 19);
      
      const values = [id, now, title, memo, 'want_to_watch', now.slice(0, 10)];
      const resultId = await this.appendData('movies_master!A:F', values);
      
      console.log('âœ… æ˜ ç”»ã®è¿½åŠ æˆåŠŸ:', id);
      return resultId;
    } catch (error) {
      console.error('âŒ æ˜ ç”»ã®è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      return Math.floor(Math.random() * 1000) + Date.now() % 1000;
    }
  }

  async updateMovieStatus(id, status) {
    try {
      const values = await this.getData('movies_master!A:F');
      const rowIndex = values.findIndex(row => row[0] == id);
      
      if (rowIndex === -1) {
        console.log('æŒ‡å®šã•ã‚ŒãŸIDã®æ˜ ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', id);
        return null;
      }

      const date = new Date().toISOString().slice(0, 10);
      const updateRange = `movies_master!E${rowIndex + 1}:F${rowIndex + 1}`;
      const updateValues = [status, date];
      
      const success = await this.updateData(updateRange, updateValues);
      
      if (success) {
        const row = values[rowIndex];
        return {
          id: row[0],
          title: row[2] || 'ä¸æ˜ãªã‚¿ã‚¤ãƒˆãƒ«',
          memo: row[3] || ''
        };
      }
      
      return null;
    } catch (error) {
      console.error('æ˜ ç”»ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
      return null;
    }
  }

  async watchMovie(id) {
    return this.updateMovieStatus(id, 'watched');
  }

  async skipMovie(id) {
    return this.updateMovieStatus(id, 'missed');
  }

  async getMovies() {
    try {
      const values = await this.getData('movies_master!A:F');
      
      return values.slice(1).map(row => {
        const [id, date, title, memo, status] = row;
        const statusEmoji = {
          'want_to_watch': 'ğŸ¬',
          'watched': 'âœ…',
          'missed': 'ğŸ˜…'
        };
        
        return `${statusEmoji[status] || 'ğŸ¬'} [${id}] ${title} (${status})`;
      });
    } catch (error) {
      console.error('æ˜ ç”»ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return ['ğŸ¬ [1] ãƒ†ã‚¹ãƒˆæ˜ ç”» (want_to_watch)'];
    }
  }

  // === æ´»å‹•é–¢é€£ã®ãƒ¡ã‚½ãƒƒãƒ‰ ===

  async addActivity(content, memo = '') {
    try {
      const id = await this.getNextId('activities_master');
      const now = new Date().toISOString().replace('T', ' ').slice(0, 19);
      
      const values = [id, now, content, memo, 'planned', now.slice(0, 10)];
      const resultId = await this.appendData('activities_master!A:F', values);
      
      console.log('âœ… æ´»å‹•ã®è¿½åŠ æˆåŠŸ:', id);
      return resultId;
    } catch (error) {
      console.error('âŒ æ´»å‹•ã®è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      return Math.floor(Math.random() * 1000) + Date.now() % 1000;
    }
  }

  async updateActivityStatus(id, status) {
    try {
      const values = await this.getData('activities_master!A:F');
      const rowIndex = values.findIndex(row => row[0] == id);
      
      if (rowIndex === -1) {
        console.log('æŒ‡å®šã•ã‚ŒãŸIDã®æ´»å‹•ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', id);
        return null;
      }

      const date = new Date().toISOString().slice(0, 10);
      const updateRange = `activities_master!E${rowIndex + 1}:F${rowIndex + 1}`;
      const updateValues = [status, date];
      
      const success = await this.updateData(updateRange, updateValues);
      
      if (success) {
        const row = values[rowIndex];
        return {
          id: row[0],
          content: row[2] || 'ä¸æ˜ãªæ´»å‹•',
          memo: row[3] || ''
        };
      }
      
      return null;
    } catch (error) {
      console.error('æ´»å‹•ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
      return null;
    }
  }

  async doneActivity(id) {
    return this.updateActivityStatus(id, 'done');
  }

  async skipActivity(id) {
    return this.updateActivityStatus(id, 'skipped');
  }

  async getActivities() {
    try {
      const values = await this.getData('activities_master!A:F');
      
      return values.slice(1).map(row => {
        const [id, date, content, memo, status] = row;
        const statusEmoji = {
          'planned': 'ğŸ¯',
          'done': 'âœ…',
          'skipped': 'ğŸ˜…'
        };
        
        return `${statusEmoji[status] || 'ğŸ¯'} [${id}] ${content} (${status})`;
      });
    } catch (error) {
      console.error('æ´»å‹•ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return ['ğŸ¯ [1] ãƒ†ã‚¹ãƒˆæ´»å‹• (planned)'];
    }
  }

  // === æ—¥å ±é–¢é€£ã®ãƒ¡ã‚½ãƒƒãƒ‰ ===

  async addDailyReport(category, itemId, content) {
    try {
      const reportId = await this.getNextId('daily_reports');
      const date = new Date().toISOString().slice(0, 10);
      
      const values = [reportId, date, category, itemId, content];
      const resultId = await this.appendData('daily_reports!A:E', values);
      
      console.log('âœ… æ—¥å ±ã®è¿½åŠ æˆåŠŸ:', reportId);
      return resultId;
    } catch (error) {
      console.error('âŒ æ—¥å ±ã®è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      return Math.floor(Math.random() * 1000) + Date.now() % 1000;
    }
  }

  async getReportsByItem(category, itemId) {
    try {
      const values = await this.getData('daily_reports!A:E');
      
      const reports = values.slice(1)
        .filter(row => 
          row[2] === category && // ã‚«ãƒ†ã‚´ãƒªãŒä¸€è‡´
          row[3] == itemId       // IDãŒä¸€è‡´
        )
        .map(row => ({
          reportId: row[0],
          date: row[1],
          category: row[2],
          itemId: row[3],
          content: row[4] || ''
        }));
      
      console.log(`${category} ID:${itemId} ã®ãƒ¬ãƒãƒ¼ãƒˆå–å¾—å®Œäº†:`, reports.length, 'ä»¶');
      return reports;
    } catch (error) {
      console.error('ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  async getRecentReports(days = 7) {
    try {
      const targetDate = new Date();
      targetDate.setDate(targetDate.getDate() - days);
      const targetDateStr = targetDate.toISOString().slice(0, 10);
      
      const values = await this.getData('daily_reports!A:E');
      
      const reports = values.slice(1)
        .filter(row => row[1] >= targetDateStr)
        .map(row => ({
          reportId: row[0],
          date: row[1],
          category: row[2],
          itemId: row[3],
          content: row[4] || ''
        }))
        .sort((a, b) => new Date(b.date) - new Date(a.date));
      
      console.log(`éå»${days}æ—¥é–“ã®ãƒ¬ãƒãƒ¼ãƒˆå–å¾—å®Œäº†:`, reports.length, 'ä»¶');
      return reports;
    } catch (error) {
      console.error('æœ€è¿‘ã®ãƒ¬ãƒãƒ¼ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  async searchReportsByKeyword(keyword) {
    try {
      const values = await this.getData('daily_reports!A:E');
      
      const reports = values.slice(1)
        .filter(row => {
          const content = (row[4] || '').toLowerCase();
          return content.includes(keyword.toLowerCase());
        })
        .map(row => ({
          reportId: row[0],
          date: row[1],
          category: row[2],
          itemId: row[3],
          content: row[4] || ''
        }))
        .sort((a, b) => new Date(b.date) - new Date(a.date));
      
      console.log(`"${keyword}" ã®æ¤œç´¢çµæœ:`, reports.length, 'ä»¶');
      return reports;
    } catch (error) {
      console.error('ãƒ¬ãƒãƒ¼ãƒˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  // === ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±å–å¾— ===

  async getItemInfo(category, id) {
    let range, titleColumn, contentColumn;
    
    switch (category) {
      case 'book':
        range = 'books_master!A:G';
        titleColumn = 2;
        contentColumn = 3;
        break;
      case 'movie':
        range = 'movies_master!A:F';
        titleColumn = 2;
        break;
      case 'activity':
        range = 'activities_master!A:F';
        contentColumn = 2;
        break;
      default:
        return null;
    }
    
    try {
      const values = await this.getData(range);
      const row = values.find(row => row[0] == id);
      
      if (row) {
        if (category === 'book') {
          return {
            title: row[titleColumn] || 'ä¸æ˜ãªã‚¿ã‚¤ãƒˆãƒ«',
            author: row[contentColumn] || 'ä¸æ˜ãªä½œè€…'
          };
        } else if (category === 'movie') {
          return {
            title: row[titleColumn] || 'ä¸æ˜ãªã‚¿ã‚¤ãƒˆãƒ«'
          };
        } else if (category === 'activity') {
          return {
            content: row[contentColumn] || 'ä¸æ˜ãªæ´»å‹•'
          };
        }
      }
      
      return null;
    } catch (error) {
      console.error('ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return null;
    }
  }

  // === æ¤œç´¢æ©Ÿèƒ½ ===

  async searchBooks(keyword) {
    try {
      const values = await this.getData('books_master!A:G');
      const results = [];
      
      for (const row of values.slice(1)) {
        const [id, date, title, author, memo, status] = row;
        const searchText = `${title} ${author} ${memo}`.toLowerCase();
        
        if (searchText.includes(keyword.toLowerCase())) {
          const statusEmoji = {
            'want_to_buy': 'ğŸ›’',
            'want_to_read': 'ğŸ“‹',
            'reading': 'ğŸ“–',
            'finished': 'âœ…',
            'abandoned': 'âŒ'
          };
          
          results.push(`${statusEmoji[status] || 'ğŸ“‹'} [${id}] ${title} - ${author} (${status})`);
        }
      }
      
      return results;
    } catch (error) {
      console.error('æœ¬ã®æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  async searchMovies(keyword) {
    try {
      const values = await this.getData('movies_master!A:F');
      const results = [];
      
      for (const row of values.slice(1)) {
        const [id, date, title, memo, status] = row;
        const searchText = `${title} ${memo}`.toLowerCase();
        
        if (searchText.includes(keyword.toLowerCase())) {
          const statusEmoji = {
            'want_to_watch': 'ğŸ¬',
            'watched': 'âœ…',
            'missed': 'ğŸ˜…'
          };
          
          results.push(`${statusEmoji[status] || 'ğŸ¬'} [${id}] ${title} (${status})`);
        }
      }
      
      return results;
    } catch (error) {
      console.error('æ˜ ç”»ã®æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  async searchActivities(keyword) {
    try {
      const values = await this.getData('activities_master!A:F');
      const results = [];
      
      for (const row of values.slice(1)) {
        const [id, date, content, memo, status] = row;
        const searchText = `${content} ${memo}`.toLowerCase();
        
        if (searchText.includes(keyword.toLowerCase())) {
          const statusEmoji = {
            'planned': 'ğŸ¯',
            'done': 'âœ…',
            'skipped': 'ğŸ˜…'
          };
          
          results.push(`${statusEmoji[status] || 'ğŸ¯'} [${id}] ${content} (${status})`);
        }
      }
      
      return results;
    } catch (error) {
      console.error('æ´»å‹•ã®æ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  // === çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾— ===

  async getBookCounts() {
    try {
      const values = await this.getData('books_master!A:G');
      const data = values.slice(1);
      
      return {
        total: data.length,
        reading: data.filter(row => row[5] === 'reading').length,
        finished: data.filter(row => row[5] === 'finished').length,
        wantToRead: data.filter(row => row[5] === 'want_to_read').length,
        wantToBuy: data.filter(row => row[5] === 'want_to_buy').length
      };
    } catch (error) {
      console.error('æœ¬ã®çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { total: 0, reading: 0, finished: 0, wantToRead: 0, wantToBuy: 0 };
    }
  }

  async getMovieCounts() {
    try {
      const values = await this.getData('movies_master!A:F');
      const data = values.slice(1);
      
      return {
        total: data.length,
        wantToWatch: data.filter(row => row[4] === 'want_to_watch').length,
        watched: data.filter(row => row[4] === 'watched').length,
        missed: data.filter(row => row[4] === 'missed').length
      };
    } catch (error) {
      console.error('æ˜ ç”»ã®çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { total: 0, wantToWatch: 0, watched: 0, missed: 0 };
    }
  }

  async getActivityCounts() {
    try {
      const values = await this.getData('activities_master!A:F');
      const data = values.slice(1);
      
      return {
        total: data.length,
        planned: data.filter(row => row[4] === 'planned').length,
        done: data.filter(row => row[4] === 'done').length,
        skipped: data.filter(row => row[4] === 'skipped').length
      };
    } catch (error) {
      console.error('æ´»å‹•ã®çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { total: 0, planned: 0, done: 0, skipped: 0 };
    }
  }

  async getWeeklyStats() {
    const now = new Date();
    const weekStart = new Date(now.getFullYear(), now.getMonth(), now.getDate() - now.getDay());
    const weekStartStr = weekStart.toISOString().slice(0, 10);
    
    try {
      const [booksData, moviesData, activitiesData] = await Promise.all([
        this.getData('books_master!A:G'),
        this.getData('movies_master!A:F'),
        this.getData('activities_master!A:F')
      ]);
      
      const finishedBooks = booksData.slice(1).filter(row => 
        row[5] === 'finished' && row[6] && row[6] >= weekStartStr
      ).length;
      
      const watchedMovies = moviesData.slice(1).filter(row => 
        row[4] === 'watched' && row[5] && row[5] >= weekStartStr
      ).length;
      
      const completedActivities = activitiesData.slice(1).filter(row => 
        row[4] === 'done' && row[5] && row[5] >= weekStartStr
      ).length;
      
      return { finishedBooks, watchedMovies, completedActivities };
    } catch (error) {
      console.error('é€±æ¬¡çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { finishedBooks: 0, watchedMovies: 0, completedActivities: 0 };
    }
  }

  async getMonthlyStats() {
    const now = new Date();
    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
    const monthStartStr = monthStart.toISOString().slice(0, 10);
    
    try {
      const [booksData, moviesData, activitiesData, reportsData] = await Promise.all([
        this.getData('books_master!A:G'),
        this.getData('movies_master!A:F'),
        this.getData('activities_master!A:F'),
        this.getData('daily_reports!A:E')
      ]);
      
      const finishedBooks = booksData.slice(1).filter(row => 
        row[5] === 'finished' && row[6] && row[6] >= monthStartStr
      ).length;
      
      const watchedMovies = moviesData.slice(1).filter(row => 
        row[4] === 'watched' && row[5] && row[5] >= monthStartStr
      ).length;
      
      const completedActivities = activitiesData.slice(1).filter(row => 
        row[4] === 'done' && row[5] && row[5] >= monthStartStr
      ).length;
      
      const reports = reportsData.slice(1).filter(row => 
        row[1] && row[1] >= monthStartStr
      ).length;
      
      return { finishedBooks, watchedMovies, completedActivities, reports };
    } catch (error) {
      console.error('æœˆæ¬¡çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { finishedBooks: 0, watchedMovies: 0, completedActivities: 0, reports: 0 };
    }
  }

  async getMonthlyBookTitles() {
    const now = new Date();
    const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
    const monthStartStr = monthStart.toISOString().slice(0, 10);
    
    try {
      const values = await this.getData('books_master!A:G');
      
      const monthlyBooks = values.slice(1)
        .filter(row => 
          row[5] === 'finished' && 
          row[6] && 
          row[6] >= monthStartStr
        )
        .map(row => row[2]);
      
      return monthlyBooks;
    } catch (error) {
      console.error('æœˆæ¬¡èª­æ›¸ã‚¿ã‚¤ãƒˆãƒ«å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return [];
    }
  }

  async getCurrentProgress() {
    try {
      const [booksData, moviesData] = await Promise.all([
        this.getData('books_master!A:G'),
        this.getData('movies_master!A:F')
      ]);
      
      const readingBooks = booksData.slice(1)
        .filter(row => row[5] === 'reading')
        .map(row => ({ id: row[0], title: row[2] }));
      
      const wantToWatchMovies = moviesData.slice(1)
        .filter(row => row[4] === 'want_to_watch')
        .map(row => ({ id: row[0], title: row[2] }));
      
      return { readingBooks, wantToWatchMovies };
    } catch (error) {
      console.error('é€²è¡ŒçŠ¶æ³å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { readingBooks: [], wantToWatchMovies: [] };
    }
  }

  async getAbandonedItems(daysAgo = 7) {
    const targetDate = new Date();
    targetDate.setDate(targetDate.getDate() - daysAgo);
    const targetDateStr = targetDate.toISOString().slice(0, 10);
    
    try {
      const [moviesData, activitiesData] = await Promise.all([
        this.getData('movies_master!A:F'),
        this.getData('activities_master!A:F')
      ]);
      
      const abandonedMovies = moviesData.slice(1)
        .filter(row => 
          row[4] === 'want_to_watch' && 
          row[1] && 
          row[1].slice(0, 10) <= targetDateStr
        )
        .map(row => ({ id: row[0], title: row[2] }));
      
      const abandonedActivities = activitiesData.slice(1)
        .filter(row => 
          row[4] === 'planned' && 
          row[1] && 
          row[1].slice(0, 10) <= targetDateStr
        )
        .map(row => ({ id: row[0], content: row[2] }));
      
      return {
        movies: abandonedMovies,
        activities: abandonedActivities
      };
    } catch (error) {
      console.error('æ”¾ç½®ã‚¢ã‚¤ãƒ†ãƒ å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return { movies: [], activities: [] };
    }
  }

/**
 * é€±æ¬¡çµ±è¨ˆã‚’å–å¾—
 */
async getWeeklyStats() {
  try {
    console.log('ğŸ“Š é€±æ¬¡çµ±è¨ˆå–å¾—é–‹å§‹');
    
    // ä»Šé€±ã®æœˆæ›œæ—¥ã‹ã‚‰æ—¥æ›œæ—¥ã¾ã§ã®æœŸé–“ã‚’è¨ˆç®—
    const now = new Date();
    const dayOfWeek = now.getDay(); // 0 = Sunday, 6 = Saturday
    const startOfWeek = new Date(now);
    startOfWeek.setDate(now.getDate() - dayOfWeek + 1); // æœˆæ›œæ—¥
    startOfWeek.setHours(0, 0, 0, 0);
    
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6); // æ—¥æ›œæ—¥
    endOfWeek.setHours(23, 59, 59, 999);

    // æŒ‡å®šæœŸé–“ã®çµ±è¨ˆã‚’å–å¾—
    const stats = await this.getStatsForDateRange(startOfWeek, endOfWeek);
    console.log('âœ… é€±æ¬¡çµ±è¨ˆå–å¾—å®Œäº†:', stats);
    return stats;
  } catch (error) {
    console.error('é€±æ¬¡çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
    return { finishedBooks: 0, watchedMovies: 0, completedActivities: 0, reports: 0 };
  }
}

/**
 * æœˆæ¬¡çµ±è¨ˆã‚’å–å¾—
 */
async getMonthlyStats() {
  try {
    console.log('ğŸ“Š æœˆæ¬¡çµ±è¨ˆå–å¾—é–‹å§‹');
    
    // ä»Šæœˆã®1æ—¥ã‹ã‚‰æœˆæœ«ã¾ã§ã®æœŸé–“ã‚’è¨ˆç®—
    const now = new Date();
    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
    const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    endOfMonth.setHours(23, 59, 59, 999);

    // æŒ‡å®šæœŸé–“ã®çµ±è¨ˆã‚’å–å¾—
    const stats = await this.getStatsForDateRange(startOfMonth, endOfMonth);
    console.log('âœ… æœˆæ¬¡çµ±è¨ˆå–å¾—å®Œäº†:', stats);
    return stats;
  } catch (error) {
    console.error('æœˆæ¬¡çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
    return { finishedBooks: 0, watchedMovies: 0, completedActivities: 0, reports: 0 };
  }
}

/**
 * æœŸé–“çµ±è¨ˆå–å¾—ãƒ¡ã‚½ãƒƒãƒ‰
 * goalServiceã¨é€£æºã™ã‚‹ãŸã‚ã®å®Ÿè£…
 */
async getStatsForDateRange(startDate, endDate) {
  try {
    console.log(`ğŸ“Š æœŸé–“çµ±è¨ˆå–å¾—: ${startDate.toISOString().slice(0, 10)} ï½ ${endDate.toISOString().slice(0, 10)}`);
    
    const startDateStr = startDate.toISOString().slice(0, 10);
    const endDateStr = endDate.toISOString().slice(0, 10);
    
    // æœ¬ã®å®Œäº†æ•°
    const finishedBooks = await this.countCompletions('books_master', 'finished', startDateStr, endDateStr);
    
    // æ˜ ç”»ã®è¦–è´å®Œäº†æ•°
    const watchedMovies = await this.countCompletions('movies_master', 'watched', startDateStr, endDateStr);
    
    // æ´»å‹•ã®å®Œäº†æ•°
    const completedActivities = await this.countCompletions('activities_master', 'done', startDateStr, endDateStr);
    
    // ãƒ¬ãƒãƒ¼ãƒˆæ•°
    const reports = await this.countReports(startDateStr, endDateStr);
    
    const result = {
      finishedBooks,
      watchedMovies,
      completedActivities,
      reports
    };
    
    console.log('âœ… æœŸé–“çµ±è¨ˆå–å¾—å®Œäº†:', result);
    return result;

  } catch (error) {
    console.error('æœŸé–“çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
    return { finishedBooks: 0, watchedMovies: 0, completedActivities: 0, reports: 0 };
  }
}

/**
 * æŒ‡å®šã‚·ãƒ¼ãƒˆã®å®Œäº†æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
 */
/**
 * æŒ‡å®šã‚·ãƒ¼ãƒˆã®å®Œäº†æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆï¼ˆæ­£ç¢ºãªåˆ—æ§‹æˆç‰ˆï¼‰
 */
async countCompletions(sheetName, completedStatus, startDate, endDate) {
  try {
    const data = await this.getData(`${sheetName}!A:Z`);
    if (!data || data.length <= 1) return 0;

    let count = 0;
    const dataRows = data.slice(1); // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—

    // ã‚·ãƒ¼ãƒˆåˆ¥ã®æ­£ç¢ºãªåˆ—æ§‹æˆ
    const sheetConfigs = {
      'books_master': {
        statusColumn: 5,  // Fåˆ—: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        dateColumn: 6,    // Gåˆ—: æ—¥ä»˜ â† æœ¬ã¯7åˆ—æ§‹æˆ
        description: 'IDã€ç™»éŒ²æ—¥æ™‚ã€ã‚¿ã‚¤ãƒˆãƒ«ã€ä½œè€…åã€å‚™è€ƒã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€æ—¥ä»˜'
      },
      'movies_master': {
        statusColumn: 4,  // Eåˆ—: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        dateColumn: 5,    // Fåˆ—: æ—¥ä»˜ â† æ˜ ç”»ã¯6åˆ—æ§‹æˆ
        description: 'IDã€ç™»éŒ²æ—¥æ™‚ã€ã‚¿ã‚¤ãƒˆãƒ«ã€å‚™è€ƒã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€æ—¥ä»˜'
      },
      'activities_master': {
        statusColumn: 4,  // Eåˆ—: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
        dateColumn: 5,    // Fåˆ—: æ—¥ä»˜ â† æ´»å‹•ã¯6åˆ—æ§‹æˆ
        description: 'IDã€ç™»éŒ²æ—¥æ™‚ã€ã‚¿ã‚¤ãƒˆãƒ«ã€å‚™è€ƒã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€æ—¥ä»˜'
      }
    };

    const config = sheetConfigs[sheetName];
    if (!config) {
      console.error(`âŒ æœªçŸ¥ã®ã‚·ãƒ¼ãƒˆ: ${sheetName}`);
      return 0;
    }

    console.log(`ğŸ“Š ${sheetName} ã‚«ã‚¦ãƒ³ãƒˆé–‹å§‹: ${completedStatus} ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ (${startDate} ï½ ${endDate})`);

    dataRows.forEach((row, index) => {
      try {
        const status = row[config.statusColumn];
        const dateValue = row[config.dateColumn];
        
        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯
        if (status !== completedStatus) return;
        
        // æ—¥ä»˜ã®å®‰å…¨ãªãƒ‘ãƒ¼ã‚¹
        const parsedDate = this.parseDateSafely(dateValue);
        if (!parsedDate) {
          return;
        }
        
        // æ—¥ä»˜ãŒæœŸé–“å†…ã‹ãƒã‚§ãƒƒã‚¯
        const dateStr = parsedDate.toISOString().slice(0, 10);
        if (dateStr >= startDate && dateStr <= endDate) {
          count++;
          // ã‚«ã‚¦ãƒ³ãƒˆã—ãŸé …ç›®ã®è©³ç´°ã‚’ãƒ­ã‚°å‡ºåŠ›
          const title = row[2] || 'ã‚¿ã‚¤ãƒˆãƒ«ä¸æ˜';
          console.log(`âœ… ${sheetName} [${count}] "${title}" - ${dateStr}`);
        }
        
      } catch (rowError) {
        console.error(`${sheetName} è¡Œ${index + 2} å‡¦ç†ã‚¨ãƒ©ãƒ¼:`, rowError.message);
      }
    });

    console.log(`ğŸ“Š ${sheetName} ${completedStatus} æœ€çµ‚ã‚«ã‚¦ãƒ³ãƒˆ: ${count}`);
    return count;
  } catch (error) {
    console.error(`${sheetName}å®Œäº†æ•°ã‚«ã‚¦ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼:`, error);
    return 0;
  }
}

/**
 * æ—¥ä»˜ã‚’å®‰å…¨ã«ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆæ—¢å­˜ã®ã‚‚ã®ã‚’ä½¿ç”¨ã¾ãŸã¯è¿½åŠ ï¼‰
 */
parseDateSafely(dateValue) {
  if (!dateValue || dateValue === '' || dateValue === '-') {
    return null;
  }
  
  try {
    // ãƒ‘ã‚¿ãƒ¼ãƒ³1: é€šå¸¸ã®æ—¥ä»˜æ–‡å­—åˆ—
    let parsedDate = new Date(dateValue);
    if (!isNaN(parsedDate.getTime())) {
      return parsedDate;
    }
    
    // ãƒ‘ã‚¿ãƒ¼ãƒ³2: Excelæ—¥ä»˜ã‚·ãƒªã‚¢ãƒ«å€¤
    if (typeof dateValue === 'string' && /^\d+$/.test(dateValue)) {
      const excelDate = new Date((parseInt(dateValue) - 25569) * 86400 * 1000);
      if (!isNaN(excelDate.getTime())) {
        return excelDate;
      }
    }
    
    // ãƒ‘ã‚¿ãƒ¼ãƒ³3: æ—¥æœ¬èªå½¢å¼ã®æ—¥ä»˜ï¼ˆä¾‹: 2025/1/15ï¼‰
    if (typeof dateValue === 'string' && dateValue.includes('/')) {
      const parts = dateValue.split('/');
      if (parts.length === 3) {
        const year = parseInt(parts[0]);
        const month = parseInt(parts[1]) - 1; // æœˆã¯0ãƒ™ãƒ¼ã‚¹
        const day = parseInt(parts[2]);
        const japaneseDate = new Date(year, month, day);
        if (!isNaN(japaneseDate.getTime())) {
          return japaneseDate;
        }
      }
    }
    
    return null;
    
  } catch (error) {
    return null;
  }
}

async debugBooksData() {
  try {
    console.log('ğŸ“š books_master ãƒ‡ãƒ¼ã‚¿ãƒ‡ãƒãƒƒã‚°é–‹å§‹');
    
    const data = await this.getData('books_master!A:G');
    if (!data || data.length <= 1) {
      console.log('âŒ books_master ã«ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
      return;
    }

    console.log(`ğŸ“Š ç·è¡Œæ•°: ${data.length} (ãƒ˜ãƒƒãƒ€ãƒ¼å«ã‚€)`);
    console.log(`ğŸ“‹ ãƒ˜ãƒƒãƒ€ãƒ¼: ${JSON.stringify(data[0])}`);
    
    // æœ€åˆã®10è¡Œã‚’ãƒã‚§ãƒƒã‚¯
    const sampleRows = data.slice(1, 11);
    
    sampleRows.forEach((row, index) => {
      const actualIndex = index + 1;
      console.log(`\nğŸ“ è¡Œ ${actualIndex + 1}:`);
      console.log(`  ID: "${row[0]}"`);
      console.log(`  ç™»éŒ²æ—¥æ™‚: "${row[1]}"`);
      console.log(`  ã‚¿ã‚¤ãƒˆãƒ«: "${row[2]}"`);
      console.log(`  ä½œè€…å: "${row[3]}"`);
      console.log(`  å‚™è€ƒ: "${row[4]}"`);
      console.log(`  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: "${row[5]}"`);
      console.log(`  æ—¥ä»˜: "${row[6]}" (å‹: ${typeof row[6]})`);
      
      // finishedã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æœ¬ã ã‘è©³ç´°è¡¨ç¤º
      if (row[5] === 'finished') {
        console.log(`  âœ… èª­äº†æœ¬ç™ºè¦‹! æ—¥ä»˜ã‚’è§£æä¸­...`);
        try {
          const date = new Date(row[6]);
          if (isNaN(date.getTime())) {
            console.log(`  âŒ ç„¡åŠ¹ãªæ—¥ä»˜: "${row[6]}"`);
          } else {
            console.log(`  âœ… æœ‰åŠ¹ãªæ—¥ä»˜: ${date.toISOString().slice(0, 10)}`);
          }
        } catch (error) {
          console.log(`  âŒ æ—¥ä»˜ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        }
      }
    });
    
    // finishedã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æœ¬ã®ç·æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
    const finishedBooks = data.slice(1).filter(row => row[5] === 'finished');
    console.log(`\nğŸ“š finishedã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æœ¬ã®ç·æ•°: ${finishedBooks.length}`);
    
    if (finishedBooks.length > 0) {
      console.log('\nğŸ“š ã™ã¹ã¦ã®èª­äº†æœ¬:');
      finishedBooks.forEach((book, index) => {
        console.log(`  ${index + 1}. "${book[2]}" - æ—¥ä»˜: "${book[6]}"`);
      });
    }
    
  } catch (error) {
    console.error('âŒ books_master ãƒ‡ãƒãƒƒã‚°ã‚¨ãƒ©ãƒ¼:', error);
  }
}

/**
 * æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç¢ºèªã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
 */
parseDateSafely(dateValue) {
  if (!dateValue || dateValue === '' || dateValue === '-') {
    return null;
  }
  
  try {
    // ãƒ‘ã‚¿ãƒ¼ãƒ³1: é€šå¸¸ã®æ—¥ä»˜æ–‡å­—åˆ—
    let parsedDate = new Date(dateValue);
    if (!isNaN(parsedDate.getTime())) {
      return parsedDate;
    }
    
    // ãƒ‘ã‚¿ãƒ¼ãƒ³2: Excelæ—¥ä»˜ã‚·ãƒªã‚¢ãƒ«å€¤
    if (typeof dateValue === 'string' && /^\d+$/.test(dateValue)) {
      const excelDate = new Date((parseInt(dateValue) - 25569) * 86400 * 1000);
      if (!isNaN(excelDate.getTime())) {
        return excelDate;
      }
    }
    
    // ãƒ‘ã‚¿ãƒ¼ãƒ³3: æ—¥æœ¬èªå½¢å¼ã®æ—¥ä»˜ï¼ˆä¾‹: 2025/1/15ï¼‰
    if (typeof dateValue === 'string' && dateValue.includes('/')) {
      const parts = dateValue.split('/');
      if (parts.length === 3) {
        const year = parseInt(parts[0]);
        const month = parseInt(parts[1]) - 1; // æœˆã¯0ãƒ™ãƒ¼ã‚¹
        const day = parseInt(parts[2]);
        const japaneseDate = new Date(year, month, day);
        if (!isNaN(japaneseDate.getTime())) {
          return japaneseDate;
        }
      }
    }
    
    console.log(`âš ï¸ ãƒ‘ãƒ¼ã‚¹ã§ããªã„æ—¥ä»˜å½¢å¼: "${dateValue}" (å‹: ${typeof dateValue})`);
    return null;
    
  } catch (error) {
    console.log(`âŒ æ—¥ä»˜ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: "${dateValue}" - ${error.message}`);
    return null;
  }
}

/**
 * ãƒ¬ãƒãƒ¼ãƒˆæ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
 */
async countReports(startDate, endDate) {
  try {
    const data = await this.getData('daily_reports!A:Z');
    if (!data || data.length <= 1) return 0;

    let count = 0;
    const dataRows = data.slice(1); // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—

    dataRows.forEach(row => {
      const reportDate = row[1]; // Båˆ—: date
      if (!reportDate) return;

      const dateStr = new Date(reportDate).toISOString().slice(0, 10);
      if (dateStr >= startDate && dateStr <= endDate) {
        count++;
      }
    });

    console.log(`Reports count: ${count}`);
    return count;
  } catch (error) {
    console.error('ãƒ¬ãƒãƒ¼ãƒˆæ•°ã‚«ã‚¦ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼:', error);
    return 0;
  }
}

/**
 * éå»Næ—¥é–“ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’å–å¾—
 */
async getRecentReports(days = 7) {
  try {
    console.log(`ğŸ“ éå»${days}æ—¥é–“ã®ãƒ¬ãƒãƒ¼ãƒˆå–å¾—é–‹å§‹`);
    
    const cutoffDate = new Date();
    cutoffDate.setDate(cutoffDate.getDate() - days);
    const cutoffDateStr = cutoffDate.toISOString().slice(0, 10);
    
    const data = await this.getData('daily_reports!A:Z');
    if (!data || data.length <= 1) return [];

    const reports = [];
    const dataRows = data.slice(1); // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—

    dataRows.forEach(row => {
      const reportDate = row[1]; // Båˆ—: date
      if (!reportDate) return;

      const dateStr = new Date(reportDate).toISOString().slice(0, 10);
      if (dateStr >= cutoffDateStr) {
        reports.push({
          timestamp: new Date(reportDate),
          category: row[2] || 'unknown', // Cåˆ—: category
          content: row[3] || '',          // Dåˆ—: content
          item_id: row[4] || '',          // Eåˆ—: item_id
          user_id: row[0] || 'default'    // Aåˆ—: user_id (ã‚‚ã—ã‚ã‚Œã°)
        });
      }
    });

    console.log(`âœ… ${reports.length}ä»¶ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’å–å¾—ã—ã¾ã—ãŸ`);
    return reports.sort((a, b) => b.timestamp - a.timestamp); // æ–°ã—ã„é †

  } catch (error) {
    console.error('ãƒ¬ãƒãƒ¼ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
    return [];
  }
}

  // === ãƒãƒƒãƒæ“ä½œãƒ¡ã‚½ãƒƒãƒ‰ ===

  async batchGetData(ranges) {
    if (!this.auth) return {};

    try {
      const operation = async () => {
        const auth = await this.auth.getClient();
        return this.sheets.spreadsheets.values.batchGet({
          auth,
          spreadsheetId: this.spreadsheetId,
          ranges
        });
      };

      const response = await this.executeWithRetry(operation);
      const result = {};
      
      response.data.valueRanges.forEach((range, index) => {
        const rangeName = ranges[index].split('!')[0];
        result[rangeName] = range.values || [];
      });
      
      return result;
    } catch (error) {
      console.error('ãƒãƒƒãƒãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return {};
    }
  }

  async getAllStats() {
    try {
      const data = await this.batchGetData([
        'books_master!A:G',
        'movies_master!A:F',
        'activities_master!A:F',
        'daily_reports!A:E'
      ]);
      
      const books = data.books_master || [];
      const movies = data.movies_master || [];
      const activities = data.activities_master || [];
      const reports = data.daily_reports || [];
      
      // å„ç¨®çµ±è¨ˆã‚’è¨ˆç®—
      const bookStats = this.calculateBookStats(books.slice(1));
      const movieStats = this.calculateMovieStats(movies.slice(1));
      const activityStats = this.calculateActivityStats(activities.slice(1));
      const reportStats = this.calculateReportStats(reports.slice(1));
      
      return {
        books: bookStats,
        movies: movieStats,
        activities: activityStats,
        reports: reportStats,
        summary: {
          totalItems: bookStats.total + movieStats.total + activityStats.total,
          completedItems: bookStats.finished + movieStats.watched + activityStats.done,
          totalReports: reportStats.total
        }
      };
    } catch (error) {
      console.error('å…¨çµ±è¨ˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      return null;
    }
  }

  // === çµ±è¨ˆè¨ˆç®—ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ ===

  calculateBookStats(books) {
    return {
      total: books.length,
      wantToBuy: books.filter(row => row[5] === 'want_to_buy').length,
      wantToRead: books.filter(row => row[5] === 'want_to_read').length,
      reading: books.filter(row => row[5] === 'reading').length,
      finished: books.filter(row => row[5] === 'finished').length,
      abandoned: books.filter(row => row[5] === 'abandoned').length
    };
  }

  calculateMovieStats(movies) {
    return {
      total: movies.length,
      wantToWatch: movies.filter(row => row[4] === 'want_to_watch').length,
      watched: movies.filter(row => row[4] === 'watched').length,
      missed: movies.filter(row => row[4] === 'missed').length
    };
  }

  calculateActivityStats(activities) {
    return {
      total: activities.length,
      planned: activities.filter(row => row[4] === 'planned').length,
      done: activities.filter(row => row[4] === 'done').length,
      skipped: activities.filter(row => row[4] === 'skipped').length
    };
  }

  calculateReportStats(reports) {
    const now = new Date();
    const thisWeek = new Date(now.getFullYear(), now.getMonth(), now.getDate() - now.getDay());
    const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);
    const thisWeekStr = thisWeek.toISOString().slice(0, 10);
    const thisMonthStr = thisMonth.toISOString().slice(0, 10);
    
    return {
      total: reports.length,
      thisWeek: reports.filter(row => row[1] >= thisWeekStr).length,
      thisMonth: reports.filter(row => row[1] >= thisMonthStr).length,
      byCategory: {
        book: reports.filter(row => row[2] === 'book').length,
        movie: reports.filter(row => row[2] === 'movie').length,
        activity: reports.filter(row => row[2] === 'activity').length
      }
    };
  }

  // === ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ ===

  async validateData() {
    try {
      const data = await this.batchGetData([
        'books_master!A:G',
        'movies_master!A:F',
        'activities_master!A:F',
        'daily_reports!A:E'
      ]);
      
      const issues = [];
      
      // æœ¬ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
      const books = data.books_master?.slice(1) || [];
      books.forEach((row, index) => {
        if (!row[0] || !row[2] || !row[3]) {
          issues.push(`æœ¬ãƒ‡ãƒ¼ã‚¿è¡Œ${index + 2}: IDã€ã‚¿ã‚¤ãƒˆãƒ«ã€ä½œè€…ãŒä¸å®Œå…¨`);
        }
        if (row[5] && !['want_to_buy', 'want_to_read', 'reading', 'finished', 'abandoned'].includes(row[5])) {
          issues.push(`æœ¬ãƒ‡ãƒ¼ã‚¿è¡Œ${index + 2}: ç„¡åŠ¹ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€Œ${row[5]}ã€`);
        }
      });
      
      // æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
      const movies = data.movies_master?.slice(1) || [];
      movies.forEach((row, index) => {
        if (!row[0] || !row[2]) {
          issues.push(`æ˜ ç”»ãƒ‡ãƒ¼ã‚¿è¡Œ${index + 2}: IDã€ã‚¿ã‚¤ãƒˆãƒ«ãŒä¸å®Œå…¨`);
        }
        if (row[4] && !['want_to_watch', 'watched', 'missed'].includes(row[4])) {
          issues.push(`æ˜ ç”»ãƒ‡ãƒ¼ã‚¿è¡Œ${index + 2}: ç„¡åŠ¹ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€Œ${row[4]}ã€`);
        }
      });
      
      // æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
      const activities = data.activities_master?.slice(1) || [];
      activities.forEach((row, index) => {
        if (!row[0] || !row[2]) {
          issues.push(`æ´»å‹•ãƒ‡ãƒ¼ã‚¿è¡Œ${index + 2}: IDã€å†…å®¹ãŒä¸å®Œå…¨`);
        }
        if (row[4] && !['planned', 'done', 'skipped'].includes(row[4])) {
          issues.push(`æ´»å‹•ãƒ‡ãƒ¼ã‚¿è¡Œ${index + 2}: ç„¡åŠ¹ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€Œ${row[4]}ã€`);
        }
      });
      
      // ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
      const reports = data.daily_reports?.slice(1) || [];
      reports.forEach((row, index) => {
        if (!row[0] || !row[1] || !row[2] || !row[3] || !row[4]) {
          issues.push(`ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿è¡Œ${index + 2}: å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸å®Œå…¨`);
        }
        if (row[2] && !['book', 'movie', 'activity'].includes(row[2])) {
          issues.push(`ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿è¡Œ${index + 2}: ç„¡åŠ¹ãªã‚«ãƒ†ã‚´ãƒªã€Œ${row[2]}ã€`);
        }
      });
      
      return {
        isValid: issues.length === 0,
        issues,
        summary: {
          totalBooks: books.length,
          totalMovies: movies.length,
          totalActivities: activities.length,
          totalReports: reports.length
        }
      };
    } catch (error) {
      console.error('ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:', error);
      return {
        isValid: false,
        issues: ['ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'],
        summary: {}
      };
    }
  }

  // === ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ ===

  async healthCheck() {
    if (!this.auth) {
      return {
        status: 'error',
        message: 'Google Sheetsèªè¨¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“',
        timestamp: new Date().toISOString()
      };
    }

    try {
      // ç°¡å˜ãªèª­ã¿å–ã‚Šãƒ†ã‚¹ãƒˆ
      await this.executeWithTimeout(async () => {
        const auth = await this.auth.getClient();
        return this.sheets.spreadsheets.values.get({
          auth,
          spreadsheetId: this.spreadsheetId,
          range: 'books_master!A1:A1'
        });
      }, 3000);

      return {
        status: 'healthy',
        message: 'Google Sheetsã¸ã®æ¥ç¶šã¯æ­£å¸¸ã§ã™',
        timestamp: new Date().toISOString()
      };
    } catch (error) {
      return {
        status: 'error',
        message: `Google Sheetsã¸ã®æ¥ç¶šã«å¤±æ•—: ${error.message}`,
        timestamp: new Date().toISOString()
      };
    }
  }

  // === ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¡ã‚½ãƒƒãƒ‰ ===

  formatDate(date = new Date()) {
    return date.toISOString().slice(0, 10);
  }

  formatDateTime(date = new Date()) {
    return date.toISOString().replace('T', ' ').slice(0, 19);
  }

  generateId() {
    return Math.floor(Math.random() * 1000) + Date.now() % 1000;
  }

  isValidStatus(category, status) {
    const validStatuses = {
      book: ['want_to_buy', 'want_to_read', 'reading', 'finished', 'abandoned'],
      movie: ['want_to_watch', 'watched', 'missed'],
      activity: ['planned', 'done', 'skipped']
    };

    return validStatuses[category]?.includes(status) || false;
  }

  getStatusEmoji(category, status) {
    const emojis = {
      book: {
        'want_to_buy': 'ğŸ›’',
        'want_to_read': 'ğŸ“‹',
        'reading': 'ğŸ“–',
        'finished': 'âœ…',
        'abandoned': 'âŒ'
      },
      movie: {
        'want_to_watch': 'ğŸ¬',
        'watched': 'âœ…',
        'missed': 'ğŸ˜…'
      },
      activity: {
        'planned': 'ğŸ¯',
        'done': 'âœ…',
        'skipped': 'ğŸ˜…'
      }
    };

    return emojis[category]?.[status] || 'â“';
  }

  getStatusText(category, status) {
    const texts = {
      book: {
        'want_to_buy': 'è²·ã„ãŸã„',
        'want_to_read': 'ç©èª­',
        'reading': 'èª­æ›¸ä¸­',
        'finished': 'èª­äº†',
        'abandoned': 'ä¸­æ–­'
      },
      movie: {
        'want_to_watch': 'è¦³ãŸã„',
        'watched': 'è¦–è´æ¸ˆã¿',
        'missed': 'è¦‹é€ƒã—'
      },
      activity: {
        'planned': 'äºˆå®š',
        'done': 'å®Œäº†',
        'skipped': 'ã‚¹ã‚­ãƒƒãƒ—'
      }
    };

    return texts[category]?.[status] || status;
  }
}

module.exports = GoogleSheetsService;

```

### config/constants.js

```
// ActivityTrackerBot è¨­å®šå®šæ•°

// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±
const APP_INFO = {
  NAME: 'ActivityTrackerBot',
  VERSION: '2.0.0',
  DESCRIPTION: 'Discord Activity Management Bot',
  AUTHOR: 'Your Name',
  REPOSITORY: 'https://github.com/yourusername/activity-tracker-bot'
};

// Discordé–¢é€£ã®åˆ¶é™
const DISCORD_LIMITS = {
  EMBED: {
    TITLE_MAX: 256,
    DESCRIPTION_MAX: 4096,
    FIELD_NAME_MAX: 256,
    FIELD_VALUE_MAX: 1024,
    FIELDS_MAX: 25,
    FOOTER_MAX: 2048,
    AUTHOR_MAX: 256,
    TOTAL_CHARS_MAX: 6000
  },
  MESSAGE: {
    CONTENT_MAX: 2000,
    ATTACHMENTS_MAX: 10
  },
  COMMAND: {
    NAME_MAX: 32,
    DESCRIPTION_MAX: 100,
    OPTION_NAME_MAX: 32,
    OPTION_DESCRIPTION_MAX: 100,
    CHOICES_MAX: 25
  }
};

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å®šç¾©
const STATUS = {
  BOOK: {
    WANT_TO_BUY: 'want_to_buy',
    WANT_TO_READ: 'want_to_read',
    READING: 'reading',
    FINISHED: 'finished',
    ABANDONED: 'abandoned'
  },
  MOVIE: {
    WANT_TO_WATCH: 'want_to_watch',
    WATCHED: 'watched',
    MISSED: 'missed'
  },
  ACTIVITY: {
    PLANNED: 'planned',
    DONE: 'done',
    SKIPPED: 'skipped'
  }
};

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºåï¼ˆæ—¥æœ¬èªï¼‰
const STATUS_NAMES = {
  BOOK: {
    [STATUS.BOOK.WANT_TO_BUY]: 'è²·ã„ãŸã„',
    [STATUS.BOOK.WANT_TO_READ]: 'ç©èª­',
    [STATUS.BOOK.READING]: 'èª­æ›¸ä¸­',
    [STATUS.BOOK.FINISHED]: 'èª­äº†',
    [STATUS.BOOK.ABANDONED]: 'ä¸­æ–­'
  },
  MOVIE: {
    [STATUS.MOVIE.WANT_TO_WATCH]: 'è¦³ãŸã„',
    [STATUS.MOVIE.WATCHED]: 'è¦–è´æ¸ˆã¿',
    [STATUS.MOVIE.MISSED]: 'è¦‹é€ƒã—'
  },
  ACTIVITY: {
    [STATUS.ACTIVITY.PLANNED]: 'äºˆå®šä¸­',
    [STATUS.ACTIVITY.DONE]: 'å®Œäº†',
    [STATUS.ACTIVITY.SKIPPED]: 'ã‚¹ã‚­ãƒƒãƒ—'
  }
};

// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹çµµæ–‡å­—
const STATUS_EMOJIS = {
  BOOK: {
    [STATUS.BOOK.WANT_TO_BUY]: 'ğŸ›’',
    [STATUS.BOOK.WANT_TO_READ]: 'ğŸ“‹',
    [STATUS.BOOK.READING]: 'ğŸ“–',
    [STATUS.BOOK.FINISHED]: 'âœ…',
    [STATUS.BOOK.ABANDONED]: 'âŒ'
  },
  MOVIE: {
    [STATUS.MOVIE.WANT_TO_WATCH]: 'ğŸ¿',
    [STATUS.MOVIE.WATCHED]: 'âœ…',
    [STATUS.MOVIE.MISSED]: 'ğŸ˜…'
  },
  ACTIVITY: {
    [STATUS.ACTIVITY.PLANNED]: 'ğŸ¯',
    [STATUS.ACTIVITY.DONE]: 'âœ…',
    [STATUS.ACTIVITY.SKIPPED]: 'ğŸ˜…'
  }
};

// ã‚«ãƒ†ã‚´ãƒªæƒ…å ±
const CATEGORIES = {
  BOOK: {
    name: 'book',
    displayName: 'æœ¬',
    emoji: 'ğŸ“š',
    color: '#9C27B0'
  },
  MOVIE: {
    name: 'movie',
    displayName: 'æ˜ ç”»',
    emoji: 'ğŸ¬',
    color: '#E91E63'
  },
  ACTIVITY: {
    name: 'activity',
    displayName: 'æ´»å‹•',
    emoji: 'ğŸ¯',
    color: '#00BCD4'
  }
};

// è‰²å®šæ•°ï¼ˆEmbedç”¨ï¼‰
const COLORS = {
  PRIMARY: '#3498DB',
  SUCCESS: '#4CAF50',
  WARNING: '#FF9800',
  ERROR: '#F44336',
  INFO: '#2196F3',
  
  // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚«ãƒ©ãƒ¼
  BOOK: '#9C27B0',
  MOVIE: '#E91E63',
  ACTIVITY: '#00BCD4',
  REPORT: '#4CAF50',
  STATS: '#9C27B0',
  SEARCH: '#FF9800',
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã‚«ãƒ©ãƒ¼
  COMPLETED: '#4CAF50',
  IN_PROGRESS: '#FF9800',
  PENDING: '#2196F3',
  ABANDONED: '#F44336'
};

// çµµæ–‡å­—å®šæ•°
const EMOJIS = {
  // åŸºæœ¬ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  ADD: 'â•',
  EDIT: 'âœï¸',
  DELETE: 'ğŸ—‘ï¸',
  SEARCH: 'ğŸ”',
  LIST: 'ğŸ“‹',
  STATS: 'ğŸ“Š',
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  SUCCESS: 'âœ…',
  ERROR: 'âŒ',
  WARNING: 'âš ï¸',
  INFO: 'â„¹ï¸',
  LOADING: 'â³',
  
  // ã‚«ãƒ†ã‚´ãƒª
  BOOK: 'ğŸ“š',
  MOVIE: 'ğŸ¬',
  ACTIVITY: 'ğŸ¯',
  REPORT: 'ğŸ“',
  
  // æ™‚é–“
  CALENDAR: 'ğŸ“…',
  CLOCK: 'ğŸ•',
  TIMER: 'â±ï¸',
  
  // è©•ä¾¡ãƒ»ãƒ¬ãƒ™ãƒ«
  TROPHY: 'ğŸ†',
  MEDAL: 'ğŸ…',
  STAR: 'â­',
  FIRE: 'ğŸ”¥',
  THUMBS_UP: 'ğŸ‘',
  HEART: 'â¤ï¸',
  
  // æ–¹å‘ãƒ»å‹•ä½œ
  UP: 'â¬†ï¸',
  DOWN: 'â¬‡ï¸',
  RIGHT: 'â¡ï¸',
  LEFT: 'â¬…ï¸',
  REFRESH: 'ğŸ”„',
  
  // é€šçŸ¥
  BELL: 'ğŸ””',
  MEGAPHONE: 'ğŸ“¢',
  MAIL: 'ğŸ“§'
};

// Google Sheetsé–¢é€£è¨­å®š
const SHEETS_CONFIG = {
  RANGES: {
    BOOKS: 'books_master!A:G',
    MOVIES: 'movies_master!A:F',
    ACTIVITIES: 'activities_master!A:F',
    REPORTS: 'daily_reports!A:E'
  },
  COLUMN_MAPPINGS: {
    BOOKS: {
      ID: 0,
      CREATED_AT: 1,
      TITLE: 2,
      AUTHOR: 3,
      MEMO: 4,
      STATUS: 5,
      UPDATED_AT: 6
    },
    MOVIES: {
      ID: 0,
      CREATED_AT: 1,
      TITLE: 2,
      MEMO: 3,
      STATUS: 4,
      UPDATED_AT: 5
    },
    ACTIVITIES: {
      ID: 0,
      CREATED_AT: 1,
      CONTENT: 2,
      MEMO: 3,
      STATUS: 4,
      UPDATED_AT: 5
    },
    REPORTS: {
      ID: 0,
      DATE: 1,
      CATEGORY: 2,
      ITEM_ID: 3,
      CONTENT: 4
    }
  },
  TIMEOUTS: {
    READ: 10000,    // 10ç§’
    WRITE: 15000,   // 15ç§’
    BATCH: 20000    // 20ç§’
  },
  RETRY: {
    MAX_ATTEMPTS: 3,
    DELAY_BASE: 1000,  // 1ç§’
    DELAY_MAX: 5000    // 5ç§’
  }
};

// é€šçŸ¥è¨­å®š
const NOTIFICATION_SETTINGS = {
  SCHEDULES: {
    MORNING_GREETING: '0 7 * * *',      // æ¯æœ7æ™‚
    DAILY_REMINDER: '0 20 * * *',       // æ¯æ—¥20æ™‚
    WEEKLY_REPORT: '0 21 * * 0',        // æ¯é€±æ—¥æ›œ21æ™‚
    MONTHLY_REPORT: '0 8 1 * *',        // æ¯æœˆ1æ—¥8æ™‚
    MONTHLY_WISHLIST: '0 9 1 * *',      // æ¯æœˆ1æ—¥9æ™‚
    ABANDONED_CHECK: '0 21 * * *'       // æ¯æ—¥21æ™‚
  },
  DEFAULTS: {
    TIMEZONE: 'Asia/Tokyo',
    ABANDONED_DAYS: 7,
    RECENT_DAYS: 7
  }
};

// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
const PERFORMANCE = {
  CACHE: {
    DEFAULT_TTL: 300000,     // 5åˆ†
    STATS_TTL: 600000,       // 10åˆ†
    SEARCH_TTL: 180000       // 3åˆ†
  },
  RATE_LIMITS: {
    COMMAND_COOLDOWN: 3000,   // 3ç§’
    REPORT_COOLDOWN: 2000,    // 2ç§’
    STATS_COOLDOWN: 5000      // 5ç§’
  },
  BATCH_SIZES: {
    DISPLAY_ITEMS: 20,
    SEARCH_RESULTS: 15,
    REPORT_HISTORY: 10
  }
};

// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
const ERROR_MESSAGES = {
  GENERIC: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚',
  NOT_FOUND: 'æŒ‡å®šã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚',
  INVALID_ID: 'ç„¡åŠ¹ãªIDãŒæŒ‡å®šã•ã‚Œã¾ã—ãŸã€‚',
  PERMISSION_DENIED: 'ã“ã®æ“ä½œã‚’å®Ÿè¡Œã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚',
  RATE_LIMITED: 'æ“ä½œãŒå¤šã™ãã¾ã™ã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚',
  TIMEOUT: 'å‡¦ç†ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚',
  VALIDATION_FAILED: 'å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒç„¡åŠ¹ã§ã™ã€‚',
  SHEETS_ERROR: 'ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ãƒ»å–å¾—ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚',
  NETWORK_ERROR: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚'
};

// æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
const SUCCESS_MESSAGES = {
  ITEM_ADDED: 'ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼',
  ITEM_UPDATED: 'ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼',
  ITEM_DELETED: 'ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼',
  REPORT_ADDED: 'æ—¥å ±ã‚’è¨˜éŒ²ã—ã¾ã—ãŸï¼',
  SEARCH_COMPLETED: 'æ¤œç´¢ãŒå®Œäº†ã—ã¾ã—ãŸã€‚',
  STATS_GENERATED: 'çµ±è¨ˆæƒ…å ±ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚'
};

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
const VALIDATION = {
  TEXT: {
    TITLE_MIN: 1,
    TITLE_MAX: 200,
    AUTHOR_MIN: 1,
    AUTHOR_MAX: 100,
    CONTENT_MIN: 1,
    CONTENT_MAX: 1000,
    MEMO_MAX: 500,
    KEYWORD_MIN: 2,
    KEYWORD_MAX: 100
  },
  NUMBERS: {
    ID_MIN: 1,
    ID_MAX: 999999,
    DAYS_MIN: 1,
    DAYS_MAX: 365
  }
};

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
const DEFAULTS = {
  BOOK_STATUS: STATUS.BOOK.WANT_TO_READ,
  MOVIE_STATUS: STATUS.MOVIE.WANT_TO_WATCH,
  ACTIVITY_STATUS: STATUS.ACTIVITY.PLANNED,
  RECENT_DAYS: 7,
  SEARCH_LIMIT: 20,
  DISPLAY_LIMIT: 10
};

// ç›®æ¨™è¨­å®š
const GOALS = {
  WEEKLY: {
    BOOKS: 2,
    MOVIES: 3,
    ACTIVITIES: 5,
    REPORTS: 7
  },
  MONTHLY: {
    BOOKS: 8,
    MOVIES: 12,
    ACTIVITIES: 20,
    REPORTS: 30
  },
  DAILY: {
    REPORTS: 1
  }
};

// ãƒ¬ãƒ™ãƒ«å®šç¾©
const LEVELS = {
  MONTHLY_ACTIVITY: [
    { min: 30, icon: 'ğŸ†', name: 'è¶…äººãƒ¬ãƒ™ãƒ«', description: 'é©šç•°çš„ãªé”æˆç‡ã§ã™ï¼' },
    { min: 20, icon: 'ğŸŒŸ', name: 'ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ', description: 'ç´ æ™´ã‚‰ã—ã„ç¶™ç¶šåŠ›ã§ã™ï¼' },
    { min: 15, icon: 'â­', name: 'ã‚¢ã‚¯ãƒ†ã‚£ãƒ–', description: 'é †èª¿ã«ãƒšãƒ¼ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™ï¼' },
    { min: 10, icon: 'ğŸ”¥', name: 'ãƒ¢ãƒãƒ™ãƒ¼ãƒˆ', description: 'è‰¯ã„ãƒšãƒ¼ã‚¹ã§é€²ã‚“ã§ã„ã¾ã™ï¼' },
    { min: 5, icon: 'ğŸ’ª', name: 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼', description: 'ã‚‚ã†å°‘ã—ãƒšãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ã§ããã†ã§ã™ï¼' },
    { min: 0, icon: 'ğŸŒ±', name: 'ã‚¹ã‚¿ãƒ¼ãƒˆ', description: 'ç¶™ç¶šãŒæˆåŠŸã®éµã§ã™ï¼' }
  ],
  READING_PACE: [
    { min: 8, icon: 'ğŸš€', name: 'è¶…é«˜é€Ÿãƒšãƒ¼ã‚¹', description: 'æœˆ8å†Šä»¥ä¸Šï¼é©šç•°çš„ãªèª­æ›¸é‡ã§ã™ï¼' },
    { min: 4, icon: 'âš¡', name: 'é«˜é€Ÿãƒšãƒ¼ã‚¹', description: 'æœˆ4å†Šä»¥ä¸Šï¼ç´ æ™´ã‚‰ã—ã„ãƒšãƒ¼ã‚¹ã§ã™ï¼' },
    { min: 2, icon: 'ğŸ“ˆ', name: 'æ¨™æº–ãƒšãƒ¼ã‚¹', description: 'æœˆ2å†Šä»¥ä¸Šï¼è‰¯ã„ãƒšãƒ¼ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™ï¼' },
    { min: 1, icon: 'ğŸ“š', name: 'å®‰å®šãƒšãƒ¼ã‚¹', description: 'æœˆ1å†Šï¼ç¶™ç¶šãŒå¤§åˆ‡ã§ã™ï¼' },
    { min: 0, icon: 'ğŸŒ±', name: 'ã‚¹ã‚¿ãƒ¼ãƒˆ', description: 'ã¾ãšã¯æœˆ1å†Šã‚’ç›®æ¨™ã«ã—ã¦ã¿ã¾ã›ã‚“ã‹ï¼Ÿ' }
  ]
};

module.exports = {
  APP_INFO,
  DISCORD_LIMITS,
  STATUS,
  STATUS_NAMES,
  STATUS_EMOJIS,
  CATEGORIES,
  COLORS,
  EMOJIS,
  SHEETS_CONFIG,
  NOTIFICATION_SETTINGS,
  PERFORMANCE,
  ERROR_MESSAGES,
  SUCCESS_MESSAGES,
  VALIDATION,
  DEFAULTS,
  GOALS,
  LEVELS
};

```

### config/database.js

```
module.exports = {
  // Google Sheets ã®è¨­å®š
  sheets: {
    // ã‚·ãƒ¼ãƒˆåã®å®šç¾©
    SHEET_NAMES: {
      BOOKS_MASTER: 'books_master',
      MOVIES_MASTER: 'movies_master',
      ACTIVITIES_MASTER: 'activities_master',
      DAILY_REPORTS: 'daily_reports'
    },
    
    // åˆ—ã®å®šç¾©
    COLUMNS: {
      BOOKS: {
        ID: 0,
        CREATED_AT: 1,
        TITLE: 2,
        AUTHOR: 3,
        MEMO: 4,
        STATUS: 5,
        UPDATED_AT: 6
      },
      MOVIES: {
        ID: 0,
        CREATED_AT: 1,
        TITLE: 2,
        MEMO: 3,
        STATUS: 4,
        UPDATED_AT: 5
      },
      ACTIVITIES: {
        ID: 0,
        CREATED_AT: 1,
        CONTENT: 2,
        MEMO: 3,
        STATUS: 4,
        UPDATED_AT: 5
      },
      REPORTS: {
        ID: 0,
        DATE: 1,
        CATEGORY: 2,
        ITEM_ID: 3,
        CONTENT: 4
      }
    },
    
    // ç¯„å›²ã®å®šç¾©
    RANGES: {
      BOOKS_ALL: 'books_master!A:G',
      MOVIES_ALL: 'movies_master!A:F',
      ACTIVITIES_ALL: 'activities_master!A:F',
      REPORTS_ALL: 'daily_reports!A:E'
    }
  },
  
  // ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
  timeouts: {
    OPERATION_TIMEOUT: 10000,
    AUTH_TIMEOUT: 30000
  }
};

```

### check_sheets_connection.js

```
require('dotenv').config();
const { google } = require('googleapis');

async function checkConnection() {
  console.log('ğŸ” Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆé–‹å§‹...');
  
  try {
    let auth;
    
    if (process.env.GOOGLE_SERVICE_ACCOUNT_JSON) {
      console.log('ğŸ“ JSONå½¢å¼ã§èªè¨¼ä¸­...');
      const credentials = JSON.parse(process.env.GOOGLE_SERVICE_ACCOUNT_JSON);
      auth = new google.auth.GoogleAuth({
        credentials,
        scopes: ['https://www.googleapis.com/auth/spreadsheets']
      });
    } else if (process.env.GOOGLE_CLIENT_EMAIL) {
      console.log('ğŸ“ ç’°å¢ƒå¤‰æ•°å½¢å¼ã§èªè¨¼ä¸­...');
      auth = new google.auth.GoogleAuth({
        credentials: {
          type: 'service_account',
          project_id: process.env.GOOGLE_PROJECT_ID,
          client_email: process.env.GOOGLE_CLIENT_EMAIL,
          private_key: process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g, '\n'),
          client_id: process.env.GOOGLE_CLIENT_ID,
          auth_uri: 'https://accounts.google.com/o/oauth2/auth',
          token_uri: 'https://oauth2.googleapis.com/token'
        },
        scopes: ['https://www.googleapis.com/auth/spreadsheets']
      });
    } else {
      throw new Error('Googleèªè¨¼æƒ…å ±ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
    }
    
    console.log('ğŸ”‘ èªè¨¼æƒ…å ±å–å¾—ä¸­...');
    const client = await auth.getClient();
    
    console.log('ğŸ“Š ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...');
    const sheets = google.sheets({ version: 'v4', auth: client });
    
    if (!process.env.SPREADSHEET_ID) {
      throw new Error('SPREADSHEET_IDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
    }
    
    // ã‚·ãƒ¼ãƒˆä¸€è¦§ã‚’å–å¾—
    const response = await sheets.spreadsheets.get({
      spreadsheetId: process.env.SPREADSHEET_ID
    });
    
    console.log('âœ… Google Sheetsæ¥ç¶šæˆåŠŸï¼');
    console.log('ğŸ“‹ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå:', response.data.properties.title);
    console.log('ğŸ“„ åˆ©ç”¨å¯èƒ½ãªã‚·ãƒ¼ãƒˆ:');
    response.data.sheets.forEach(sheet => {
      console.log(`  - ${sheet.properties.title}`);
    });
    
    // æœ¬ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãƒ†ã‚¹ãƒˆ
    console.log('ğŸ“š books_masterã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ...');
    const booksData = await sheets.spreadsheets.values.get({
      spreadsheetId: process.env.SPREADSHEET_ID,
      range: 'books_master!A:G'
    });
    
    const books = booksData.data.values || [];
    console.log(`ğŸ“Š ç™»éŒ²æ¸ˆã¿æœ¬æ•°: ${books.length - 1}å†Š`); // ãƒ˜ãƒƒãƒ€ãƒ¼é™¤ã
    
    if (books.length > 1) {
      console.log('ğŸ“– æœ€æ–°ã®æœ¬3å†Š:');
      books.slice(-3).forEach(book => {
        console.log(`  - [${book[0]}] ${book[2]} - ${book[3]} (${book[5]})`);
      });
    }
    
    console.log('ğŸ‰ Google Sheetsé€£æºã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼');
    
  } catch (error) {
    console.error('âŒ Google Sheetsæ¥ç¶šã‚¨ãƒ©ãƒ¼:', error.message);
    console.log('ğŸ”§ ç¢ºèªäº‹é …:');
    console.log('  1. ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹');
    console.log('  2. Google Sheets APIãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹');
    console.log('  3. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ç·¨é›†æ¨©é™ãŒã‚ã‚‹ã‹');
  }
}

checkConnection();

```

### commands/report.js

```
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('report')
    .setDescription('ğŸ“ æ—¥å ±ã®è¨˜éŒ² - æ´»å‹•ã®æŒ¯ã‚Šè¿”ã‚Šã‚’ã‚µãƒãƒ¼ãƒˆ')
    .addStringOption(option =>
      option
        .setName('category')
        .setDescription('è¨˜éŒ²å¯¾è±¡ã®ã‚«ãƒ†ã‚´ãƒª')
        .setRequired(true)
        .addChoices(
          { name: 'ğŸ“š æœ¬', value: 'book' },
          { name: 'ğŸ¬ æ˜ ç”»', value: 'movie' },
          { name: 'ğŸ¯ æ´»å‹•', value: 'activity' }
        ))
    .addIntegerOption(option =>
      option
        .setName('id')
        .setDescription('å¯¾è±¡ã®ã‚¢ã‚¤ãƒ†ãƒ ID')
        .setRequired(true))
    .addStringOption(option =>
      option
        .setName('content')
        .setDescription('è¨˜éŒ²å†…å®¹ãƒ»æ„Ÿæƒ³ãƒ»é€²æ—ãªã©')
        .setRequired(true)),

  // ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå‡¦ç†ï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«å§”è­²ï¼‰
  async execute(interaction) {
    throw new Error('ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§å‡¦ç†ã•ã‚Œã¾ã™');
  },

  // ã‚³ãƒãƒ³ãƒ‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  category: 'tracking',
  permissions: [],
  cooldown: 2,
  
  // ä½¿ç”¨ä¾‹
  examples: [
    '/report category:æœ¬ id:1 content:ç¬¬3ç« ã¾ã§èª­äº†ã€‚ä¸»äººå…¬ã®å¿ƒå¢ƒå¤‰åŒ–ãŒèˆˆå‘³æ·±ã„',
    '/report category:æ˜ ç”» id:2 content:æ„Ÿå‹•çš„ãªã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§ã—ãŸã€‚è©•ä¾¡â˜…â˜…â˜…â˜…â˜†',
    '/report category:æ´»å‹• id:3 content:ä»Šæ—¥ã¯30åˆ†ã‚¸ãƒ§ã‚®ãƒ³ã‚°å®Œäº†ã€‚ä½“èª¿è‰¯å¥½',
    '/report category:æœ¬ id:4 content:50ãƒšãƒ¼ã‚¸é€²ã‚“ã ã€‚é›£ã—ã„å†…å®¹ã ãŒç†è§£ã§ãã¦ã„ã‚‹',
    '/report category:æ´»å‹• id:5 content:ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’2æ™‚é–“ã€‚é…åˆ—ã®æ¦‚å¿µã‚’ç¿’å¾—'
  ],

  // ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
  help: {
    description: 'æ—¥å ±ãƒ»é€²æ—è¨˜éŒ²æ©Ÿèƒ½ã§ã™ã€‚æœ¬ãƒ»æ˜ ç”»ãƒ»æ´»å‹•ã®é€²æ—ã‚„æ„Ÿæƒ³ã‚’è¨˜éŒ²ã—ã€ç¶™ç¶šã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚',
    usage: 'ã‚«ãƒ†ã‚´ãƒªã€IDã€è¨˜éŒ²å†…å®¹ã‚’æŒ‡å®šã—ã¦æ—¥å ±ã‚’ä½œæˆã—ã¾ã™ã€‚',
    parameters: {
      category: 'è¨˜éŒ²å¯¾è±¡ï¼ˆæœ¬/æ˜ ç”»/æ´»å‹•ï¼‰ã‚’é¸æŠã—ã¾ã™',
      id: 'è¨˜éŒ²ã—ãŸã„ã‚¢ã‚¤ãƒ†ãƒ ã®IDã‚’æŒ‡å®šã—ã¾ã™',
      content: 'ä»Šæ—¥ã®é€²æ—ã€æ„Ÿæƒ³ã€æ°—ã¥ããªã©ã‚’è‡ªç”±ã«è¨˜éŒ²ã—ã¾ã™'
    },
    tips: [
      'ğŸ“Š è¨˜éŒ²ã—ãŸå†…å®¹ã¯ /reports ã‚³ãƒãƒ³ãƒ‰ã§å¾Œã‹ã‚‰ç¢ºèªã§ãã¾ã™',
      'ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã¯ /reports search ã§å¯èƒ½ã§ã™',
      'ğŸ“ˆ ç¶™ç¶šçš„ãªè¨˜éŒ²ã§æˆé•·ã‚’å®Ÿæ„Ÿã§ãã¾ã™',
      'ğŸ’­ çŸ­ã„è¨˜éŒ²ã§ã‚‚ç¶™ç¶šã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™'
    ],
    goodPractices: [
      'èª­æ›¸: èª­ã‚“ã ãƒšãƒ¼ã‚¸æ•°ã€å°è±¡ã«æ®‹ã£ãŸéƒ¨åˆ†ã€ç†è§£åº¦ãªã©',
      'æ˜ ç”»: æ„Ÿæƒ³ã€è©•ä¾¡ã€å°è±¡çš„ãªã‚·ãƒ¼ãƒ³ãªã©',
      'æ´»å‹•: å®Ÿè¡Œæ™‚é–“ã€é”æˆåº¦ã€èª²é¡Œã€æ¬¡ã®ç›®æ¨™ãªã©'
    ]
  }
};

```

### commands/reports.js

```
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('reports')
    .setDescription('ğŸ“ ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã®ç®¡ç† - è¨˜éŒ²ã—ãŸæ—¥å ±ã®æ¤œç´¢ãƒ»é–²è¦§')
    .addSubcommand(subcommand =>
      subcommand
        .setName('history')
        .setDescription('ğŸ“œ ç‰¹å®šã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã‚’è¡¨ç¤º')
        .addStringOption(option =>
          option
            .setName('category')
            .setDescription('ã‚«ãƒ†ã‚´ãƒª')
            .setRequired(true)
            .addChoices(
              { name: 'ğŸ“š æœ¬', value: 'book' },
              { name: 'ğŸ¬ æ˜ ç”»', value: 'movie' },
              { name: 'ğŸ¯ æ´»å‹•', value: 'activity' }
            ))
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('å¯¾è±¡ã‚¢ã‚¤ãƒ†ãƒ ã®ID')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('recent')
        .setDescription('ğŸ•’ æœ€è¿‘ã®ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§ã‚’è¡¨ç¤º')
        .addIntegerOption(option =>
          option
            .setName('days')
            .setDescription('ä½•æ—¥å‰ã¾ã§è¡¨ç¤ºã™ã‚‹ã‹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 7æ—¥ï¼‰')
            .setRequired(false)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('search')
        .setDescription('ğŸ” ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã§ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢')
        .addStringOption(option =>
          option
            .setName('keyword')
            .setDescription('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('calendar')
        .setDescription('ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å½¢å¼ã§ãƒ¬ãƒãƒ¼ãƒˆçŠ¶æ³ã‚’è¡¨ç¤º')
        .addStringOption(option =>
          option
            .setName('month')
            .setDescription('è¡¨ç¤ºæœˆï¼ˆYYYY-MMå½¢å¼ã€çœç•¥æ™‚ã¯ä»Šæœˆï¼‰')
            .setRequired(false)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('analytics')
        .setDescription('ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆåˆ†æï¼ˆé »åº¦ãƒ»å‚¾å‘ãƒ»çµ±è¨ˆï¼‰'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('export')
        .setDescription('ğŸ“¤ ãƒ¬ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ')
        .addStringOption(option =>
          option
            .setName('format')
            .setDescription('å‡ºåŠ›å½¢å¼')
            .setRequired(false)
            .addChoices(
              { name: 'ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼', value: 'text' },
              { name: 'ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³å½¢å¼', value: 'markdown' },
              { name: 'JSONå½¢å¼', value: 'json' }
            ))
        .addStringOption(option =>
          option
            .setName('period')
            .setDescription('æœŸé–“')
            .setRequired(false)
            .addChoices(
              { name: 'ä»Šé€±', value: 'week' },
              { name: 'ä»Šæœˆ', value: 'month' },
              { name: 'å…¨æœŸé–“', value: 'all' }
            ))),

  // ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå‡¦ç†ï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«å§”è­²ï¼‰
  async execute(interaction) {
    throw new Error('ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§å‡¦ç†ã•ã‚Œã¾ã™');
  },

  // ã‚³ãƒãƒ³ãƒ‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  category: 'tracking',
  permissions: [],
  cooldown: 3,
  
  // ä½¿ç”¨ä¾‹
  examples: [
    '/reports history category:æœ¬ id:1',
    '/reports recent days:14',
    '/reports search keyword:æ„Ÿæƒ³'
  ],

  // ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
  help: {
    description: 'ã“ã‚Œã¾ã§ã«è¨˜éŒ²ã—ãŸæ—¥å ±ãƒ»ãƒ¬ãƒãƒ¼ãƒˆã®æ¤œç´¢ã€é–²è¦§æ©Ÿèƒ½ã§ã™ã€‚æ´»å‹•ã®æŒ¯ã‚Šè¿”ã‚Šã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚',
    usage: 'ä»¥ä¸‹ã®ãƒ¬ãƒãƒ¼ãƒˆç®¡ç†æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ï¼š',
    subcommands: {
      history: 'ç‰¹å®šã®æœ¬ãƒ»æ˜ ç”»ãƒ»æ´»å‹•ã«é–¢ã™ã‚‹ã™ã¹ã¦ã®ãƒ¬ãƒãƒ¼ãƒˆå±¥æ­´ã‚’æ™‚ç³»åˆ—ã§è¡¨ç¤º',
      recent: 'æŒ‡å®šã—ãŸæ—¥æ•°ä»¥å†…ã«è¨˜éŒ²ã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆã‚’ä¸€è¦§è¡¨ç¤º',
      search: 'ãƒ¬ãƒãƒ¼ãƒˆå†…å®¹ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã—ã€é–¢é€£ã™ã‚‹è¨˜éŒ²ã‚’æŠ½å‡º'
    },
    tips: [
      'ğŸ“ˆ ç¶™ç¶šçš„ãªè¨˜éŒ²ã§æˆé•·ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠŠæ¡',
      'ğŸ” ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã§éå»ã®æ°—ã¥ãã‚’å†ç™ºè¦‹',
      'ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆé »åº¦ã§ç¿’æ…£ã®å®šç€åº¦ã‚’ç¢ºèª'
    ]
  }
};

```

### commands/activity.js

```
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('activity')
    .setDescription('ğŸ¯ æ´»å‹•ã®ç®¡ç† - ç›®æ¨™é”æˆã‚’ã‚µãƒãƒ¼ãƒˆ')
    .addSubcommand(subcommand =>
      subcommand
        .setName('add')
        .setDescription('ğŸ¯ æ–°ã—ã„æ´»å‹•ã‚’è¿½åŠ ')
        .addStringOption(option =>
          option
            .setName('content')
            .setDescription('æ´»å‹•å†…å®¹')
            .setRequired(true))
        .addStringOption(option =>
          option
            .setName('memo')
            .setDescription('å‚™è€ƒãƒ»ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰')
            .setRequired(false)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('done')
        .setDescription('âœ… æ´»å‹•ã‚’å®Œäº†')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('å®Œäº†ã—ãŸæ´»å‹•ã®ID')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('skip')
        .setDescription('ğŸ˜… æ´»å‹•ã‚’ã‚¹ã‚­ãƒƒãƒ—')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹æ´»å‹•ã®ID')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('list')
        .setDescription('ğŸ¯ ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®æ´»å‹•ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('planned')
        .setDescription('ğŸ¯ äºˆå®šä¸­ã®æ´»å‹•ä¸€è¦§ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('completed')
        .setDescription('âœ… å®Œäº†æ¸ˆã¿æ´»å‹•ä¸€è¦§ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('info')
        .setDescription('ğŸ“„ ç‰¹å®šã®æ´»å‹•ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('è©³ç´°ã‚’è¦‹ãŸã„æ´»å‹•ã®ID')
            .setRequired(true))),

  // ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå‡¦ç†ï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«å§”è­²ï¼‰
  async execute(interaction) {
    throw new Error('ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§å‡¦ç†ã•ã‚Œã¾ã™');
  },

  // ã‚³ãƒãƒ³ãƒ‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  category: 'management',
  permissions: [],
  cooldown: 3,
  
  // ä½¿ç”¨ä¾‹
  examples: [
    '/activity add content:æ¯æ—¥30åˆ†é‹å‹•ã™ã‚‹',
    '/activity add content:æ–°ã—ã„ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã‚’å­¦ã¶ memo:Pythonå­¦ç¿’',
    '/activity done id:1',
    '/activity skip id:2',
    '/activity list',
    '/activity planned',
    '/activity info id:1'
  ],

  // ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
  help: {
    description: 'æ´»å‹•ãƒ»ç›®æ¨™ã®ç®¡ç†æ©Ÿèƒ½ã§ã™ã€‚æ—¥ã€…ã®æ´»å‹•ã‚„ç›®æ¨™ã®é”æˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚',
    usage: 'ä»¥ä¸‹ã®ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ãŒåˆ©ç”¨ã§ãã¾ã™ï¼š',
    subcommands: {
      add: 'æ–°ã—ã„æ´»å‹•ã‚„ç›®æ¨™ã‚’äºˆå®šãƒªã‚¹ãƒˆã«ç™»éŒ²ã—ã¾ã™ã€‚',
      done: 'æ´»å‹•ã‚’å®Œäº†ã—ã€å®Œäº†æ¸ˆã¿ãƒªã‚¹ãƒˆã«ç§»å‹•ã—ã¾ã™ã€‚',
      skip: 'æ´»å‹•ã‚’ã‚¹ã‚­ãƒƒãƒ—ã¨ã—ã¦ãƒãƒ¼ã‚¯ã—ã¾ã™ã€‚',
      list: 'ã™ã¹ã¦ã®æ´»å‹•ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«è¡¨ç¤ºã—ã¾ã™ã€‚',
      planned: 'äºˆå®šä¸­ã®æ´»å‹•ã®ã¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚',
      completed: 'å®Œäº†æ¸ˆã¿ã®æ´»å‹•ã®ã¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚',
      info: 'ç‰¹å®šã®æ´»å‹•ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚'
    },
    tips: [
      'ğŸ“ æ´»å‹•ã®é€²æ—ã¯ /report activity ã‚³ãƒãƒ³ãƒ‰ã§è¨˜éŒ²ã§ãã¾ã™',
      'ğŸ” æ´»å‹•ã®æ¤œç´¢ã¯ /search activity ã‚³ãƒãƒ³ãƒ‰ãŒä¾¿åˆ©ã§ã™',
      'ğŸ“Š æ´»å‹•çµ±è¨ˆã¯ /stats ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã¾ã™'
    ]
  }
};

```

### commands/book.js

```
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('book')
    .setDescription('ğŸ“š æœ¬ã®ç®¡ç† - èª­æ›¸ãƒ©ã‚¤ãƒ•ã‚’ã‚µãƒãƒ¼ãƒˆ')
    .addSubcommand(subcommand =>
      subcommand
        .setName('add')
        .setDescription('ğŸ“– æ–°ã—ã„æœ¬ã‚’è¿½åŠ ')
        .addStringOption(option =>
          option
            .setName('title')
            .setDescription('æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«')
            .setRequired(true))
        .addStringOption(option =>
          option
            .setName('author')
            .setDescription('ä½œè€…å')
            .setRequired(true))
        .addStringOption(option =>
          option
            .setName('status')
            .setDescription('åˆæœŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ç©èª­ï¼‰')
            .setRequired(false)
            .addChoices(
              { name: 'ğŸ›’ è²·ã„ãŸã„', value: 'want_to_buy' },
              { name: 'ğŸ“‹ ç©èª­', value: 'want_to_read' }
            ))
        .addStringOption(option =>
          option
            .setName('memo')
            .setDescription('å‚™è€ƒãƒ»ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰')
            .setRequired(false)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('buy')
        .setDescription('ğŸ›’ æœ¬ã‚’è³¼å…¥å®Œäº†ï¼ˆè²·ã„ãŸã„ â†’ ç©èª­ï¼‰')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('è³¼å…¥ã—ãŸæœ¬ã®ID')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('start')
        .setDescription('ğŸ“– èª­æ›¸ã‚’é–‹å§‹ï¼ˆç©èª­ â†’ èª­æ›¸ä¸­ï¼‰')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('èª­ã¿å§‹ã‚ã‚‹æœ¬ã®ID')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('finish')
        .setDescription('âœ… èª­æ›¸ã‚’å®Œäº†ï¼ˆèª­æ›¸ä¸­ â†’ èª­äº†ï¼‰')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('èª­ã¿çµ‚ãˆãŸæœ¬ã®ID')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('list')
        .setDescription('ğŸ“š ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®æœ¬ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('wishlist')
        .setDescription('ğŸ›’ è²·ã„ãŸã„æœ¬ä¸€è¦§ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('reading')
        .setDescription('ğŸ“– ç¾åœ¨èª­æ›¸ä¸­ã®æœ¬ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('finished')
        .setDescription('âœ… èª­äº†æ¸ˆã¿ã®æœ¬ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('info')
        .setDescription('ğŸ“„ ç‰¹å®šã®æœ¬ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('è©³ç´°ã‚’è¦‹ãŸã„æœ¬ã®ID')
            .setRequired(true))),

  // ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå‡¦ç†ï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«å§”è­²ï¼‰
  async execute(interaction) {
    // ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ bookHandler.js ã§å‡¦ç†ã•ã‚Œã‚‹
    // index.js ã®ãƒ­ã‚¸ãƒƒã‚¯ã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹
    throw new Error('ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§å‡¦ç†ã•ã‚Œã¾ã™');
  },

  // ã‚³ãƒãƒ³ãƒ‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  category: 'management',
  permissions: [],
  cooldown: 3, // 3ç§’ã®ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
  
  // ä½¿ç”¨ä¾‹
  examples: [
    '/book add ã‚¿ã‚¤ãƒˆãƒ«:é¬¼æ»…ã®åˆƒ ä½œè€…:å¾å³ å‘¼ä¸–æ™´',
    '/book add ã‚¿ã‚¤ãƒˆãƒ«:JavaScriptå…¥é–€ ä½œè€…:å±±ç”°å¤ªéƒ status:è²·ã„ãŸã„ memo:ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å­¦ç¿’ç”¨',
    '/book buy id:1',
    '/book start id:2',
    '/book finish id:3',
    '/book list',
    '/book wishlist',
    '/book reading',
    '/book info id:1'
  ],

  // ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
  help: {
    description: 'æœ¬ã®ç®¡ç†æ©Ÿèƒ½ã§ã™ã€‚èª­æ›¸ã®é€²æ—ã‚’è¿½è·¡ã—ã€èª­æ›¸ç¿’æ…£ã®å½¢æˆã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚',
    usage: 'ä»¥ä¸‹ã®ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ãŒåˆ©ç”¨ã§ãã¾ã™ï¼š',
    subcommands: {
      add: 'æ–°ã—ã„æœ¬ã‚’ç™»éŒ²ã—ã¾ã™ã€‚è²·ã„ãŸã„æœ¬ãƒªã‚¹ãƒˆã¾ãŸã¯ç©èª­ãƒªã‚¹ãƒˆã«è¿½åŠ ã§ãã¾ã™ã€‚',
      buy: 'è²·ã„ãŸã„æœ¬ã‚’è³¼å…¥å®Œäº†ã—ã€ç©èª­ãƒªã‚¹ãƒˆã«ç§»å‹•ã—ã¾ã™ã€‚',
      start: 'ç©èª­æœ¬ã®èª­æ›¸ã‚’é–‹å§‹ã—ã€èª­æ›¸ä¸­ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«å¤‰æ›´ã—ã¾ã™ã€‚',
      finish: 'èª­æ›¸ä¸­ã®æœ¬ã‚’èª­äº†å®Œäº†ã—ã€èª­äº†ãƒªã‚¹ãƒˆã«ç§»å‹•ã—ã¾ã™ã€‚',
      list: 'ã™ã¹ã¦ã®æœ¬ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«è¡¨ç¤ºã—ã¾ã™ã€‚',
      wishlist: 'è²·ã„ãŸã„æœ¬ã®ã¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚',
      reading: 'ç¾åœ¨èª­æ›¸ä¸­ã®æœ¬ã®ã¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚',
      finished: 'èª­äº†æ¸ˆã¿ã®æœ¬ã®ã¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚',
      info: 'ç‰¹å®šã®æœ¬ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚'
    },
    tips: [
      'ğŸ“ èª­æ›¸ã®è¨˜éŒ²ã¯ /report book ã‚³ãƒãƒ³ãƒ‰ã§æ—¥å ±ã¨ã—ã¦æ®‹ã›ã¾ã™',
      'ğŸ” æœ¬ã®æ¤œç´¢ã¯ /search book ã‚³ãƒãƒ³ãƒ‰ãŒä¾¿åˆ©ã§ã™',
      'ğŸ“Š èª­æ›¸çµ±è¨ˆã¯ /stats books ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã¾ã™'
    ]
  }
};

```

### commands/search.js

```
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('search')
    .setDescription('ğŸ” ã‚¢ã‚¤ãƒ†ãƒ ã®æ¤œç´¢ - ç™»éŒ²æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ¤œç´¢')
    .addSubcommand(subcommand =>
      subcommand
        .setName('book')
        .setDescription('ğŸ“š æœ¬ã‚’æ¤œç´¢')
        .addStringOption(option =>
          option
            .setName('keyword')
            .setDescription('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»ä½œè€…ãƒ»å‚™è€ƒï¼‰')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('movie')
        .setDescription('ğŸ¬ æ˜ ç”»ã‚’æ¤œç´¢')
        .addStringOption(option =>
          option
            .setName('keyword')
            .setDescription('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»å‚™è€ƒï¼‰')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('activity')
        .setDescription('ğŸ¯ æ´»å‹•ã‚’æ¤œç´¢')
        .addStringOption(option =>
          option
            .setName('keyword')
            .setDescription('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆæ´»å‹•å†…å®¹ãƒ»å‚™è€ƒï¼‰')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('all')
        .setDescription('ğŸ” å…¨ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æ¤œç´¢')
        .addStringOption(option =>
          option
            .setName('keyword')
            .setDescription('æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('status')
        .setDescription('ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥æ¤œç´¢')
        .addStringOption(option =>
          option
            .setName('category')
            .setDescription('æ¤œç´¢ã‚«ãƒ†ã‚´ãƒª')
            .setRequired(true)
            .addChoices(
              { name: 'ğŸ“š æœ¬', value: 'book' },
              { name: 'ğŸ¬ æ˜ ç”»', value: 'movie' },
              { name: 'ğŸ¯ æ´»å‹•', value: 'activity' }
            ))
        .addStringOption(option =>
          option
            .setName('status')
            .setDescription('æ¤œç´¢ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹')
            .setRequired(true)
            .addChoices(
              { name: 'ğŸ›’ è²·ã„ãŸã„', value: 'want_to_buy' },
              { name: 'ğŸ“‹ ç©èª­', value: 'want_to_read' },
              { name: 'ğŸ“– èª­æ›¸ä¸­', value: 'reading' },
              { name: 'âœ… èª­äº†/è¦–è´æ¸ˆã¿/å®Œäº†', value: 'finished' },
              { name: 'ğŸ¿ è¦³ãŸã„', value: 'want_to_watch' },
              { name: 'ğŸ¯ äºˆå®šä¸­', value: 'planned' },
              { name: 'ğŸ˜… ã‚¹ã‚­ãƒƒãƒ—/è¦‹é€ƒã—', value: 'skipped' }
            ))),

  // ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå‡¦ç†ï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«å§”è­²ï¼‰
  async execute(interaction) {
    throw new Error('ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§å‡¦ç†ã•ã‚Œã¾ã™');
  },

  // ã‚³ãƒãƒ³ãƒ‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  category: 'utility',
  permissions: [],
  cooldown: 2,
  
  // ä½¿ç”¨ä¾‹
  examples: [
    '/search book keyword:JavaScript',
    '/search movie keyword:ã‚¢ãƒ™ãƒ³ã‚¸ãƒ£ãƒ¼ã‚º',
    '/search activity keyword:é‹å‹•',
    '/search all keyword:å­¦ç¿’',
    '/search status category:æœ¬ status:èª­æ›¸ä¸­'
  ],

  // ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
  help: {
    description: 'ç™»éŒ²æ¸ˆã¿ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§çµã‚Šè¾¼ã¿æ¤œç´¢ãŒã§ãã¾ã™ã€‚',
    usage: 'ä»¥ä¸‹ã®æ¤œç´¢æ–¹æ³•ãŒåˆ©ç”¨ã§ãã¾ã™ï¼š',
    subcommands: {
      book: 'æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«ã€ä½œè€…ã€å‚™è€ƒã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã—ã¾ã™',
      movie: 'æ˜ ç”»ã®ã‚¿ã‚¤ãƒˆãƒ«ã€å‚™è€ƒã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã—ã¾ã™',
      activity: 'æ´»å‹•å†…å®¹ã€å‚™è€ƒã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã—ã¾ã™',
      all: 'å…¨ã‚«ãƒ†ã‚´ãƒªã‚’æ¨ªæ–­ã—ã¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã—ã¾ã™',
      status: 'ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¾ã™'
    },
    searchTips: [
      'ğŸ”¤ éƒ¨åˆ†ä¸€è‡´ã§æ¤œç´¢ã•ã‚Œã‚‹ãŸã‚ã€çŸ­ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§ã‚‚æœ‰åŠ¹ã§ã™',
      'ğŸ“ ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠãƒ»æ¼¢å­—ã™ã¹ã¦ã«å¯¾å¿œã—ã¦ã„ã¾ã™',
      'ğŸ¯ è¤‡æ•°ã®è¨€è‘‰ã‚’å«ã‚€å ´åˆã¯ã€ã‚¹ãƒšãƒ¼ã‚¹ã§åŒºåˆ‡ã£ã¦æ¤œç´¢',
      'ğŸ“Š ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ¤œç´¢ã§é€²æ—ç®¡ç†ãŒã—ã‚„ã™ããªã‚Šã¾ã™'
    ],
    examples_detailed: {
      keyword_search: [
        'ã‚¿ã‚¤ãƒˆãƒ«: "ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹" â†’ ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹é–¢é€£ã®æœ¬ã‚’æ¤œç´¢',
        'ä½œè€…: "æ‘ä¸Šæ˜¥æ¨¹" â†’ æ‘ä¸Šæ˜¥æ¨¹ã®ä½œå“ã‚’æ¤œç´¢',
        'ã‚¸ãƒ£ãƒ³ãƒ«: "ãƒŸã‚¹ãƒ†ãƒªãƒ¼" â†’ ãƒŸã‚¹ãƒ†ãƒªãƒ¼é–¢é€£ä½œå“ã‚’æ¤œç´¢'
      ],
      status_search: [
        'èª­æ›¸ä¸­ã®æœ¬ã ã‘ã‚’ç¢ºèªã—ãŸã„æ™‚',
        'è¦³ãŸã„æ˜ ç”»ãƒªã‚¹ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã„æ™‚',
        'å®Œäº†æ¸ˆã¿ã®æ´»å‹•ã‚’æŒ¯ã‚Šè¿”ã‚ŠãŸã„æ™‚'
      ]
    }
  }
};

```

### commands/movie.js

```
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('movie')
    .setDescription('ğŸ¬ æ˜ ç”»ã®ç®¡ç† - æ˜ ç”»ãƒ©ã‚¤ãƒ•ã‚’ã‚µãƒãƒ¼ãƒˆ')
    .addSubcommand(subcommand =>
      subcommand
        .setName('add')
        .setDescription('ğŸ¬ æ–°ã—ã„æ˜ ç”»ã‚’è¿½åŠ ')
        .addStringOption(option =>
          option
            .setName('title')
            .setDescription('æ˜ ç”»ã®ã‚¿ã‚¤ãƒˆãƒ«')
            .setRequired(true))
        .addStringOption(option =>
          option
            .setName('memo')
            .setDescription('å‚™è€ƒãƒ»ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰')
            .setRequired(false)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('watch')
        .setDescription('âœ… æ˜ ç”»ã‚’è¦–è´å®Œäº†')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('è¦–è´ã—ãŸæ˜ ç”»ã®ID')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('skip')
        .setDescription('ğŸ˜… æ˜ ç”»ã‚’è¦‹é€ƒã—ãƒ»ã‚¹ã‚­ãƒƒãƒ—')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('è¦‹é€ƒã—ãŸæ˜ ç”»ã®ID')
            .setRequired(true)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('list')
        .setDescription('ğŸ¬ ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å…¨ã¦ã®æ˜ ç”»ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('watchlist')
        .setDescription('ğŸ¿ è¦³ãŸã„æ˜ ç”»ä¸€è¦§ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('watched')
        .setDescription('âœ… è¦–è´æ¸ˆã¿æ˜ ç”»ä¸€è¦§ã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('info')
        .setDescription('ğŸ“„ ç‰¹å®šã®æ˜ ç”»ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º')
        .addIntegerOption(option =>
          option
            .setName('id')
            .setDescription('è©³ç´°ã‚’è¦‹ãŸã„æ˜ ç”»ã®ID')
            .setRequired(true))),

  // ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå‡¦ç†ï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«å§”è­²ï¼‰
  async execute(interaction) {
    throw new Error('ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§å‡¦ç†ã•ã‚Œã¾ã™');
  },

  // ã‚³ãƒãƒ³ãƒ‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  category: 'management',
  permissions: [],
  cooldown: 3,
  
  // ä½¿ç”¨ä¾‹
  examples: [
    '/movie add title:å›ã®åã¯ã€‚',
    '/movie add title:ã‚¢ãƒ™ãƒ³ã‚¸ãƒ£ãƒ¼ã‚º memo:ãƒãƒ¼ãƒ™ãƒ«æ˜ ç”»',
    '/movie watch id:1',
    '/movie skip id:2',
    '/movie list',
    '/movie watchlist',
    '/movie watched',
    '/movie info id:1'
  ],

  // ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
  help: {
    description: 'æ˜ ç”»ã®ç®¡ç†æ©Ÿèƒ½ã§ã™ã€‚è¦³ãŸã„æ˜ ç”»ãƒªã‚¹ãƒˆã®ç®¡ç†ã¨è¦–è´è¨˜éŒ²ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚',
    usage: 'ä»¥ä¸‹ã®ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ãŒåˆ©ç”¨ã§ãã¾ã™ï¼š',
    subcommands: {
      add: 'æ–°ã—ã„æ˜ ç”»ã‚’è¦³ãŸã„ãƒªã‚¹ãƒˆã«ç™»éŒ²ã—ã¾ã™ã€‚',
      watch: 'æ˜ ç”»ã‚’è¦–è´å®Œäº†ã—ã€è¦–è´æ¸ˆã¿ãƒªã‚¹ãƒˆã«ç§»å‹•ã—ã¾ã™ã€‚',
      skip: 'æ˜ ç”»ã‚’è¦‹é€ƒã—ãƒ»ã‚¹ã‚­ãƒƒãƒ—ã¨ã—ã¦ãƒãƒ¼ã‚¯ã—ã¾ã™ã€‚',
      list: 'ã™ã¹ã¦ã®æ˜ ç”»ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ã«è¡¨ç¤ºã—ã¾ã™ã€‚',
      watchlist: 'è¦³ãŸã„æ˜ ç”»ã®ã¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚',
      watched: 'è¦–è´æ¸ˆã¿ã®æ˜ ç”»ã®ã¿ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚',
      info: 'ç‰¹å®šã®æ˜ ç”»ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚'
    },
    tips: [
      'ğŸ“ æ˜ ç”»ã®æ„Ÿæƒ³ã¯ /report movie ã‚³ãƒãƒ³ãƒ‰ã§è¨˜éŒ²ã§ãã¾ã™',
      'ğŸ” æ˜ ç”»ã®æ¤œç´¢ã¯ /search movie ã‚³ãƒãƒ³ãƒ‰ãŒä¾¿åˆ©ã§ã™',
      'ğŸ“Š è¦–è´çµ±è¨ˆã¯ /stats ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã¾ã™'
    ]
  }
};

```

### commands/stats.js

```
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('stats')
    .setDescription('ğŸ“Š çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤º - æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã®åˆ†æ')
    .addSubcommand(subcommand =>
      subcommand
        .setName('summary')
        .setDescription('ğŸ“Š å…¨ä½“çµ±è¨ˆã‚µãƒãƒªãƒ¼'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('weekly')
        .setDescription('ğŸ“… ä»Šé€±ã®æ´»å‹•çµ±è¨ˆ'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('monthly')
        .setDescription('ğŸ—“ï¸ ä»Šæœˆã®æ´»å‹•çµ±è¨ˆ'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('books')
        .setDescription('ğŸ“š èª­æ›¸çµ±è¨ˆè©³ç´°'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('current')
        .setDescription('âš¡ ç¾åœ¨ã®é€²è¡ŒçŠ¶æ³'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('trends')
        .setDescription('ğŸ“ˆ æ´»å‹•ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('goals')
        .setDescription('ğŸ¯ ç›®æ¨™é”æˆçŠ¶æ³'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('compare')
        .setDescription('ğŸ“Š æœŸé–“æ¯”è¼ƒçµ±è¨ˆ')
        .addStringOption(option =>
          option
            .setName('period')
            .setDescription('æ¯”è¼ƒæœŸé–“')
            .setRequired(true)
            .addChoices(
              { name: 'ä»Šé€± vs å…ˆé€±', value: 'week' },
              { name: 'ä»Šæœˆ vs å…ˆæœˆ', value: 'month' },
              { name: 'ä»Šå¹´ vs æ˜¨å¹´', value: 'year' }
            ))),

  // ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œå‡¦ç†ï¼ˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã«å§”è­²ï¼‰
  async execute(interaction) {
    throw new Error('ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã§å‡¦ç†ã•ã‚Œã¾ã™');
  },

  // ã‚³ãƒãƒ³ãƒ‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  category: 'analytics',
  permissions: [],
  cooldown: 5,
  
  // ä½¿ç”¨ä¾‹
  examples: [
    '/stats summary',
    '/stats weekly',
    '/stats monthly',
    '/stats books',
    '/stats current'
  ],

  // ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
  help: {
    description: 'æ´»å‹•ãƒ‡ãƒ¼ã‚¿ã®çµ±è¨ˆæƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚é€²æ—ã®å¯è¦–åŒ–ã¨åˆ†æã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚',
    usage: 'ä»¥ä¸‹ã®çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆãŒåˆ©ç”¨ã§ãã¾ã™ï¼š',
    subcommands: {
      summary: 'æœ¬ãƒ»æ˜ ç”»ãƒ»æ´»å‹•ã®å…¨ä½“çš„ãªçµ±è¨ˆã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º',
      weekly: 'ä»Šé€±å®Œäº†ã—ãŸã‚¢ã‚¤ãƒ†ãƒ æ•°ã¨æ´»å‹•çŠ¶æ³ã‚’è¡¨ç¤º',
      monthly: 'ä»Šæœˆã®å®Ÿç¸¾ã¨é”æˆçŠ¶æ³ã‚’è©³ç´°è¡¨ç¤º',
      books: 'èª­æ›¸ã«ç‰¹åŒ–ã—ãŸè©³ç´°çµ±è¨ˆï¼ˆèª­äº†æ•°ã€ãƒšãƒ¼ã‚¹ã€åˆ†æï¼‰',
      current: 'ç¾åœ¨é€²è¡Œä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ã¨é€²æ—çŠ¶æ³'
    },
    metrics: [
      'ğŸ“š èª­æ›¸: èª­äº†å†Šæ•°ã€èª­æ›¸ãƒšãƒ¼ã‚¹ã€å®Œèª­ç‡',
      'ğŸ¬ æ˜ ç”»: è¦–è´æœ¬æ•°ã€å®Œäº†ç‡',
      'ğŸ¯ æ´»å‹•: å®Œäº†ç‡ã€ç¶™ç¶šæ€§ã€é”æˆåº¦',
      'ğŸ“ è¨˜éŒ²: æ—¥å ±æŠ•ç¨¿é »åº¦ã€è¨˜éŒ²ç¶™ç¶šæ—¥æ•°'
    ],
    benefits: [
      'ğŸ“ˆ é€²æ—ã®å¯è¦–åŒ–ã§ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³å‘ä¸Š',
      'ğŸ¯ é”æˆåº¦ã®æ˜ç¢ºåŒ–',
      'ğŸ“Š æ”¹å–„ç‚¹ã®ç™ºè¦‹',
      'ğŸ† é”æˆæ„Ÿã®å¢—å¼·ã¨ç¶™ç¶šæ„æ¬²ã®å‘ä¸Š'
    ]
  }
};

```

### commands/goals.js

```
const { SlashCommandBuilder } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('goals')
    .setDescription('ğŸ¯ å€‹äººç›®æ¨™ã®è¨­å®šãƒ»ç®¡ç†')
    .addSubcommand(subcommand =>
      subcommand
        .setName('show')
        .setDescription('ğŸ“Š ç¾åœ¨ã®ç›®æ¨™è¨­å®šã‚’è¡¨ç¤º'))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('set')
        .setDescription('âš™ï¸ ç›®æ¨™ã‚’è¨­å®š')
        .addStringOption(option =>
          option
            .setName('period')
            .setDescription('æœŸé–“')
            .setRequired(true)
            .addChoices(
              { name: 'é€±æ¬¡ç›®æ¨™', value: 'weekly' },
              { name: 'æœˆæ¬¡ç›®æ¨™', value: 'monthly' }
            ))
        .addStringOption(option =>
          option
            .setName('category')
            .setDescription('ã‚«ãƒ†ã‚´ãƒª')
            .setRequired(true)
            .addChoices(
              { name: 'ğŸ“š æœ¬', value: 'books' },
              { name: 'ğŸ¬ æ˜ ç”»', value: 'movies' },
              { name: 'ğŸ¯ æ´»å‹•', value: 'activities' },
              { name: 'ğŸ“ æ—¥å ±', value: 'reports' }
            ))
        .addIntegerOption(option =>
          option
            .setName('target')
            .setDescription('ç›®æ¨™æ•°å€¤')
            .setRequired(true)
            .setMinValue(0)
            .setMaxValue(100)))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('reset')
        .setDescription('ğŸ”„ ç›®æ¨™ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™')
        .addStringOption(option =>
          option
            .setName('period')
            .setDescription('ãƒªã‚»ãƒƒãƒˆã™ã‚‹æœŸé–“ï¼ˆçœç•¥æ™‚ã¯å…¨ã¦ï¼‰')
            .setRequired(false)
            .addChoices(
              { name: 'é€±æ¬¡ç›®æ¨™', value: 'weekly' },
              { name: 'æœˆæ¬¡ç›®æ¨™', value: 'monthly' },
              { name: 'å…¨ã¦ã®ç›®æ¨™', value: 'all' }
            )))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('quick')
        .setDescription('âš¡ ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šï¼ˆã‚ˆãä½¿ã‚ã‚Œã‚‹çµ„ã¿åˆã‚ã›ï¼‰')
        .addStringOption(option =>
          option
            .setName('preset')
            .setDescription('ãƒ—ãƒªã‚»ãƒƒãƒˆ')
            .setRequired(true)
            .addChoices(
              { name: 'ğŸŒ± åˆå¿ƒè€…å‘ã‘', value: 'beginner' },
              { name: 'ğŸ“ˆ æ¨™æº–', value: 'standard' },
              { name: 'ğŸ”¥ ãƒãƒ£ãƒ¬ãƒ³ã‚¸', value: 'challenge' },
              { name: 'ğŸ† ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆ', value: 'expert' }
            )))
    
    .addSubcommand(subcommand =>
      subcommand
        .setName('progress')
        .setDescription('ğŸ“Š ç›®æ¨™é”æˆé€²æ—ã‚’è©³ç´°è¡¨ç¤º')),

  // å®Ÿè¡Œãƒ¡ã‚½ãƒƒãƒ‰
  async execute(interaction) {
    console.log(`[DEBUG] goals ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ: ${interaction.options.getSubcommand()}`);
    
    try {
      // goalsHandlerã«å‡¦ç†ã‚’å§”è­²
      const goalsHandler = require('../handlers/goalsHandler');
      return await goalsHandler.execute(interaction);
    } catch (error) {
      console.error('[ERROR] goals ã‚³ãƒãƒ³ãƒ‰ã§ã‚¨ãƒ©ãƒ¼:', error);
      
      // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
      const errorMessage = 'âŒ ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
      
      if (interaction.deferred) {
        return await interaction.editReply(errorMessage);
      } else {
        return await interaction.reply({ content: errorMessage, ephemeral: true });
      }
    }
  },

  // ã‚³ãƒãƒ³ãƒ‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  category: 'settings',
  permissions: [],
  cooldown: 3,
  
  // ä½¿ç”¨ä¾‹
  examples: [
    '/goals show',
    '/goals set period:é€±æ¬¡ç›®æ¨™ category:æœ¬ target:3',
    '/goals quick preset:ãƒãƒ£ãƒ¬ãƒ³ã‚¸',
    '/goals reset period:é€±æ¬¡ç›®æ¨™',
    '/goals progress'
  ],

  // ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
  help: {
    description: 'å€‹äººçš„ãªç›®æ¨™ã‚’è¨­å®šãƒ»ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã«åˆã‚ã›ãŸç›®æ¨™è¨­å®šãŒå¯èƒ½ã§ã™ã€‚',
    usage: 'ä»¥ä¸‹ã®ç›®æ¨™ç®¡ç†æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ï¼š',
    subcommands: {
      show: 'ç¾åœ¨è¨­å®šã•ã‚Œã¦ã„ã‚‹ç›®æ¨™ã‚’è¡¨ç¤ºã—ã¾ã™',
      set: 'å€‹åˆ¥ã«ç›®æ¨™æ•°å€¤ã‚’è¨­å®šã—ã¾ã™',
      reset: 'ç›®æ¨™ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã—ã¾ã™',
      quick: 'ã‚ã‚‰ã‹ã˜ã‚ç”¨æ„ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆã§ä¸€æ‹¬è¨­å®š',
      progress: 'ç›®æ¨™é”æˆçŠ¶æ³ã®è©³ç´°åˆ†æã‚’è¡¨ç¤º'
    },
    presets: {
      beginner: 'é€±: æœ¬1å†Š, æ˜ ç”»2æœ¬, æ´»å‹•3ä»¶, æ—¥å ±5ä»¶',
      standard: 'é€±: æœ¬2å†Š, æ˜ ç”»3æœ¬, æ´»å‹•5ä»¶, æ—¥å ±7ä»¶',
      challenge: 'é€±: æœ¬3å†Š, æ˜ ç”»4æœ¬, æ´»å‹•7ä»¶, æ—¥å ±10ä»¶',
      expert: 'é€±: æœ¬4å†Š, æ˜ ç”»5æœ¬, æ´»å‹•10ä»¶, æ—¥å ±14ä»¶'
    },
    tips: [
      'ğŸ¯ ç¾å®Ÿçš„ãªç›®æ¨™è¨­å®šãŒç¶™ç¶šã®éµã§ã™',
      'ğŸ“ˆ æ®µéšçš„ã«ç›®æ¨™ã‚’ä¸Šã’ã¦ã„ãã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™',
      'ğŸ“Š é€²æ—ã‚’å®šæœŸçš„ã«ç¢ºèªã—ã¦èª¿æ•´ã—ã¾ã—ã‚‡ã†',
      'ğŸ’ª é”æˆã§ããªãã¦ã‚‚è½ã¡è¾¼ã¾ãšã€æ¬¡ã«æ´»ã‹ã—ã¾ã—ã‚‡ã†'
    ]
  }
};

```

### devug_test.js

```
// debug_test.js - Google Sheetsã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
const GoogleSheetsService = require('./services/googleSheets');

async function testGoogleSheetsService() {
  console.log('=== Google Sheets Service ãƒ†ã‚¹ãƒˆé–‹å§‹ ===');
  
  try {
    // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
    const sheetsService = new GoogleSheetsService();
    console.log('âœ… GoogleSheetsService ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ');
    console.log('åˆ©ç”¨å¯èƒ½ãªãƒ¡ã‚½ãƒƒãƒ‰:', Object.getOwnPropertyNames(Object.getPrototypeOf(sheetsService)));
    
    // ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    console.log('\n--- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ ---');
    const health = await sheetsService.healthCheck();
    console.log('ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯çµæœ:', health);
    
    // getData ãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ç¢ºèª
    console.log('\n--- ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª ---');
    console.log('getData ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨:', typeof sheetsService.getData === 'function');
    console.log('updateData ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨:', typeof sheetsService.updateData === 'function');
    console.log('appendData ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨:', typeof sheetsService.appendData === 'function');
    
    // ç°¡å˜ãªãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
    console.log('\n--- ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ ---');
    try {
      const testData = await sheetsService.getData('books_master!A1:A5');
      console.log('âœ… getData ãƒ†ã‚¹ãƒˆæˆåŠŸ, ãƒ‡ãƒ¼ã‚¿:', testData?.length || 0, 'è¡Œ');
    } catch (error) {
      console.log('âŒ getData ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼:', error.message);
    }
    
  } catch (error) {
    console.error('âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—:', error.message);
    console.error('ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹:', error.stack);
  }
  
  console.log('\n=== ãƒ†ã‚¹ãƒˆå®Œäº† ===');
}

// ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
testGoogleSheetsService().catch(console.error);

```

### index.js

```
require('dotenv').config();
const { Client, GatewayIntentBits, REST, Routes } = require('discord.js');
const path = require('path');
const fs = require('fs');

// ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const GoogleSheetsService = require('./services/googleSheets');

class ActivityTrackerBot {
  constructor() {
    console.log('ğŸš€ ActivityTrackerBot v2.0 åˆæœŸåŒ–é–‹å§‹...');
    
    // Discord ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®è¨­å®š
    this.client = new Client({
      intents: [
        GatewayIntentBits.Guilds, 
        GatewayIntentBits.GuildMessages,
        GatewayIntentBits.MessageContent
      ],
      rest: { 
        timeout: 60000, 
        retries: 3 
      }
    });
    
    // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
    this.commands = new Map();
    this.handlers = new Map();
    
    // ã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–
    this.googleSheets = new GoogleSheetsService();
    
    // åˆæœŸåŒ–å‡¦ç†
    this.loadCommands();
    this.loadHandlers();
    this.setupEvents();
    this.setupNotifications();
    this.setupGracefulShutdown();
  }

  loadCommands() {
    console.log('ğŸ“ ã‚³ãƒãƒ³ãƒ‰èª­ã¿è¾¼ã¿ä¸­...');
    
    const commandsPath = path.join(__dirname, 'commands');
    if (!fs.existsSync(commandsPath)) {
      console.log('âš ï¸ commandsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      console.log('ğŸ’¡ commandsãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…ç½®ã—ã¦ãã ã•ã„');
      return;
    }
    
    const commandFiles = fs.readdirSync(commandsPath).filter(file => file.endsWith('.js'));
    
    if (commandFiles.length === 0) {
      console.log('âš ï¸ ã‚³ãƒãƒ³ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      return;
    }
    
    let loadedCount = 0;
    for (const file of commandFiles) {
      try {
        const command = require(path.join(commandsPath, file));
        
        // ã‚³ãƒãƒ³ãƒ‰ã®æ§‹é€ ãƒã‚§ãƒƒã‚¯
        if (!command.data || !command.data.name) {
          console.error(`âŒ ${file}: ç„¡åŠ¹ãªã‚³ãƒãƒ³ãƒ‰æ§‹é€ `);
          continue;
        }
        
        this.commands.set(command.data.name, command);
        console.log(`âœ… ã‚³ãƒãƒ³ãƒ‰èª­ã¿è¾¼ã¿: ${command.data.name}`);
        loadedCount++;
      } catch (error) {
        console.error(`âŒ ${file} èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:`, error.message);
      }
    }
    
    console.log(`ğŸ“ ã‚³ãƒãƒ³ãƒ‰èª­ã¿è¾¼ã¿å®Œäº†: ${loadedCount}/${commandFiles.length}`);
  }

  loadHandlers() {
    console.log('ğŸ”§ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼èª­ã¿è¾¼ã¿ä¸­...');
    
    const handlersPath = path.join(__dirname, 'handlers');
    if (!fs.existsSync(handlersPath)) {
      console.log('âš ï¸ handlersãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      return;
    }
    
    const handlerFiles = fs.readdirSync(handlersPath).filter(file => file.endsWith('.js'));
    
    if (handlerFiles.length === 0) {
      console.log('âš ï¸ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      return;
    }
    
    let loadedCount = 0;
    for (const file of handlerFiles) {
      try {
        const handler = require(path.join(handlersPath, file));
        
        // ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®æ§‹é€ ãƒã‚§ãƒƒã‚¯
        if (!handler.execute || typeof handler.execute !== 'function') {
          console.error(`âŒ ${file}: executeãƒ¡ã‚½ãƒƒãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
          continue;
        }
        
        const handlerName = path.basename(file, '.js').replace('Handler', '');
        this.handlers.set(handlerName, handler);
        console.log(`âœ… ãƒãƒ³ãƒ‰ãƒ©ãƒ¼èª­ã¿è¾¼ã¿: ${handlerName}`);
        loadedCount++;
      } catch (error) {
        console.error(`âŒ ${file} èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:`, error.message);
      }
    }
    
    console.log(`ğŸ”§ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼èª­ã¿è¾¼ã¿å®Œäº†: ${loadedCount}/${handlerFiles.length}`);
  }

  async deployCommands() {
    if (this.commands.size === 0) {
      console.log('âš ï¸ ç™»éŒ²ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');
      return;
    }
    
    const rest = new REST({ version: '10' }).setToken(process.env.DISCORD_TOKEN);
    
    try {
      console.log('ğŸ”„ Discord APIã«ã‚³ãƒãƒ³ãƒ‰ç™»éŒ²ä¸­...');
      
      const commandsData = Array.from(this.commands.values()).map(cmd => cmd.data.toJSON());
      
      await rest.put(
        Routes.applicationCommands(this.client.user.id),
        { body: commandsData }
      );
      
      console.log(`âœ… ${commandsData.length}å€‹ã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã‚’ç™»éŒ²ã—ã¾ã—ãŸ`);
      
      // ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ä¸€è¦§ã‚’è¡¨ç¤º
      const commandNames = commandsData.map(cmd => cmd.name).join(', ');
      console.log(`ğŸ“‹ ç™»éŒ²ã‚³ãƒãƒ³ãƒ‰: ${commandNames}`);
      
    } catch (error) {
      console.error('âŒ ã‚³ãƒãƒ³ãƒ‰ç™»éŒ²å¤±æ•—:', error);
      if (error.code === 50001) {
        console.error('ğŸ’¡ Botæ¨©é™ãŒä¸è¶³ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™');
      }
    }
  }

  setupEvents() {
    // Botæº–å‚™å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
    this.client.once('ready', async () => {
      console.log(`âœ… ${this.client.user.tag} ãŒã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã«ãªã‚Šã¾ã—ãŸï¼`);
      console.log(`ğŸ›ï¸ ${this.client.guilds.cache.size}å€‹ã®ã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ä¸­`);
      console.log(`ğŸ‘¥ ${this.client.users.cache.size}äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚µãƒ¼ãƒ“ã‚¹æä¾›ä¸­`);
      
      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®è¨­å®š
      this.client.user.setActivity('æ´»å‹•ã‚’è¿½è·¡ä¸­ ğŸ“Š', { type: 'WATCHING' });
      
      await this.deployCommands();
      
      // Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆ
      const healthCheck = await this.googleSheets.healthCheck();
      console.log(`ğŸ“Š Google Sheets: ${healthCheck.status === 'healthy' ? 'âœ… æ¥ç¶šOK' : 'âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼'}`);
      
      console.log('ğŸ‰ BotåˆæœŸåŒ–å®Œäº†ï¼æº–å‚™OKï¼');
    });

    // ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
    this.client.on('interactionCreate', async interaction => {
      if (!interaction.isChatInputCommand()) return;

      const startTime = Date.now();
      console.log(`ğŸ“¨ [${interaction.commandName}] by ${interaction.user.tag} in ${interaction.guild?.name || 'DM'}`);

      try {
        // ãƒªãƒ—ãƒ©ã‚¤ã®æº–å‚™
        await interaction.deferReply();

        // ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å–å¾—
        const handler = this.handlers.get(interaction.commandName);
        if (!handler) {
          await interaction.editReply({
            content: 'âŒ ã“ã®ã‚³ãƒãƒ³ãƒ‰ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚',
            ephemeral: true
          });
          return;
        }

        // ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å®Ÿè¡Œ
        await handler.execute(interaction);
        
        const executionTime = Date.now() - startTime;
        console.log(`âœ… [${interaction.commandName}] å®Œäº† (${executionTime}ms)`);

      } catch (error) {
        const executionTime = Date.now() - startTime;
        console.error(`âŒ [${interaction.commandName}] ã‚¨ãƒ©ãƒ¼ (${executionTime}ms):`, error);

        // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®è©³ç´°åŒ–
        this.logError(error, interaction);

        try {
          const errorMessage = process.env.NODE_ENV === 'development' 
            ? `âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`
            : 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚';
            
          if (interaction.deferred) {
            await interaction.editReply(errorMessage);
          } else {
            await interaction.reply({ content: errorMessage, ephemeral: true });
          }
        } catch (replyError) {
          console.error('âŒ ã‚¨ãƒ©ãƒ¼å¿œç­”é€ä¿¡å¤±æ•—:', replyError);
        }
      }
    });

    // ã‚¨ãƒ©ãƒ¼å‡¦ç†
    this.client.on('error', error => {
      console.error('ğŸš¨ Discord.js ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ©ãƒ¼:', error);
    });

    this.client.on('warn', info => {
      console.warn('âš ï¸ Discord.js è­¦å‘Š:', info);
    });

    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å‡¦ç†
    this.client.on('rateLimit', rateLimitInfo => {
      console.warn('â° ãƒ¬ãƒ¼ãƒˆåˆ¶é™:', rateLimitInfo);
    });

    // å†æ¥ç¶šã‚¤ãƒ™ãƒ³ãƒˆ
    this.client.on('reconnecting', () => {
      console.log('ğŸ”„ Discord ã«å†æ¥ç¶šä¸­...');
    });

    this.client.on('resume', () => {
      console.log('âœ… Discord æ¥ç¶šå¾©æ—§');
    });
  }

  setupNotifications() {
    // é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã®åˆæœŸåŒ–ï¼ˆé€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰
    try {
      const NotificationService = require('./services/notifications');
      this.notifications = new NotificationService(this.client, this.googleSheets);
      console.log('ğŸ“¢ é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–å®Œäº†');
    } catch (error) {
      console.log('ğŸ’¡ é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã¯å¾Œã§å®Ÿè£…äºˆå®š');
    }
  }

  setupGracefulShutdown() {
    // Graceful shutdown ã®è¨­å®š
    const shutdown = async (signal) => {
      console.log(`\nğŸ›‘ ${signal} ã‚’å—ä¿¡ã—ã¾ã—ãŸã€‚å®‰å…¨ã«ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ä¸­...`);
      
      try {
        // é€²è¡Œä¸­ã®æ“ä½œã®å®Œäº†ã‚’å¾…æ©Ÿ
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Discord ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®çµ‚äº†
        this.client.destroy();
        console.log('âœ… Discord æ¥ç¶šã‚’çµ‚äº†ã—ã¾ã—ãŸ');
        
        console.log('ğŸ‘‹ ActivityTrackerBot ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³å®Œäº†');
        process.exit(0);
      } catch (error) {
        console.error('âŒ ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
        process.exit(1);
      }
    };

    process.on('SIGTERM', () => shutdown('SIGTERM'));
    process.on('SIGINT', () => shutdown('SIGINT'));
    
    // æœªå‡¦ç†ã®Promiseæ‹’å¦ã‚’ã‚­ãƒ£ãƒƒãƒ
    process.on('unhandledRejection', (error) => {
      console.error('ğŸš¨ æœªå‡¦ç†ã®Promiseæ‹’å¦:', error);
    });

    process.on('uncaughtException', (error) => {
      console.error('ğŸš¨ æœªå‡¦ç†ã®ä¾‹å¤–:', error);
      shutdown('UNCAUGHT_EXCEPTION');
    });
  }

  logError(error, interaction) {
    const errorInfo = {
      timestamp: new Date().toISOString(),
      command: interaction.commandName,
      user: interaction.user.tag,
      guild: interaction.guild?.name || 'DM',
      error: {
        name: error.name,
        message: error.message,
        stack: error.stack
      }
    };

    // è©³ç´°ãƒ­ã‚°ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯å¤–éƒ¨ãƒ­ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡ï¼‰
    if (process.env.NODE_ENV === 'development') {
      console.error('ğŸ” è©³ç´°ã‚¨ãƒ©ãƒ¼æƒ…å ±:', JSON.stringify(errorInfo, null, 2));
    }
  }

  // Bot ã®çµ±è¨ˆæƒ…å ±ã‚’å–å¾—
  getStats() {
    return {
      guilds: this.client.guilds.cache.size,
      users: this.client.users.cache.size,
      commands: this.commands.size,
      handlers: this.handlers.size,
      uptime: process.uptime(),
      memoryUsage: process.memoryUsage()
    };
  }

  async start() {
    console.log('ğŸš€ ActivityTrackerBot èµ·å‹•ä¸­...');
    
    // ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯
    if (!process.env.DISCORD_TOKEN) {
      console.error('âŒ DISCORD_TOKEN ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“');
      console.log('ğŸ’¡ .env ãƒ•ã‚¡ã‚¤ãƒ«ã« DISCORD_TOKEN ã‚’è¨­å®šã—ã¦ãã ã•ã„');
      process.exit(1);
    }

    if (!process.env.SPREADSHEET_ID) {
      console.warn('âš ï¸ SPREADSHEET_ID ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚Google Sheetsæ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã¾ã™');
    }

    try {
      await this.client.login(process.env.DISCORD_TOKEN);
    } catch (error) {
      console.error('âŒ Discord ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—:', error);
      
      if (error.code === 'TokenInvalid') {
        console.log('ğŸ’¡ DISCORD_TOKEN ãŒç„¡åŠ¹ã§ã™ã€‚æ­£ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ã¦ãã ã•ã„');
      }
      
      process.exit(1);
    }
  }
}

// ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ
if (require.main === module) {
  console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
  console.log('â•‘        ActivityTrackerBot v2.0      â•‘');
  console.log('â•‘    Discord Activity Management Bot   â•‘');
  console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  
  const bot = new ActivityTrackerBot();
  bot.start();
}

module.exports = ActivityTrackerBot;

```

### utils/helpers.js

```
class Helpers {
  // æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  static formatDate(date) {
    return new Date(date).toLocaleDateString('ja-JP', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit'
    });
  }

  // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  static formatDateTime(date) {
    return new Date(date).toLocaleString('ja-JP', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit'
    });
  }

  // ãƒ©ãƒ³ãƒ€ãƒ IDç”Ÿæˆ
  static generateId() {
    return Math.floor(Math.random() * 1000) + Date.now() % 1000;
  }

  // ãƒ†ã‚­ã‚¹ãƒˆåˆ‡ã‚Šè©°ã‚
  static truncateText(text, maxLength = 100) {
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength - 3) + '...';
  }

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹çµµæ–‡å­—å–å¾—
  static getStatusEmoji(category, status) {
    const emojis = {
      book: {
        want_to_buy: 'ğŸ›’',
        want_to_read: 'ğŸ“‹',
        reading: 'ğŸ“–',
        finished: 'âœ…',
        abandoned: 'âŒ'
      },
      movie: {
        want_to_watch: 'ğŸ¬',
        watched: 'âœ…',
        missed: 'ğŸ˜…'
      },
      activity: {
        planned: 'ğŸ¯',
        done: 'âœ…',
        skipped: 'ğŸ˜…'
      }
    };

    return emojis[category]?.[status] || 'â“';
  }

  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ†ã‚­ã‚¹ãƒˆå–å¾—
  static getStatusText(category, status) {
    const texts = {
      book: {
        want_to_buy: 'è²·ã„ãŸã„',
        want_to_read: 'ç©èª­',
        reading: 'èª­æ›¸ä¸­',
        finished: 'èª­äº†',
        abandoned: 'ä¸­æ–­'
      },
      movie: {
        want_to_watch: 'è¦³ãŸã„',
        watched: 'è¦–è´æ¸ˆã¿',
        missed: 'è¦‹é€ƒã—'
      },
      activity: {
        planned: 'äºˆå®š',
        done: 'å®Œäº†',
        skipped: 'ã‚¹ã‚­ãƒƒãƒ—'
      }
    };

    return texts[category]?.[status] || status;
  }

  // ã‚«ãƒ†ã‚´ãƒªçµµæ–‡å­—å–å¾—
  static getCategoryEmoji(category) {
    const emojis = {
      book: 'ğŸ“š',
      movie: 'ğŸ¬',
      activity: 'ğŸ¯'
    };

    return emojis[category] || 'â“';
  }

  // ã‚«ãƒ†ã‚´ãƒªåå–å¾—
  static getCategoryName(category) {
    const names = {
      book: 'æœ¬',
      movie: 'æ˜ ç”»',
      activity: 'æ´»å‹•'
    };

    return names[category] || category;
  }

  // é…åˆ—ã‚’å®‰å…¨ã«å–å¾—
  static safeArray(arr) {
    return Array.isArray(arr) ? arr : [];
  }

  // æ–‡å­—åˆ—ã‚’å®‰å…¨ã«å–å¾—
  static safeString(str) {
    return typeof str === 'string' ? str : '';
  }

  // æ•°å€¤ã‚’å®‰å…¨ã«å–å¾—
  static safeNumber(num) {
    return typeof num === 'number' && !isNaN(num) ? num : 0;
  }

  // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ·±ã„ã‚³ãƒ”ãƒ¼
  static deepCopy(obj) {
    return JSON.parse(JSON.stringify(obj));
  }

  // é€±ã®é–‹å§‹æ—¥ã‚’å–å¾—
  static getWeekStart(date = new Date()) {
    const d = new Date(date);
    const day = d.getDay();
    const diff = d.getDate() - day;
    return new Date(d.setDate(diff));
  }

  // æœˆã®é–‹å§‹æ—¥ã‚’å–å¾—
  static getMonthStart(date = new Date()) {
    return new Date(date.getFullYear(), date.getMonth(), 1);
  }

  // æ–‡å­—åˆ—ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  static highlightText(text, keyword) {
    if (!keyword) return text;
    const regex = new RegExp(`(${keyword})`, 'gi');
    return text.replace(regex, '**$1**');
  }
}

module.exports = Helpers;

```

### utils/embedUtils.js

```
const { EmbedBuilder } = require('discord.js');

/**
 * Embedä½œæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */

/**
 * æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Embedä½œæˆ
 */
function createSuccessEmbed(title, description) {
  return new EmbedBuilder()
    .setColor('#2ecc71')
    .setTitle(title)
    .setDescription(description)
    .setTimestamp();
}

/**
 * ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Embedä½œæˆ
 */
function createErrorEmbed(title, description) {
  return new EmbedBuilder()
    .setColor('#e74c3c')
    .setTitle(title)
    .setDescription(description)
    .setTimestamp();
}

/**
 * æƒ…å ±ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Embedä½œæˆ
 */
function createInfoEmbed(title, description) {
  return new EmbedBuilder()
    .setColor('#3498db')
    .setTitle(title)
    .setDescription(description)
    .setTimestamp();
}

/**
 * è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®Embedä½œæˆ
 */
function createWarningEmbed(title, description) {
  return new EmbedBuilder()
    .setColor('#f39c12')
    .setTitle(title)
    .setDescription(description)
    .setTimestamp();
}

/**
 * ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ã®Embedä½œæˆ
 */
function createCustomEmbed(title, description, color = '#95a5a6') {
  return new EmbedBuilder()
    .setColor(color)
    .setTitle(title)
    .setDescription(description)
    .setTimestamp();
}

module.exports = {
  createSuccessEmbed,
  createErrorEmbed,
  createInfoEmbed,
  createWarningEmbed,
  createCustomEmbed
};

```

### utils/errorHandler.js

```
class ErrorHandler {
  static async handleInteractionError(interaction, error) {
    console.error('âŒ Interaction Error:', error);
    console.error('âŒ Stack:', error.stack);
    
    const errorMessage = `ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`;
    
    try {
      if (interaction.deferred && !interaction.replied) {
        await interaction.editReply({ 
          content: errorMessage,
          ephemeral: true 
        });
      } else if (!interaction.replied) {
        await interaction.reply({ 
          content: errorMessage, 
          ephemeral: true 
        });
      }
    } catch (replyError) {
      console.error('âŒ ã‚¨ãƒ©ãƒ¼å¿œç­”å¤±æ•—:', replyError);
    }
  }

  static async handleCommandError(commandName, error) {
    console.error(`âŒ Command Error [${commandName}]:`, error);
    console.error('âŒ Stack:', error.stack);
    
    // ã“ã“ã§ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜éŒ²ã—ãŸã‚Šã€ç®¡ç†è€…ã«é€šçŸ¥ã—ãŸã‚Šã§ãã¾ã™
    const logger = require('./logger');
    logger.error(`Command ${commandName} failed`, { 
      error: error.message, 
      stack: error.stack 
    });
  }

  static logError(context, error, metadata = {}) {
    console.error(`âŒ ${context}:`, error);
    
    const logger = require('./logger');
    logger.error(context, { 
      error: error.message, 
      stack: error.stack,
      ...metadata 
    });
  }
}

module.exports = ErrorHandler;

```

### utils/helper.js

```
// æ—¥ä»˜ãƒ»æ™‚é–“é–¢é€£ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
const DateHelpers = {
  // æ—¥æœ¬æ™‚é–“ã§ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—
  getCurrentDateJST() {
    return new Date().toLocaleDateString('ja-JP', {
      timeZone: 'Asia/Tokyo',
      year: 'numeric',
      month: '2-digit',
      day: '2-digit'
    }).replace(/\//g, '-');
  },

  // æ—¥æœ¬æ™‚é–“ã§ç¾åœ¨ã®æ—¥æ™‚ã‚’å–å¾—
  getCurrentDateTimeJST() {
    return new Date().toLocaleString('ja-JP', {
      timeZone: 'Asia/Tokyo'
    });
  },

  // é€±ã®é–‹å§‹æ—¥ã‚’å–å¾—
  getWeekStart(date = new Date()) {
    const day = date.getDay();
    const diff = date.getDate() - day; // æ—¥æ›œæ—¥ã‚’é€±ã®é–‹å§‹ã¨ã™ã‚‹
    return new Date(date.setDate(diff));
  },

  // æœˆã®é–‹å§‹æ—¥ã‚’å–å¾—
  getMonthStart(date = new Date()) {
    return new Date(date.getFullYear(), date.getMonth(), 1);
  },

  // æ—¥ä»˜ã®å·®åˆ†ã‚’è¨ˆç®—ï¼ˆæ—¥æ•°ï¼‰
  getDaysDifference(date1, date2) {
    const oneDay = 24 * 60 * 60 * 1000;
    return Math.round(Math.abs((date1 - date2) / oneDay));
  },

  // ç›¸å¯¾çš„ãªæ—¥ä»˜è¡¨ç¤º
  getRelativeDateString(date) {
    const now = new Date();
    const diff = this.getDaysDifference(now, date);
    
    if (diff === 0) return 'ä»Šæ—¥';
    if (diff === 1) return 'æ˜¨æ—¥';
    if (diff <= 7) return `${diff}æ—¥å‰`;
    if (diff <= 30) return `${Math.floor(diff / 7)}é€±é–“å‰`;
    if (diff <= 365) return `${Math.floor(diff / 30)}ãƒ¶æœˆå‰`;
    return `${Math.floor(diff / 365)}å¹´å‰`;
  }
};

// æ–‡å­—åˆ—å‡¦ç†ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
const StringHelpers = {
  // æ–‡å­—åˆ—ã‚’æŒ‡å®šé•·ã•ã§åˆ‡ã‚Šè©°ã‚
  truncate(str, length, suffix = '...') {
    if (str.length <= length) return str;
    return str.substring(0, length - suffix.length) + suffix;
  },

  // æ–‡å­—åˆ—ã‚’ã‚¿ã‚¤ãƒˆãƒ«ã‚±ãƒ¼ã‚¹ã«å¤‰æ›
  toTitleCase(str) {
    return str.replace(/\w\S*/g, (txt) => 
      txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
    );
  },

  // æ–‡å­—åˆ—ã‹ã‚‰æ•°å­—ã®ã¿ã‚’æŠ½å‡º
  extractNumbers(str) {
    return str.replace(/\D/g, '');
  },

  // å…¨è§’è‹±æ•°å­—ã‚’åŠè§’ã«å¤‰æ›
  toHalfWidth(str) {
    return str.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, (s) => 
      String.fromCharCode(s.charCodeAt(0) - 0xFEE0)
    );
  },

  // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  highlightKeywords(text, keywords, wrapper = '**') {
    let highlightedText = text;
    
    if (Array.isArray(keywords)) {
      keywords.forEach(keyword => {
        const regex = new RegExp(keyword, 'gi');
        highlightedText = highlightedText.replace(regex, `${wrapper}${keyword}${wrapper}`);
      });
    } else {
      const regex = new RegExp(keywords, 'gi');
      highlightedText = highlightedText.replace(regex, `${wrapper}${keywords}${wrapper}`);
    }
    
    return highlightedText;
  }
};

// æ•°å€¤ãƒ»çµ±è¨ˆå‡¦ç†ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
const NumberHelpers = {
  // æ•°å€¤ã‚’æ—¥æœ¬èªå½¢å¼ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
  formatNumber(num) {
    return new Intl.NumberFormat('ja-JP').format(num);
  },

  // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’è¨ˆç®—
  calculatePercentage(value, total, decimals = 1) {
    if (total === 0) return 0;
    return parseFloat(((value / total) * 100).toFixed(decimals));
  },

  // å¹³å‡å€¤ã‚’è¨ˆç®—
  calculateAverage(numbers) {
    if (numbers.length === 0) return 0;
    const sum = numbers.reduce((acc, num) => acc + num, 0);
    return sum / numbers.length;
  },

  // ä¸­å¤®å€¤ã‚’è¨ˆç®—
  calculateMedian(numbers) {
    if (numbers.length === 0) return 0;
    const sorted = [...numbers].sort((a, b) => a - b);
    const middle = Math.floor(sorted.length / 2);
    
    if (sorted.length % 2 === 0) {
      return (sorted[middle - 1] + sorted[middle]) / 2;
    }
    return sorted[middle];
  },

  // ç¯„å›²å†…ã®ä¹±æ•°ã‚’ç”Ÿæˆ
  randomInRange(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  },

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ç”Ÿæˆ
  generateProgressBar(percentage, length = 10, filledChar = 'â–ˆ', emptyChar = 'â–‘') {
    const filled = Math.round((percentage / 100) * length);
    const empty = length - filled;
    return filledChar.repeat(filled) + emptyChar.repeat(empty) + ` ${percentage}%`;
  }
};

// é…åˆ—å‡¦ç†ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
const ArrayHelpers = {
  // é…åˆ—ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
  groupBy(array, key) {
    return array.reduce((groups, item) => {
      const group = typeof key === 'function' ? key(item) : item[key];
      groups[group] = groups[group] || [];
      groups[group].push(item);
      return groups;
    }, {});
  },

  // é…åˆ—ã‚’ãƒãƒ£ãƒ³ã‚¯ï¼ˆæŒ‡å®šã‚µã‚¤ã‚ºã«åˆ†å‰²ï¼‰
  chunk(array, size) {
    const chunks = [];
    for (let i = 0; i < array.length; i += size) {
      chunks.push(array.slice(i, i + size));
    }
    return chunks;
  },

  // é…åˆ—ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  shuffle(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  },

  // é…åˆ—ã‹ã‚‰é‡è¤‡ã‚’é™¤å»
  unique(array) {
    return [...new Set(array)];
  },

  // é…åˆ—å†…ã®è¦ç´ ã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
  countOccurrences(array) {
    return array.reduce((counts, item) => {
      counts[item] = (counts[item] || 0) + 1;
      return counts;
    }, {});
  }
};

// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ˜ãƒ«ãƒ‘ãƒ¼
const ValidationHelpers = {
  // æ–‡å­—åˆ—ã®é•·ã•ã‚’ãƒã‚§ãƒƒã‚¯
  isValidLength(str, min = 1, max = 1000) {
    return str && str.length >= min && str.length <= max;
  },

  // æ•°å€¤ã®ç¯„å›²ã‚’ãƒã‚§ãƒƒã‚¯
  isInRange(num, min, max) {
    return num >= min && num <= max;
  },

  // æ—¥ä»˜ã®å¦¥å½“æ€§ã‚’ãƒã‚§ãƒƒã‚¯
  isValidDate(dateString) {
    const date = new Date(dateString);
    return date instanceof Date && !isNaN(date);
  },

  // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒç©ºã‹ãƒã‚§ãƒƒã‚¯
  isEmpty(obj) {
    return Object.keys(obj).length === 0;
  },

  // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å­˜åœ¨ã‚’ãƒã‚§ãƒƒã‚¯
  hasRequiredFields(obj, requiredFields) {
    return requiredFields.every(field => obj.hasOwnProperty(field) && obj[field] !== null && obj[field] !== undefined);
  }
};

// Discordå›ºæœ‰ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼
const DiscordHelpers = {
  // ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
  escapeMentions(text) {
    return text.replace(/@/g, '@\u200b');
  },

  // Embedã®æ–‡å­—æ•°åˆ¶é™ã‚’ãƒã‚§ãƒƒã‚¯
  validateEmbedLimits(embed) {
    const limits = {
      title: 256,
      description: 4096,
      fieldName: 256,
      fieldValue: 1024,
      footer: 2048,
      author: 256
    };

    const warnings = [];

    if (embed.title && embed.title.length > limits.title) {
      warnings.push(`ã‚¿ã‚¤ãƒˆãƒ«ãŒé•·ã™ãã¾ã™ (${embed.title.length}/${limits.title})`);
    }

    if (embed.description && embed.description.length > limits.description) {
      warnings.push(`èª¬æ˜æ–‡ãŒé•·ã™ãã¾ã™ (${embed.description.length}/${limits.description})`);
    }

    if (embed.fields) {
      embed.fields.forEach((field, index) => {
        if (field.name && field.name.length > limits.fieldName) {
          warnings.push(`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰${index + 1}ã®åå‰ãŒé•·ã™ãã¾ã™`);
        }
        if (field.value && field.value.length > limits.fieldValue) {
          warnings.push(`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰${index + 1}ã®å€¤ãŒé•·ã™ãã¾ã™`);
        }
      });
    }

    return {
      isValid: warnings.length === 0,
      warnings
    };
  },

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‹ã‚‰ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
  createUserMention(userId) {
    return `<@${userId}>`;
  },

  // ãƒãƒ£ãƒ³ãƒãƒ«IDã‹ã‚‰ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
  createChannelMention(channelId) {
    return `<#${channelId}>`;
  },

  // ãƒ­ãƒ¼ãƒ«IDã‹ã‚‰ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
  createRoleMention(roleId) {
    return `<@&${roleId}>`;
  }
};

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ˜ãƒ«ãƒ‘ãƒ¼
const ErrorHelpers = {
  // ã‚¨ãƒ©ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®‰å…¨ã«æ–‡å­—åˆ—åŒ–
  stringifyError(error) {
    return JSON.stringify(error, Object.getOwnPropertyNames(error), 2);
  },

  // ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
  cleanStackTrace(error) {
    if (!error.stack) return '';
    
    return error.stack
      .split('\n')
      .filter(line => !line.includes('node_modules'))
      .join('\n');
  },

  // ã‚¨ãƒ©ãƒ¼ã®é‡è¦åº¦ã‚’åˆ¤å®š
  getErrorSeverity(error) {
    const criticalErrors = ['ENOTFOUND', 'ECONNREFUSED', 'TokenInvalid'];
    const warningErrors = ['RateLimited', 'Timeout'];
    
    if (criticalErrors.some(code => error.message.includes(code))) {
      return 'critical';
    }
    
    if (warningErrors.some(code => error.message.includes(code))) {
      return 'warning';
    }
    
    return 'info';
  },

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
  getUserFriendlyMessage(error) {
    const messages = {
      'TokenInvalid': 'Botã®èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚',
      'RateLimited': 'æ“ä½œãŒå¤šã™ãã¾ã™ã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚',
      'Timeout': 'å‡¦ç†ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚',
      'ENOTFOUND': 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚',
      'ECONNREFUSED': 'ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã€‚'
    };

    for (const [code, message] of Object.entries(messages)) {
      if (error.message.includes(code)) {
        return message;
      }
    }

    return 'äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ç®¡ç†è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚';
  }
};

// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®šãƒ˜ãƒ«ãƒ‘ãƒ¼
const PerformanceHelpers = {
  // å®Ÿè¡Œæ™‚é–“ã‚’æ¸¬å®š
  async measureExecutionTime(asyncFunction, ...args) {
    const start = Date.now();
    const result = await asyncFunction(...args);
    const end = Date.now();
    
    return {
      result,
      executionTime: end - start
    };
  },

  // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’å–å¾—
  getMemoryUsage() {
    const usage = process.memoryUsage();
    return {
      rss: Math.round(usage.rss / 1024 / 1024), // MB
      heapTotal: Math.round(usage.heapTotal / 1024 / 1024),
      heapUsed: Math.round(usage.heapUsed / 1024 / 1024),
      external: Math.round(usage.external / 1024 / 1024)
    };
  },

  // CPUä½¿ç”¨ç‡ã‚’å–å¾—ï¼ˆç°¡æ˜“ç‰ˆï¼‰
  getCPUUsage() {
    const usage = process.cpuUsage();
    return {
      user: usage.user / 1000, // ãƒã‚¤ã‚¯ãƒ­ç§’ã‚’ãƒŸãƒªç§’ã«å¤‰æ›
      system: usage.system / 1000
    };
  }
};

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ˜ãƒ«ãƒ‘ãƒ¼
class CacheHelper {
  constructor(defaultTTL = 300000) { // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5åˆ†
    this.cache = new Map();
    this.defaultTTL = defaultTTL;
  }

  set(key, value, ttl = this.defaultTTL) {
    const expireAt = Date.now() + ttl;
    this.cache.set(key, { value, expireAt });
  }

  get(key) {
    const item = this.cache.get(key);
    
    if (!item) return null;
    
    if (Date.now() > item.expireAt) {
      this.cache.delete(key);
      return null;
    }
    
    return item.value;
  }

  has(key) {
    return this.get(key) !== null;
  }

  delete(key) {
    return this.cache.delete(key);
  }

  clear() {
    this.cache.clear();
  }

  // æœŸé™åˆ‡ã‚Œã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤
  cleanup() {
    const now = Date.now();
    for (const [key, item] of this.cache.entries()) {
      if (now > item.expireAt) {
        this.cache.delete(key);
      }
    }
  }

  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±è¨ˆã‚’å–å¾—
  getStats() {
    return {
      size: this.cache.size,
      keys: Array.from(this.cache.keys())
    };
  }
}

// è¨­å®šãƒ˜ãƒ«ãƒ‘ãƒ¼
const ConfigHelpers = {
  // ç’°å¢ƒå¤‰æ•°ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
  checkRequiredEnvVars(requiredVars) {
    const missing = requiredVars.filter(varName => !process.env[varName]);
    
    if (missing.length > 0) {
      throw new Error(`å¿…é ˆã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“: ${missing.join(', ')}`);
    }
    
    return true;
  },

  // ç’°å¢ƒå¤‰æ•°ã‚’å®‰å…¨ã«å–å¾—
  getEnvVar(name, defaultValue = null) {
    return process.env[name] || defaultValue;
  },

  // Booleanå‹ã®ç’°å¢ƒå¤‰æ•°ã‚’å–å¾—
  getBooleanEnvVar(name, defaultValue = false) {
    const value = process.env[name];
    if (!value) return defaultValue;
    
    return ['true', '1', 'yes', 'on'].includes(value.toLowerCase());
  },

  // æ•°å€¤å‹ã®ç’°å¢ƒå¤‰æ•°ã‚’å–å¾—
  getNumberEnvVar(name, defaultValue = 0) {
    const value = process.env[name];
    if (!value) return defaultValue;
    
    const parsed = parseInt(value, 10);
    return isNaN(parsed) ? defaultValue : parsed;
  }
};

// ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
module.exports = {
  DateHelpers,
  StringHelpers,
  NumberHelpers,
  ArrayHelpers,
  ValidationHelpers,
  DiscordHelpers,
  ErrorHelpers,
  PerformanceHelpers,
  CacheHelper,
  ConfigHelpers,

  // ã‚ˆãä½¿ã‚ã‚Œã‚‹é–¢æ•°ã‚’ç›´æ¥ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  formatDate: DateHelpers.getCurrentDateJST,
  truncate: StringHelpers.truncate,
  percentage: NumberHelpers.calculatePercentage,
  progressBar: NumberHelpers.generateProgressBar,
  groupBy: ArrayHelpers.groupBy,
  isValidLength: ValidationHelpers.isValidLength,
  escapeMentions: DiscordHelpers.escapeMentions,
  measureTime: PerformanceHelpers.measureExecutionTime
};

```

### utils/logger.js

```
const fs = require('fs');
const path = require('path');

class Logger {
  constructor() {
    this.logDir = path.join(__dirname, '..', 'logs');
    this.ensureLogDirectory();
  }

  ensureLogDirectory() {
    if (!fs.existsSync(this.logDir)) {
      fs.mkdirSync(this.logDir, { recursive: true });
    }
  }

  formatTimestamp() {
    return new Date().toISOString();
  }

  formatMessage(level, message, meta = {}) {
    const timestamp = this.formatTimestamp();
    const metaStr = Object.keys(meta).length > 0 ? ` | ${JSON.stringify(meta)}` : '';
    return `[${timestamp}] [${level.toUpperCase()}] ${message}${metaStr}`;
  }

  writeToFile(filename, message) {
    const filePath = path.join(this.logDir, filename);
    const logEntry = message + '\n';
    
    try {
      fs.appendFileSync(filePath, logEntry);
    } catch (error) {
      console.error('ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  info(message, meta = {}) {
    const formattedMessage = this.formatMessage('info', message, meta);
    console.log(`â„¹ï¸  ${formattedMessage}`);
    this.writeToFile('info.log', formattedMessage);
  }

  warn(message, meta = {}) {
    const formattedMessage = this.formatMessage('warn', message, meta);
    console.warn(`âš ï¸  ${formattedMessage}`);
    this.writeToFile('warn.log', formattedMessage);
  }

  error(message, error = null, meta = {}) {
    const errorInfo = error ? {
      name: error.name,
      message: error.message,
      stack: error.stack,
      ...meta
    } : meta;
    
    const formattedMessage = this.formatMessage('error', message, errorInfo);
    console.error(`âŒ ${formattedMessage}`);
    this.writeToFile('error.log', formattedMessage);
  }

  debug(message, meta = {}) {
    if (process.env.NODE_ENV === 'development') {
      const formattedMessage = this.formatMessage('debug', message, meta);
      console.debug(`ğŸ› ${formattedMessage}`);
      this.writeToFile('debug.log', formattedMessage);
    }
  }

  command(commandName, userId, guildId, success = true, executionTime = null) {
    const meta = {
      command: commandName,
      user: userId,
      guild: guildId,
      success,
      executionTime: executionTime ? `${executionTime}ms` : null
    };
    
    const message = `Command ${commandName} ${success ? 'completed' : 'failed'}`;
    
    if (success) {
      this.info(message, meta);
    } else {
      this.warn(message, meta);
    }
    
    this.writeToFile('commands.log', this.formatMessage('command', message, meta));
  }

  sheets(operation, success = true, error = null) {
    const meta = {
      operation,
      success,
      error: error ? error.message : null
    };
    
    const message = `Google Sheets ${operation} ${success ? 'succeeded' : 'failed'}`;
    
    if (success) {
      this.info(message, meta);
    } else {
      this.error(message, error, meta);
    }
  }

  notification(type, recipient, success = true) {
    const meta = {
      type,
      recipient,
      success
    };
    
    const message = `Notification ${type} ${success ? 'sent' : 'failed'}`;
    this.info(message, meta);
    this.writeToFile('notifications.log', this.formatMessage('notification', message, meta));
  }

  // ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†
  cleanOldLogs(daysToKeep = 30) {
    try {
      const files = fs.readdirSync(this.logDir);
      const cutoffDate = new Date();
      cutoffDate.setDate(cutoffDate.getDate() - daysToKeep);

      for (const file of files) {
        const filePath = path.join(this.logDir, file);
        const stats = fs.statSync(filePath);
        
        if (stats.mtime < cutoffDate) {
          fs.unlinkSync(filePath);
          this.info(`å¤ã„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤: ${file}`);
        }
      }
    } catch (error) {
      this.error('ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç†ã‚¨ãƒ©ãƒ¼', error);
    }
  }
}

// ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
const logger = new Logger();

module.exports = logger;

```

### utils/formatUtils.js

```
/**
 * ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */

/**
 * æ•°å€¤ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰
 */
function formatNumber(num) {
  return new Intl.NumberFormat('ja-JP').format(num);
}

/**
 * ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ç”Ÿæˆ
 * @param {number} percentage - é€²æ—ç‡ï¼ˆ0-100ï¼‰
 * @param {number} length - ãƒãƒ¼ã®é•·ã•ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰
 * @returns {string} ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
 */
function getProgressBar(percentage, length = 10) {
  const filled = Math.round((percentage / 100) * length);
  const empty = length - filled;
  
  const filledBar = 'â–ˆ'.repeat(filled);
  const emptyBar = 'â–‘'.repeat(empty);
  
  return `${filledBar}${emptyBar}`;
}

/**
 * æ®‹ã‚Šæ™‚é–“ã‚’å–å¾—
 * @param {string} period - 'weekly' ã¾ãŸã¯ 'monthly'
 * @returns {string} æ®‹ã‚Šæ™‚é–“ã®æ–‡å­—åˆ—
 */
function getTimeRemaining(period) {
  const now = new Date();
  
  if (period === 'weekly') {
    // ä»Šé€±ã®æ—¥æ›œæ—¥ã‚’å–å¾—
    const sunday = new Date(now);
    sunday.setDate(now.getDate() - now.getDay() + 7);
    sunday.setHours(23, 59, 59, 999);
    
    const timeDiff = sunday.getTime() - now.getTime();
    const daysRemaining = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
    
    if (daysRemaining === 1) {
      return 'ä»Šæ—¥ã¾ã§';
    } else if (daysRemaining === 2) {
      return 'æ˜æ—¥ã¾ã§';
    } else {
      return `ã‚ã¨${daysRemaining - 1}æ—¥`;
    }
  } else if (period === 'monthly') {
    // ä»Šæœˆã®æœ€çµ‚æ—¥ã‚’å–å¾—
    const lastDay = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    lastDay.setHours(23, 59, 59, 999);
    
    const timeDiff = lastDay.getTime() - now.getTime();
    const daysRemaining = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
    
    if (daysRemaining === 1) {
      return 'ä»Šæ—¥ã¾ã§';
    } else if (daysRemaining === 2) {
      return 'æ˜æ—¥ã¾ã§';
    } else {
      return `ã‚ã¨${daysRemaining}æ—¥`;
    }
  }
  
  return '';
}

/**
 * æœŸé–“ã®è¡¨ç¤ºåã‚’å–å¾—
 */
function getPeriodDisplayName(period) {
  const names = {
    weekly: 'é€±æ¬¡',
    monthly: 'æœˆæ¬¡',
    daily: 'æ—¥æ¬¡',
    yearly: 'å¹´æ¬¡'
  };
  return names[period] || period;
}

/**
 * ã‚«ãƒ†ã‚´ãƒªã®è¡¨ç¤ºåã‚’å–å¾—
 */
function getCategoryDisplayName(category) {
  const names = {
    books: 'ğŸ“š æœ¬',
    movies: 'ğŸ¬ æ˜ ç”»',
    activities: 'ğŸ¯ æ´»å‹•',
    reports: 'ğŸ“ æ—¥å ±'
  };
  return names[category] || category;
}

/**
 * æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
 * @param {Date} date - æ—¥ä»˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * @param {string} format - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå½¢å¼
 * @returns {string} ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸæ—¥ä»˜æ–‡å­—åˆ—
 */
function formatDate(date, format = 'YYYY/MM/DD') {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  const hours = String(date.getHours()).padStart(2, '0');
  const minutes = String(date.getMinutes()).padStart(2, '0');
  
  switch (format) {
    case 'YYYY/MM/DD':
      return `${year}/${month}/${day}`;
    case 'MM/DD':
      return `${month}/${day}`;
    case 'YYYY/MM/DD HH:mm':
      return `${year}/${month}/${day} ${hours}:${minutes}`;
    case 'relative':
      return getRelativeTime(date);
    default:
      return date.toLocaleDateString('ja-JP');
  }
}

/**
 * ç›¸å¯¾æ™‚é–“ã‚’å–å¾—ï¼ˆä¾‹: 2æ™‚é–“å‰ã€3æ—¥å‰ï¼‰
 */
function getRelativeTime(date) {
  const now = new Date();
  const diff = now.getTime() - date.getTime();
  
  const seconds = Math.floor(diff / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  const days = Math.floor(hours / 24);
  const weeks = Math.floor(days / 7);
  const months = Math.floor(days / 30);
  
  if (months > 0) return `${months}ãƒ¶æœˆå‰`;
  if (weeks > 0) return `${weeks}é€±é–“å‰`;
  if (days > 0) return `${days}æ—¥å‰`;
  if (hours > 0) return `${hours}æ™‚é–“å‰`;
  if (minutes > 0) return `${minutes}åˆ†å‰`;
  return 'ä»Š';
}

/**
 * ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’çµµæ–‡å­—ã§è¡¨ç¾
 */
function getPercentageEmoji(percentage) {
  if (percentage >= 100) return 'ğŸ‰';
  if (percentage >= 90) return 'ğŸ”¥';
  if (percentage >= 75) return 'ğŸ’ª';
  if (percentage >= 50) return 'ğŸ“ˆ';
  if (percentage >= 25) return 'ğŸš€';
  return 'ğŸ“';
}

/**
 * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®çµµæ–‡å­—ã‚’å–å¾—
 */
function getStatusEmoji(status) {
  const emojis = {
    completed: 'âœ…',
    in_progress: 'ğŸ”„',
    planned: 'ğŸ“…',
    cancelled: 'âŒ',
    on_hold: 'â¸ï¸'
  };
  return emojis[status] || 'â“';
}

module.exports = {
  formatNumber,
  getProgressBar,
  getTimeRemaining,
  getPeriodDisplayName,
  getCategoryDisplayName,
  formatDate,
  getRelativeTime,
  getPercentageEmoji,
  getStatusEmoji
};

```

### utils/dateUtils.js

```
/**
 * æ—¥ä»˜æ“ä½œãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 */

/**
 * é€±ã®é–‹å§‹æ—¥ï¼ˆæœˆæ›œæ—¥ï¼‰ã‚’å–å¾—
 * @param {Date} date - åŸºæº–æ—¥
 * @returns {Date} é€±ã®é–‹å§‹æ—¥
 */
function getWeekStart(date = new Date()) {
  const d = new Date(date);
  const day = d.getDay();
  const diff = d.getDate() - day + (day === 0 ? -6 : 1); // æœˆæ›œæ—¥ã‚’é€±ã®é–‹å§‹ã¨ã™ã‚‹
  const weekStart = new Date(d.setDate(diff));
  weekStart.setHours(0, 0, 0, 0);
  return weekStart;
}

/**
 * é€±ã®çµ‚äº†æ—¥ï¼ˆæ—¥æ›œæ—¥ï¼‰ã‚’å–å¾—
 * @param {Date} date - åŸºæº–æ—¥
 * @returns {Date} é€±ã®çµ‚äº†æ—¥
 */
function getWeekEnd(date = new Date()) {
  const weekStart = getWeekStart(date);
  const weekEnd = new Date(weekStart);
  weekEnd.setDate(weekStart.getDate() + 6);
  weekEnd.setHours(23, 59, 59, 999);
  return weekEnd;
}

/**
 * æœˆã®é–‹å§‹æ—¥ã‚’å–å¾—
 * @param {Date} date - åŸºæº–æ—¥
 * @returns {Date} æœˆã®é–‹å§‹æ—¥
 */
function getMonthStart(date = new Date()) {
  const d = new Date(date);
  const monthStart = new Date(d.getFullYear(), d.getMonth(), 1);
  monthStart.setHours(0, 0, 0, 0);
  return monthStart;
}

/**
 * æœˆã®çµ‚äº†æ—¥ã‚’å–å¾—
 * @param {Date} date - åŸºæº–æ—¥
 * @returns {Date} æœˆã®çµ‚äº†æ—¥
 */
function getMonthEnd(date = new Date()) {
  const d = new Date(date);
  const monthEnd = new Date(d.getFullYear(), d.getMonth() + 1, 0);
  monthEnd.setHours(23, 59, 59, 999);
  return monthEnd;
}

/**
 * å¹´ã®é–‹å§‹æ—¥ã‚’å–å¾—
 * @param {Date} date - åŸºæº–æ—¥
 * @returns {Date} å¹´ã®é–‹å§‹æ—¥
 */
function getYearStart(date = new Date()) {
  const d = new Date(date);
  const yearStart = new Date(d.getFullYear(), 0, 1);
  yearStart.setHours(0, 0, 0, 0);
  return yearStart;
}

/**
 * å¹´ã®çµ‚äº†æ—¥ã‚’å–å¾—
 * @param {Date} date - åŸºæº–æ—¥
 * @returns {Date} å¹´ã®çµ‚äº†æ—¥
 */
function getYearEnd(date = new Date()) {
  const d = new Date(date);
  const yearEnd = new Date(d.getFullYear(), 11, 31);
  yearEnd.setHours(23, 59, 59, 999);
  return yearEnd;
}

/**
 * æŒ‡å®šã—ãŸæ—¥ä»˜ãŒä»Šé€±ã‹ã©ã†ã‹ã‚’åˆ¤å®š
 * @param {Date} date - åˆ¤å®šå¯¾è±¡ã®æ—¥ä»˜
 * @returns {boolean} ä»Šé€±ã‹ã©ã†ã‹
 */
function isThisWeek(date) {
  const now = new Date();
  const weekStart = getWeekStart(now);
  const weekEnd = getWeekEnd(now);
  return date >= weekStart && date <= weekEnd;
}

/**
 * æŒ‡å®šã—ãŸæ—¥ä»˜ãŒä»Šæœˆã‹ã©ã†ã‹ã‚’åˆ¤å®š
 * @param {Date} date - åˆ¤å®šå¯¾è±¡ã®æ—¥ä»˜
 * @returns {boolean} ä»Šæœˆã‹ã©ã†ã‹
 */
function isThisMonth(date) {
  const now = new Date();
  const monthStart = getMonthStart(now);
  const monthEnd = getMonthEnd(now);
  return date >= monthStart && date <= monthEnd;
}

/**
 * æŒ‡å®šã—ãŸæ—¥ä»˜ãŒä»Šå¹´ã‹ã©ã†ã‹ã‚’åˆ¤å®š
 * @param {Date} date - åˆ¤å®šå¯¾è±¡ã®æ—¥ä»˜
 * @returns {boolean} ä»Šå¹´ã‹ã©ã†ã‹
 */
function isThisYear(date) {
  const now = new Date();
  return date.getFullYear() === now.getFullYear();
}

/**
 * æŒ‡å®šã—ãŸæ—¥ä»˜ãŒä»Šæ—¥ã‹ã©ã†ã‹ã‚’åˆ¤å®š
 * @param {Date} date - åˆ¤å®šå¯¾è±¡ã®æ—¥ä»˜
 * @returns {boolean} ä»Šæ—¥ã‹ã©ã†ã‹
 */
function isToday(date) {
  const now = new Date();
  return date.toDateString() === now.toDateString();
}

/**
 * 2ã¤ã®æ—¥ä»˜ã®å·®ã‚’æ—¥æ•°ã§å–å¾—
 * @param {Date} date1 - é–‹å§‹æ—¥
 * @param {Date} date2 - çµ‚äº†æ—¥
 * @returns {number} æ—¥æ•°ã®å·®
 */
function getDaysDifference(date1, date2) {
  const oneDay = 24 * 60 * 60 * 1000;
  return Math.round((date2.getTime() - date1.getTime()) / oneDay);
}

/**
 * æŒ‡å®šã—ãŸæ—¥æ•°å‰ã®æ—¥ä»˜ã‚’å–å¾—
 * @param {number} days - æ—¥æ•°
 * @param {Date} fromDate - åŸºæº–æ—¥ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ä»Šæ—¥ï¼‰
 * @returns {Date} æŒ‡å®šæ—¥æ•°å‰ã®æ—¥ä»˜
 */
function getDaysAgo(days, fromDate = new Date()) {
  const date = new Date(fromDate);
  date.setDate(date.getDate() - days);
  return date;
}

/**
 * æŒ‡å®šã—ãŸæ—¥æ•°å¾Œã®æ—¥ä»˜ã‚’å–å¾—
 * @param {number} days - æ—¥æ•°
 * @param {Date} fromDate - åŸºæº–æ—¥ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ä»Šæ—¥ï¼‰
 * @returns {Date} æŒ‡å®šæ—¥æ•°å¾Œã®æ—¥ä»˜
 */
function getDaysLater(days, fromDate = new Date()) {
  const date = new Date(fromDate);
  date.setDate(date.getDate() + days);
  return date;
}

/**
 * æ—¥ä»˜ã‚’ ISO æ–‡å­—åˆ—ï¼ˆYYYY-MM-DDï¼‰ã«å¤‰æ›
 * @param {Date} date - æ—¥ä»˜
 * @returns {string} ISOæ–‡å­—åˆ—
 */
function toISODateString(date) {
  return date.toISOString().split('T')[0];
}

/**
 * ISOæ–‡å­—åˆ—ã‹ã‚‰æ—¥ä»˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
 * @param {string} isoString - ISOæ–‡å­—åˆ—
 * @returns {Date} æ—¥ä»˜ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 */
function fromISODateString(isoString) {
  return new Date(isoString + 'T00:00:00.000Z');
}

/**
 * æ—¥ä»˜ãŒæœ‰åŠ¹ã‹ã©ã†ã‹ã‚’åˆ¤å®š
 * @param {Date} date - åˆ¤å®šå¯¾è±¡ã®æ—¥ä»˜
 * @returns {boolean} æœ‰åŠ¹ãªæ—¥ä»˜ã‹ã©ã†ã‹
 */
function isValidDate(date) {
  return date instanceof Date && !isNaN(date.getTime());
}

/**
 * æ—¥ä»˜ã‚’å®‰å…¨ã«ãƒ‘ãƒ¼ã‚¹
 * @param {string|Date} dateInput - æ—¥ä»˜ã®å…¥åŠ›
 * @returns {Date|null} ãƒ‘ãƒ¼ã‚¹ã•ã‚ŒãŸæ—¥ä»˜ã¾ãŸã¯null
 */
function safeParseDate(dateInput) {
  if (dateInput instanceof Date) {
    return isValidDate(dateInput) ? dateInput : null;
  }
  
  if (typeof dateInput === 'string') {
    const parsed = new Date(dateInput);
    return isValidDate(parsed) ? parsed : null;
  }
  
  return null;
}

module.exports = {
  getWeekStart,
  getWeekEnd,
  getMonthStart,
  getMonthEnd,
  getYearStart,
  getYearEnd,
  isThisWeek,
  isThisMonth,
  isThisYear,
  isToday,
  getDaysDifference,
  getDaysAgo,
  getDaysLater,
  toISODateString,
  fromISODateString,
  isValidDate,
  safeParseDate
};

```

### packeage.json

```
{
  "name": "activity-tracker-bot",
  "version": "2.0.0",
  "description": "Discord bot for tracking books, movies, and activities with Google Sheets integration",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "dev": "nodemon index.js",
    "test": "jest",
    "test:watch": "jest --watch",
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "deploy": "node scripts/deploy.js",
    "logs": "tail -f logs/*.log",
    "clean-logs": "node scripts/clean-logs.js"
  },
  "keywords": [
    "discord",
    "bot",
    "activity-tracker",
    "books",
    "movies",
    "productivity",
    "google-sheets",
    "habit-tracker"
  ],
  "author": "Your Name <your.email@example.com>",
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/yourusername/activity-tracker-bot.git"
  },
  "bugs": {
    "url": "https://github.com/yourusername/activity-tracker-bot/issues"
  },
  "homepage": "https://github.com/yourusername/activity-tracker-bot#readme",
  "engines": {
    "node": ">=16.0.0",
    "npm": ">=8.0.0"
  },
  "dependencies": {
    "discord.js": "^14.14.1",
    "dotenv": "^16.3.1",
    "googleapis": "^126.0.1",
    "node-cron": "^3.0.3"
  },
  "devDependencies": {
    "nodemon": "^3.0.2",
    "eslint": "^8.56.0",
    "jest": "^29.7.0",
    "@types/node": "^20.10.5"
  },
  "jest": {
    "testEnvironment": "node",
    "collectCoverage": true,
    "coverageDirectory": "coverage",
    "coverageReporters": ["text", "lcov", "html"],
    "testMatch": [
      "**/tests/**/*.test.js",
      "**/tests/**/*.spec.js"
    ]
  },
  "eslintConfig": {
    "env": {
      "node": true,
      "es2021": true,
      "jest": true
    },
    "extends": "eslint:recommended",
    "parserOptions": {
      "ecmaVersion": "latest",
      "sourceType": "module"
    },
    "rules": {
      "no-console": "off",
      "no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
      "prefer-const": "error",
      "no-var": "error"
    }
  },
  "nodemonConfig": {
    "watch": [
      "."
    ],
    "ext": "js,json",
    "ignore": [
      "node_modules/",
      "logs/",
      "coverage/",
      "*.test.js"
    ],
    "env": {
      "NODE_ENV": "development"
    }
  }
}

```

### update_handlers_for_sheets.js

```
const fs = require('fs');

console.log('ğŸ”„ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’Google Sheetsé€£æºç‰ˆã«æ›´æ–°ä¸­...');

// bookHandler.jsã‚’å®Ÿãƒ‡ãƒ¼ã‚¿ç‰ˆã«æ›´æ–°
const bookHandlerContent = `const { EmbedBuilder } = require('discord.js');
const googleSheets = require('../services/googleSheets');

module.exports = {
  async execute(interaction) {
    const subcommand = interaction.options.getSubcommand();
    
    try {
      switch (subcommand) {
        case 'add':
          await this.handleAdd(interaction);
          break;
        case 'buy':
          await this.handleBuy(interaction);
          break;
        case 'start':
          await this.handleStart(interaction);
          break;
        case 'finish':
          await this.handleFinish(interaction);
          break;
        case 'list':
          await this.handleList(interaction);
          break;
        case 'wishlist':
          await this.handleWishlist(interaction);
          break;
        default:
          await interaction.editReply(\`âŒ ä¸æ˜ãªã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰: \${subcommand}\`);
      }
    } catch (error) {
      console.error('BookHandler ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
  },

  async handleAdd(interaction) {
    const title = interaction.options.getString('title');
    const author = interaction.options.getString('author');
    const status = interaction.options.getString('status') || 'want_to_read';
    const memo = interaction.options.getString('memo') || '';
    
    try {
      // Google Sheetsã«å®Ÿéš›ã«ä¿å­˜
      const bookId = await googleSheets.addBook(title, author, status, memo);
      
      const statusText = {
        'want_to_buy': 'è²·ã„ãŸã„',
        'want_to_read': 'ç©ã‚“ã§ã„ã‚‹'
      };
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“š æœ¬ã‚’è¿½åŠ ã—ã¾ã—ãŸï¼')
        .setColor('#4CAF50')
        .addFields(
          { name: 'ID', value: bookId.toString(), inline: true },
          { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: title, inline: true },
          { name: 'ä½œè€…', value: author, inline: true },
          { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: statusText[status], inline: true }
        )
        .setTimestamp();
      
      if (memo) {
        embed.addFields({ name: 'å‚™è€ƒ', value: memo, inline: false });
      }
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æœ¬è¿½åŠ ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('æœ¬ã®è¿½åŠ ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
  },

  async handleList(interaction) {
    try {
      // Google Sheetsã‹ã‚‰å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const books = await googleSheets.getBooks();
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ“š æœ¬ä¸€è¦§')
        .setColor('#9C27B0')
        .setDescription(books.length > 0 ? books.join('\\n') : 'ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹æœ¬ã¯ã‚ã‚Šã¾ã›ã‚“')
        .setFooter({ text: 'è©³ç´°ã¯å„IDã§æ“ä½œã—ã¦ãã ã•ã„' })
        .setTimestamp();
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('æœ¬ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('æœ¬ä¸€è¦§ã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
  },

  async handleWishlist(interaction) {
    try {
      // Google Sheetsã‹ã‚‰è²·ã„ãŸã„æœ¬ã®ã¿ã‚’å–å¾—
      const wishlistBooks = await googleSheets.getWishlistBooks();
      
      const embed = new EmbedBuilder()
        .setTitle('ğŸ›’ è²·ã„ãŸã„æœ¬ä¸€è¦§')
        .setColor('#E91E63')
        .setDescription(
          wishlistBooks.length > 0 
            ? wishlistBooks.join('\\n') 
            : 'è²·ã„ãŸã„æœ¬ã¯ã‚ã‚Šã¾ã›ã‚“'
        )
        .setFooter({ text: 'è³¼å…¥ã—ãŸã‚‰ /book buy [ID] ã§ç©èª­ãƒªã‚¹ãƒˆã«ç§»å‹•ã§ãã¾ã™' })
        .setTimestamp();
      
      await interaction.editReply({ embeds: [embed] });
    } catch (error) {
      console.error('ã‚¦ã‚£ãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('ã‚¦ã‚£ãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã®å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
  },

  // ä»–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯çœç•¥ï¼ˆGoogle Sheetsé€£æºã‚’å«ã‚€ï¼‰
  async handleBuy(interaction) {
    const buyId = interaction.options.getInteger('id');
    
    try {
      const boughtBook = await googleSheets.buyBook(buyId);
      
      if (boughtBook) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ›’ æœ¬ã‚’è³¼å…¥ã—ã¾ã—ãŸï¼')
          .setColor('#2196F3')
          .setDescription('ç©èª­ãƒªã‚¹ãƒˆã«è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼ğŸ“šâœ¨')
          .addFields(
            { name: 'ID', value: boughtBook.id.toString(), inline: true },
            { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: boughtBook.title, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: 'è²·ã„ãŸã„ â†’ ç©èª­', inline: true }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        await interaction.editReply('æŒ‡å®šã•ã‚ŒãŸIDã®æœ¬ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€æ—¢ã«è³¼å…¥æ¸ˆã¿ã§ã™ã€‚');
      }
    } catch (error) {
      console.error('æœ¬è³¼å…¥ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('æœ¬ã®è³¼å…¥ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
  },

  async handleStart(interaction) {
    const startId = interaction.options.getInteger('id');
    
    try {
      const startedBook = await googleSheets.startReading(startId);
      
      if (startedBook) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ“– èª­æ›¸é–‹å§‹ï¼')
          .setColor('#FF9800')
          .setDescription('é ‘å¼µã£ã¦èª­ã¿é€²ã‚ã¾ã—ã‚‡ã†ï¼âœ¨')
          .addFields(
            { name: 'ID', value: startedBook.id.toString(), inline: true },
            { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: startedBook.title, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: 'ç©èª­ â†’ èª­æ›¸ä¸­', inline: true }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        await interaction.editReply('æŒ‡å®šã•ã‚ŒãŸIDã®æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
      }
    } catch (error) {
      console.error('èª­æ›¸é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('èª­æ›¸é–‹å§‹ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
  },

  async handleFinish(interaction) {
    const finishId = interaction.options.getInteger('id');
    
    try {
      const finishedBook = await googleSheets.finishReading(finishId);
      
      if (finishedBook) {
        const embed = new EmbedBuilder()
          .setTitle('ğŸ‰ èª­äº†ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼')
          .setColor('#FFD700')
          .setDescription('ç´ æ™´ã‚‰ã—ã„é”æˆæ„Ÿã§ã™ã­ï¼æ¬¡ã®æœ¬ã‚‚æ¥½ã—ã¿ã§ã™ğŸ“šâœ¨')
          .addFields(
            { name: 'ID', value: finishedBook.id.toString(), inline: true },
            { name: 'ã‚¿ã‚¤ãƒˆãƒ«', value: finishedBook.title, inline: true },
            { name: 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹', value: 'èª­æ›¸ä¸­ â†’ èª­äº†', inline: true }
          )
          .setTimestamp();
        
        await interaction.editReply({ embeds: [embed] });
      } else {
        await interaction.editReply('æŒ‡å®šã•ã‚ŒãŸIDã®æœ¬ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
      }
    } catch (error) {
      console.error('èª­äº†è¨˜éŒ²ã‚¨ãƒ©ãƒ¼:', error);
      await interaction.editReply('èª­äº†è¨˜éŒ²ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
  }
};`;

fs.writeFileSync('handlers/bookHandler.js', bookHandlerContent);
console.log('âœ… bookHandler.js ã‚’å®Ÿãƒ‡ãƒ¼ã‚¿ç‰ˆã«æ›´æ–°ã—ã¾ã—ãŸ');

```

